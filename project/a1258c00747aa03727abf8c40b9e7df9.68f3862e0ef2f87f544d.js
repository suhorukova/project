(self.webpackChunkvk=self.webpackChunkvk||[]).push([[43639],{686478:(e,t,i)=>{"use strict";i.d(t,{default:()=>r});const r=(0,i(379333).makeIcon)("Icon24Gift","gift_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="gift_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M21 10v2a1 1 0 0 1-1 1h-1v6.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 5 19.5V13h1-2a1 1 0 0 1-1-1v-2a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2Zm-8 3h6v2h-6v7h-2v-7H5v-2h6V8h2v5Zm-1-5C9 8 5.5 7 5.5 5.5s2-3 3.5-2.5c1 .333 2 2 3 5 1-3 2-4.667 3-5 1.5-.5 3.5 1 3.5 2.5S15 8 12 8Z" fill="currentColor" /></g></symbol>',24,24)},890803:(e,t,i)=>{"use strict";function r(){return{icon:'<svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M6 12A6 6 0 1 0 6 0a6 6 0 0 0 0 12z" fill="#99a2ad"/><path clip-rule="evenodd" d="M8.78 3.97c.3.3.3.77 0 1.06L5.53 8.28c-.3.3-.77.3-1.06 0L3.22 7.03a.75.75 0 0 1 1.06-1.06l.72.72 2.72-2.72c.3-.3.77-.3 1.06 0z" fill="#fff" fill-rule="evenodd"/></svg>',name:"check_circle_fill_12"}}i.d(t,{getIcon12CheckCircleFill:()=>r})},728638:(e,t,i)=>{"use strict";function r(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="m7.22 3.38.01-.03a4.15 4.15 0 0 1 .17-.48c.36-.82.95-1.29 1.86-1.36l.16-.01h1.21c1.05.03 1.74.6 2.1 1.7l.05.18.05.16c.01.07.03.14.06.2l.05.14.03.02.06-.02.11-.04.14-.06a5.36 5.36 0 0 1 .17-.08l.03-.01a4.23 4.23 0 0 1 .43-.15c.93-.27 1.68-.08 2.32.61l.1.13.72.88c.63.83.61 1.72 0 2.68l-.12.16-.1.14-.12.18-.06.1-.03.05v.02l.08.05.11.06.13.08c1.21.61 1.71 1.42 1.52 2.54l-.03.16-.22.92c-.13.59-.24.87-.67 1.25a2.13 2.13 0 0 1-1.05.52h-.01a3.92 3.92 0 0 1-.44.06l-.2.02H15.63l-.16.01-.16.02.01.13.01.08.03.15c.07.32.1.62.1.9a2.04 2.04 0 0 1-1.13 1.87l-.15.08-1.02.5c-.9.4-1.72.23-2.48-.47a3.93 3.93 0 0 1-.15-.14l-.13-.14-.11-.13a2.94 2.94 0 0 0-.15-.17l-.09-.08-.04-.04-.08.08-.09.1-.1.1c-.83.99-1.7 1.34-2.77.93l-.15-.06-.91-.45-.28-.13a1.78 1.78 0 0 1-.87-.92 2.15 2.15 0 0 1-.2-1.01v-.02c0-.19.02-.39.06-.6l.04-.2.04-.2.01-.15-.1-.02-.12-.01h-.15a4.14 4.14 0 0 1-.86-.1h-.01a2.05 2.05 0 0 1-1.61-1.53l-.05-.16-.25-1.1c-.2-1.03.2-1.82 1.19-2.41l.17-.1.15-.08.19-.1.13-.1v-.01l-.05-.1-.07-.1-.09-.13a5.2 5.2 0 0 1-.29-.42c-.54-.9-.53-1.72.05-2.52l.1-.14.72-.87c.68-.8 1.56-.96 2.64-.56l.18.08.16.07a2.9 2.9 0 0 0 .19.08l.12.04.03-.02.03-.07.04-.12.04-.15.04-.16Zm4.24.84.01.04.05.14a1.5 1.5 0 0 0 .75.83l.03.01a1.5 1.5 0 0 0 1.13.08l.06-.02a1.47 1.47 0 0 0 .07-.02l.12-.04.06-.03.13-.06.04-.01a2.7 2.7 0 0 1 .41-.16c.27-.08.41-.06.47-.04.06.01.16.05.32.22l.07.09.69.84c.13.18.15.29.15.35 0 .09-.03.27-.23.58l-.08.12-.08.1a4.4 4.4 0 0 0-.18.27l-.02.02-.06.1v.01l-.01.02-.03.05a1.5 1.5 0 0 0-.18 1.06v.01a1.5 1.5 0 0 0 .65.96l.08.05.05.04.1.06.07.03.13.08.04.01c.45.24.62.43.67.52.04.06.09.16.04.42l-.02.12-.2.89c-.07.28-.1.35-.11.37h-.01a.97.97 0 0 1-.1.11.65.65 0 0 1-.36.16 2.36 2.36 0 0 1-.25.04h-.16l-.13.01h-.08a4.55 4.55 0 0 0-.28.02l-.15.02a1.5 1.5 0 0 0-1.32 1.63l.01.12v.07l.02.09.01.06.03.15v.05c.06.23.07.42.07.55 0 .2-.04.3-.07.35a.72.72 0 0 1-.28.24l-.1.05-.98.47c-.2.1-.32.09-.38.07-.08-.01-.23-.06-.46-.28a2.38 2.38 0 0 1-.08-.07l-.1-.1-.09-.11a4.39 4.39 0 0 0-.21-.24l-.02-.01-.08-.09a1.43 1.43 0 0 0-.04-.03l-.04-.04a1.5 1.5 0 0 0-2.05.01l-.08.08a1.43 1.43 0 0 0-.04.04l-.1.1a1.53 1.53 0 0 0-.04.04l-.1.12-.03.03c-.31.37-.53.5-.64.53-.08.03-.19.05-.42-.03l-.1-.04-.86-.42-.24-.12a1.19 1.19 0 0 1-.13-.08v-.01a1.08 1.08 0 0 1-.09-.15.67.67 0 0 1-.06-.34l.04-.36.04-.18a4.38 4.38 0 0 0 .06-.35l.01-.15a1.5 1.5 0 0 0-.43-1.22 1.5 1.5 0 0 0-.86-.43h-.1a1.4 1.4 0 0 0-.06-.02h-.13a1.54 1.54 0 0 0-.06-.01h-.19a2.66 2.66 0 0 1-.55-.07c-.22-.05-.3-.11-.35-.15a.7.7 0 0 1-.17-.32L3.26 12l-.24-1.05c-.04-.22 0-.33.02-.38.04-.08.15-.23.46-.42l.13-.08.12-.06a4.43 4.43 0 0 0 .31-.18l.14-.09a1.5 1.5 0 0 0 .65-.94v-.02a1.5 1.5 0 0 0-.17-1.07l-.05-.09a1.49 1.49 0 0 0-.04-.06l-.07-.11a1.5 1.5 0 0 0-.04-.06l-.09-.12a1.52 1.52 0 0 0-.02-.03c-.31-.4-.37-.65-.38-.76 0-.06 0-.18.15-.4L4.2 6l.68-.83c.16-.18.27-.21.33-.23.1-.02.28-.03.63.1l.13.06.13.05a4.42 4.42 0 0 0 .31.13l.12.04a1.5 1.5 0 0 0 1.14-.05l.03-.02a1.5 1.5 0 0 0 .76-.82l.03-.08.02-.07.04-.12.02-.06.04-.14.01-.04.03-.12.12-.32c.1-.23.19-.32.24-.36.04-.03.13-.09.34-.1l.1-.01h1.14c.24.01.34.07.39.11.07.06.2.2.3.54l.05.14.03.13.1.3ZM10 11.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Zm0 1.5a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" clip-rule="evenodd"/></svg>',name:"gear_outline_20"}}i.d(t,{getIcon20GearOutline:()=>r})},290686:(e,t,i)=>{"use strict";function r(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="gift_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="gift_outline_20__Icons-20/gift_outline_20"><g id="gift_outline_20__gift_outline_20"><path d="M0 0h20v20H0z"/><path d="M14.85 2.31c1.02 1.03 1.23 2.88-.26 4.19h.91a3 3 0 0 1 3 3v.5c0 .82-.1 1.15-.27 1.48a1.88 1.88 0 0 1-1.23.94v1.61c0 1.56-.16 2.13-.47 2.7-.3.57-.75 1.02-1.32 1.32l-.2.1c-.48.23-1.04.35-2.23.37h-5.3c-1.55 0-2.12-.16-2.69-.47a3.18 3.18 0 0 1-1.32-1.32l-.1-.2A5.12 5.12 0 0 1 3 14.3V12.4a1.88 1.88 0 0 1-1.23-.93c-.16-.3-.25-.6-.27-1.3V9.5a3 3 0 0 1 3-3h.91c-1.49-1.31-1.28-3.16-.26-4.19C6.37 1.1 8.74 1.04 10 3.57c1.26-2.53 3.63-2.47 4.85-1.26ZM9.25 12.5H4.5v1.76l.01.4c.02.6.08.92.2 1.2l.08.16c.17.31.4.54.7.71l.17.08c.33.14.72.2 1.6.2h1.99V12.5Zm6.25 0h-4.75v4.52h2l.4-.01c.6-.02.91-.08 1.19-.2l.16-.08c.31-.17.54-.4.71-.7.19-.36.27-.7.29-1.56V12.5ZM9.16 8H4.5C3.67 8 3 8.67 3 9.5v.87c.02.23.04.31.09.4.03.06.08.1.14.14.11.06.22.08.63.09h5.39V8h-.09Zm6.34 0h-4.76v3h5.4c.4 0 .52-.03.63-.09.06-.03.1-.08.14-.14.06-.12.09-.25.09-.78V9.5c0-.83-.67-1.5-1.5-1.5ZM9.22 6.16c-.43-3.1-1.96-3.83-3-2.79C5.16 4.42 5.9 5.95 9 6.38l.26.04Zm1.56 0-.03.19.01.06.24-.03c3.1-.43 3.83-1.96 2.79-3-1.05-1.05-2.58-.32-3.01 2.78Z" id="gift_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>',name:"gift_outline_20"}}i.d(t,{getIcon20GiftOutline:()=>r})},187567:(e,t,i)=>{"use strict";function r(){return{icon:'<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M15.88 18.12a1.25 1.25 0 0 1-1.76 1.76l-7-7a1.25 1.25 0 0 1 0-1.76l7-7a1.25 1.25 0 0 1 1.76 1.76L9.77 12z" fill="currentColor"/></svg>',name:"chevron_left_24"}}i.d(t,{getIcon24ChevronLeft:()=>r})},276299:(e,t,i)=>{"use strict";function r(){return{icon:'<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M14.23 12 8.12 5.88a1.25 1.25 0 1 1 1.76-1.76l7 7c.5.48.5 1.28 0 1.76l-7 7a1.25 1.25 0 0 1-1.76-1.76z" fill="currentColor"/></svg>',name:"chevron_right_24"}}i.d(t,{getIcon24ChevronRight:()=>r})},28556:(e,t,i)=>{"use strict";function r(){return{icon:'<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M14.46 10.3a2.39 2.39 0 0 1 2.76.31c.35.3.38.8.06 1.13a.88.88 0 0 1-1.19.06l-.08-.07c-.26-.18-.48-.16-.75-.02a.97.97 0 0 0-.15.09l-.08.06a.88.88 0 0 1-1.11-.12.77.77 0 0 1 .06-1.13c.1-.09.26-.2.48-.3zM8.5 9.55a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zM13.45 14c.55 0 1 .45.9 1-.02.13-.05.26-.09.34a2.44 2.44 0 0 1-3.2 1.32 2.45 2.45 0 0 1-1.32-1.32c-.04-.08-.07-.2-.1-.35-.1-.54.36-.99.91-.99zM9.1 3.8a.9.9 0 0 0 0-1.8zM2 9.1a.9.9 0 0 0 1.8 0z"/><path clip-rule="evenodd" d="M2 9.1A7.1 7.1 0 0 1 9.1 2v1.8a5.3 5.3 0 0 0-5.3 5.3z" fill-rule="evenodd"/><path d="M9.1 20.2a.9.9 0 1 1 0 1.8zM2 14.9a.9.9 0 0 1 1.8 0z"/><path clip-rule="evenodd" d="M2 14.9A7.1 7.1 0 0 0 9.1 22v-1.8a5.3 5.3 0 0 1-5.3-5.3z" fill-rule="evenodd"/><path d="M14.9 3.8a.9.9 0 1 1 0-1.8zM22 9.1a.9.9 0 1 1-1.8 0z"/><path clip-rule="evenodd" d="M22 9.1A7.1 7.1 0 0 0 14.9 2v1.8a5.3 5.3 0 0 1 5.3 5.3z" fill-rule="evenodd"/><path d="M14.9 20.2a.9.9 0 1 0 0 1.8zm7.1-5.3a.9.9 0 0 0-1.8 0z"/><path clip-rule="evenodd" d="M22 14.9a7.1 7.1 0 0 1-7.1 7.1v-1.8a5.3 5.3 0 0 0 5.3-5.3z" fill-rule="evenodd"/></g></svg>',name:"vmoji_outline_24"}}i.d(t,{getIcon24VmojiOutline:()=>r})},970929:(e,t,i)=>{"use strict";i.d(t,{default:()=>g});i(530522),i(66108),i(579665),i(95767),i(175115),i(59357),i(283946),i(991181),i(296253),i(83276);var r=i(19331),s=i(754259),n=i(324816),o=i(40906),a=i(726271);function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],r=!0,s=!1,n=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(i.push(o.value),!t||i.length!==t);r=!0);}catch(e){s=!0,n=e}finally{try{r||null==a.return||a.return()}finally{if(s)throw n}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var d=Object.entries(n.EMOJI_HINTS).map((e=>{var t=c(e,2),i=t[0],r=c(t[1],2),s=(r[0],r[1]);return[new RegExp(`(\\s|^)(${(0,o.escapeRE)(s)}${s.endsWith(")")||s.endsWith("(")?"+":""})([\\s\\.,]|$)`,"gi"),i]})),u={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."};a.browser.mac?u["\\"]="ё":u["`"]="ё";var _=new RegExp(`[${(0,o.escapeRE)(Object.keys(u).join(""))}]`,"gi"),f=e=>e.replace(_,(e=>u[e])),m=Object.entries(u).reduce(((e,t)=>{var i=c(t,2),r=i[0];return e[i[1]]=r,e})),h=new RegExp(`[${(0,o.escapeRE)(Object.keys(m).join(""))}]`,"gi"),v=e=>e.replace(h,(e=>m[e])),p=-184940019;const g=class{constructor(e){this.config={mvk:!1,peerId:null,maxInputLength:256},this.setConfig(e)}setConfig(e){Object.assign(this.config,e)}getQueries(e){if(!e||e.length>this.config.maxInputLength)return[""];var t=window.Wall&&window.Wall.replyNamesRE||window.post&&window.post.replyNamesRE;if(t){var i=t();i&&(e=e.replace(i,""))}e=e.toLowerCase(),e=(e=d.reduce(((e,t)=>{var i=c(t,2),r=i[0],n=i[1];return e.replace(r,((e,t,i,r)=>(t||"")+(0,s.emojiByteHexToSymbol)(n)+(r||"")))}),e)).replace(/^[\s\uFEFF\xA0]+|\n+$/g,"");for(var r=[e=(0,s.emojiRemoveSkinToneModifiers)(e)],n=0,o=[...r];n<o.length;n++){var a=o[n];r.push(f(a)),r.push(v(a))}for(var l=0,u=[...r];l<u.length;l++){var _=u[l];r.push(_.replace(/ё/g,"е")),r.push(_.replace(/е/g,"ё"))}for(var m=0,h=[...r];m<h.length;m++){var p=h[m];r.push(p.replace(/[.!?]+$/,""))}return Object.keys(r.reduce(((e,t)=>(e[t]=1,e)),{}))}isBotLinkEnabled(){return(0,r.partConfigEnabled)("stickers_bot_link")&&this.config.peerId!==p}getBotLinkUrl(){return this.config.mvk?`/mail?act=show&peer=${p}`:`/im?sel=${p}`}getBotLinkImageUrl(e){return`/images/stickers_suggestions_bot_${arguments.length>1&&void 0!==arguments[1]?arguments[1]:"light"}_${e}.png`}getBotLinkClickStatName(){return"stickers_suggestions_bot_link"}getBotLinkClickStatKeys(){return[]}isMoneyTransferEnabled(){return(0,r.partConfigEnabled)("stickers_money_transfer_suggestions")&&(this.isMoneySendEnabled()||this.isMoneyRequestEnabled())}isMoneySendEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.send)}isMoneyRequestEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.request)}}},104958:(e,t,i)=>{"use strict";i.d(t,{Emoji:()=>Z});i(66108),i(579665),i(95767),i(820075),i(209865),i(796409),i(175115),i(940851),i(751876),i(991181),i(296253),i(530522),i(283946),i(21466),i(59357);var r=i(324816),s=i(726271),n=i(787481),o=i(479957),a=i(100416),c=i(486125),l=i(635676),d=i(803834),u=i(49535),_=i(754259),f=i(898884),m=i(408270),h=i(857748),v=i(19331),p=i(695724),g=i(315544),k=i(11122),S=i(970929),w=i(494422),y=i(376270),j=i(386409),T=i(654612),C=i(376852),b=i(786067),E=i(40906),I=i(483295),x=i(826338),P=i(124041),R=i(749091),N=i(922377),L=i(310835),A=i(751595),B=i(870264),O=i(399321),M=i(665820),H=i(348230),D=i(290686),F=i(728638),K=i(890803),G=i(276299),V=i(187567),z=i(28556),W=i(511417),U=i(575867);function $(){return $=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},$.apply(this,arguments)}function q(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=J(e))){var t=0,i=function(){};return{s:i,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s,n=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return n=e.done,e},e:function(e){o=!0,s=e},f:function(){try{n||null==r.return||r.return()}finally{if(o)throw s}}}}function Y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],r=!0,s=!1,n=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(i.push(o.value),!t||i.length!==t);r=!0);}catch(e){s=!0,n=e}finally{try{r||null==a.return||a.return()}finally{if(s)throw n}}return i}(e,t)||J(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,t){if(e){if("string"==typeof e)return X(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?X(e,t):void 0}}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function Q(){return(0,v.partConfigEnabled)("stickers_web_new_ui")}var Z={opts:{},raw:{},last:0,shownId:!1,hasNewStickers:!1,preventMouseOver:!1,stickerPacksToLoad:[],ttShift:45,favoriteAvailable:!1,favoriteRemindOn:!1,favoriteRemindOff:!1,favoriteLimit:20,favoriteLimitNoticed:!1,isStickersPreloading:!1,stickerSizes:{},stickers:{},TAB_EMOJI:0,TAB_RECENT_STICKERS:-1,TAB_FAVORITE_STICKERS:-2,TAB_NEW_CONVO_STICKERS:-3,TAB_VMOJI:-4,CLICK_DELAY:500,SORTED_EMOJI_SECTIONS_CODES:[-1,1,3,8,2,4,5,6,7,9],CACHED_HEIGHT_PROP:"_emojiHeight",CACHED_WIDTH_PROP:"_emojiWidth",BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY:150,SHOW_TT_TIMEOUT:100,HIDE_TT_TIMEOUT:300,SHOWN_TT_CLS:"emoji_tt_shown",STICKER_REFERRERS:{RECENT:"recent",FAVORITE:"favourite",NEW_CONVO:"new_convo",KEYBOARD:"keyboard",STORY_KEYBOARD:"story_keyboard"},DELETE_FAV_STICKER_ELEMENTS_DELAY:500,FAV_ICON_TT_MIN_HEIGHT:35,SUGGESTION_WORD_MAX_LENGTH:256,logHintsDelay:0,tabDefaultId:0,stickersKeywordsExpire:36e5*(6+2*Math.random()),PACK_FIELD_ID:0,PACK_FIELD_IS_ACTIVE:1,STICKER_FIELD_IMAGES:6,init:function(e,t){var i=Z.last;Z.tabDefaultId=Z.TAB_RECENT_STICKERS,t.txt=e,t.id=i,t.fieldWrap=(0,g.gpeByClass)("_emoji_field_wrap",e),t.emojiWrap=(0,g.domByClass)(t.fieldWrap,"_emoji_wrap"),t.emojiBtn=(0,g.domByClass)(t.emojiWrap,"_emoji_btn"),t.emojiWrap&&(0,g.data)(t.emojiWrap,"optId",i),e.emojiId=i,t.lastLoadedEmojiCategoriesIdxes={},t.preventDoubleClick=(0,E.vkNow)(),t.deletedFavoriteStickers=[],t.deleteFavoriteStickersTimeout=null,t.suggestions=new S.default(t.suggestionsConfig);var r=(0,p.isRetina)()?128:64;if(Z.stickerSizes[r]=!0,t.forceTxt)t.editable=0,(0,a.placeholderInit)(e);else{if(t.editable=1,setTimeout((function(){(0,a.placeholderInit)(e,{editable:1,editableFocus:Z.editableFocus,global:t.global}),t.shouldFocus&&Z.editableFocus(e,!1,!0)}),0),s.browser.mozilla)try{document.execCommand("enableObjectResizing",!1,!1),cur.destroy.push((function(){document.execCommand("enableObjectResizing",!1,!0)}))}catch(e){}(0,u.addEvent)(window,"mousemove",Z.preventMouseOverHandle),(0,u.addEvent)(e,s.browser.opera&&!s.browser.chrome?"click":"mousedown",(function(r){if(r.target&&"IMG"==r.target.tagName&&Z.getCode(r.target))return Z.editableFocus(e,r.target,r.offsetX>8),(0,u.cancelEvent)(r);Z.shown&&Z.ttClick(i,(0,g.geByClass1)("emoji_smile",t.controlsCont),!0)})),t.noLineBreaks&&(0,u.addEvent)(e,"blur",(function(t){e.textContent||e.innerText||(0,p.each)((0,g.geByTag)("br",e),(function(e,t){(0,g.re)(t)}))})),(0,u.addEvent)(e,"keypress keydown keyup input paste",(function(r){if(r.canceled)return!1;if("keydown"===r.type){t.onChange&&(Z.raw[i]=e.innerHTML);var n=t.ctrlSend?t.ctrlSend():t.noEnterSend;if(r.keyCode==u.KEY.RETURN||10==r.keyCode){if(t.forceEnterSend&&t.onSend)return t.onSend(),(0,u.cancelEvent)(r);var o=cur.ctrl_submit&&!t.noCtrlSend;if((o||n)&&(r.ctrlKey||s.browser.mac&&r.metaKey)||!o&&!r.shiftKey&&!(r.ctrlKey||s.browser.mac&&r.metaKey)){var a=(0,g.data)(e,"composer");if(!Z.emojiEnter(i,r)||!Z.stickerHintMove(r)||a&&a.wdd&&(0,g.isVisible)(a.wdd.listWrap))return!1;if(!n||r.ctrlKey||s.browser.mac&&r.metaKey)return Z.ttClick(i,(0,g.geByClass1)("emoji_smile",t.controlsCont),!0),t.onSend&&t.onSend(),(0,u.cancelEvent)(r)}if(t.noLineBreaks)return(0,u.cancelEvent)(r)}if(r.ctrlKey&&r.keyCode==u.KEY.RETURN){var c=this.value;if(t.editable)Z.insertHTML("<div><br/></div>");else{if("number"==typeof this.selectionStart&&"number"==typeof this.selectionEnd){var l=this.selectionStart;this.value=c.slice(0,l)+"\n"+c.slice(this.selectionEnd),this.selectionStart=this.selectionEnd=l+1}else if(document.selection&&document.selection.createRange){this.focus();var d=document.selection.createRange();d.text="\r\n",d.collapse(!1),s.browser.opera&&!s.browser.chrome&&(d.moveEnd("character",0),d.moveStart("character",0)),d.select()}e.autosize.update(),setTimeout((function(){e.autosize.update()}),0)}return!1}var _=(0,y.hasAccessibilityMode)()&&(0,v.partConfigEnabled)("emoji_tooltip_a11y_mode");if(r.keyCode===u.KEY.TAB&&!(r.ctrlKey||s.browser.mac&&r.metaKey)&&!_){var f=(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(t.txt));if(f&&(0,g.isVisible)(f)){var m=(0,g.geByClass1)("over",f);if(m?Z.stickerHintKeyOut(i,m):Z.stickerHintKeyOver(i,(0,g.geByClass1)("emoji_sticker_item",f)),!Z.shown)return(0,u.cancelEvent)(r)}return Z.shown?(Z.editableFocus(e,!1,!0,void 0,!0),Z.ttClick(i,(0,g.geByClass1)("emoji_smile",t.controlsCont),!0)):Z.ttClick(i,(0,g.geByClass1)("emoji_smile",t.controlsCont),!1,!0,void 0,!0),(0,u.cancelEvent)(r)}if(r.keyCode==u.KEY.ESC){var h=(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(t.txt)),k=!1;if(h&&(0,g.isVisible)(h)&&(Z.stickerHintKeyOut(i,(0,g.geByClass1)("emoji_sticker_item",h)),Z.stickersHintsHide(h,t,100),k=!0),Z.shown&&(Z.editableFocus(e,!1,!0,void 0,!0),Z.ttClick(i,(0,g.geByClass1)("emoji_smile",t.controlsCont),!0),k=!0),k)return(0,u.cancelEvent)(r);if(t.onEsc)return t.onEsc(r)}}return"paste"===r.type?(Z.onEditablePaste(e,t,i,r),t.checkEditable&&setTimeout(t.checkEditable.pbind(i,e),0),Z.checkStickersKeywords(i,t)):"keyup"===r.type?(!t.noLineBreaks||e.textContent||e.innerText||(0,p.each)((0,g.geByTag)("br",e),(function(e,t){(0,g.re)(t)})),t.checkEditable&&t.checkEditable(i,e),Z.checkStickersKeywords(i,t),t.onChange&&(Z.raw[i]!=e.innerHTML&&Z.onChange(t),delete Z.raw[i])):"keydown"!==r.type&&"input"!==r.type||(t.checkEditable&&setTimeout(t.checkEditable.pbind(i,e),0),Z.checkStickersKeywords(i,t)),t.onKeyAction&&t.onKeyAction(r),cur.onReplyFormSizeUpdate&&cur.onReplyFormSizeUpdate(r),!0}))}return window.Notifier&&Notifier.addRecvClbk("emoji",0,Z.lcRecv,!0),Z.initStickersKeywords(),Z.initPromotedStickerUrls(),Z.checkNewStickers(t),Z.opts[Z.last]=t,Z.last++},setSuggestionsConfig:function(e,t){Z.opts[e].suggestions.setConfig(t)},onChange:function(e){(0,E.isFunction)(e.onChange)&&setTimeout(e.onChange,0)},preventMouseOverHandle:function(){Z.preventMouseOver=!1},lcRecv:function(e){if("updateTabs"===e.act)Z.updateTabs(e.newStickers,e.keywords)},correctCaret:function(e){var t=e?(0,w.getCaretBoundingRect)(e).bottom:0;(t<0||t>e.offsetHeight)&&(e.scrollTop+=t-e.offsetHeight)},insertWithBr:function(e,t){if(t){var i=t.replace(/\n/g,"<br/>"),r=(0,g.ce)("div",{innerHTML:i});Z.cleanCont(r),Z.insertHTML(r.innerHTML)}},insertWithoutNL:function(e,t){if(t){var i=t.replace(/\n/g,""),r=(0,g.ce)("div",{innerHTML:i});Z.cleanCont(r),Z.insertHTML(r.innerHTML)}},focusTrick:function(e,t,i,r,s){s||(s=e);var n=(0,g.ce)("TEXTAREA",{className:"emoji_tmp_textarea"});e.parentNode.appendChild(n),n.focus(),setTimeout((function(){var o=s.scrollTop;(0,g.re)(n),e.focus(),s.scrollTop=o,Z.setRange(r),t((0,p.clean)((0,g.val)(n))),i(e)}),0)},finalizeInsert:function(e){Z.cleanCont(e),setTimeout(Z.correctCaret.pbind(e),10)},getClipboard:function(e){return e.clipboardData?(0,p.clean)(e.clipboardData.getData("text")):!!window.clipboardData&&(0,p.clean)(window.clipboardData.getData("Text"))},processImagePaste:function(e,t,i,r){if(null!=e.clipboardData){var s=function(){var s=e.clipboardData;function n(e){if(!e.match(/^webkit\-fake\-url\:\/\//)){var s=new Image;return s.crossOrigin="anonymous",s.onload=function(){var e=document.createElement("canvas");e.width=s.width,e.height=s.height,e.getContext("2d").drawImage(s,0,0,e.width,e.height),e.toBlob((function(e){!function(e){var r,s;if(e.name=e.filename="upload_"+(new Date).toISOString()+"_"+(0,E.irand)(0,100)+".png",(0,g.hasClass)(t,"_im_text")){if(i.uploadActions)return void i.uploadActions.paste([e])}else r="post_field"==t.id?cur.wallAddMedia:(s=(0,g.data)(t,"composer"))&&s.addMedia;r&&(0,E.isFunction)(i.initUploadForImagePasteCallback)&&i.initUploadForImagePasteCallback(t,r,e)}(e)}),"image/png"),r(!0)},s.src=e}}if(s.items){var o=!1,a=s.types;if((0,v.partConfigEnabled)("emoji_disable_new_html_processing")||a.includes("Files")||a.includes("text/plain"))for(var c=0,l=s.items.length;c<l;c++){var d=s.items[c];if(d.type.match(/^image\//)&&"file"===d.kind){var u=new FileReader;u.onload=function(e){return n(e.target.result)},u.readAsDataURL(d.getAsFile()),o=!0}else if("text/plain"===d.type)return{v:r()}}else if(s.types.includes("text/html")){var _=(0,g.se)(`<div>${s.getData("text/html")}</div>`).querySelectorAll("img");o=_.length>0,_.forEach((e=>{n(e.src)}))}return{v:o}}if(-1!==Array.prototype.indexOf.call(s.types,"text/plain"))return{v:r()};!function(e){for(var i=Math.floor(1e3*Math.random()),s=(0,g.geByTag)("img",t),n=0,o=s.length;n<o;n++)s[n]["_before_paste_"+i]=!0;setTimeout((function(){for(var s=(0,g.geByTag)("img",t),n=!1,o=0,a=s.length;o<a;o++){var c=s[o];c["_before_paste_"+i]||(e(c.src),(0,g.re)(c),n=!0)}n||r()}),1)}((function(e){return n(e)}))}();if("object"==typeof s)return s.v}else r()},detectInvalidClipboardData(e){if(!e.clipboardData)return!1;var t=e.clipboardData.types;if(t.includes("text/html")){if(t.includes("Files"))return!0;var i=e.clipboardData.getData("text/html");return i&&i.match(/<iframe/i)}return!1},onEditablePaste:function(e,t,i,r,s){var n=!1;"true"===e.getAttribute("contenteditable")&&(n=Z.getRange());var o=this.getClipboard(r),a=o&&n&&!s;this.detectInvalidClipboardData(r)&&(0,u.cancelEvent)(r),(this.processImagePaste(r,e,t,function(i){i||(a?(t.noLineBreaks?this.insertWithoutNL(n,o):this.insertWithBr(n,o),setTimeout(this.finalizeInsert.bind(this,e),0)):n&&this.focusTrick(e,t.noLineBreaks?this.insertWithoutNL.pbind(n):this.insertWithBr.pbind(n),this.finalizeInsert.bind(this,e),n))}.bind(this))||a)&&(0,u.cancelEvent)(r),Z.onChange(t)},cleanCont:function(e){for(var t=e.firstChild;t;){var i=t.nextSibling;switch(t.nodeType){case 1:if("tmp_paste_cont"==t.id)break;if("DIV"==t.tagName||"P"==t.tagName||"SPAN"==t.tagName)t.setAttribute("style",""),t.className="",t.id="",Z.cleanCont(t);else if("IMG"==t.tagName)Z.getCode(t)||(0,g.re)(t);else if("BR"!=t.tagName){var s=Z.editableVal(t,{saveEmoji:!0}),n=(0,g.cf)((0,p.clean)(s).replace(/\n/g,"<br/>"));t.parentNode.replaceChild(n,t)}break;case 3:var o=(0,p.clean)(t.textContent||t.innerText),a=(0,r.emojiRegex)();o&&o.match(a)&&(o=o.replace(a,f.emojiReplace),t.parentNode.replaceChild((0,g.cf)(o),t))}t=i}},focus:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Z.editableFocus(e,!1,!0);var r=i||e.parentNode;if(t){var s=(0,g.getXY)(r)[1],n=(0,d.scrollGetY)(),o=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:boxLayerBG.offsetHeight,a=(0,g.getSize)(r)[1];n+o<s+a?(0,d.scrollToY)(s-o+a+60,100):n>s&&(0,d.scrollToY)(s-60,100)}},destroy:function(e){if(Z.opts.hasOwnProperty(e)){var t=Z.opts[e];t.txt&&t.txt.blur(),t.imagesLoader&&t.imagesLoader.destroy(),e===Z.shownId&&(Z.shownId=!1,Z.shown=!1),delete Z.opts[e]}},editableFocus:function(e,t,i,r,n){if(!e||n&&document.activeElement===e)return!1;if((e=(0,g.ge)(e)).focus(),e.phonfocus&&e.phonfocus(),void 0!==window.getSelection&&void 0!==document.createRange){var o=window.getSelection();if(!s.browser.opera||s.browser.chrome||i){var a=document.createRange();t?a.selectNode(t):a.selectNodeContents(e),s.browser.mozilla&&e.innerHTML.endsWith("<br>")&&e.removeChild(e.lastChild),r||a.collapse(!i),(o=window.getSelection()).removeAllRanges(),o.addRange(a)}else o.collapse(t||e,0)}else if(void 0!==document.body.createTextRange){var c=document.body.createTextRange();c.moveToElementText(t||e),c.collapse(!i),c.select()}},getRange:function(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},setRange:function(e){if(window.getSelection){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}else document.selection&&e.select&&e.select()},val:function(e,t){if(void 0===t)return Z.editableVal(e);t=(t=(0,f.emojiToHTML)(t,!0)).replace(/ $/,"&nbsp;"),e.setValue?(e.setValue(t),e.phonblur&&e.phonblur()):e.innerHTML=t,Z.updateStickersHints();var i=(0,g.data)(e,"composer");return i&&window.Composer&&setTimeout(Composer.updateAutoComplete.pbind(i)),!0},editableVal:function(e,t){if(!e)return"";if("TEXTAREA"==e.tagName)return(0,g.val)(e);for(var i,r=e.firstChild,s="",n=new RegExp("^(DIV|P|LI|OL|TR|TD|BLOCKQUOTE)$");r;){switch(r.nodeType){case 3:s+=i=r.data.replace(/^\n|\n$/g," ").replace(/[\n\xa0]/g," ").replace(/[ ]+/g," ");break;case 1:if(i=Z.editableVal(r),r.tagName&&r.tagName.match(n)&&i){"\n"!=i.substr(-1)&&(i+="\n");for(var o=r.previousSibling;o&&3==o.nodeType&&""==(0,p.trim)(o.nodeValue);)o=o.previousSibling;!o||o.tagName&&(o.tagName.match(n)||"BR"==o.tagName)||(i="\n"+i)}else if("IMG"==r.tagName){var a=Z.getCode(r);a&&(t&&t.saveEmoji?i+=Z.getEmojiHTML(a):i+=Z.codeToChr(a))}else"BR"==r.tagName&&(i+="\n");s+=i}r=r.nextSibling}return s},cssEmoji:r.EMOJI_HINTS,getEmojiHTML:f.getEmojiHTML,codeToChr:_.emojiByteHexToSymbol,checkEditable:function(e,t,i){var r=t.scrollHeight,n=Z.opts[e];if(!n)return!1;n.scPaddings||(n.scPaddings=(0,p.intval)((0,g.getStyle)(t,"paddingTop"))+(0,p.intval)((0,g.getStyle)(t,"paddingBottom"))),r-=n.scPaddings;var o=n.tt;if(r>i.height+(s.browser.mozilla&&n.isChat?0:5)){if(!n.isSized){(0,g.setStyle)(t,{height:i.height+"px",overflowY:"auto"});var a=(0,g.geByClass1)("emoji_smile",n.controlsCont),c=(0,g.geByClass1)("emoji_smile_icon_promo",n.controlsCont),l=(0,g.ge)("im_upload"),d=(0,j.sbWidth)();n.ttWrap&&(d+=(0,g.getSize)(n.ttWrap)[0]-((0,g.getXY)(n.emojiBtn)[0]-(0,g.getXY)(n.ttWrap)[0])),(0,g.setStyle)(a,vk.rtl?{left:1+d}:{right:1+d}),c&&(0,g.setStyle)(c,vk.rtl?{left:2+d}:{right:2+d}),l&&(0,g.setStyle)(l.parentNode,vk.rtl?{left:1+d}:{right:1+d}),o&&(0,g.setStyle)(o,vk.rtl?{left:(n.ttDiff||31)+d}:{right:(n.ttDiff||31)+d}),n.isSized=!0}}else if(n.isSized){(0,g.setStyle)(t,{height:"auto",overflowY:"hidden"});var u=(0,g.geByClass1)("emoji_smile",n.controlsCont),_=(0,g.geByClass1)("emoji_smile_icon_promo",n.controlsCont),f=(0,g.ge)("im_upload");(0,g.setStyle)(u,vk.rtl?{left:1}:{right:1}),_&&(0,g.setStyle)(_,vk.rtl?{left:2}:{right:2}),f&&(0,g.setStyle)(f.parentNode,vk.rtl?{left:1}:{right:1}),o&&(0,g.setStyle)(o,vk.rtl?{left:n.ttDiff||31}:{right:n.ttDiff||31}),n.isSized=!1}n.onResize&&n.onResize()},stickersHintsShow:function(e,t,i){((0,g.isVisible)(e)||(0,l.fadeIn)(e,i),t.stickerEventsInited)||((e&&(0,g.geByClass1)("_sticker_hints_inner",e)).addEventListener("wheel",Z.onWheelStickersHints),(0,u.addEvent)(document,"keydown",Z.stickerHintMove),t.onHintsMouseDown=function(){t.hintsClicked=!0,setTimeout((function(){delete t.hintsClicked}),0)},(0,u.addEvent)(e,"mousedown",t.onHintsMouseDown),t.txt&&(t.onTxtFocus&&((0,u.removeEvent)(t.txt,"focus",t.onTxtFocus),delete t.onTxtFocus),t.onTxtBlur=function(r){if(t.hintsClicked)return(0,u.cancelEvent)(r),!0;Z.stickersHintsHide(e,t,i)},(0,u.addEvent)(t.txt,"blur",t.onTxtBlur)),t.stickerEventsInited=!0);Z.checkStickersHintsSize(e,t)},stickersHintsHide:function(e,t,i){((0,l.fadeOut)(e,i),(0,u.removeEvent)(document,"keydown",Z.stickerHintMove),t.onHintsMouseDown&&(0,u.removeEvent)(e,"mousedown",Z.onHintsMouseDown),t.onHintsWheel)&&(e&&(0,g.geByClass1)("_sticker_hints_inner",e)).removeEventListener("wheel",Z.onWheelStickersHints);t.txt&&(t.onTxtBlur&&((0,u.removeEvent)(t.txt,"blur",t.onTxtBlur),delete t.onTxtBlur),t.onTxtFocus&&(0,u.removeEvent)(t.txt,"focus",t.onTxtFocus),t.onTxtFocus=function(){var e=t.txt&&(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(t.txt));e&&!(0,g.isVisible)(e)&&(delete t.stickerHintsString,Z.checkStickersKeywords(t.id,t,!1))},(0,u.addEvent)(t.txt,"focus",t.onTxtFocus)),delete t.stickerEventsInited,delete Z.shownHintId,Z.sendHintsLog()},stickerHintOver:function(e){Z.stickerHintOut(e),(0,g.addClass)(e,"over")},stickerHintOut:function(e){(0,p.each)((0,g.geByClass)("over",(0,g.domPN)(e)),(function(){(0,g.removeClass)(this,"over")}))},stickerHintClick:function(e,t,i,r){var s=Z.opts[e]||{},n=s.txt,o=n&&(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(n)),a="suggestion_"+Z.stickerSuggestionQuery;return"stories"===s.ref&&(a="story_suggestion_"+Z.stickerSuggestionQuery),t<0?Z.previewSticker(!1,r,{stickerId:-t,sticker_referrer:a}):((0,g.val)(n,""),Z.stickerClick(e,t,256,i,r,a),s.checkEditable&&s.checkEditable(e,n)),Z.stickersHintsHide(o,s,0),!1},stickerHintKeyOver:function(e,t){Z.stickerHintOver(t),Z.shownHintId=e},stickerHintKeyOut:function(e,t){Z.stickerHintOut(t),delete Z.shownHintId},stickerHintMove:function(e){var t=Z.shownHintId;if(void 0===t)return!0;var i=Z.opts[t],r=i&&(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(i.txt));if(r&&(0,g.isVisible)(r)){var s=(0,g.geByClass1)("over",r)||(0,g.geByClass1)("emoji_sticker_item",r);switch(e.keyCode){case u.KEY.LEFT:return(s=(0,g.domPS)(s))&&(Z.stickerHintOver(s),Z.checkStickersHintsScroll(s)),(0,u.cancelEvent)(e),!1;case u.KEY.RIGHT:return(s=(0,g.domNS)(s))&&(Z.stickerHintOver(s),Z.checkStickersHintsScroll(s)),(0,u.cancelEvent)(e),!1;case u.KEY.ENTER:return s.click(),(0,u.cancelEvent)(e),!1}}return!0},checkStickersHintsSize:function(e,t,i){i&&((0,g.addClass)(e,"_margin_transition"),(0,g.removeClassDelayed)(e,"_margin_transition")),(0,g.setStyle)(e,{marginLeft:0});var r=(0,g.getXY)(e),s=(0,g.getSize)(e),n=Z.getEmojiTtXY(t.tt);t.tt&&n&&n[0]&&r[0]+s[0]+10>n[0]&&r[1]+s[1]>n[1]&&(0,g.setStyle)(e,{marginLeft:n[0]-r[0]-s[0]-10}),(0,g.domFC)(e)||Z.stickersHintsHide(e,t,0)},getEmojiTtXY:function(e){return e&&(0,g.hasClass)(e,Z.SHOWN_TT_CLS)?(0,g.getXY)(e):[0,0]},hintachCache:{},hintachNotFoundStickers:{},checkHintach:function(e,t,i){if((0,v.partConfigEnabled)("hintach"))return Z.hintachCache[e]?requestAnimationFrame((()=>Z.renderHintach(e,t,i,Z.hintachCache[e]))):void ajax.post("/hintach",{query:e},{onDone:r=>{Z.hintachCache[e]=r,Z.renderHintach(e,t,i,Z.hintachCache[e])}})},onHintachItemClick:function(e){var t=e.currentTarget.dataset.hint,i=parseInt(e.currentTarget.parentNode.dataset.opt);if(t&&!isNaN(i)){var r=Z.opts[i]||{},s=r.txt,n=s&&(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(s)),o=(0,h.parseAttachmentId)(t);return o&&r.onHintachSend&&((0,g.val)(s,""),r.onHintachSend(o.type,o.rawId),r.checkEditable&&r.checkEditable(i,s),Z.stickersHintsHide(n,r,0)),!1}},renderHintach:function(e,t,i,r){var s=t.txt,n=(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(s)),o=(0,E.isArray)(r.photos)&&r.photos.length||(0,E.isArray)(r.docs)&&r.docs.length;if(e&&t.stickerHintsString&&o){var a=n&&(0,g.geByClass1)("_sticker_hints_inner",n);if(!a||t.noStickers)return!1;Z.clearHintsLog(),Z.hintachNotFoundStickers[e]&&(a.innerHTML="");var c=a.querySelector(".Hintach");c||(c=a.appendChild((0,g.ce)("div",{className:"Hintach"}))),c.setAttribute("data-opt",t.id),c.innerHTML="";var l=64*window.devicePixelRatio,d=64*window.devicePixelRatio;(r.photos||[]).forEach((e=>{var t=(0,h.getPhotoSize)(e.sizes,l,d);if(t){var i=Y(t,3),r=i[0],s=i[1],n=i[2],o=Y((0,h.prepareImageBounds)(s,n),2),a=o[0],u=o[1],_=(0,g.ce)("div",{className:"Hintach__item Hintach__item--photo"});_.setAttribute("data-hint","photo"+e.id),_.appendChild((0,g.ce)("div",{className:"Hintach__itemThumb"},{width:a,height:u,backgroundImage:`url(${r})`})),_.onclick=Z.onHintachItemClick,c.appendChild(_)}})),(r.docs||[]).forEach((e=>{if(e.preview&&(e.preview.video||e.preview.graffiti)){var t=Y(e.preview.video||e.preview.graffiti,3),i=t[0],r=t[1],s=t[2],n=Y((0,h.prepareImageBounds)(r,s),2),o=n[0],a=n[1],l=(0,g.ce)("div",{className:"Hintach__item Hintach__item--doc"});l.setAttribute("data-hint","doc"+e.id);var d=l.appendChild((0,g.ce)(e.preview.video?"video":"img",{className:"Hintach__itemPreview",src:i},{width:o,height:a}));e.preview.video&&(l.appendChild((0,g.ce)("div",{className:"Hintach__itemType",innerHTML:"GIF"})),d.autoplay=!0,d.loop=!0),l.onclick=Z.onHintachItemClick,c.appendChild(l)}})),c.childElementCount>0&&(Z.stickersHintsShow(n,t,100),a.scrollLeft=0,Z.checkStickersHintsScroll(n,a.scrollLeft))}},onMoneyTransferSuggestionClick:function(e,t,i){var r=Z.opts[e],s=r.txt.parentNode.querySelector("._sticker_hints");if(Z.stickersHintsHide(s,r,0),"send"===t&&r.suggestions.isMoneySendEnabled()||"request"===t&&r.suggestions.isMoneyRequestEnabled()){var n=r.suggestions.config,a=n.fromId,c=n.peer;k.default.onClick(a,c,t,i,{onSendStart:()=>{r.clearText&&r.clearText()}});var l=Z.moneyTransferTextMatch&&Z.moneyTransferTextMatch.input||"";(0,o.statlogsValueEvent)("stickers_money_transfer_suggestions","select",[t],l)}},renderMoneyTransferSuggestions:function(e,t){var i=Z.opts[e],r=(0,p.isRetina)()?128:64,s={};return i.suggestions.isMoneyRequestEnabled()?s.request=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="request"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'request', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/request/${r}.png" />\n      </a>`:s.request="",i.suggestions.isMoneySendEnabled()?s.send=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="send"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'send', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/send/${r}.png" />\n      </a>`:s.send="",t.request?s.request+s.send:s.send+s.request},checkStickersKeywords:function(e,t,i){if(t.noStickers||!window.stickersKeywords||!window.stickersKeywordsData||!window.stickersKeywordsData.length)return!1;var r=i?0:100,s=t.txt,n=(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(s)),o=function(i,r){if(Z.stickers[Z.TAB_RECENT_STICKERS]){var s=Z.sortStickersHints(window.stickersKeywords[i]),o=Z.stickers[Z.TAB_RECENT_STICKERS].promoted,a="";r&&(a+=Z.renderMoneyTransferSuggestions(e,r)),(0,p.each)(s,(function(){a+=Z.render.stickerHintRs(e,this,o[this])})),t.suggestions.isBotLinkEnabled()&&(a+=Z.renderSuggestionsBotLink(e)),Z.showStickersHints(n,t,a)}},a=function(){var a=t.suggestions.getQueries(Z.val(s));if(a.length){var c=a[0],l=t.suggestions.isMoneyTransferEnabled()&&k.default.match(c,1);if(l&&(a=[k.default.DEFAULT_QUERY]),Z.moneyTransferTextMatch=l,!n&&!(n=Z.initStickersHints(s)))return!1;if(c!=t.stickerHintsString){var d=a.find((e=>e&&window.stickersKeywords[e]&&window.stickersKeywords[e].length||l));if(Z.stickerSuggestionQuery=d,d)if(Z.stickers[Z.TAB_RECENT_STICKERS])o(d,l);else{var u=t.onRecentEmojiUpdate;t.onRecentEmojiUpdate=function(e){u&&u(),e&&(u?t.onRecentEmojiUpdate=u:delete t.onRecentEmojiUpdate,o(d,l))},Z.emojiLoadMore(e)}else Z.hintachNotFoundStickers[c]=!0,Z.stickersHintsHide(n,t,r);!l&&c&&c.length<20&&t.onHintachSend&&(clearTimeout(t.hintachCheckTimeout),t.hintachCheckTimeout=setTimeout((()=>{Z.checkHintach(c,t,i)}),160)),t.stickerHintsString=c}}};i?a():(clearTimeout(t.stickerHintTT),t.stickerHintTT=setTimeout(a,n&&(0,g.isVisible)(n)?0:200))},showStickersHints:function(e,t,i){var r=e&&(0,g.geByClass1)("_sticker_hints_inner",e);if(!r||t.noStickers)return!1;Z.clearHintsLog(),(0,g.val)(r,i),Z.stickersHintsShow(e,t,100),r.scrollLeft=0,Z.checkStickersHintsScroll(e,r.scrollLeft)},checkStickersHintsScroll:function(e,t){var i=(0,g.domClosest)("_sticker_hints",e),r=i&&(0,g.geByClass1)("_sticker_hints_inner",i),s=i&&(0,g.geByClass1)("_sticker_left",i),n=i&&(0,g.geByClass1)("_sticker_right",i);if(!r)return!1;var a=(0,g.getSize)(s)[0],c=(0,g.getSize)(n)[0];if((0,g.hasClass)(e,"emoji_sticker_item")){var l=e.offsetLeft-8-a,d=e.offsetLeft+(0,g.getSize)(e)[1]+2+c-r.clientWidth;r.scrollLeft>l&&(r.scrollLeft=l),r.scrollLeft<d&&(r.scrollLeft=d),t=r.scrollLeft}var u=t>0,_=t+r.clientWidth<r.scrollWidth;(0,g.toggle)(s,u),(0,g.toggleClass)(i,"sticker_hints_left_pad",u),(0,g.toggle)(n,_),(0,g.toggleClass)(i,"sticker_hints_right_pad",_),t=void 0===t?r.scrollLeft:t;var f=r.querySelectorAll(".emoji_sticker_item"),m=u?a+8:0,h=_?c+2:0,v=Array.from(f).filter((e=>e.offsetLeft-m>=t&&e.offsetLeft+e.offsetWidth+h-r.clientWidth<=t));Z.logHints(v.map((e=>(0,p.intval)(e.getAttribute("data-sticker-id")))).filter((e=>e)));var k=v.map((e=>e.getAttribute("data-money-transfer-type"))).filter((e=>e));if(k.length){var S=Z.moneyTransferTextMatch&&Z.moneyTransferTextMatch.input||"";(0,o.statlogsValueEvent)("stickers_money_transfer_suggestions","show",k,S)}},logHints:function(e){Z.logHintsTimeout&&clearTimeout(Z.logHintsTimeout),Z.logHintsTimeout=setTimeout((()=>{Z.hintsLogBuffer=e.reduce(((e,t)=>(e[t]=1,e)),Z.hintsLogBuffer||{})}),Z.logHintsDelay)},clearHintsLog:function(){Z.logHintsTimeout&&clearTimeout(Z.logHintsTimeout),Z.hintsLogBuffer={}},sendHintsLog:function(){var e=Z.hintsLogBuffer&&Object.keys(Z.hintsLogBuffer),t=window.cur&&window.cur.emojiHintsSendLogHash;e&&e.length&&t&&ajax.post("stickers.php",{act:"log_hints",sticker_ids:e,hash:t}),Z.clearHintsLog()},scrollStickersHints:function(e,t,i){var r=(0,g.domClosest)("_sticker_hints",e),s=r&&(0,g.geByClass1)("_sticker_hints_inner",r),n=r&&(0,g.geByClass1)("_sticker_left",r),o=r&&(0,g.geByClass1)("_sticker_right",r);if(!s)return!1;var a=s.scrollLeft+t*(s.clientWidth-2*(0,g.getSize)(e)[0]),c=(0,g.geByClass)("emoji_sticker_item",s);(0,p.each)(c,(function(e,i){return t>0&&i.offsetLeft-8-(0,g.getSize)(n)[0]>a?(a=c[e-1]&&c[e-1].offsetLeft-8-(0,g.getSize)(n)[0]||a,!1):t<0&&i.offsetLeft+(0,g.getSize)(i)[1]+2+(0,g.getSize)(o)[0]-s.clientWidth>a?(a=i.offsetLeft+(0,g.getSize)(i)[1]+2+(0,g.getSize)(o)[0]-s.clientWidth||a,!1):void 0})),a=Math.max(0,Math.min(s.scrollWidth-s.clientWidth,a)),(0,l.animate)(s,{scrollLeft:a},{duration:Math.abs(s.scrollLeft-a)+50,transition:l.Fx.Transitions.easeOutCubic}),Z.checkStickersHintsScroll(s,a)},onWheelStickersHints:function(e){e.preventDefault(),e.stopPropagation();var t=e.currentTarget;t.scrollLeft+=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX,Z.checkStickersHintsScroll(t,t.scrollLeft)},sortStickersHints:function(e){var t=[];Z.stickers[-1]&&(t=Z.stickers[-1].stickers);var i={},r=[];return(0,p.each)(t,(function(){(0,p.inArray)(this[0],e)&&!i[this[0]]&&(r.push(this[0]),i[this[0]]=1)})),(0,p.each)(e,(function(){i[this]||r.push(this)})),r},initStickersHints:function(e){return!!e&&(0,g.domPN)(e).insertBefore((0,g.se)(`<div class="_sticker_hints sticker_hints_tt">\n      <div class="sticker_hints_arrow sticker_left _sticker_left" onmousedown="Emoji.scrollStickersHints(this, -1, event);cancelEvent(event);" onclick="cancelEvent(event);">\n        ${(0,V.getIcon24ChevronLeft)().icon}\n      </div>\n      <div class="_sticker_hints_inner sticker_hints_inner"></div>\n      <div class="sticker_hints_arrow sticker_right _sticker_right" onmousedown="Emoji.scrollStickersHints(this, 1, event);cancelEvent(event);" onclick="cancelEvent(event);">\n        ${(0,G.getIcon24ChevronRight)().icon}\n      </div>\n    </div>`),e)},updateStickersHints:function(e){Z.opts&&(0,p.each)(Z.opts,(function(t,i){e&&delete i.stickerHintsString,Z.checkStickersKeywords(t,i,!0)}))},renderSuggestionsBotLink(e){var t=Z.opts[e].suggestions,i=(0,p.isRetina)()?128:64,r=W.colorScheme.isDarkScheme()?"dark":"light";return`<a\n    class="emoji_sticker_item"\n    href="${t.getBotLinkUrl()}"\n    onClick="Emoji.onSuggestionsBotLinkClick(event, ${e});"\n    target="_blank">\n    <img class="emoji_sticker_image" src="${t.getBotLinkImageUrl(i,r)}" />\n  </a>`},onSuggestionsBotLinkClick(e,t){e.stopPropagation();var i=Z.opts[t].suggestions;(0,o.statlogsValueEvent)(i.getBotLinkClickStatName(),0,...i.getBotLinkClickStatKeys())},initStickersKeywords:function(){if(!window.stickersKeywordsData){var e=ls.get("stickers_keywords");e&&e.time&&e.time>(0,E.vkNow)()-Z.stickersKeywordsExpire&&(window.stickersKeywordsData=e.keywords)}window.stickersKeywordsData&&Z.setStickersKeywords(window.stickersKeywordsData)},initPromotedStickerUrls:function(){if(!window.promotedStickerUrls){var e=ls.get("promoted_stickers_urls");if(e&&e.time&&e.time>(0,E.vkNow)()-Z.stickersKeywordsExpire)window.promotedStickerUrls=e.stickerUrls;else{ajax.post("al_im.php",{act:"get_promoted_stickers"},{onDone:function(e){ls.set("promoted_stickers_urls",{time:(0,E.vkNow)(),stickerUrls:e}),window.promotedStickerUrls=e}})}}},cachedStickersKeywordsTime:function(){var e=ls.get("stickers_keywords");return e&&e.time?Math.floor(e.time/1e3):0},setStickersKeywords:function(e,t){if(!e)return!1;window.stickersKeywords={};var i=(0,g.ce)("div"),r=[],s="";if(e.forEach((function(e){var t=e.words||[],i=e.user_stickers||[],n=e.promoted_stickers||[],o=i.concat(n.map((function(e){return-e})));t.forEach((function(e){s+="\n"+e,r.push(o)}))})),(0,g.val)(i,s),(s=i.textContent||i.innerText)&&s.slice("\n".length).split("\n").forEach((function(e,t){window.stickersKeywords[e]=r[t]})),!Z.stickers[Z.TAB_RECENT_STICKERS]){var n=ls.get("recent_stickers");n&&(Z.stickers[Z.TAB_RECENT_STICKERS]=n)}t&&(ls.set("stickers_keywords",{time:(0,E.vkNow)(),keywords:e}),Z.updateStickersHints(!0))},emojiEnter:function(e,t){var i=Z.opts[e],r=(i.ctrlSend?i.ctrlSend():i.noEnterSend)||cur.ctrl_submit&&!i.noCtrlSend;if(i.emojiFocused&&i.emojiOvered&&i.openedByTabKey&&(r?!(t.ctrlKey||s.browser.mac&&t.metaKey):!t.shiftKey)){if(0===i.curTab){var n=(0,g.geByTag1)("img",i.emojiOvered)||(0,g.geByTag1)("i",i.emojiOvered);Z.addEmoji(e,Z.getCode(n),i.emojiOvered)}return(0,u.cancelEvent)(t)}return!0},insertHTML:function(e){if(s.browser.msie&&parseInt(s.browser.version)<12)if(document.selection){var t=document.selection.createRange();t.pasteHTML&&t.pasteHTML(e)}else{var i=document.getSelection().getRangeAt(0),r=document.createElement("span");i.surroundContents(r),r.innerHTML=e,i.collapse(!1)}else e&&document.execCommand("insertHTML",!1,e)},addEmoji:function(e,t,i){if(!1===e||!1===t)return!1;var r=Z.opts[e];if(!((0,E.vkNow)()-r.ttShowT<Z.CLICK_DELAY)){if(r.editable){var n=Z.getEmojiHTML(t,Z.codeToChr(t),!0),o=r.txt,a=!!window.getSelection&&window.getSelection(),c=!1;if(a&&a.rangeCount){var l=a.getRangeAt(0);c=l.commonAncestorContainer?l.commonAncestorContainer:l.parentElement?l.parentElement():l.item(0)}for(var d=c;d&&d!=o;)d=d.parentNode;var u=o.lastChild||{};s.browser.mozilla&&"BR"==u.tagName&&!u.previousSibling&&(0,g.re)(o.lastChild),d||Z.editableFocus(o,!1,!0),Z.insertHTML(n);var _=(0,g.geByClass)("emoji",o);for(var f in _.push.apply(_,(0,g.geByClass)("emoji_css",o)),_)if(_.hasOwnProperty(f)){var m=_[f].previousSibling;if(m&&3==m.nodeType&&m.textContent&&32==m.textContent.charCodeAt(0)){var h=m.previousSibling;h&&3==h.nodeType&&h.textContent&&160==h.textContent.charCodeAt(h.textContent.length-1)&&(0,g.re)(m)}}o.check&&o.check(),setTimeout(Z.correctCaret.pbind(o),5),Z.onChange(r);var v=(0,g.data)(o,"composer");v&&window.Composer&&Composer.updateAutoComplete(v)}else{var p,k,S,w=r.txt,y=w.value;p=s.browser.iphone||s.browser.ipad?Z.codeToChr(t):Z.cssEmoji[t][1]+" ",null!=w.selectionStart&&null!=w.selectionEnd?(k=w.selectionEnd,w.value=y.slice(0,w.selectionStart)+p+y.slice(k),w.selectionStart=w.selectionEnd=k+p.length):void 0!==document.selection&&void 0!==document.selection.createRange&&(w.focus(),(S=document.selection.createRange()).text=p,S.select())}r.checkEditable&&r.checkEditable(e,r.txt),Z.checkStickersKeywords(e,r),r.saveDraft&&r.saveDraft(),r.onEmojiAdded&&r.onEmojiAdded(),Z.incrRecentEmojiRate(e,t)}},showShadow:function(){return!(s.browser.msie&&s.browser.version<10)},scrollTabsTo(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Z.opts[e];if(r.tt){var s=r.tt.querySelector(".emoji_tabs_wrap"),n=s.querySelector(".emoji_tabs_cont"),o=n.getBoundingClientRect().width-s.getBoundingClientRect().width,a=Math.max(0,Math.min(t,o));s.parentNode.classList.toggle("emoji_tabs--scrollable-left",a>0),s.parentNode.classList.toggle("emoji_tabs--scrollable-right",a<o),n.classList.toggle("emoji_tabs_cont--no-transition",i),n.style.setProperty("--scroll-left",-a+"px"),r.tabsScrollLeft=a}},scrollTabsBy(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Z.opts[e].tabsScrollLeft,s=void 0===r?0:r;Z.scrollTabsTo(e,s+t,i)},updateTabsScroll(e){Z.scrollTabsBy(e,0,!0)},scrollTabsLeft(e){Z.scrollTabsBy(e,-170)},scrollTabsRight(e){Z.scrollTabsBy(e,170)},tabsWheel:function(e,t){(0,u.cancelEvent)(e);var i=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;Z.scrollTabsBy(t,i,!0)},scrollToTab:function(e,t){var i=Z.opts[t].tt.querySelector(`.emoji_tab_${e}`);if(i){var r=i.getBoundingClientRect(),s=i.closest(".emoji_tabs_cont").getBoundingClientRect(),n=i.closest(".emoji_tabs_wrap").getBoundingClientRect(),o=r.left-s.left-(n.width-r.width)/2;Z.scrollTabsTo(t,o),Z.selectTab(t,e,i)}},selectTab:function(e,t,i){var r,s=Z.opts[e],n=i.closest(".emoji_tabs");null===(r=n.querySelector(".emoji_tab_sel"))||void 0===r||r.classList.remove("emoji_tab_sel"),i.classList.add("emoji_tab_sel"),s.curTab=t,cur.stickersTab=t,ls.set("stickers_tab",t);var o=i.closest(".emoji_tabs_group");o&&(o.classList.add("emoji_tabs_group--expanded"),o.style.setProperty("--width",o.scrollWidth+"px")),n.querySelectorAll(".emoji_tabs_group").forEach((e=>{e!==o&&e.classList.remove("emoji_tabs_group--expanded")}))},show:function(e,t){var i=(0,g.data)((0,g.domPN)(e),"optId");void 0!==i&&Z.ttShow(i,e,t)},hide:function(e,t,i){var r=(0,g.data)((0,g.domPN)(e),"optId");void 0!==r&&Z.ttHide(r,e,t,i)},ttShow:function(e,t,i){var r=Z.opts[e];clearTimeout(r.ctt),clearTimeout(r.stt),r.scrolling&&(r.afterScrollFn=!1),r.ttShown||(t?r.obj=t:t=r.obj,r.stt=setTimeout((function(){Z.ttClick(e,t,!1,!0,i)}),Z.SHOW_TT_TIMEOUT))},ttHide:function(e,t,i,r){var s=Z.opts[e];if(clearTimeout(s.stt),s.ttShown)if(s.scrolling)s.afterScrollFn=Z.ttHide.pbind(e,t,i,r);else{t=t||s.obj||(0,g.geByClass1)("emoji_smile",s.controlsCont);var n=function(){Z.ttClick(e,t,!0,!1,i)};r?n():(clearTimeout(s.ctt),s.ctt=setTimeout(n,Z.HIDE_TT_TIMEOUT))}},ttClick:function(e,t,i,r,n,o){var a=Z.opts[e];if(a&&!(i&&!Z.shown||r&&Z.shown)&&(t||(t=Z.shown||(0,g.ge)(-3==cur.peer?"imw_smile":"im_smile")))){t.tt&&t.tt.destroy&&t.tt.destroy(),!a.tt&&a.sharedTT&&a.sharedTT.emojiTT&&(a.tt=a.sharedTT.emojiTT,a.emojiScroll=a.sharedTT.emojiScroll,a.allEmojiId=a.sharedTT.emojiAllId);var c,l=a.tt;if(!l){var d=ls.get("stickers_tab");d||(d=Z.TAB_EMOJI),a.curTab=cur.stickersTab=Z.TAB_EMOJI,d==Z.TAB_EMOJI||a.noStickers||(Z.stickers[Z.TAB_RECENT_STICKERS]=ls.get("recent_stickers"),a.curTab=cur.stickersTab=d);var _='<div class="emoji_tabs_l_s" onmousedown="Emoji.scrollTabsLeft('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event)"><div class="emoji_sprite emoji_tabs_l_sc"></div><div class="emoji_sprite emoji_tabs_l_si"></div></div><div class="emoji_tabs_r_s" onmousedown="Emoji.scrollTabsRight('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event);"><div class="emoji_sprite emoji_tabs_r_sc"></div><div class="emoji_sprite emoji_tabs_r_si"></div></div>';_+=Z.getTabsCode([[0,1]],e),_+='<span class="emoji_tabs_wrap"><span id="emoji_tabs_cont_'+e+'" class="emoji_tabs_cont">',a.noStickers||!1===window.emojiStickers||void 0===window.emojiStickers||(_+=Z.getTabsCode(window.emojiStickers,e));var f="",m='onmousedown="Emoji.showStickersStore('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event);"',h="showTooltip(this, {text: '"+(0,b.getLang)("global_store_stickers")+"', shift: [4,6,6], showdt: 0, black: 1});";a.rPointer?m+=" onmouseover=\"addClass(this.parentNode.parentNode.parentNode, 'emoji_shop_over');"+h+'" onmouseout="removeClass(this.parentNode.parentNode.parentNode, \'emoji_shop_over\');"':m+=' onmouseover="'+h+'"',_+="</span></span>",a.noStickers||(_+='<a class="emoji_shop" '+m+'><div class="emoji_sprite emoji_shop_icon">'+(Z.hasNewStickers?'<div class="emoji_shop_icon_badge">'+Math.abs(Z.hasNewStickers)+"</div>":"")+"</div></a>"),Z.showShadow()||(f+=" emoji_no_opacity"),(a.noStickers||a.hideStickersInitial)&&(f+=" emoji_no_tabs"),l=(0,g.ce)("div",{id:"emoji_block_"+e,className:"emoji_tt_wrap tt_down"+f,innerHTML:'<div class="emoji_block_cont"><div class="emoji_block_rel"><div class="emoji_list_cont"><div class="emoji_cats_title_helper"></div><div class="emoji_list"><div class="emoji_scroll emoji_scroll_smiles"></div><div class="emoji_scroll emoji_scroll_stickers"></div></div></div></div><div class="emoji_tabs clear_fix">'+_+"</div></div>",onmouseenter:function(t){(0,g.hasClass)(l,"emoji_animated")||Z.ttShow(e,!1,t)},onmouseleave:function(t){(0,g.hasClass)(l,"emoji_animated")||Z.ttHide(e,!1,t)}}),a.tt=l,Z.reappendEmoji(e,l),Z.emojiOver(e,(0,g.geByClass1)("emoji_scroll_smiles",l).firstChild),(0,p.each)(["emoji_tabs_l_s","emoji_tabs_r_s","emoji_tabs_wrap"],(function(){(0,u.addEvent)((0,g.geByClass1)(this,a.tt),"DOMMouseScroll wheel",(function(t){Z.tabsWheel(t,e)}))})),a.sharedTT&&(a.sharedTT.emojiTT=l),Z.updateTabsScroll(e)}if(clearTimeout(a.ttEmojiHide),!1!==Z.shownId&&Z.shownId!=e&&Z.ttClick(Z.shownId,(0,g.geByClass1)("emoji_smile",Z.opts[Z.shownId].controlsCont),!0),Z.preventMouseOver=!1,a.emojiExpanded||Z.emojiExpand(e,l),Z.shown)Z.hideTt(l),(c=(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(a.txt)))&&(0,g.isVisible)(c)&&Z.checkStickersHintsSize(c,a,!0),Z.shown=!1,Z.shownId=!1,a.ttShown=!1,a.emojiFocused=!1,a.emojiOvered=!1,cur.onMouseClick=!1,(0,u.removeEvent)(document,"keydown",Z.emojiMove),(0,g.removeClass)(t,"emoji_smile_on"),a.onHide&&a.onHide(),Z.favorite.deleteFavoriteStickerElements(e);else{if(a.needUpdateRecentStickers&&(Z.updateRecentStickers(e),a.needUpdateRecentStickers=!1),!(0,g.getXY)(a.emojiBtn)[0]||!(0,g.getXY)(a.emojiBtn)[1])return;a.openedByTabKey=!!o,Z.showTt(l),Z.repositionEmoji(e,t,l),(c=(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(a.txt)))&&(0,g.isVisible)(c)&&Z.checkStickersHintsSize(c,a,!0),Z.shownId=e,Z.shown=t,cur.emojiList=(0,g.geByClass1)("emoji_list",l),a.ttShown=!0,a.ttShowT=(0,E.vkNow)(),a.emojiFocused=!0,(0,u.removeEvent)(document,"keydown",Z.emojiMove),setTimeout((function(){cur.onMouseClick=function(t){for(var i=t.target;i;){if("im_texts"==i.id||(0,g.hasClass)(i,"emoji_tt_wrap")||(0,g.hasClass)(i,"imw_emoji_wrap"))return!1;i=i.parentNode}Z.ttClick(e,!1,!0)},(0,u.addEvent)(document,"keydown",Z.emojiMove)}),0),(0,g.addClass)(t,"emoji_smile_on"),a.emojiScroll&&a.emojiExpanded&&(a.emojiScroll.update(),s.browser.msie&&0===a.curTab&&a.emojiOvered&&Z.scrollToListEl(e,a.emojiOvered)),a.currentPeerId=void 0,Z.tabSwitch(a.curTab,a.curTab,e),a.onRecentEmojiUpdate&&a.onRecentEmojiUpdate(!0),a.onShow&&a.onShow(),a.tt.classList.toggle("emoji_tt_can_gift",!("im"===cur.module&&cur.gid))}return Z.hideStickersStoreNotification(),Z.noNewStickers=!0,a.noStickersStore?(0,g.addClass)((0,g.geByClass1)("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"):(0,g.removeClass)((0,g.geByClass1)("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"),(0,u.cancelEvent)(n)}},curEmojiKeys:{},curEmojiRecent:{},loadingPeerInfo:{},getPeerId(e){var t=Z.opts[e];if(window.curFastChat){var i=window.curFastChat.activeBox;if(i&&i.content&&i.content.compareDocumentPosition(t.emojiBtn)&Node.DOCUMENT_POSITION_CONTAINED_BY)return window.curFastChat.peer}return cur.peer},getPeerInfo(e){if(this.loadingPeerInfo[e])return this.loadingPeerInfo[e];if(!(0,x.isUserPeer)(e))return Promise.resolve(null);var t=new Promise(((t,i)=>ajax.post("stickers.php",{act:"get_peer_info",peer_id:e},{onDone:i=>{this.loadingPeerInfo[e]=null,t(i)},onFail(){this.onDone(null)}})));return this.loadingPeerInfo[e]=t,t},emojiLoadMore:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=Z.opts[e];r.emojiMoreSt||(r.emojiMoreSt=1,Z.emojiFetchMore(t).then((t=>{var s=t.stickers,n=t.recentEmoji;Z.updateEmojiList(s,n,e,r),(0,E.isFunction)(i)&&i()}),(e=>{console.error("Emoji.emojiLoadMore error ",e),r.emojiMoreSt=0})),Z.curEmojiRecent&&r.onRecentEmojiUpdate&&r.onRecentEmojiUpdate())},emojiFetchMore(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.act="get_emoji_list",Z.stickerPacksToLoad&&(e.sticker_packs_to_load=Z.stickerPacksToLoad.join(",")),Z.hasNewStickers<0&&(e.new_shown=1);var t=Object.assign(e.sizes||{},Z.stickerSizes);return e.sizes=t&&Object.keys(t).join(","),new Promise(((t,i)=>{ajax.post("al_im.php",e,{onDone:function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];t(i)},onFail:function(e){return i(e),!0}})})).then((e=>{var i=Y(e,6),r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],c=i[5];if(Z.buildStickersIndex(r),void 0!==r[Z.TAB_FAVORITE_STICKERS]){var l=r[Z.TAB_FAVORITE_STICKERS];Z.tabDefaultId=Z.TAB_FAVORITE_STICKERS,Z.favoriteAvailable=!0,Z.favoriteRemindOn=!!l.remind_on,Z.favoriteRemindOff=!!l.remind_off,Z.favoriteLimit=l.limit,Z.favoriteLimitNoticed=l.limit_noticed,Z.sendHintsLogHash=a,k.default.setIntroViewed(c)}o&&(0,p.extend)(cur.lang,o),Object.assign(Z.stickerSizes,t);var d=[];return void 0!==Object.values(r).find((e=>e.vmoji_character_id))&&d.push(window.jsc("web/vmoji.js")),n&&d.push(window.jsc("web/stickers.js")),window.stManager.add(d).then((()=>({stickers:r,recentEmoji:s})))}))},emojiPreloadMore(e,t){Z.isStickersPreloading||(Z.isStickersPreloading=!0,Z.emojiFetchMore(e).then((e=>{var i=e.stickers,r=e.recentEmoji;Z.stickers=i,Z.stickers[Z.TAB_RECENT_STICKERS]&&ls.set("recent_stickers",Z.stickers[-1]),Z.stickers[Z.TAB_FAVORITE_STICKERS];var s=Z.emojiGetRecentFromStorage();s?Z.curEmojiRecent=Z.filterEmoji(s):Z.emojiOldRecentPrepare(r),t&&t()}),(e=>{console.error("Emoji.emojiPreloadMore error ",e)})).finally((()=>{Z.isStickersPreloading=!1})))},buildStickersIndex:function(e){var t={};if(e)for(var i in e)if(e.hasOwnProperty(i)&&i>0&&e[i].stickers)for(var r=e[i].stickers,s=r.length;s--;){var n=r[s];t[n[0]]={sticker:n,packId:i}}Z.stickersById=t},updateEmojiList:function(e,t,i,r){Z.stickers=e,r.emojiMoreSt=0,Z.stickers[-1]&&(ls.set("recent_stickers",Z.stickers[-1]),Z.updateRecentEmoji(i)),Z.stickers[-2],r.allEmojiId=0,r.sharedTT&&(r.sharedTT.emojiAllId=0),Z.onStickersLoad&&(r.afterLoad=1),Z.onStickersLoad&&window.emojiStickers&&(Z.onStickersLoad(),Z.onStickersLoad=!1);var s=Z.emojiGetRecentFromStorage();s?Z.curEmojiRecent=Z.filterEmoji(s):(Z.emojiOldRecentPrepare(t,i),Z.updateEmojiCont(i)),Z.updateRecentEmoji(i),r.onRecentEmojiUpdate&&r.onRecentEmojiUpdate(!0)},filterEmoji:function(e){var t=Object.keys(e);e:for(var i in m.EMOJI_SECTIONS_CODES)if(m.EMOJI_SECTIONS_CODES.hasOwnProperty(i))for(var r in m.EMOJI_SECTIONS_CODES[i])if(m.EMOJI_SECTIONS_CODES[i].hasOwnProperty(r)){var s=m.EMOJI_SECTIONS_CODES[i][r],n=t.indexOf(s);if(-1!=n&&(t.splice(n,1),0==t.length))break e}var o={};for(var a in e)e.hasOwnProperty(a)&&-1==t.indexOf(a)&&(o[a]=e[a]);return t.length>0&&Z.setRecentEmojiList(o),o},emojiGetRecentFromStorage:function(){try{return JSON.parse(localStorage.getItem("emoji_recent_list"))}catch(e){return!1}},emojiOldRecentPrepare:function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var r=e[i],s=void 0,n=void 0;(0,E.isString)(r)?(s=1,n=r):(s=r,n=i),t[n]=s}Z.setRecentEmojiList(Z.filterEmoji(t))},getRecentEmojiSorted:function(){var e=[];for(var t in Z.curEmojiRecent)if(Z.curEmojiRecent.hasOwnProperty(t)){var i=Z.curEmojiRecent[t];e.push([t,i])}e.sort((function(e,t){return t[1]-e[1]}));var r=[];for(var s in e)e.hasOwnProperty(s)&&r.push(e[s][0]);return r.slice(0,20)},incrRecentEmojiRate:function(e,t){Z.emojiRecentRateTime||(Z.emojiRecentRateTime=Date.now()/1e3-6);var i=Date.now()/1e3-Z.emojiRecentRateTime;if(i>=6){var r=Math.min(100,Math.floor(i/6));for(var s in Z.curEmojiRecent)if(Z.curEmojiRecent.hasOwnProperty(s)){if(s==t)continue;Z.curEmojiRecent[s]*=Math.pow(.998076,r)}Z.emojiRecentRateTime+=6*r}Z.curEmojiRecent[t]||(Z.curEmojiRecent[t]=0),Z.curEmojiRecent[t]+=1;var n=Z.getRecentEmojiSorted();m.EMOJI_SECTIONS_CODES[-1]=n,n.length>=20&&-1==n.indexOf(t)&&(n.splice(-1),n.push(t));var o={};for(var a in n)if(n.hasOwnProperty(a)){var c=n[a];o[c]=Z.curEmojiRecent[c]}Z.setRecentEmojiList(o),window.Notifier&&Notifier.lcSend("recent_emoji_set",o)},setRecentEmojiList:function(e){localStorage.setItem("emoji_recent_list",JSON.stringify(e)),Z.curEmojiRecent=e},updateEmojiCont:function(e){var t=Z.opts[e];t&&0==t.curTab&&((0,g.val)((0,g.geByClass1)("emoji_scroll_smiles",t.tt),Z.getInitEmojiContent(e)),Z.updateEmojiCatTitle(e))},ttEmojiList:function(e,t){var i="",r=Z.emojiGetRecentFromStorage();r&&Z.setRecentEmojiList(r),m.EMOJI_SECTIONS_CODES[-1]=Z.getRecentEmojiSorted();var s=t||Z.SORTED_EMOJI_SECTIONS_CODES;for(var n in s)if(s.hasOwnProperty(n)){var o=s[n];i+=Z.getEmojiCategoryHtml(e,o)}return i},getInitEmojiContent:function(e){Z.setEmojiLastAddedCategoryIdx(e,1);return Z.ttEmojiList(e,[-1,1])},getEmojiCategoryHtml:function(e,t){var i="",r=m.EMOJI_SECTIONS_CODES[t];if(!r.length)return i;var s=-1==t?"recent":t,n='<div class="emoji_cat_title_helper" data-id="'+t+'" id="emoji_recent_list'+e+"_"+t+'"><div class="emoji_cat_title">'+(0,b.getLang)("global_emoji_cat_"+s)+"</div></div>";return i+=n+=Z.emojiGetCatCont(e,r)},getEmojiLastAddedCategoryIdx:function(e){return Z.opts[e].lastLoadedEmojiCategoriesIdxes[e]},setEmojiLastAddedCategoryIdx:function(e,t){Z.opts[e].lastLoadedEmojiCategoriesIdxes[e]=t},addNextEmojiCategoty:function(e){var t=Z.opts[e],i=t.tt,r=Z.getEmojiLastAddedCategoryIdx(e);if(!t.emojiCategoryAdding&&!t.allEmojiLoaded)if(t.emojiCategoryAdding=!0,r){var s=(0,g.geByClass1)("emoji_scroll_smiles",i);if(r++,Z.SORTED_EMOJI_SECTIONS_CODES.length>r){var o=Z.SORTED_EMOJI_SECTIONS_CODES[r];s.insertAdjacentHTML("beforeEnd",Z.getEmojiCategoryHtml(e,o)),Z.setEmojiLastAddedCategoryIdx(e,r),t.emojiScroll.update()}else t.allEmojiLoaded=!0;t.emojiCategoryAdding=!1}else(0,n.debugLog)("No emoji last category idx")},hideTt:function(e){(0,g.removeClass)(e,Z.SHOWN_TT_CLS)},showTt:function(e){(0,g.addClass)(e,Z.SHOWN_TT_CLS)},emojiGetCatCont:function(e,t){for(var i="",r="",s=t.length-1,n=0;n<=s;n++)r+=Z.emojiWrapItem(e,t[n],n),(n>0&&n%10==9||n>=s)&&(i+='<div class="emoji_smiles_row">'+r+"</div>",r="");return i},updateRecentEmoji:function(e){var t=Z.getRecentEmojiSorted(),i=Z.emojiGetCatCont(e,t),r=(0,g.ge)("emoji_recent_list"+e+"_-1");if(r){for(var s=r.nextSibling;s&&(s=s.nextSibling,(0,g.hasClass)(s.previousSibling,"emoji_smiles_row"));)(0,g.re)(s.previousSibling);for(var n=(0,g.ce)("div",{innerHTML:i}),o=r.nextSibling,a=r.parentNode;s=n.firstChild;)a.insertBefore(s,o)}},updateRecentStickers:function(e){var t=Z.opts[e];if(Z.stickers[Z.TAB_RECENT_STICKERS]&&t&&t.emojiExpanded){var i=(0,g.ge)("emoji_recent_stickers_cont"+e);if(i){(0,g.val)(i,"");for(var r=Z.stickers[Z.TAB_RECENT_STICKERS].stickers,s=(0,g.cf)(),n=0;n<r.length;n++){var o=Z.render.sticker(e,Z.TAB_RECENT_STICKERS,r[n]);s.appendChild(o);var a=68*Math.ceil((n+1)/4);t.needLoadStickers.unshift([e+"_"+Z.TAB_RECENT_STICKERS+"_"+r[n][0],a])}i.appendChild(s),Z.updateStickersPos(e)}}},findStickerIndex:function(e,t){if(e)for(var i=e.stickers,r=i.length;r--;)if(String(i[r][0])===String(t))return r;return-1},findSticker:function(e,t){var i=Z.findStickerIndex(e,t);if(-1!==i)return e.stickers[i]},findFavoriteStickerIndex:function(e){return Z.findStickerIndex(Z.stickers[Z.TAB_FAVORITE_STICKERS],e)},findFavoriteSticker:function(e){return Z.findSticker(Z.stickers[Z.TAB_FAVORITE_STICKERS],e)},findRecentStickerIndex:function(e){return Z.findStickerIndex(Z.stickers[Z.TAB_RECENT_STICKERS],e)},findRecentSticker:function(e){return Z.findSticker(Z.stickers[Z.TAB_RECENT_STICKERS],e)},findPackSticker:function(e){if(Z.stickersById&&Z.stickersById.hasOwnProperty(e))return Z.stickersById[e].sticker},isStickersLoaded:function(){if(Z.stickers)for(var e in Z.stickers)if(Z.stickers.hasOwnProperty(e)&&e!==String(Z.TAB_RECENT_STICKERS))return!0;return!1},tabs:{favoriteTabContent:function(e,t){var i=Z.TAB_FAVORITE_STICKERS,r="emoji_tab emoji_tab_img_cont emoji_tab_favorite emoji_tab_"+i;if(cur.stickersTab===i&&(r+=" emoji_tab_sel"),0===t&&Z.isStickersLoaded()){var s=Z.stickers[i];t=s?s.stickers.length:0}return 0===t&&(r+=" unshown"),'<a class="'+r+'" onmousedown="'+e+'" onclick="return cancelEvent(event)"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_favorite"></span></a>'}},favorite:{reminder:function(e){var t=(0,g.hasClass)(e,"on"),i=t?"favoriteRemindOff":"favoriteRemindOn";if(!Z[i]){var r={text:function(){return(0,b.getLang)(t?"purchases_stickers_favorite_rm_tt":"purchases_stickers_favorite_add_tt")},black:1,hidedt:100,typeClass:"tt_black",noZIndex:!0,shift:[10,8]},s=(0,g.domClosest)("ui_scroll_container",e);r.appendEl=s;var n=(0,g.domClosest)("ui_scroll_overflow",e),o=(0,g.getXYRect)(e),a=(0,g.getXYRect)(n),c=o.top-a.top,l=(a.right,o.right,a.bottom-o.bottom),d=o.left-a.left,u=(a.width||a.right-a.left)/2;(!vk.rtl&&d>u||vk.rtl&&d<u)&&(r.needLeft=!0,r.shift[0]=9),r.forcetodown=c<Z.FAV_ICON_TT_MIN_HEIGHT,r.forcetoup=l<Z.FAV_ICON_TT_MIN_HEIGHT,(0,C.showTooltip)(e,r),Z[i]=!0,ajax.post("stickers.php",{act:"tt_favorite_off",tt_type:t?1:2})}},addFavoriteSticker:function(e,t,i){var r=Z.stickers[Z.TAB_FAVORITE_STICKERS];if(r){var s=Z.findPackSticker(t);if(s){s[4]=1,r.stickers.unshift(s);var n=Z.opts[e],o=n.deletedFavoriteStickers;for(n.deletedFavoriteStickers=[t];r.stickers.length>Z.favoriteLimit;)Z.favorite.deleteFavoriteSticker(e,r.stickers[r.stickers.length-1][0]);Z.favorite.deleteFavoriteStickerElements(e),n.deletedFavoriteStickers=o;var a=Z.findRecentSticker(t);a&&(a[4]=1);var c=(0,g.ge)("emoji_favorite_stickers_cont"+e);if(c){var l=Z.opts[e].emojiScroll.data.scrollHeight,d=Z.opts[e].emojiScroll.data.scrollTop,u=(0,g.ge)("emoji_sticker_item"+e+"_"+Z.TAB_FAVORITE_STICKERS+"_"+t);if(!u){u=Z.render.sticker(e,Z.TAB_FAVORITE_STICKERS,s),Z.render.stickerContent(e,u,!1);var _=(0,g.domFC)(c);_?(0,g.domInsertBefore)(u,_):c.appendChild(u),Z.opts[e].emojiScroll.update();var f=Z.opts[e].emojiScroll.data.scrollHeight-l;Z.opts[e].emojiScroll.scrollTop(d+f),Z.updateStickersPos(e)}}var m=(0,g.geByClass1)("emoji_tab_"+Z.TAB_FAVORITE_STICKERS);if((0,g.hasClass)(m,"unshown")&&(Z.opts[e].curTab===Z.TAB_FAVORITE_STICKERS&&(0,g.removeClass)((0,g.geByClass1)("emoji_tab_"+Z.TAB_RECENT_STICKERS),"emoji_tab_sel"),(0,g.removeClass)(m,"unshown")),Z.favorite.updateFavoriteStickerElements(e,t,!0),Z.opts[e].deletedFavoriteStickers.length>0){var h=(0,p.indexOf)(Z.opts[e].deletedFavoriteStickers,t);-1!==h&&Z.opts[e].deletedFavoriteStickers.splice(h,1)}}}},deleteFavoriteSticker:function(e,t,i){var r=Z.stickers[Z.TAB_FAVORITE_STICKERS];if(r){var s=Z.findFavoriteStickerIndex(t);if(-1!==s){if(r.stickers.splice(s,1),Z.opts[e].deletedFavoriteStickers.push(t),0===r.stickers.length&&i)(0,g.addClass)((0,g.geByClass1)("emoji_tab_"+Z.TAB_FAVORITE_STICKERS),"unshown"),(0,g.domData)(i.parentElement,"pack-id")===String(Z.TAB_FAVORITE_STICKERS)&&(0,g.addClass)((0,g.geByClass1)("emoji_tab_"+Z.TAB_RECENT_STICKERS),"emoji_tab_sel");Z.favorite.updateFavoriteStickerElements(e,t,!1);var n=Z.findRecentSticker(t);n&&(n[4]=0);var o=Z.findPackSticker(t);o&&(o[4]=0)}}},deleteFavoriteStickerElement:function(e,t){(0,g.re)("emoji_sticker_item"+e+"_"+Z.TAB_FAVORITE_STICKERS+"_"+t)},deleteFavoriteStickerElements:function(e){var t=Z.opts[e];t.deletedFavoriteStickers.length>0&&(t.deletedFavoriteStickers.forEach((function(t){Z.favorite.deleteFavoriteStickerElement(e,t)})),t.deletedFavoriteStickers=[],Z.updateStickersPos(e))},deleteFavoriteStickerElementsAsync:function(e){var t=Z.opts[e];t.deleteFavoriteStickersTimeout||(t.deleteFavoriteStickersTimeout=setTimeout((function(){Z.favorite.deleteFavoriteStickerElements(e),t.deleteFavoriteStickersTimeout=null}),Z.DELETE_FAV_STICKER_ELEMENTS_DELAY))},updateFavoriteStickerElements:function(e,t,i){(0,g.geByClass)("sticker_item_"+t).forEach((function(e){(0,g.domData)(e,"fav",i?"1":null),(0,g.toggleClass)(e,"faved",i),(0,g.toggleClass)((0,g.geByClass1)("emoji_sticker_item_fav",e),"on",i)}))}},updateEmojiCatTitle:function(e){var t=Z.opts[e];if(t&&t.emojiScroll){var i,r,s,o=(0,g.ge)("emoji_block_"+e),a=(0,g.geByClass)("emoji_cat_title_helper",o),c=t.emojiScroll.data.scrollTop,l=(0,g.geByClass1)("emoji_cats_title_helper",t.tt);if(a.length){var d=a[0];i=Z.getSizeCached(d)[1]}for(var u=a.length-1;u>=0;u--)if(c>a[u].offsetTop-i){r=a[u],s=u;break}if(!r)return(0,n.debugLog)("title not found");var _=(0,p.intval)((0,g.attr)(r,"data-id"));if(t.curEmojiCatId!=_){t.curEmojiCatId=_;var f=[r],m=a[s-1];m&&((0,g.addClass)(m,"emoji_cat_title_fix"),(0,g.setStyle)(m.firstChild,"transform","translateY("+(r.offsetTop-m.offsetTop-i)+"px)"));for(var h=r.nextSibling;h;)(0,g.hasClass)(h,"emoji_cat_title_fix")&&f.push(h),h=h.nextSibling;for(var v in f)f.hasOwnProperty(v)&&((0,g.removeClass)(f[v],"emoji_cat_title_fix"),(0,g.setStyle)(f[v].firstChild,"transform","translateY(0px)"));(0,g.val)(l,""),t.emojiTitleHelperIsSet=0}!t.emojiTitleHelperIsSet&&c>=r.offsetTop&&c>0?((0,g.val)(l,(0,g.val)(r)),t.emojiTitleHelperIsSet=1):t.emojiTitleHelperIsSet&&(c<r.offsetTop||0==c)&&((0,g.val)(l,""),t.emojiTitleHelperIsSet=0)}},emojiWrapItem:function(e,t,i){var r,n=Z.cssEmoji[t];r=n?' title="'+n[1]+'"':"";var o="";return s.browser.mobile||(o=' onmouseover="return Emoji.emojiOver('+e+', this, true);"'),'<a class="emoji_smile_cont '+("2764"!=t&&i&&i<54?"emoji_smile_shadow":"")+'" '+r+" onmousedown=\"Emoji.addEmoji(Emoji.shownId, '"+t+'\', this); return cancelEvent(event);" onclick="return cancelEvent(event);" '+o+'><div class="emoji_bg"></div><div class="emoji_shadow"></div>'+Z.getEmojiHTML(t,!1,!1,!0)+"</a>"},reappendEmoji:function(e,t){var i=Z.opts[e];i&&i.rceCont&&(i.addMediaBtn?i.sendWrap.insertBefore(i.rceCont,i.addMediaBtn):i.sendWrap.appendChild(i.rceCont)),t&&(i.ttWrap?i.ttWrap.appendChild(t):i.emojiWrap?i.emojiWrap.appendChild(t):i.obj.appendChild(t),clearTimeout(cur.ttEmojiHide),Z.hideTt(t))},ttCalcHeight:function(e,t,i){window.headH=window.headH||(0,g.ge)("page_header")&&Z.getSizeCached((0,g.ge)("page_header"))[1]||0;var r=(window.pageNode&&window.browser.mozilla?Math.min((0,g.getSize)(pageNode)[1],window.lastWindowHeight):window.lastWindowHeight)||(0,g.getScroll)()[3],s=window.scrollGetY?(0,d.scrollGetY)():(0,g.getScroll)()[1],n=(0,g.getXY)(t)[1],o=Z.getSizeCached(t)[1],a=(0,g.geByClass1)("emoji_list",i),c=Z.opts[e].emojiSmileHeigh,l=window.headH,u=Z.opts[e].emojiRowsCount;(0,g.isAncestor)(t,pageNode)||(l=0),(0,g.setStyle)(a,{height:u*c+8});for(var _,f,m,h,v=s+l,p=s+r,k=i,S=(0,g.getSize)(i)[1];k!==bodyNode&&(k=(0,g.domClosestOverflowHidden)(k));){var w=(0,g.getXY)(k)[1];v=Math.max(v,w),p=Math.min(p,w+(0,g.getSize)(k)[1])}for(m=p-n-o-9,_=(f=n-9-v)<S&&m<S?f>=m:f>=S,Z.opts[e].forceUp&&(_=!0),h=_?f:m;h<S&&u>3;)u--,S-=c;Z.opts[e].emojiRowsCount=u,Z.opts[e].emojiSmileHeigh=c,(0,g.setStyle)(a,{height:u*c+8}),(0,g.toggleClass)(i,"tt_down",_),(0,g.toggleClass)(i,"tt_up",!_)},repositionEmoji:function(e,t,i){var r,s=Z.opts[e];if(s){if(i.parentNode&&g.getXY&&g.getStyle&&g.setStyle&&g.geByClass&&(r=(0,g.geByClass1)("emoji_rpointer",i))){var n=parseInt((0,g.getStyle)(i,"width")),o=(0,g.getXY)(t)[0],a=parseInt((0,g.getStyle)(t,"width")),c=(0,g.getXY)(i.parentNode)[0];o+a/2<283?((0,g.setStyle)(i,"left",-n-c),(0,g.setStyle)(r,"left",o+a/2-20+"px")):((0,g.setStyle)(i,"left",""),(0,g.setStyle)(r,"left",""))}else(0,g.setStyle)(i,"left","");var l=(0,g.geByClass1)("emoji_list",i),d=(0,g.geByClass1)("emoji_smile_cont",l);if(Z.opts[e].emojiSmileHeigh=d&&Z.getSizeCached(d)[1]||26,Z.opts[e].emojiRowsCount=9,Z.ttCalcHeight(e,t,i),s.ttWrap){var u=(0,g.getSize)(s.ttWrap)[0]-((0,g.getXY)(s.emojiBtn)[0]-(0,g.getXY)(s.ttWrap)[0]);(0,g.setStyle)(i,"right",u-s.ttDiff+"px")}}},emojiOver:function(e,t,i){if(s.browser.mobile||i&&Z.preventMouseOver)return!0;var r=Z.opts[e];(0,g.addClass)(t,"emoji_over"),r.emojiOvered&&r.emojiOvered!=t&&(0,g.removeClass)(r.emojiOvered,"emoji_over"),r.emojiOvered=t},emojiExpand:function(e,t){var i=Z.opts[e];(0,g.addClass)(t,"emoji_expanded"),Z.emojiLoadMore(e),i.emojiScroll?i.emojiScroll.update():(i.emojiScroll=new uiScroll((0,g.geByClass1)("emoji_list",t),{theme:"default emoji no_transition",shadows:!0,global:!0,noForceReFlow:!0,ondragstart:function(){i.scrolling=!0},ondragstop:function(){i.scrolling=!1,(0,E.isFunction)(i.afterScrollFn)&&i.afterScrollFn()},onscrollstart:function(){window.tooltips&&tooltips.destroyAll(),i.scrollStarted=!0},onupdate:function(t){i.curTab==Z.TAB_EMOJI?Z.updateEmojiCategories(t,i,e):Z.updateShownStickers(e)},onresize:e=>{var t=e.container,i=e.data;t.style.setProperty("--scroll-viewport-height",i.viewportHeight+"px")}}),i.imagesLoader=i.imagesLoader||imagesLoader(i.emojiScroll.scroller,{use_iframe:!0,need_load_class:"emoji_need_load"}),i.sharedTT&&(i.sharedTT.emojiScroll=i.emojiScroll)),i.emojiExpanded=!0},updateEmojiCategories:function(e,t,i){e.data.scrollBottom-Z.BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY<=0&&t.scrollStarted&&setTimeout((function(){Z.addNextEmojiCategoty(i),Z.updateEmojiCatTitle(i)}),0),Z.updateEmojiCatTitle(i)},updateShownStickers:function(e,t){var i=Z.opts[e];if(i.emojiScroll&&i.stickersSplitersPos){i.needLoadStickers||(i.needLoadStickers=[]);var r=i.emojiScroll.data.scrollTop,s=r,n=r+i.emojiScroll.data.viewportHeight,o=i.needLoadStickers;clearTimeout(i.preloadStickersTimer);for(var a=[],c=0;c<o.length;c++){var l=o[c];if(l[1]+72>=s&&l[1]<=n){var d=(0,g.ge)("emoji_sticker_item"+l[0]);if(!d||(0,g.hasClass)(d,"__loaded"))continue;var u=Z.render.stickerContent(e,d,!0);a.push([u,l[0]])}}if(Z.loadStickers(e,a),a.length||Z.preloadStickers(e),!(t||i.scrollAnimation||Z.onStickersLoad)){for(var _=-1,f=0;f<i.stickersSplitersPos.length;f++){var m=i.stickersSplitersPos[f];if(!(m[1]-30<r))break;_=m[0]}_!=Z.TAB_FAVORITE_STICKERS&&Z.favorite.deleteFavoriteStickerElementsAsync(e),i.curTab!=_&&Z.scrollToTab(_,e)}}},loadStickers:function(e,t){var i=Z.opts[e];if(t.length){for(var r={},s=0;s<t.length;s++){var n=t[s][0]+":"+t[s][1];i.imagesLoading[n]&&(r[n]=i.imagesLoading[n],delete i.imagesLoading[n],t.splice(s,1),s--)}for(var o in i.imagesLoading)if(i.imagesLoading.hasOwnProperty(o)){var a=i.imagesLoading[o];if(!a)return;a.src=""}for(var c in i.imagesLoading=r,t)if(t.hasOwnProperty(c)){var l=t[c][0]+":"+t[c][1];i.imagesLoading[l]=i.imagesLoader.iloader.add(t[c][0],Z.onStickerLoaded,e+":"+t[c][1])}}},preloadStickers:function(e){var t=Z.opts[e];t.imagesLoading&&Object.keys(t.imagesLoading).length>0||(clearTimeout(t.preloadStickersTimer),t.preloadStickersTimer=setTimeout((function(){var i=t.emojiScroll.data.scrollTop,r=t.emojiScroll.data.viewportHeight,s=i+r,n=i-r,o=i,a=s,c=s+r,l=(0,g.geByClass1)("emoji_scroll_stickers",t.tt);if((0,g.isVisible)(l)){for(var d=l.firstChild,u=[];d;){if((0,g.hasClass)(d,"emoji_sticker_item")&&!(0,g.hasClass)(d,"__loaded")){var _=d.offsetTop;if(_>=n&&_<=o||_>=a&&_<=c){var f=d.id.replace("emoji_sticker_item",""),m=Z.render.stickerContent(e,d,!0);u.push([m,f])}}d=d.nextSibling}Z.loadStickers(e,u)}}),50))},onStickerLoaded:function(e){var t=String(this).split(":"),i=t[1],r=(0,p.intval)(t[0]),s=Z.opts[r],n=(0,g.ge)("emoji_sticker_item"+i);if(n){var o=(0,g.geByTag1)("img",n);if(o){(0,g.addClass)(n,"__loaded"),(0,g.attr)(o,"src",e),delete Z.opts[r].imagesLoading[e+":"+i];for(var a=0;a<s.needLoadStickers.length;a++){if(i==s.needLoadStickers[a][0]){s.needLoadStickers.splice(a,1);break}}Object.keys(Z.opts[r].imagesLoading).length||Z.preloadStickers(r)}}},emojiMove:function(e){var t=Z.shownId,i=Z.opts[t];if(Z.shown&&i&&i.emojiFocused&&i.openedByTabKey){var r=null;if(i.emojiOvered)switch(e.keyCode){case u.KEY.LEFT:r=Z.getEmojiEl(i.emojiOvered,"left"),(0,u.cancelEvent)(e);break;case u.KEY.RIGHT:r=Z.getEmojiEl(i.emojiOvered,"right"),(0,u.cancelEvent)(e);break;case u.KEY.UP:r=Z.getEmojiEl(i.emojiOvered,"up");break;case u.KEY.DOWN:r=Z.getEmojiEl(i.emojiOvered,"down");break;case u.KEY.ENTER:if(!Z.emojiEnter(t,e))return(0,u.cancelEvent)(e),!1;break;default:return!0}else r=Z.getFirstEmojiEl(t);if(r)return Z.preventMouseOver=!0,Z.emojiOver(t,r),Z.scrollToListEl(t,r),!1}return!0},scrollToListEl:function(e,t){var i=Z.opts[e];if(i&&i.emojiScroll){var r=t.offsetTop,s=Math.max(r+30-i.emojiScroll.data.viewportHeight,Math.min(i.emojiScroll.data.scrollTop,r-30));i.emojiScroll.data.scrollTop!=s&&i.emojiScroll.scrollTop(s)}},anim:function(e,t){clearInterval(cur._imAnim);var i=Math.floor(300/13),r=0,s=(0,g.domLC)(e),n=(0,g.domFC)(e),o=t?0:45,a=t?45:0,c=t?1:0,l=t?0:1;cur._imAnim=setInterval((function(){var d=++r>=i?a:o+1.95*r*(t?1:-1),u=d-45,_=r>=i?l:c+.043333333333333335*r*(t?-1:1),f=1-_;s.style.WebkitTransform=s.style.OTransform=s.style.transform="rotate("+d+"deg)",n.style.WebkitTransform=n.style.OTransform=n.style.transform="rotate("+u+"deg)",s.style.opacity=_,n.style.opacity=f,r>=i&&(clearInterval(cur._imAnim),(t?g.addClass:g.removeClass)(e,"emoji_smile_on"),s.style.WebkitTransform=s.style.OTransform=s.style.transform=n.style.WebkitTransform=n.style.OTransform=n.style.transform=s.style.opacity=n.style.opacity="")}),13)},tplSmile:function(e){return'<div class="emoji_smile_wrap _emoji_wrap"><div class="emoji_smile _emoji_btn" title="'+e+'" onmouseenter="return Emoji.show(this, event);" onmouseleave="return Emoji.hide(this, event);" onclick="return cancelEvent(event);"><div class="emoji_smile_icon"></div></div></div>'},emojiToHTML:f.emojiToHTML,emojiReplace:f.emojiReplace,emojiRegex:(0,r.emojiRegex)(),getCode:function(e){var t=!1;if("emoji_css"==e.className)t=e.getAttribute("emoji");else if(-1!=e.className.indexOf("emoji")){var i=e.src&&e.src.match(/\/([a-f0-9*]+)(_2x)?.png/);t=i?i[1]:e.getAttribute("emoji")}return t},showProductSettings(e){(0,A.previewStickerProduct)(e,{settings:!0})},updatePeerInfo(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=Z.opts[e];if("im"===cur.module&&cur.gid)this.renderPeerInfo(e,null);else{var r=this.getPeerId(e);(r!==i.currentPeerId||t)&&(i.currentPeerId=r,r?(i.tt.classList.add("emoji_tt_peer_info_loading"),this.getPeerInfo(r).then((t=>{i.tt.classList.remove("emoji_tt_peer_info_loading"),r===i.currentPeerId&&this.renderPeerInfo(e,t)}))):this.renderPeerInfo(e,null))}},renderPeerInfo(e,t){var i=Z.opts[e];if(t){i.tt.classList.remove("emoji_tt_peer_info_unavailable");var r=t.product_ids.reduce(((e,t)=>(e[t]=1,e)),{});i.tt.querySelectorAll(".emoji_stickers_pack_peer_info").forEach((e=>{var i=e.dataset.productId;if(r.hasOwnProperty(i)){var s=void 0!==e.dataset.isStyle;e.innerHTML=`\n        <img\n          class="emoji_stickers_pack_peer_info__photo"\n          src="${t.photo}"\n          width="16"\n          height="16"\n          loading="lazy"\n        />\n        <div\n          class="emoji_stickers_pack_peer_info__purchased_icon"\n        >\n          ${(0,K.getIcon12CheckCircleFill)().icon}\n        </div>\n        <div\n          class="emoji_stickers_pack_peer_info__tooltip_overlay"\n          data-tooltip-text="${s?t.tooltip_style:t.tooltip_pack}"\n          onmouseover="Emoji.showPeerInfoTooltip(event);"\n        ></div>\n      `}else e.innerHTML=""}))}else i.tt.classList.add("emoji_tt_peer_info_unavailable")},showPeerInfoTooltip(e){(0,C.showTooltip)(e.target,{text:e.target.dataset.tooltipText,center:!0,black:!0,shift:[4,8],appendEl:e.target.closest(".emoji_block_cont")})},getTabCont:function(e,t){var i="";if(t){var r,s="",n="",o="",a=Z.opts[e].forceStickerPack,c=q(window.emojiStickers);try{for(c.s();!(r=c.n()).done;){var l=r.value,d=l[0],u=d===Z.TAB_RECENT_STICKERS,_=d===Z.TAB_FAVORITE_STICKERS,f=l[1],m=l[4]&&a==d;if(f||m){var h=l[8],v=l[9];if(Z.stickers.hasOwnProperty(d)){var p=Z.stickers[d],g=p.stickers,k=p.title,S=p.base_id,w=p.can_gift,y=p.images,j='<div class="clear emoji_stickers_spliter" id="emoji_tab_cont_'+d+"_"+e+'"></div>';if(d===Z.TAB_VMOJI){if(vk.widget)continue;j+=`\n          <div class="emoji_vmoji_stub">\n            <div class="emoji_vmoji_create_avatar">\n              <img class="emoji_vmoji_create_avatar__image" src="${y[W.colorScheme.isDarkScheme()?"dark":"light"]||Object.values(y)[0]}" alt="" />\n              ${P.FlatButton.render({className:"emoji_vmoji_create_avatar__button",appearance:P.FlatButtonAppearance.TERTIARY,size:P.FlatButtonSize.M,children:(0,b.getLang)("vmoji_keyboard_create_avatar"),restAttrs:{onclick:"Emoji.createVmojiAvatar();"}}).outerHTML}\n            </div>\n          </div>\n        `}else if(u)j+='<div class="emoji_recent_stickers_cont" id="emoji_recent_stickers_cont'+e+'">';else if(_)j+='<div class="emoji_favorite_stickers_cont" id="emoji_favorite_stickers_cont'+e+'">';else{if(j+=`\n        <div class="clear emoji_stickers_pack_header">\n          <div class="emoji_stickers_pack_header_main">\n            <div class="emoji_stickers_pack_title">${k}</div>`,S&&!vk.widget)j+=`<a class="${(0,I.classNames)("emoji_stickers_pack_settings",{"emoji_stickers_pack_settings--new":h})}" href="javascript:void(0);" onclick="Emoji.showProductSettings(${S});" title="${(0,b.getLang)("purchases_stickers_keyboard_pack_setup")}">${(0,F.getIcon20GearOutline)().icon}</a>`;if(v&&!vk.widget&&(j+=`\n            <a\n              class="emoji_stickers_pack_settings"\n              href="javascript:void(0);"\n              onclick="Vmoji.showAvatar(${vk.id}, '${v}', ${d});"\n              title="${(0,b.getLang)("purchases_stickers_keyboard_pack_setup")}"\n            >\n              ${(0,F.getIcon20GearOutline)().icon}\n            </a>\n          `),j+='\n          </div>\n          <div class="emoji_stickers_pack_header_aside">',w&&!vk.widget)j+=`\n            <div\n              class="emoji_stickers_pack_peer_info"\n              data-product-id="${d}"\n              ${S&&S!==d?"data-is-style":""}\n            ></div>\n            <a\n              class="emoji_stickers_pack_gift"\n              onclick="Emoji.giftStickerToCurrentPeer(${e}, ${d}, event, { sticker_referrer: &quot;stickers_keyboard2&quot; });"\n            >\n              ${(0,D.getIcon20GiftOutline)().icon}\n            </a>`;j+="\n          </div>\n        </div>"}var T,C=q(g);try{for(C.s();!(T=C.n()).done;){var E=T.value;j+=Z.render.stickerRs(e,d,E)}}catch(e){C.e(e)}finally{C.f()}u?s=j+"</div>":_?n=j+"</div>":v?o+=j:m?i=j+i:i+=j}}}}catch(e){c.e(e)}finally{c.f()}i=n+s+o+i}else i=Z.ttEmojiList(e);return i},updateStickersCont:function(e){var t=Z.opts[e],i=Z.getTabCont(e,Z.tabDefaultId);(0,g.geByClass1)("emoji_scroll_stickers",t.tt).innerHTML=i,t.initedStickers=1,t.imagesLoading=[],clearTimeout(t.preloadStickersTimer),Z.updateStickersPos(e)},updateStickersPos:function(e){for(var t=Z.opts[e],i=[],r=[],s=(0,g.geByClass1)("emoji_scroll_stickers",t.tt).firstChild,n=!1,o=!1;s;){if(!n&&(0,g.hasClass)(s,"emoji_recent_stickers_cont")?(s=s.firstChild,n=!0):!o&&(0,g.hasClass)(s,"emoji_favorite_stickers_cont")&&s.firstChild&&(s=s.firstChild,o=!0),(0,g.hasClass)(s,"emoji_sticker_item")){var a=s.id.replace("emoji_sticker_item","");i.push([a,s.offsetTop])}else if((0,g.hasClass)(s,"emoji_stickers_spliter")){var c=s.id.replace("emoji_tab_cont_","").split("_");r.push([(0,p.intval)(c[0]),s.offsetTop])}(!s.nextSibling&&n||!s.nextSibling&&o)&&(s=s.parentNode),s=s.nextSibling}t.needLoadStickers=i,t.stickersSplitersPos=r},stickerItem:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-opt-id="%optId%" data-sticker-id="%stickerId%" data-pack-id="%selId%" data-src="%stickerUrl%" data-fav="%fav%" data-fav-hash="%favHash%" class="emoji_sticker_item sticker_item_%stickerId% %favClass%" onclick="Emoji.stickerClick(%optId%, %stickerId%, %size%, \'%stickerUrl%\', this, \'%referrer%\');"></a>'},stickerItemAnimation:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-opt-id="%optId%" data-uniq-id="%uniqId%" data-sticker-id="%stickerId%" data-pack-id="%selId%" data-src="%stickerUrl%" data-animation-path="%animationUrl%" data-fav="%fav%" data-fav-hash="%favHash%" class="emoji_sticker_item sticker_item_%stickerId% %favClass%" onclick="Emoji.stickerClick(%optId%, %stickerId%, %size%, \'%stickerUrl%\', this, \'%referrer%\');"></a>'},hintsStickerItemAnimation:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" data-animation-path="%animationUrl%" data-uniq-id="%uniqId%" data-sticker-id="%stickerId%"><img class="emoji_sticker_image sticker_img" src="%stickerUrl%" /></a>'},hintsStickerItem:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)"><img class="emoji_sticker_image" src="%stickerUrl%" /></a>'},tabSwitch:function(e,t,i,r){if(null!=e){var s=Z.opts[i],n=s.tt;"number"==typeof e&&(e=(0,g.geByClass1)("emoji_tab_"+e,n));var o=(0,g.geByClass1)("emoji_scroll_smiles",n),a=(0,g.geByClass1)("emoji_scroll_stickers",n),c=(0,g.geByClass1)("emoji_cats_title_helper",n);if((0,g.val)(c,""),s.curEmojiCatId=null,t==Z.TAB_EMOJI)(0,g.hide)(a),(0,g.show)(o),(0,g.show)(c),s.emojiInited||((0,g.val)(o,Z.getInitEmojiContent(i)),s.emojiInited=!0),s.imagesLoader&&s.imagesLoader.processLoad(),s.emojiOvered&&0===s.curTab&&Z.emojiOver(i,Z.getFirstEmojiEl(i)),s.curTab!=Z.TAB_EMOJI&&s.emojiScroll&&s.emojiScroll.scrollTop(0),Z.updateRecentEmoji(i),Z.updateEmojiCatTitle(i);else{(0,g.hide)(o),(0,g.show)(a),(0,g.hide)(c);var l=Z.stickers&&(0,p.clone)(Z.stickers);if(l&&delete l[Z.TAB_RECENT_STICKERS],!window.emojiStickers||!l||(0,E.isEmpty)(l)||!l[t]&&t!=Z.TAB_RECENT_STICKERS)Z.onStickersLoad=function(){var e;Z.updateTabsOpt(i),(null===(e=Z.stickers)||void 0===e?void 0:e[t])||(t=Z.TAB_RECENT_STICKERS),Z.tabSwitch(t,t,i,r)},Z.stickersLoadingProgress(i,t,e),s.stickersInited=!1,s.curTab=null,Z.emojiLoadMore(i);else{var d=window.emojiStickers.find((e=>e[0]===t));d&&d[7]&&(0,L.updateUserProductState)(t,R.UserProductStateKey.IsNew,0,!1).then((()=>{Array.from(document.querySelectorAll(`.emoji_tab_${t}`)).forEach((e=>{e.classList.remove("emoji_tab_is_new")}))})),s.stickersInited||(Z.updateStickersCont(i),s.stickersInited=!0)}(s.curTab!=t||s.afterLoad)&&(Z.scrollToStickerPack(i,t,s.curTab==Z.TAB_EMOJI),s.afterLoad=0),Z.updateShownStickers(i,!0),s.stickersInited&&Z.updatePeerInfo(i)}Z.onStickersLoad&&t!=Z.TAB_EMOJI||Z.selectTab(i,t,e)}},getFirstEmojiEl:function(e){for(var t=Z.opts[e],i=(0,g.geByClass1)("emoji_scroll_smiles",t.tt).firstChild;i;){if((0,g.hasClass)(i,"emoji_smiles_row"))return i.firstChild;i=i.nextSibling}return null},getEmojiEl:function(e,t){for(var i,r=0,s=e.parentNode,o=0,a=s.firstChild;a&&(o++,a!==e);)a=a.nextSibling;for(;e&&!i;){if("left"==t||"right"==t)(i="left"==t?e.previousSibling:e.nextSibling)||("left"==t?(t="up",o=10):(t="down",o=1));else{if("up"!=t&&"down"!=t)break;for(var c=s;c&&(c="up"==t?c.previousSibling:c.nextSibling)&&!(0,g.hasClass)(c,"emoji_smiles_row"););if(!c)break;if(o&&c)for(var l=0,d=c.firstChild;d&&l<o;){if(++l>=o){i=d;break}d=d.nextSibling}if(i||!c)break;i="up"==t||o&&"down"==t?c.lastChild:c.firstChild}if(++r>20){(0,n.debugLog)("ERR!!");break}}return i},stickerClick:function(e,t,i,r,s,n){var a=Z.opts[e];if(!(Date.now()-a.ttShowT<Z.CLICK_DELAY||a.preventDoubleClick&&Date.now()-a.preventDoubleClick<Z.CLICK_DELAY)){Z.opts[e].preventDoubleClick=Date.now();var c=parseInt((0,g.attr)(s,"data-pack-id")),l=!0;if(window.emojiStickers&&(0,p.each)(window.emojiStickers,(function(e,t){if(t[0]==c)return l=!!t[1],!1})),l){var d=Z.findRecentStickerIndex(t);-1!==d?Z.stickers[Z.TAB_RECENT_STICKERS].stickers.splice(d,1):Z.stickers[Z.TAB_RECENT_STICKERS]||(Z.stickers[Z.TAB_RECENT_STICKERS]={stickers:[]});var u=(0,g.domData)(s,"animation-path")||"",_=(0,g.domData)(s,"fav"),f=(0,g.domData)(s,"fav-hash");Z.stickers[Z.TAB_RECENT_STICKERS].stickers.unshift([t,i,r,u,_,f]),ls.set("recent_stickers",Z.stickers[Z.TAB_RECENT_STICKERS]),a.needUpdateRecentStickers=!0}if(a.onStickerSend){var m,h,v=null===(m=Z.stickersById)||void 0===m||null===(h=m[t])||void 0===h?void 0:h.sticker[Z.STICKER_FIELD_IMAGES];a.onStickerSend(t,n,"animation",v)}(0,o.statlogsValueEvent)("stickers_usage",a.ref,t,n),Z.ttHide(e,!1,!1,!0),a.recentSticker=t}},stickerOver:function(e,t){var i={act:"a_stickers_hover",sticker_id:e,from:cur.module};if((0,E.isObject)(t.tt)&&"IMG"===t.firstChild.nodeName)return t.tt.show();ajax.post("al_im.php",i,{onDone:function(e,i){var r=(cur.tooltips||[]).length,s=["subscribe_post_tt","sticker_extra_tt","sticker_extra_tt"+r,e.image?"":"tt_text_only"];if(s=s.join(" "),e.show){var n={index:r,className:s,content:i,shift:function(){return[-138,0,-200]},hasover:1,slideX:15,showsp:150,cache:1,forcetodown:!0,no_shadow:!0,dir:"left",onShowStart:function(e){var t=e.container,i=(0,g.getSize)(e.container)[1];if(!(i>=225)){var r=(0,p.intval)((225-i)/2)+10,s=(0,p.intval)((0,g.getStyle)(t,"top",!0))+r;(0,g.setStyle)(t,"top",s)}}};(0,g.gpeByClass)("_im_peer_history_w",t)&&(n.appendParentCls="_im_peer_history_w"),(0,C.showTooltip)(t,n)}}})},selectPeer:function(e){if(void 0!==e){var t=Z.opts[e];if(t.peer)return t.peer}var i=cur.peer||(cur.mbTo?cur.mbTo[0]:"");if(-3==i&&cur.wdd.imw_dd){var r=0;for(var s in cur.wdd.imw_dd.selected)cur.wdd.imw_dd.selected.hasOwnProperty(s)&&(i=cur.wdd.imw_dd.selected[s][0],r+=1);r>1&&(i="")}return i},showMyStickers:function(){cur.boxMyStickers=(0,T.showBox)("al_im.php",{act:"stickers_my"},{dark:1,stat:["im.css","imn.js",window.jsc("web/sorter.js")]})},getSelectedStickersStoreTabId(){var e=document.querySelector("#im_stickers_tabs");if(e){var t=e.querySelector(".ui_tab_sel");if(t)return Y(t.parentNode.id.match(/^tbt_stickers_(.*)$/)||[],2)[1]}},showStickersStore:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=Z.selectPeer(!1!==e?e:void 0),n=Z.opts[e];i=$({},i,{act:"stickers_store",peer:s,box:1}),t&&(i.ref=t),cur.boxStickersStore=(0,T.showBox)("al_im.php",i,{dark:1,stat:["im.css","imn.js","page_help.css",window.jsc("web/sorter.js")],params:{onDestroy(){n&&n.onStoreHide&&n.onStoreHide(),cur.boxStickersStore=null}},onDone(){void 0!==r.scrollTop&&((0,H.getBoxLayerWrap)().scrollTop=r.scrollTop)}}),cur.boxStickersStore.reload=()=>{if(cur.boxStickersStore){var i=Z.getSelectedStickersStoreTabId(),r=(0,H.getBoxLayerWrap)().scrollTop;cur.boxStickersStore.hide(),Z.showStickersStore(e,t,{tab:i},{scrollTop:r})}},Z.hideStickersStoreNotification(),(0,p.each)((0,g.geByClass)("emoji_shop_icon_badge"),(function(e,t){(0,g.re)(t)})),Z.hasNewStickers=!1},previewSticker:function(e,t,i,r){if(Q()){var s=(i=i||{}).peerId||Z.selectPeer(),n={recipientIds:s?[s]:[],preview_ref:i.sticker_referrer||"store"};return i.stickerId?(0,A.previewSticker)(i.stickerId,n):(0,A.previewStickerProduct)(e,n),(0,u.cancelEvent)(r),!1}if(i=i||{},r&&(0,u.checkEvent)(r))return!0;var o={act:"sticker_preview",pack_id:e},a=Z.selectPeer();if(i.peer?o.peer=i.peer:a&&(o.peer=a),i.preview&&(o.preview=1),i.gift&&(o.gift=1),i.giftTo&&(o.gift_to=i.giftTo),i.stickerId&&(o.sticker_id=i.stickerId),o.sticker_referrer=i.sticker_referrer||"store",i.name){var c=nav.objLoc[0].split("/");"stickers"==c[0]&&c[1]!=i.name&&nav.setLoc({0:"stickers/"+i.name})}return cur.boxStickersPreview=(0,T.showBox)("al_im.php",o,{dark:1,stat:["im.css","imn.js"],onFail:function(t){if(window.cur.emojiStickersDisabled||(window.cur.emojiStickersDisabled={}),e&&(window.cur.emojiStickersDisabled[e]=!0),t)return!0}}),(0,u.cancelEvent)(r),!1},getStickerPack(e){if(window.emojiStickers){var t=window.emojiStickers.find((t=>t[Z.PACK_FIELD_ID]===e))||null;return Promise.resolve(t)}return new Promise(((t,i)=>{ajax.post("al_im.php",{act:"a_stickers_list"},{onDone(i){window.emojiStickers=i,t(i?Z.getStickerPack(e):null)},onFail:()=>(i(),!0)})}))},getClosestTextInput(e){if(e.getAttribute("contenteditable"))return e;var t=e.closest(".js-im-page, .fc_tab, .mv_chat");return t?t.matches(".fc_tab")?t.querySelector(".fc_editable"):t.matches(".js-im-page")?document.querySelector("._im_text"):t.matches(".mv_chat")?t.querySelector(".mv_chat_reply_input"):null:null},showPackInKeyboard(e,t){var i=Z.getClosestTextInput(t);if(i&&void 0!==i.emojiId){var r=Z.opts[i.emojiId];Z.ttClick(i.emojiId,i.parentNode.parentNode.querySelector("._emoji_btn"),!1,!0);var s=r.tt.querySelector(`.emoji_tab_${e}`),n=void 0!==Object.keys(Z.stickers||{}).find((e=>e!==Z.TAB_RECENT_STICKERS));n?(r.initedStickers=0,Z.tabSwitch(s,e,i.emojiId)):(Z.onStickersLoad=Z.tabSwitch.pbind(e,e,i.emojiId),Z.stickersLoadingProgress(i.emojiId,e,s))}},showVmojiAvatar(e,t,i){var r=(0,c.showBoxLoader)();window.stManager.add(window.jsc("web/vmoji.js")).then((()=>{(0,c.isBoxLoadingCancelled)(r)||((0,c.hideBoxLoader)(),window.Vmoji.showAvatar(e,t,i))}))},clickSticker:function(e,t,i){var r,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(null===(r=window.cur.emojiStickersDisabled)||void 0===r?void 0:r[e])return!0;var n=s.vmoji;if(n&&(0,v.partConfigEnabled)("vmoji")&&!window.vk.widget){var o=n.avatarOwnerId,a=n.avatarCharacterId;return o?(o===window.vk.id&&t?Promise.all([Z.getStickerPack(e),Z.getVmojiAvatar()]).then((i=>{var r=Y(i,2),s=r[0],n=r[1],c=Boolean(null==s?void 0:s[Z.PACK_FIELD_IS_ACTIVE]);n&&n.character_id===a&&c?Z.showPackInKeyboard(e,t):Z.showVmojiAvatar(o,a,e)})):Z.showVmojiAvatar(o,a,e),!1):(window.vk.widget||Z.previewSticker(e,!1,{sticker_referrer:"message"}),!1)}return t?(Z.getStickerPack(e).then((i=>{Boolean(i&&i[Z.PACK_FIELD_IS_ACTIVE])?Z.showPackInKeyboard(e,t):Z.previewSticker(e,!1,{sticker_referrer:"message"})})),!1):(window.vk.widget||Z.previewSticker(e,!1,{sticker_referrer:"message"}),!1)},stickersLoadingProgress:function(e,t,i){var r=Z.opts[e];(0,g.removeClass)((0,g.geByClass1)("emoji_tab_sel",r.tt),"emoji_tab_sel"),(0,g.addClass)(i,"emoji_tab_sel"),(0,g.geByClass1)("emoji_scroll_stickers",r.tt).innerHTML='<div class="emoji_scroll_progress">'+(0,g.rs)(vk.pr_tpl,{id:"",cls:"pr_big"})+"</div>"},buyStickers:function(e,t,i,r,s){if(i&&(0,g.hasClass)(i,"secondary"))return!0;if(Q())return(0,j.lockButton)(i),O.Cart.create([e]).order({hash:r,ref:s}).then((t=>{if((0,j.unlockButton)(i),t&&!t.error){(0,c.showDoneBox)((0,H.getPurchaseResult)(t));try{vk.widget&&window.Rpc&&window.Rpc.callMethod("proxy","updateStickers")}catch(e){}"video_live"===s&&window.Videoview&&window.Videoview.onStickersPurchased(e),(0,v.partConfigEnabled)("stickers_catalog_reload_after_buy")&&(cur.boxStickersStore?cur.boxStickersStore.reload():nav.reload({params:{tab:Z.getSelectedStickersStoreTabId()},preventScroll:!0}))}})),(0,u.cancelEvent)(t);var n=Z.selectPeer();return ajax.post("/al_im.php",{act:"a_stickers_buy",pack_id:e,hash:r,peer:n,sticker_referrer:(0,E.unclean)(s)},{onDone:function(t,i,r,n,o,a){if((0,p.each)((0,g.geByClass)("_sticker_btn_"+e),(function(){this.innerHTML=n,this.onmouseover="",this.onclick="",(0,g.addClass)(this,"secondary")})),cur.boxStickersPreview&&cur.boxStickersPreview.hide(),o&&cur.boxStickersStore&&cur.boxStickersStore.hide(),(0,c.showDoneBox)(t),i){Z.stickers[Z.TAB_RECENT_STICKERS].promoted=a,Z.updateTabs(i,r,!0);try{vk.widget&&window.Rpc&&window.Rpc.callMethod("proxy","updateStickers")}catch(e){}"video_live"===s&&window.Videoview&&window.Videoview.onStickersPurchased(e)}var l=cur.tabbedStickersBox;if(l&&l.tbUpdate)for(var d in l.tbUpdate)l.tbUpdate.hasOwnProperty(d)&&(l.tbUpdate[d]=1);var u=cur.emojiId&&cur.emojiId[cur.peer];if(u){var _=(0,g.geByClass1)("emoji_tab_"+e,Z.opts[u].tt);_&&Z.tabSwitch(_,e,u)}(0,v.partConfigEnabled)("stickers_catalog_reload_after_buy")&&nav.reload({preventScroll:!0})},showProgress:j.lockButton.pbind(i),hideProgress:j.unlockButton.pbind(i),onFail:function(e){return e&&setTimeout((0,T.showFastBox)((0,b.getLang)("global_error"),e).hide,3e3),!0}}),(0,u.cancelEvent)(t)},stickerAct:function(e,t,i,r,s){if(s&&(0,g.hasClass)(e,"secondary"))return!0;var n=(s?(0,g.hasClass)(e,"secondary"):(0,g.hasClass)(e,"_im_sticker_activated"))?1:0,o=cur.tabbedStickersBox;if(o)for(var a in o.tbUpdate)o.tbUpdate.hasOwnProperty(a)&&(o.tbUpdate[a]=1);return ajax.post("/al_im.php",{act:"a_stickers_switch",pack_id:t,hash:i,state:n,from_btn:s?1:0},{onDone:function(i,r,o,a){s||(P.FlatButton.setLabel(e,i),e.onmouseover="",(0,g.setStyle)(e,{width:"auto"}),(0,g.toggleClass)(e,"_im_sticker_activated",!n)),(0,p.each)((0,g.geByClass)("_sticker_btn_"+t),(function(){P.FlatButton.setLabel(this,a),this.onmouseover="",(0,g.toggleClass)(this,"secondary",!n)})),Z.updateTabs(r,o,!0);var c=e.parentNode.parentNode;if(!s){if(cur.stickersSorter.destroy(),n){(0,g.show)("im_stickers_deact");var l=(0,g.ge)("im_stickers_deact_wrap");l.firstChild?l.insertBefore(c,l.firstChild):l.appendChild(c),(0,g.setStyle)(c,{cursor:"default"})}else{(0,g.geByTag1)("div","im_stickers_my_wrap").appendChild(c),(0,g.ge)("im_stickers_deact_wrap").childNodes.length||(0,g.hide)("im_stickers_deact")}cur.stickersSorterInit()}},showProgress:()=>P.FlatButton.lock(e),hideProgress:()=>P.FlatButton.unlock(e)}),(0,u.cancelEvent)(r)},getTabsCode:function(e,t){var i=[];e&&i.push.apply(i,e),i.length>1&&(Z.hasNewStickers=!1);for(var r=Z.opts[t].forceStickerPack,s="",n="",o="",a=0,c=i;a<c.length;a++){var l=c[a],d=l[0],u=l[1],_=l[3],f=l[4]&&d===r,m=l[5];if(u||_||f){var h=l[6],v=l[7],p=l[8],g=l[9],k=void 0;if(u||f?(d>0&&-1===Z.stickerPacksToLoad.indexOf(d)&&Z.stickerPacksToLoad.push(d),k="Emoji.tabSwitch(this, "+d+", "+t+"); return cancelEvent(event);"):k="Emoji.previewSticker("+d+", false, {sticker_referrer: 'keyboard'}); return cancelEvent(event);",l[2]&&(Z.hasNewStickers=l[2]),d===Z.TAB_VMOJI)s+=`\n        <a class="${(0,I.classNames)(`emoji_tab emoji_tab_${d} emoji_tab--vmoji-stub`,{emoji_tab_sel:cur.stickersTab==d})}" onmousedown="${k}" onclick="return cancelEvent(event);">\n          ${(0,z.getIcon24VmojiOutline)().icon}\n        </a>\n      `;else if(d===Z.TAB_RECENT_STICKERS){var S="emoji_tab emoji_tab_img_cont emoji_tab_recent emoji_tab_"+d;cur.stickersTab==d&&(S+=" emoji_tab_sel"),s+='<a class="'+S+'" onmousedown="'+k+'" onclick="return cancelEvent(event);"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_recent"></span></a>'}else if(d===Z.TAB_FAVORITE_STICKERS)s+=Z.tabs.favoriteTabContent(k,h);else if(d){var w="emoji_tab emoji_tab_img_cont emoji_tab_"+d;(v||p)&&(w+=" emoji_tab_is_new"),cur.stickersTab==d&&(w+=" emoji_tab_sel"),u||f||(w+=" emoji_tab_promo"),g&&(w+=" emoji_tab--vmoji");var y='<a class="'+w+'" onmousedown="'+k+'" onclick="return cancelEvent(event);"><img width="22" height="22" src="'+m+'" class="emoji_tab_img" /></a>';g?o+=y:f?n=y+n:n+=y}else{var j="emoji_tab emoji_tab_"+d;cur.stickersTab==d&&(j+=" emoji_tab_sel"),u||(j+=" emoji_tab_promo"),s+='<a class="'+j+'" onmousedown="'+k+'" onclick="return cancelEvent(event);"><div class="emoji_tab_icon emoji_sprite emoji_tab_icon_'+d+'"></div></a>'}}}return o&&(o=`<span class="emoji_tabs_group emoji_tabs_group--vmoji">${o}</span>`),s+o+n},updateTabsOpt:function(e,t){var i=Z.opts[e];if(!i.noStickers){var r=(0,g.ge)("emoji_tabs_cont_"+e);r&&(r.innerHTML=Z.getTabsCode(window.emojiStickers,e)),Z.updateTabsScroll(e),Z.checkNewStickers(i),void 0!==typeof t&&(i.stickersInited=!!t)}},updateTabs:function(e,t,i){e&&i&&window.Notifier&&Notifier.lcSend("emoji",{act:"updateTabs",newStickers:e,keywords:t});var r=0;for(var s in void 0===t?(Z.initStickersKeywords(),window.stickersKeywordsData||(r=1)):(window.stickersKeywordsData=t,Z.setStickersKeywords(window.stickersKeywordsData,i)),void 0===e?window.emojiStickers&&window.stickersKeywordsData||ajax.post("al_im.php",{act:"a_stickers_list",need_keywords:r,cache_time:Z.cachedStickersKeywordsTime()},{onDone:Z.updateTabs}):window.emojiStickers=e,Z.opts)Z.opts.hasOwnProperty(s)&&Z.updateTabsOpt(s,!1);var n=Z.stickers&&(0,p.clone)(Z.stickers);n&&delete n[Z.TAB_RECENT_STICKERS],Z.onStickersLoad&&window.emojiStickers&&!(0,E.isEmpty)(n)&&(Z.onStickersLoad(),Z.onStickersLoad=!1)},showStickersStoreNotification(){Array.from(document.querySelectorAll(".emoji_smile")).filter((e=>!e.querySelector(".emoji_smile_icon_promo"))).forEach((e=>{e.appendChild((0,g.ce)("div",{className:"emoji_smile_icon_promo"}))}));var e=document.querySelector("#l_stickers");e&&e.classList.add("AppLeftMenuWithNotify")},hideStickersStoreNotification(){document.querySelectorAll(".emoji_smile_icon_promo").forEach((e=>{e.parentNode.removeChild(e)}));var e=document.querySelector("#l_stickers");e&&e.classList.remove("AppLeftMenuWithNotify")},checkNewStickers:function(e){var t=e.txt;if(!e.noStickers&&!e.noStickersStore&&window.emojiStickers&&t&&t.getAttribute("contenteditable")){for(var i in window.emojiStickers)if(window.emojiStickers.hasOwnProperty(i)&&window.emojiStickers[i][2]){Z.hasNewStickers=window.emojiStickers[i][2];break}Z.hasNewStickers<0&&!Z.noNewStickers&&setTimeout((()=>Z.showStickersStoreNotification()),(0,g.hasClass)(t,"fc_editable")?200:0)}},giftStickerToCurrentPeer(e,t,i,r){var s=this.getPeerId(e);(0,x.isUserPeer)(s)||(0,x.isChatPeer)(s)?this.giftSticker(t,s,i,r):this.giftSticker(t,"",i,r)},giftSticker:function(e,t,i,r){if(Q())return(0,B.giftStickerProducts)([e],t?String(t).split(",").map((e=>Number(e))):[],{ref:r.sticker_referrer||"store",gift_ref:r.ref}),(0,u.cancelEvent)(i);var s={act:"stickers_gift_box",pack_id:e,peers:t,ref:(r=r||{}).ref};return r.from&&(s.from=r.from),s.sticker_referrer=r.sticker_referrer||"store",boxLayerWrap.scrollTop=0,(0,T.showBox)("/al_im.php",s,{stat:["wide_dd.js","wide_dd.css","notifier.css","notifier.js"],dark:1}),(0,u.cancelEvent)(i)},showStickerTT:function(e){var t=e.getAttribute("data-title");t&&(0,C.showTooltip)(e,{text:t,slide:15,shift:[74-(0,g.getSize)(e)[0]/2,120,5],className:"sticker_hint_tt",hasover:1})},scrollToStickerPack:function(e,t,i){var r=Z.opts[e],s=(0,g.ge)("emoji_tab_cont_"+t+"_"+e),n=s&&t!=Z.tabDefaultId?s.offsetTop+(0,g.getSize)(s)[1]:0;r.scrollAnimation=1,r.emojiScroll.scrollTop(n,i?0:200,(function(){r.scrollAnimation=0})),Z.scrollToTab(t,e)},toggleStickers:function(e,t){var i=Z.opts[e];i&&i.tt?(i.noStickers=t,(0,g.toggleClass)(i.tt,"emoji_no_tabs",t),i.curTab&&Z.tabSwitch(0,0,e)):i&&(i.hideStickersInitial=t)},getSizeCached:function(e){return(e=(0,g.ge)(e))?(void 0!==e[Z.CACHED_WIDTH_PROP]&&void 0!==e[Z.CACHED_HEIGHT_PROP]||(e[Z.CACHED_WIDTH_PROP]=e.offsetWidth,e[Z.CACHED_HEIGHT_PROP]=e.offsetHeight),[e[Z.CACHED_WIDTH_PROP],e[Z.CACHED_HEIGHT_PROP]]):[0,0]},clearSizeCached:function(e){(e=(0,g.ge)(e))&&(e[Z.CACHED_WIDTH_PROP]=void 0,e[Z.CACHED_HEIGHT_PROP]=void 0)},getStickerReferrer:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=Z.opts[t];return i&&"stories"===i.ref?Z.STICKER_REFERRERS.STORY_KEYBOARD:e===Z.TAB_RECENT_STICKERS?Z.STICKER_REFERRERS.RECENT:e===Z.TAB_FAVORITE_STICKERS?Z.STICKER_REFERRERS.FAVORITE:e===Z.TAB_NEW_CONVO_STICKERS?Z.STICKER_REFERRERS.NEW_CONVO:Z.STICKER_REFERRERS.KEYBOARD},render:{sticker:function(e,t,i){var r=Z.render.stickerRs(e,t,i);return(0,g.se)(r)},stickerRs:function(e,t,i){var r={optId:e,selId:t,stickerId:i[0],size:i[1]?i[1]:256,stickerUrl:i[2],fav:i[4]||"",favHash:i[5]||"",referrer:Z.getStickerReferrer(t,e),favClass:i[4]?"faved":""},n="";if(s.browser.msie&&!s.browser.msie_edge||!i[3])n=Z.stickerItem();else{n=Z.stickerItemAnimation();var o=(0,E.rand)(1,1e5);r.animationUrl=i[3],r.uniqId=o}return(0,g.rs)(n,r)},stickerHintRs:function(e,t,i){var r=t,n="";if(t<0)n=window.promotedStickerUrls&&window.promotedStickerUrls[-r];else if(i)n=i[2];else{var o=(0,M.getSticker)(r);o&&(n=(0,N.getStickerImageUrl)(o,64,64))}var a=i?i[3]:"",c={optId:e,selId:0,stickerId:r,stickerUrl:n,class:r<0?"promo":"",onclick:"Emoji.stickerHintClick("+e+", "+r+", '"+n+"', this)"},l="";return(!s.browser.msie||s.browser.msie_edge)&&a&&n?(l=Z.hintsStickerItemAnimation(),c.animationUrl=a,c.class+=" sticker_animation"):n&&(l=Z.hintsStickerItem()),(0,g.rs)(l,c)},stickerContent:function(e,t,i){var r=(0,g.attr)(t,"data-animation-path"),s=(0,g.attr)(t,"data-src"),n="/images/blank.gif";i||(n=s);var o=(0,g.attr)(t,"data-sticker-id"),a=(0,g.attr)(t,"data-fav-hash"),c=(0,g.attr)(t,"data-fav"),l="";r?l='<div data-uniq-id="'+(0,g.attr)(t,"data-uniq-id")+'" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" class="sticker_animation" data-sticker-id="'+o+'" data-animation-path="'+r+'"><img class="sticker_img emoji_sticker_image" src="'+n+'" data-src="'+s+'"/></div>':l='<img class="emoji_sticker_image" src="'+n+'" data-src="'+s+'"/>';if(Z.favoriteAvailable){var d="";1==c&&(d="on"),l+=`<span role="link"\n               onmouseover="Emoji.favorite.reminder(this)"\n               class="emoji_sticker_item_fav ${d}"\n               data-sticker-id="${o}"\n               data-hash="${a}"\n               onmousedown="Stickers.toggleFavorite(this, event, ${e}); cancelEvent(event);"\n               onclick="cancelEvent(event)"></span>`}return(0,g.val)(t,l),s}},_vmojiAvatarCache:void 0,getVmojiAvatar:()=>void 0!==Z._vmojiAvatarCache?Promise.resolve(Z._vmojiAvatarCache):(0,U.vmojiGetAvatar)().then((e=>{var t=e.avatar,i=void 0===t?null:t;return Z._vmojiAvatarCache=i,i})),resetVmojiAvatarCache(){Z._vmojiAvatarCache=void 0},createVmojiAvatar(){var e=(0,c.showBoxLoader)();window.stManager.add(window.jsc("web/vmoji.js")).then((()=>{(0,c.isBoxLoadingCancelled)(e)||((0,c.hideBoxLoader)(),window.Vmoji.createAvatar())}))},resetStickersCache(){Z.stickers={},Z.resetVmojiAvatarCache(),cur.boxMyStickers&&(cur.boxMyStickers.isVisible()||cur.boxMyStickers.setOptions({onShow(){cur.boxMyStickers.hide(),Z.showMyStickers()}}))},__eof:1}},494422:(e,t,i)=>{"use strict";i.d(t,{getCaretBoundingRect:()=>r});var r=function(e){var t=e.getBoundingClientRect(),i=null,r=null;if(t.top===t.bottom)return{left:0,top:0,bottom:0};if(document.selection)(i=(r=document.selection.createRange()).getClientRects()||[]).length||(r.text="_",r.moveStart("character",-1),i=r.getClientRects(),r.text=""),i=i[i.length-1];else if(window.getSelection){var s=getSelection();if(s.anchorNode){if((r=s.getRangeAt(0)).collapsed){var n=r.startOffset;r.setStart(r.startContainer,0),i=r.getClientRects(),r.setStart(r.startContainer,n)}i=i&&i.length?i[i.length-1]:{right:t.left,top:t.top,bottom:t.top}}else i={right:0,top:0,bottom:0}}return{left:i.right-t.left,top:i.top-t.top,bottom:i.bottom-t.top}}},408270:(e,t,i)=>{"use strict";i.d(t,{EMOJI_SECTIONS_CODES:()=>n});i(991181),i(296253);var r=i(754259),s={1:["😀","😃","😄","😁","😅","😆","😂","🤣","😉","😊","☺","🙂","🙃","😇","😗","😙","😚","😘","😍","🥰","🤩","🤗","😋","😜","🤪","😛","😝","🤑","🤭","🤐","🤫","😶","🤔","🤨","🧐","😐","😑","🙄","😬","🤥","😏","😌","🤤","😴","🤓","😎","🥳","🤠","😒","😔","😪","😕","😟","🙁","☹","😮","😯","😲","😳","🥺","😦","😧","😨","😰","😥","😢","😭","😱","😖","😣","😞","😓","😩","😫","😷","🤒","🤕","🤢","🤮","🤧","🥶","🥵","🥴","😵","🤯","😤","😠","😡","🤬","😈","👿","💀","☠","💩","🤡","👹","👺","👻","👽","👾","🤖","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🙈","🙉","🙊","🦠"],2:["🐵","🐒","🦍","🐶","🐕","🐩","🐺","🦊","🦝","🐱","🐈","🦁","🐯","🐅","🐆","🐴","🐎","🦄","🦓","🦌","🐮","🐂","🐃","🐄","🐷","🐽","🐖","🐗","🐏","🐑","🐐","🐪","🐫","🦙","🦒","🐘","🦏","🦛","🐭","🐁","🐀","🐹","🐰","🐇","🐿","🦔","🦇","🐻","🐨","🐼","🦘","🦡","🐾","🦃","🐔","🐓","🐣","🐤","🐥","🐦","🐧","🕊","🦅","🦆","🦢","🦉","🦚","🦜","🐸","🐊","🐢","🦎","🐍","🐲","🐉","🦕","🦖","🐳","🐋","🐬","🐟","🐠","🐡","🦈","🐙","🦀","🦞","🦐","🦑","🐚","🐌","🦋","🐛","🐜","🐝","🐞","🦗","🕷","🕸","🦂","🦟","💐","🌸","💮","🏵","🌹","🥀","🌺","🌻","🌼","🌷","🌳","🌲","🎄","🌴","🌵","🌾","🌱","🌿","☘","🍀","🍁","🍂","🍃","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌙","🌚","🌛","🌜","🌡","☀","🌝","🌞","⭐","🌟","🌠","☁","⛅","⛈","🌤","🌥","🌦","🌧","🌨","🌩","🌪","🌫","🌬","💨","🌀","🌈","🌂","☂","☔","⛱","⚡","❄","☃","⛄","☄","🔥","💦","💧","🌊"],3:["👍🏻","👎🏻","👌🏻","✌🏻","🤞🏻","🤟🏻","🤘🏻","🤙🏻","🖕🏻","✊🏻","👊🏻","🤛🏻","🤜🏻","👈🏻","👉🏻","👆🏻","👇🏻","☝🏻","👋🏻","🤚🏻","🖐🏻","✋🏻","🖖🏻","👏🏻","🙌🏻","👐🏻","🤲🏻","🤝🏻","🙏🏻","💪🏻","🦵🏻","🦶🏻","👂🏻","👃🏻","🧠","🦷","🦴","👀","👁","👅","👄","✍🏻","💅🏻","🤳","👫","👭","👬","👩‍❤️‍💋‍👨","👨‍❤️‍💋‍👨","👩‍❤️‍💋‍👩","👩‍❤️‍👨","👨‍❤️‍👨","👩‍❤️‍👩","👪","👶","🧒","👦","👧","🧑","👱","👨","🧔","👱‍♂️","👨‍🦰","👨‍🦱","👨‍🦳","👨‍🦲","👩","👱‍♀️","👩‍🦰","👩‍🦱","👩‍🦳","👩‍🦲","🧓️","👴️","👵️","🙍‍♂️️","🙍‍♀️️","🙎‍♂️","🙎‍♀️️","🙅‍♂️","🙅‍♀️","🙆‍♂️","🙆‍♀️","💁‍♂️","💁‍♀️️","🙋‍♂️","🙋‍♀️️","🙇‍♂️","🙇‍♀️️","🤦‍♂️","🤦‍♀️","🤷‍♂️","🤷‍♀️","💆‍♂️️","💆‍♀️","💇‍♂️️","💇‍♀️","🚶‍♂️️","🚶‍♀️️","🏃‍♂️️","🏃‍♀️","💃","🕺","🕴️","👯‍♂️️","👯‍♀️","🧖‍♂️","🧖‍♀️️","👼","🎅","🤶","🦸‍♂️","🦸‍♀️","🦹‍♂️","🦹‍♀️","🧙‍♂️","🧙‍♀️","🧚‍♂️","🧚‍♀️","🧛‍♂️","🧛‍♀️","🧜‍♂️","🧜‍♀️","🧝‍♂️","🧝‍♀️","🧞‍♂️","🧞‍♀️","🧟‍♂️","🧟‍♀️","👨‍⚕️","👩‍⚕️","👨‍🎓","👩‍🎓","👨‍🏫","👩‍🏫","👨‍⚖️","👩‍⚖️","👨‍🌾","👩‍🌾","👨‍🍳","👩‍🍳","👨‍🔧","👩‍🔧","👨‍🏭","👩‍🏭","👨‍💼","👩‍💼","👨‍🔬","👩‍🔬","👨‍💻","👩‍💻","👨‍🎤","👩‍🎤","👨‍🎨","👩‍🎨","👨‍✈️","👩‍✈️","👨‍🚀","👩‍🚀","👨‍🚒","👩‍🚒","👮‍♂️","👮‍♀️","🕵️‍♂️","🕵️‍♀️","💂‍♂️","💂‍♀️","👷‍♂️","👷‍♀️","🤴","👸","👳‍♂️","👳‍♀️","👲","🧕","🤵","👰","🤰","🤱","🛀","🛌"],4:["🍏","🍎","🍐","🍅","🥝","🍑","🍒","🍓","🍇","🍈","🍉","🍊","🍋","🍌","🍍","🥭","🥥","🥑","🍆","🥔","🥕","🌽","🌶","🥒","🥬","🥦","🍄","🥜","🌰","🍞","🥐","🥖","🥨","🥯","🥞","🧀","🍖","🍗","🥩","🥓","🍔","🍟","🍕","🌭","🥪","🌮","🌯","🥙","🥚","🍳","🥘","🍲","🥣","🥗","🍿","🧂","🥫","🍱","🍘","🍙","🍚","🍛","🍜","🍝","🍠","🍢","🍣","🍤","🍥","🥮","🍡","🥟","🥠","🥡","🍦","🍧","🍨","🍩","🍪","🎂","🍰","🧁","🥧","🍫","🍬","🍭","🍮","🍯","🍼","🥛","☕","🍵","🍶","🍾","🍷","🍸","🍹","🍺","🍻","🥂","🥃","🥤","🥢","🍽","🍴","🥄"],5:["⚽","⚾","🥎","🏀","🏐","🏈","🏉","🎾","🥏","🎳","🏏","🏑","🏒","🥍","🏓","🏸","🥊","🥋","🥅","⛳","⛸","🎣","🎽","🛹","🎿","🛷","🥌","🎯","🎱","🎮","🕹","🎰","🎲","🧩","♟","🧗‍♂️️","🧗‍♀️","🤺","🏇","⛷","🏂","🏌️‍♂️","🏌️‍♀️","🏄‍♂️","🏄‍♀️","🚣‍♂️","🚣‍♀️","🏊‍♂️","🏊‍♀️","⛹️‍♂️","⛹️‍♀️","🏋️‍♂️","🏋️‍♀️","🚴‍♂️","🚴‍♀️","🚵‍♂️","🚵‍♀️","🤸","🤼‍♂️","🤼‍♀️","🤽‍♂️","🤽‍♀️","🤾‍♂️","🤾‍♀️","🤹‍♂️","🤹‍♀️","🧘‍♂️","🧘‍♀️","🎖","🏆","🏅","🥇","🥈","🥉"],6:["🚂","🚃","🚄","🚅","🚆","🚇","🚈","🚉","🚊","🚝","🚞","🚋","🚌","🚍","🚎","🚐","🚑","🚒","🚓","🚔","🚕","🚖","🚗","🚘","🚙","🚚","🚛","🚜","🏎","🏍","🛵","🚲","🛴","🚏","🛣","🛤","🛢","⛽","🚨","🚥","🚦","🛑","🚧","⚓","⛵","🛶","🚤","🛳","⛴","🛥","🚢","✈","🛩","🛫","🛬","💺","🚁","🚟","🚠","🚡","🛰","🚀","🛸","🌍","🌎","🌏","🌐","🗺","🗾","🧭","🏔","⛰","🌋","🗻","🏕","🏖","🏜","🏝","🏞","🏟","🏛","🏗","🧱","🏘","🏚","🏠","🏡","🏢","🏣","🏤","🏥","🏦","🏨","🏩","🏪","🏫","🏬","🏭","🏯","🏰","💒","🗼","🗽","⛪","🕌","🕍","⛩","🕋","⛲","⛺","🌁","🌃","🏙","🌄","🌅","🌆","🌇","🌉","♨","🌌","🎠","🎡","🎢","💈","🎪"],7:["🎙","🎚","🎛","🎤","🎧","📻","🎷","🎸","🎹","🎺","🎻","🥁","📯","🎭","🖼","🎨","🧵","🧶","🔮","🧿","🧸","🃏","🀄","🎴","🎃","🎆","🎇","🧨","✨","🎈","🎉","🎊","🎋","🎍","🎎","🎏","🎐","🎑","🧧","🎀","🎁","🎗","🎟","🎫","🛎","🧳","⌛","⏳","⌚","⏰","⏱","⏲","🕰","👓","🕶","🥽","🥼","👔","👕","👖","🧣","🧤","🧥","🧦","👗","👘","👙","👚","👛","👜","👝","🛍","🎒","👞","👟","🥾","🥿","👠","👡","👢","👑","👒","🎩","🎓","🧢","⛑","📿","💄","💍","💎","📱","📲","☎","📞","📟","📠","🔋","🔌","💻","🖥","🖨","⌨","🖱","🖲","💽","💾","💿","📀","🧮","🎥","🎞","📽","🎬","📺","📷","📸","📹","📼","🔍","🔎","🕯","💡","🔦","🏮","📔","📕","📖","📗","📘","📙","📚","📓","📒","📃","📜","📄","📰","🗞","📑","🔖","🏷","💰","💴","💵","💶","💷","💸","💳","🧾","💹","💱","💲","✉","💌","📧","📨","📩","📤","📥","📦","📫","📪","📬","📭","📮","🗳","✏","✒","🖋","🖊","🖌","🖍","📝","💼","📁","📂","🗂","📅","📆","🗒","🗓","📇","📈","📉","📊","📋","📌","📍","📎","🖇","📏","📐","✂","🗃","🗄","🗑","🔒","🔓","🔏","🔐","🔑","🗝","🔨","⛏","⚒","🛠","🗡","⚔","🔪","🔫","🏹","🛡","🔧","🔩","⚙","🗜","⚖","🔗","⛓","🧰","🧲","⚗","🧪","🧫","🧬","🔬","🔭","📡","💉","💊","🚪","🛏","🛋","🚽","🚿","🛁","🧴","🧷","🧹","🧺","🧻","🧼","🧽","🧯","🛒","🚬","⚰","⚱","🏺","🗿"],8:["💋","❤","💔","❣","💘","💝","💖","💗","💓","💞","💕","💟","💜","🧡","💛","💚","💙","🖤","💯","💢","💥","💫","🕳","💣","💬","👁️‍🗨️","🗨","🗯","💭","💤","🗣","👤","👥","👣","🔇","🔊","📢","📣","🔔","🔕","🎼","🎵","🎶","⚠","🚸","☢","☣","🆚","🆓","🆕","🚮","🚾","🚭","✅","♻","⚕","🔱","‼","⁉","❓","❗","🆘","⛔","🚫","🚳","🚯","🚱","🚷","📵","🔞"],9:["🇷🇺","🇰🇿","🇧🇾","🇺🇦","🇲🇳","🇬🇪","🇦🇿","🇹🇯","🇧🇷","🇱🇹","🇱🇻","🇪🇪","🇦🇲","🏁","🚩","🎌","🏴","🏳","🏳️‍🌈","🏴‍☠️","🇦🇨","🇦🇩","🇦🇪","🇦🇫","🇦🇬","🇦🇮","🇦🇱","🇦🇴","🇦🇶","🇦🇷","🇦🇸","🇦🇹","🇦🇺","🇦🇼","🇦🇽","🇧🇦","🇧🇧","🇧🇩","🇧🇪","🇧🇫","🇧🇬","🇧🇭","🇧🇮","🇧🇯","🇧🇱","🇧🇲","🇧🇳","🇧🇴","🇧🇶","🇧🇸","🇧🇹","🇧🇻","🇧🇼","🇧🇿","🇨🇦","🇨🇨","🇨🇩","🇨🇫","🇨🇬","🇨🇭","🇨🇮","🇨🇰","🇨🇱","🇨🇲","🇨🇳","🇨🇴","🇨🇵","🇨🇷","🇨🇺","🇨🇻","🇨🇼","🇨🇽","🇨🇾","🇨🇿","🇩🇪","🇩🇬","🇩🇯","🇩🇰","🇩🇲","🇩🇴","🇩🇿","🇪🇨","🇪🇬","🇪🇭","🇪🇷","🇪🇸","🇪🇹","🇪🇺","🇫🇮","🇫🇯","🇫🇰","🇫🇲","🇫🇴","🇫🇷","🇬🇦","🇬🇧","🇬🇩","🇬🇫","🇬🇬","🇬🇭","🇬🇮","🇬🇱","🇬🇲","🇬🇳","🇬🇵","🇬🇶","🇬🇷","🇬🇸","🇬🇹","🇬🇺","🇬🇼","🇬🇾","🇭🇰","🇭🇲","🇭🇳","🇭🇷","🇭🇹","🇭🇺","🇮🇨","🇮🇩","🇮🇪","🇮🇱","🇮🇲","🇮🇳","🇮🇴","🇮🇶","🇮🇷","🇮🇸","🇮🇹","🇯🇪","🇯🇲","🇯🇴","🇯🇵","🇰🇪","🇰🇬","🇰🇭","🇰🇮","🇰🇲","🇰🇳","🇰🇵","🇰🇷","🇰🇼","🇰🇾","🇱🇦","🇱🇧","🇱🇨","🇱🇮","🇱🇰","🇱🇷","🇱🇸","🇱🇺","🇱🇾","🇲🇦","🇲🇨","🇲🇩","🇲🇪","🇲🇫","🇲🇬","🇲🇭","🇲🇰","🇲🇱","🇲🇲","🇲🇴","🇲🇵","🇲🇶","🇲🇷","🇲🇸","🇲🇹","🇲🇺","🇲🇻","🇲🇼","🇲🇽","🇲🇾","🇲🇿","🇳🇦","🇳🇨","🇳🇪","🇳🇫","🇳🇬","🇳🇮","🇳🇱","🇳🇴","🇳🇵","🇳🇷","🇳🇺","🇳🇿","🇴🇲","🇵🇦","🇵🇪","🇵🇫","🇵🇬","🇵🇭","🇵🇰","🇵🇱","🇵🇲","🇵🇳","🇵🇷","🇵🇸","🇵🇹","🇵🇼","🇵🇾","🇶🇦","🇷🇪","🇷🇴","🇷🇸","🇷🇼","🇸🇦","🇸🇧","🇸🇨","🇸🇩","🇸🇪","🇸🇬","🇸🇭","🇸🇮","🇸🇯","🇸🇰","🇸🇱","🇸🇲","🇸🇳","🇸🇴","🇸🇷","🇸🇸","🇸🇹","🇸🇻","🇸🇽","🇸🇾","🇸🇿","🇹🇦","🇹🇨","🇹🇩","🇹🇫","🇹🇬","🇹🇭","🇹🇰","🇹🇱","🇹🇲","🇹🇳","🇹🇴","🇹🇷","🇹🇹","🇹🇻","🇹🇼","🇹🇿","🇺🇬","🇺🇲","🇺🇳","🇺🇸","🇺🇾","🇺🇿","🇻🇦","🇻🇨","🇻🇪","🇻🇬","🇻🇮","🇻🇳","🇻🇺","🇼🇫","🇼🇸","🇽🇰","🇾🇪","🇾🇹","🇿🇦","🇿🇲","🇿🇼"]},n=Object.keys(s).reduce(((e,t)=>(e[t]=s[t].map((e=>(0,r.emojiSymbolToByteHex)(e))),e)),{})},857748:(e,t,i)=>{"use strict";i.d(t,{parseAttachmentId:()=>r,prepareImageBounds:()=>s,getPhotoSize:()=>n});i(991181),i(296253),i(796409),i(820075),i(21466);function r(e){if(!e||"string"!=typeof e)return null;var t=e.match(/(photo|doc)(-?\d+)_(\d+)/);if(!t)return null;var i=t[1],r=parseInt(t[2]),s=parseInt(t[3]),n=[r,s].join("_");return{type:i,ownerId:r,id:s,rawId:n}}function s(e,t){var i=e;return e>68&&(i=68),t>68&&(i=68*e/t),[i,i*(t/e)]}function n(e,t,i){if(!e||!t||!i)return null;var r=Object.values(e).sort(((e,t)=>e[1]-t[1]||e[2]-t[2]));return r.find((e=>e[1]>=t&&e[2]>=i))||r[parseInt(r.length/2)]||r[0]}},11122:(e,t,i)=>{"use strict";i.d(t,{default:()=>p});i(175115),i(530522),i(66108),i(579665),i(95767),i(991181),i(296253),i(83276),i(59357),i(21466),i(283946);var r=i(962857),s=i(850167);function n(){return n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},n.apply(this,arguments)}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],r=!0,s=!1,n=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(i.push(o.value),!t||i.length!==t);r=!0);}catch(e){s=!0,n=e}finally{try{r||null==a.return||a.return()}finally{if(s)throw n}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return a(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var c=["мне","тебе","ему","ей","маме","папе","сестре","брату","родителям"],l=["ден(?:ьги|ежки|ьгу|ежку|ег|ежек|як)","дол(?:г|жок)","(?:(?:в|на)\\s)подар(?:ок|ки)"],d=["переводом","(?:(?:по|на)\\s)(?:номеру?\\s)?(?:карт(?:у|очку|ы|очки)|тел(?:ефона)?)","(?:по\\s)?безнал(?:у|ичке|ом|ичкой)","на\\sсбер(?:банк)?"],u=["сот(?:оч)ку","\\d+(?:\\s*р(?:[.,\\s]|уб(?:лей)?|$))?"],_=new RegExp(`(${u.join(")|(")})`);function f(e,t){return"amount"===e?function(e){var t=e.match(_);if(t){if(t[1])return 100;if(t[2])return parseInt(t[2])}return 0}(t):t}var m=new RegExp(`^(?:(${["(?:за|с|пере)?кин(?:ь(?:ся)?|ьте(?:сь)?|ешь(?:ся)?|ете(?:сь)?)","переве(?:ди|дите|дешь|дете)","отправ(?:ь|ьте|ишь|ите)","соб(?:ери|ерите|ерешь|ерете)","(?:от)?да(?:й|йте|шь|дите)","верн(?:и|ите|ешь|ете)","возвра(?:ти|тите|тишь|щай|щайте)","займ(?:и|ите|ешь)"].join("|")})|(${["перевод","(?:за|с|пере)?кин(?:уть(?:ся)?|у(?:сь)?|ем(?:ся)?)","переве(?:сти|вожу|дим|ду|ем)","отправ(?:ить|ляю|ляем|лю|им)","(?:со)?б(?:рать|ираю|ираем|еру|ерем)","(?:от)?да(?:ть|ю|ем|м|дим)","верн(?:уть|у|ем)","возвра(?:тить|щу|тим|щаю|щаем)"].join("|")}))((?:\\s+(?:${[...c,...l,...d,...u].join("|")}))+)\\s*$`),h=new RegExp(`(${c.join("|")})|(${l.join("|")})|(${d.join("|")})|(${u.join("|")})`,"gi"),v={DEFAULT_QUERY:"деньги",introViewed:!1,match:function(e){var t=e.toLowerCase().replace(/ё/g,"е").match(m);if(t){for(var i={input:e,request:t[1],send:t[2],context:t[3]};t=h.exec(i.context),t;)for(var r={receiver:t[1],subject:t[2],method:t[3],amount:t[4]},s=0,n=Object.entries(r);s<n.length;s++){var a=o(n[s],2),c=a[0],l=a[1];l&&(i[c]=f(c,l))}if(i.subject||i.method||i.amount)return i}return null},setIntroViewed:function(e){this.introViewed=e},onClick:function(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(this.introViewed){var c=[e,t,i,o].join("_");r.MoneyTransfer.showMoneyTransferBox({tab:i,amount:o,owner_id:e,to_id:t,from:"sticker_link"},{cache:this.lastBoxId===c},void 0,(()=>{cur.paymentsOptions&&(cur.paymentsOptions.onSendStart=a.onSendStart)})),this.lastBoxId=c}else(0,s.showWiki)(n({w:"moneysend_promo",fromId:e,toId:t,action:i},o?{amount:o}:{})),this.introViewed=!0}};const p=v},748759:(e,t,i)=>{"use strict";i.d(t,{useInView:()=>p});var r=i(667294),s=i(702177);function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},o.apply(this,arguments)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var c=new Map,l=new Map,d=new Map,u=0;function _(e,t,i){void 0===i&&(i={}),i.threshold||(i.threshold=0);var r=i,n=r.root,o=r.rootMargin,a=r.threshold;if(c.has(e)&&(0,s.default)(!1),e){var _=function(e){return e?d.has(e)?d.get(e):(u+=1,d.set(e,u.toString()),d.get(e)+"_"):""}(n)+(o?a.toString()+"_"+o:a.toString()),f=l.get(_);f||(f=new IntersectionObserver(m,i),_&&l.set(_,f));var h={callback:t,element:e,inView:!1,observerId:_,observer:f,thresholds:f.thresholds||(Array.isArray(a)?a:[a])};return c.set(e,h),f.observe(e),h}}function f(e){if(e){var t=c.get(e);if(t){var i=t.observerId,r=t.observer,s=r.root;r.unobserve(e);var n=!1,o=!1;i&&c.forEach((function(t,r){r!==e&&(t.observerId===i&&(n=!0,o=!0),t.observer.root===s&&(o=!0))})),!o&&s&&d.delete(s),r&&!n&&r.disconnect(),c.delete(e)}}}function m(e){e.forEach((function(e){var t=e.isIntersecting,i=e.intersectionRatio,r=e.target,s=c.get(r);if(s&&i>=0){var n=s.thresholds.some((function(e){return s.inView?i>e:i>=e}));void 0!==t&&(n=n&&t),s.inView=n,s.callback(n,e)}}))}var h=function(e){var t,i;function c(){for(var t,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return n(a(t=e.call.apply(e,[this].concat(r))||this),"state",{inView:!1,entry:void 0}),n(a(t),"node",null),n(a(t),"handleNode",(function(e){t.node&&(f(t.node),e||t.props.triggerOnce||t.setState({inView:!1,entry:void 0})),t.node=e||null,t.observeNode()})),n(a(t),"handleChange",(function(e,i){(e!==t.state.inView||e)&&t.setState({inView:e,entry:i}),t.props.onChange&&t.props.onChange(e,i)})),t}i=e,(t=c).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var l=c.prototype;return l.componentDidMount=function(){this.node||(0,s.default)(!1)},l.componentDidUpdate=function(e,t){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold||(f(this.node),this.observeNode()),t.inView!==this.state.inView&&this.state.inView&&this.props.triggerOnce&&(f(this.node),this.node=null)},l.componentWillUnmount=function(){this.node&&(f(this.node),this.node=null)},l.observeNode=function(){if(this.node){var e=this.props,t=e.threshold,i=e.root,r=e.rootMargin;_(this.node,this.handleChange,{threshold:t,root:i,rootMargin:r})}},l.render=function(){var e=this.state,t=e.inView,i=e.entry;if(!function(e){return"function"!=typeof e.children}(this.props))return this.props.children({inView:t,entry:i,ref:this.handleNode});var s=this.props,n=s.children,a=s.as,c=s.tag,l=(s.triggerOnce,s.threshold,s.root,s.rootMargin,s.onChange,function(e,t){if(null==e)return{};var i,r,s={},n=Object.keys(e);for(r=0;r<n.length;r++)i=n[r],t.indexOf(i)>=0||(s[i]=e[i]);return s}(s,["children","as","tag","triggerOnce","threshold","root","rootMargin","onChange"]));return(0,r.createElement)(a||c||"div",o({ref:this.handleNode},l),n)},c}(r.Component);n(h,"displayName","InView"),n(h,"defaultProps",{threshold:0,triggerOnce:!1});var v={inView:!1,entry:void 0};function p(e){void 0===e&&(e={});var t=(0,r.useRef)(),i=(0,r.useState)(v),s=i[0],n=i[1],o=(0,r.useCallback)((function(i){t.current&&f(t.current),i&&_(i,(function(t,r){n({inView:t,entry:r}),t&&e.triggerOnce&&f(i)}),e),t.current=i}),[e.threshold,e.root,e.rootMargin,e.triggerOnce]);return(0,r.useEffect)((function(){t.current||s===v||e.triggerOnce||n(v)})),[o,s.inView,s.entry]}},702177:(e,t,i)=>{"use strict";i.d(t,{default:()=>s});var r="Invariant failed";const s=function(e,t){if(!e)throw new Error(r)}},654921:(e,t,i)=>{"use strict";i.d(t,{STICKER_PACK_ICON:()=>a,STICKER_PACK_THUMB:()=>c,STICKER_IMAGE:()=>l,STICKER_ANIMATION:()=>d,DEFAULT_CACHE:()=>u,SAMPLE_RECIPIENT_ID:()=>_,ORDER_ERRORS:()=>s,ORDER_ITEM_ERRORS:()=>n});var r,s,n,o=i(749091),a={square_png:{id:"square.png",width:104,height:104},square_15x_png:{id:"square_1.5x.png",width:156,height:156},square_2x_png:{id:"square_2x.png",width:208,height:208},square_3x_png:{id:"square_3x.png",width:312,height:312},square_4x_png:{id:"square_4x.png",width:416,height:416}},c={"102_png":{id:"102.png",width:102,height:102,theme:o.Theme.LIGHT},"51_png":{id:"51.png",width:51,height:51,theme:o.Theme.LIGHT},"68_png":{id:"68.png",width:68,height:68,theme:o.Theme.LIGHT},"34_png":{id:"34.png",width:34,height:34,theme:o.Theme.LIGHT},"60_png":{id:"60.png",width:60,height:60,theme:o.Theme.LIGHT},"30_png":{id:"30.png",width:30,height:30,theme:o.Theme.LIGHT},"102b_png":{id:"102b.png",width:102,height:102,theme:o.Theme.DARK},"51b_png":{id:"51b.png",width:51,height:51,theme:o.Theme.DARK},"68b_png":{id:"68b.png",width:68,height:68,theme:o.Theme.DARK},"34b_png":{id:"34b.png",width:34,height:34,theme:o.Theme.DARK},"60b_png":{id:"60b.png",width:60,height:60,theme:o.Theme.DARK},"30b_png":{id:"30b.png",width:30,height:30,theme:o.Theme.DARK},"44_png":{id:"44.png",width:44,height:44},"22_png":{id:"22.png",width:22,height:22}},l={"64_png":{id:"64.png",width:64,height:64,theme:o.Theme.LIGHT},"128_png":{id:"128.png",width:128,height:128,theme:o.Theme.LIGHT},"256_png":{id:"256.png",width:256,height:256,theme:o.Theme.LIGHT},"352_png":{id:"352.png",width:352,height:352,theme:o.Theme.LIGHT},"512_png":{id:"512.png",width:512,height:512,theme:o.Theme.LIGHT},"64b_png":{id:"64b.png",width:64,height:64,theme:o.Theme.DARK},"128b_png":{id:"128b.png",width:128,height:128,theme:o.Theme.DARK},"256b_png":{id:"256b.png",width:256,height:256,theme:o.Theme.DARK},"352b_png":{id:"352b.png",width:352,height:352,theme:o.Theme.DARK},"512b_png":{id:"512b.png",width:512,height:512,theme:o.Theme.DARK}},d=((r={})[o.Theme.LIGHT]="animation.json",r[o.Theme.DARK]="animation.b.json",r),u={products:(0,o.createProductsMap)([]),productIdsQueue:new Set,productsPromise:void 0,productPromises:new Map,stickers:new Map},_=-1;!function(e){e.NOT_SIGNED_IN="not_signed_in",e.NO_VALID_ITEMS="no_valid_items"}(s||(s={})),function(e){e.DUPLICATE_PRODUCT="duplicate_product"}(n||(n={}))},749091:(e,t,i)=>{"use strict";var r;i.d(t,{Theme:()=>r,imageSizesIndex:()=>n,imageSizeCache:()=>o,createProductsMap:()=>a,UserProductStateKey:()=>s,isBasePack:()=>l,isStyleProduct:()=>d,isPackProduct:()=>u,ProductsByType:()=>_}),function(e){e.LIGHT="light",e.DARK="dark",e.DEFAULT="light"}(r||(r={}));var s,n=Symbol(),o=Symbol(),a=function(e){return new Map(e)};!function(e){e.IsNew="is_new"}(s||(s={}));var c,l=function(e){return void 0!==e.sticker_ids},d=function(e){return void 0!==e.base_id},u=function(e){return l(e)&&!d(e)};!function(e){e.Pack="pack",e.Style="style"}(c||(c={}));var _=function(){function e(e){var t=this;void 0===e&&(e=[]),this.pack=new Set,this.style=new Set,e.forEach((function(e){return t.add(e)}))}return e.prototype.add=function(e){e&&(u(e)?this.pack.add(e):d(e)&&this.style.add(e))},e.prototype.getPack=function(){return this.pack.values().next().value},e.prototype.getStyles=function(){return Array.from(this.style.values())},e.prototype.getCount=function(){return this.pack.size+this.style.size},e}();!function(){function e(e){var t=this;this.pack=[],this.style=[],e.forEach((function(e){return t.add(e)}))}e.prototype.add=function(e){var t=e.product;t&&(u(t)?this.pack.push(e):d(t)&&this.style.push(e))}}()},922377:(e,t,i)=>{"use strict";i.d(t,{getStickerImageUrl:()=>a,getStickerAnimationUrl:()=>c,getStickerPackIconUrl:()=>l,isSampleOrderItem:()=>d});var r=i(570655),s=i(749091),n=i(654921),o=function(e,t,i,r){void 0===r&&(r=s.Theme.DEFAULT);var n=window.devicePixelRatio,o=[t*=n,i*=n,r].toString(),a=e[s.imageSizeCache];if(a&&a.has(o)){var c=a.get(o);if(c)return c}a||(a=new Map,e[s.imageSizeCache]=a);var l=function(e){var t=e[s.imageSizesIndex];return t||(t=Object.values(e).sort((function(e,t){return e.width-t.width||e.height-t.height})),e[s.imageSizesIndex]=t),t}(e).filter((function(e){return!e.theme||e.theme===r})),d=l.find((function(e){return e.width>=t&&e.height>=i}))||l[l.length-1];return a.set(o,d),d};function a(e,t,i,a){var c,l,d;if(void 0===a&&(a=s.Theme.DEFAULT),null===(d=e.render)||void 0===d?void 0:d.images){var u=e.render.images;u.sort((function(e,t){return e.width-t.width||e.height-t.height}));var _=void 0;try{for(var f=(0,r.__values)(u),m=f.next();!m.done;m=f.next()){var h=m.value;if(h.width>=t&&h.height>=i){if(h.theme===a)return h.url;_=h}}}catch(e){c={error:e}}finally{try{m&&!m.done&&(l=f.return)&&l.call(f)}finally{if(c)throw c.error}}if(_)return _.url}return function(e,t){return e.image.base_url+"/"+t.id+(e.image.version?"?"+e.image.version:"")}(e,function(e,t,i){return void 0===i&&(i=s.Theme.DEFAULT),o(n.STICKER_IMAGE,e,t,i)}(t,i,a))}var c=function(e,t){return void 0===t&&(t=s.Theme.DEFAULT),e.animation?e.animation.base_url+"/"+n.STICKER_ANIMATION[t]+(e.animation.version?"?"+e.animation.version:""):""},l=function(e,t,i,r){return void 0===r&&(r=s.Theme.DEFAULT),function(e,t){return e.icon.base_url+"/"+t.id+(e.thumb.version?"?"+e.thumb.version:"")}(e,function(e,t,i){return void 0===i&&(i=s.Theme.DEFAULT),o(n.STICKER_PACK_ICON,e,t,i)}(t,i,r))},d=function(e){return e.recipient_id===n.SAMPLE_RECIPIENT_ID}},665820:(e,t,i)=>{"use strict";i.d(t,{getCache:()=>l,updateCache:()=>d,getSticker:()=>u,getStickers:()=>_,getPackByStickerId:()=>m});var r=i(570655),s=i(293680),n=i(654921),o=i(749091),a=i(310835),c=i(26330),l=function(){if(!window.stickersCache){var e=c.default.get("stickers_cache");window.stickersCache=(0,r.__assign)((0,r.__assign)({},n.DEFAULT_CACHE),e)}return window.stickersCache},d=function(e){window.stickersCache=(0,r.__assign)((0,r.__assign)({},l()),e)},u=function(e){return l().stickers.get(e)},_=function(e){var t=l().stickers;return e.map((function(e){return t.get(e)}))},f=function(e){var t=u(e);if(!t||!t.pack_id)return null;var i=(0,a.getProductFromCache)(t.pack_id);return i&&(0,o.isBasePack)(i)?i:null},m=function(e){var t=f(e);return t?Promise.resolve(t):new Promise((function(t){s.ajax.post("stickers.php",{act:"get_products",sticker_ids:[e]},{onDone:function(i){(0,a.cacheProductsData)(i),t(f(e))},onFail:function(e){return console.error(e),t(null),!0}})}))}},399321:(e,t,i)=>{"use strict";i.d(t,{Cart:()=>c});var r=i(570655),s=i(293680),n=i(236783),o=i(654921),a=i(310835),c=function(){function e(e,t){void 0===t&&(t=[]),this.loadTimeout=null,this.loadCancellationToken=null,this.isGift=!1,this.onChange=null,this._order=null,this.setItems(e),this.recipientIds=new Set(t),this.recipients=new Map}return e.create=function(t,i){return void 0===i&&(i=[]),new e(t.map((function(e){return{product_id:e,amount:1}})),i)},e.prototype.copy=function(){var t=new e(this.getItems(),this.getRecipientIds());return t.setOrder(this.getOrder()),t},e.prototype.getItems=function(){return Array.from(this.items.values())},e.prototype.setItems=function(e){this.items=new Map(e.map((function(e){return[e.product_id,e]})))},e.prototype.loadItems=function(){var e=this,t=Array.from(this.items.keys());return(0,a.getProducts)(t).then((function(){var t,i;try{for(var s=(0,r.__values)(Array.from(e.items.values())),n=s.next();!n.done;n=s.next()){var o=n.value;o.product=(0,a.getProductFromCache)(o.product_id)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}}))},e.prototype.getProducts=function(){return(0,a.getProductsFromCache)(Array.from(this.items.keys()))},e.prototype.hasProduct=function(e){return this.items.has(e)},e.prototype.addProduct=function(e,t){if(void 0===t&&(t=!1),!this.hasProduct(e)){var i={product_id:e,amount:1};t?this.setItems((0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(this.getItems())),[i])):this.setItems((0,r.__spreadArray)([i],(0,r.__read)(this.getItems()))),this.onChange&&this.onChange()}},e.prototype.removeProduct=function(e){this.hasProduct(e)&&(this.items.delete(e),this.onChange&&this.onChange())},e.prototype.getRecipientIds=function(e){return void 0===e&&(e=!1),this.recipientIds.size?Array.from(this.recipientIds.values()):this.isGift&&e?[o.SAMPLE_RECIPIENT_ID]:[]},e.prototype.setRecipientIds=function(e){this.recipientIds=new Set(e)},e.prototype.hasRecipientId=function(e){return this.recipientIds.has(e)},e.prototype.addRecipientId=function(e){this.hasRecipientId(e)||(this.recipientIds.add(e),this.onChange&&this.onChange())},e.prototype.removeRecipientId=function(e){this.hasRecipientId(e)&&(this.recipientIds.delete(e),this.onChange&&this.onChange())},e.prototype.setOrder=function(e){var t,i;if(this._order=e,e){this.recipientIds.clear();try{for(var s=(0,r.__values)(e.items),n=s.next();!n.done;n=s.next()){var a=n.value;a.recipient_id!==o.SAMPLE_RECIPIENT_ID&&this.recipientIds.add(a.recipient_id)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}}},e.prototype.loadOrder=function(e){var t=e.items.map((function(e){return e.product_id}));return(0,a.getProducts)(t).then((function(t){return(0,r.__assign)((0,r.__assign)({},e),{items:e.items.map((function(e,i){return(0,r.__assign)((0,r.__assign)({},e),{product:t[i]})}))})}),(function(){return e}))},e.prototype.getOrder=function(){return this._order},e.prototype.getRecipientsMap=function(){return this.recipients},e.prototype.getRecipients=function(){return Array.from(this.recipients.values())},e.prototype.getRecipientById=function(e){return this.recipients.get(e)},e.prototype.addRecipients=function(e){this.recipients=new Map((0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(this.getRecipients())),(0,r.__read)(e)).map((function(e){return[e[0],e]})))},e.prototype.getJSON=function(){return JSON.stringify({items:this.getItems().map((function(e){return(0,r.__assign)((0,r.__assign)({},e),{product:void 0})})),recipient_ids:this.getRecipientIds(!0)})},e.prototype.isLoaded=function(){return null!==this.getOrder()},e.prototype.cancelLoad=function(){this.loadTimeout&&(window.clearTimeout(this.loadTimeout),this.loadTimeout=null),this.loadCancellationToken&&(this.loadCancellationToken.cancel(),this.loadCancellationToken=null)},e.prototype.load=function(e){var t=this;return void 0===e&&(e=!1),this.cancelLoad(),new Promise((function(i){t.loadTimeout=window.setTimeout((function(){t.loadCancellationToken=new n.AjaxCancellationToken,s.ajax.post("stickers.php",{act:"preview_products_order",cart:t.getJSON(),with_suggested_recipients:e?1:0},{cancellationToken:t.loadCancellationToken,onDone:function(e){(0,a.cacheProductsData)(e),Promise.all([t.loadItems(),t.loadOrder(e.order)]).then((function(s){var n=(0,r.__read)(s,2)[1];t.setOrder(n),e.recipients&&t.addRecipients(e.recipients),i(t)}),(function(){}))},onFail:function(e){return e&&window.__dev&&console.error(e),i(t),!0}})}),300)}))},e.prototype.order=function(e){var t=this;return void 0===e&&(e={}),new Promise((function(i){var n;s.ajax.post("stickers.php",{act:"order_products",cart:t.getJSON(),hash:e.hash||(null===(n=t.getOrder())||void 0===n?void 0:n.hash),message:e.message,is_private:e.is_private?1:0,ref:e.ref,gift_ref:e.gift_ref},{onDone:function(e){(0,a.cacheProductsData)(e),Promise.all([t.loadOrder(e.order),t.loadOrder(e.result)]).then((function(e){var s=(0,r.__read)(e,2),n=s[0],o=s[1];t.setOrder(n),i(o)}),(function(){}))},onFail:function(e){return e&&console.error(e),i(null),!0}})}))},e}()},360989:(e,t,i)=>{"use strict";i.d(t,{default:()=>u});var r=i(570655),s=i(785893),n=i(667294),o=i(748759),a=i(483295),c=i(749091),l=i(330494),d=i(166347);const u=function(e){var t=e.className,i=e.sticker,u=e.theme,_=void 0===u?c.Theme.LIGHT:u,f=e.width,m=e.height,h=(0,r.__read)((0,o.useInView)({threshold:0}),2),v=h[0],p=h[1],g=void 0!==i.animation,k=(0,r.__read)((0,n.useState)(!1),2),S=k[0],w=k[1];return(0,s.jsx)("div",(0,r.__assign)({className:(0,a.classNames)("Sticker",t),ref:v,onMouseEnter:function(){w(!0)},onMouseLeave:function(){w(!1)}},{children:g?(0,s.jsx)(d.default,{sticker:i,theme:_,width:f,height:m,isInView:p,play:S},void 0):(0,s.jsx)(l.default,{sticker:i,theme:_,width:f,height:m,isInView:p},void 0)}),void 0)}},166347:(e,t,i)=>{"use strict";i.d(t,{default:()=>d});var r=i(570655),s=i(785893),n=i(667294),o=i(483295),a=i(211248),c=i.n(a),l=i(922377);const d=function(e){var t=e.className,i=e.sticker,a=e.theme,d=e.width,u=e.height,_=e.isInView,f=void 0===_||_,m=e.play,h=void 0!==m&&m,v=(0,n.useRef)(null),p=(0,r.__read)((0,n.useState)(null),2),g=p[0],k=p[1],S=(0,l.getStickerAnimationUrl)(i,a);return(0,n.useEffect)((function(){if(g&&g.isLoaded){var e=h&&f;e&&!g.playing&&(g.item.play(),k((0,r.__assign)((0,r.__assign)({},g),{playing:!0}))),!e&&g.playing&&(g.item.pause(),k((0,r.__assign)((0,r.__assign)({},g),{playing:!1})))}}),[g,h,f]),(0,n.useEffect)((function(){if(!g||g.url!==S)if(g&&g.item.destroy(),S&&f){var e=c().loadAnimation({container:v.current,path:S,renderer:"svg",autoplay:!1,loop:!0,rendererSettings:{className:"StickerAnimation__animation",progressiveLoad:!0,hideOnTransparent:!0}}),t={url:S,isLoaded:!1,item:e,playing:!1};e.addEventListener("DOMLoaded",(function(){k((0,r.__assign)((0,r.__assign)({},t),{isLoaded:!0}))})),k(t)}else k(null)}),[S,f]),(0,s.jsx)("div",{className:(0,o.classNames)("StickerAnimation",t),style:{width:d,height:u},ref:v},void 0)}},330494:(e,t,i)=>{"use strict";i.d(t,{default:()=>c});var r=i(570655),s=i(785893),n=i(667294),o=i(483295),a=i(922377);const c=function(e){var t=e.className,i=e.sticker,c=e.theme,l=e.width,d=e.height,u=e.isInView,_=void 0===u||u,f=(0,n.useRef)(null),m=(0,a.getStickerImageUrl)(i,l,d,c);return(0,n.useLayoutEffect)((function(){f.current&&f.current.src!==m&&_&&(f.current.src=m)}),[_,m]),(0,s.jsx)("div",(0,r.__assign)({className:(0,o.classNames)("StickerImage",t),style:{width:l,height:d}},{children:(0,s.jsx)("img",{className:"StickerImage__image",ref:f},void 0)}),void 0)}},60578:(e,t,i)=>{"use strict";i.d(t,{default:()=>P});var r=i(570655),s=i(785893),n=i(667294),o=i(486125),a=i(654612),c=i(786067),l=i(41650),d=i(213984),u=i(288420),_=i(118690),f=i(733024),m=i(686478),h=i(749091),v=i(654921),p=i(665820),g=i(348230),k=i(451322),S=i(683791),w=i(155639),y=i(450134),j=i(360989),T=i(295565),C=i(54637),b=i(369783),E=i(870264),I=i(511417),x=l.default.getLang;const P=function(e){var t=e.pack,i=e.cart,l=e.options,P=l.recipientIds,R=void 0===P?[]:P,N=l.ref,L=l.gift_ref,A=e.closeBox,B=(0,r.__read)((0,k.usePack)(t.id),1)[0];B&&(t=B);var O=(0,r.__read)((0,S.useStyles)(t.style_ids||[]),2),M=O[0],H=O[1],D=(0,r.__read)((0,y.useCart)((function(){return i})),2),F=D[0],K=D[1],G=(0,r.__read)((0,w.useWithProducts)(F.getItems()),1)[0],V=F.getProducts(),z=F.getOrder(),W=(0,p.getSticker)(t.sticker_ids[0]),U=function(e){var t,i;if(!e)return null;var s=[],n=[];try{for(var o=(0,r.__values)(e.items),a=o.next();!a.done;a=o.next()){var l=a.value,d=l.product,u=l.error;d&&!u&&((0,h.isPackProduct)(d)?s.push(l):(0,h.isStyleProduct)(d)&&n.push(l))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}var _=n.reduce((function(e,t){var i;return e+((null===(i=t.price)||void 0===i?void 0:i.current)||0)}),0);if(s.length){var f=s.reduce((function(e,t){var i;return e+((null===(i=t.price)||void 0===i?void 0:i.current)||0)}),0);return f?n.length?_?(0,c.langStr)(x("purchases_stickers_order_summary_pack_for_styles_for",n.length),"pack_price",x("global_n_votes",f),"styles_num",n.length,"styles_price_sum",_):(0,c.langStr)(x("purchases_stickers_order_summary_pack_for_styles_free",n.length),"pack_price",x("global_n_votes",f),"styles_num",n.length):(0,c.langStr)(x("purchases_stickers_order_summary_pack_for"),"pack_price",x("global_n_votes",f)):n.length?_?(0,c.langStr)(x("purchases_stickers_order_summary_pack_free_styles_for",n.length),"styles_num",n.length,"styles_price_sum",x("global_n_votes",_)):(0,c.langStr)(x("purchases_stickers_order_summary_pack_free_styles_free",n.length),"styles_num",n.length):(0,c.langStr)(x("purchases_stickers_order_summary_pack_free"))}if(n.length)return _?(0,c.langStr)(x("purchases_stickers_order_summary_styles_for",n.length),"styles_num",n.length,"styles_price_sum",x("global_n_votes",_)):(0,c.langStr)(x("purchases_stickers_order_summary_styles_free",n.length),"styles_num",n.length);return null}(z),$=!K&&z&&!z.error,q=(0,r.__read)((0,n.useState)(!1),2),Y=q[0],J=q[1],X=null;if(z)if(z.error){if(z.error===v.ORDER_ERRORS.NOT_SIGNED_IN){X=(0,s.jsx)(_.default,(0,r.__assign)({className:"StickerPackPreview__purchase",size:"m",loading:K,onClick:function(){(0,o.showDoneBox)(x("purchases_please_sign_in").replace(/\{link\}(.*?)\{\/link\}/,"<a href=\"/join\" onclick=\"return !showBox('join.php', { act: 'box', from: nav.strLoc }, {}, event)\">$1</a>"))}},{children:x("purchases_stickers_get_pack_btn")}),void 0)}else if(z.error===v.ORDER_ERRORS.NO_VALID_ITEMS){if(1===z.items.length){var Q=z.items[0],Z=Q.product,ee=Q.error;if(Z&&ee!==v.ORDER_ITEM_ERRORS.DUPLICATE_PRODUCT&&Z.purchase_details){var te=Z.purchase_details,ie=te.label,re=te.title,se=te.text,ne=te.button_title,oe=te.button_url;X=(0,s.jsx)(_.default,(0,r.__assign)({className:"StickerPackPreview__purchase",size:"m",appearance:"primary",loading:K,onClick:function(){(0,a.showFastBox)(re||x("purchases_stickers_catalog_purchase_details_title"),se,oe&&ne||null,oe?function(){window.location.href=oe}:null)}},{children:ie||x("purchases_stickers_product_unavailable")}),void 0)}}if(!X){var ae=!z.items.find((function(e){return e.error!==v.ORDER_ITEM_ERRORS.DUPLICATE_PRODUCT}));X=(0,s.jsx)(_.default,(0,r.__assign)({className:"StickerPackPreview__purchase",size:"m",appearance:"secondary",loading:K,disabled:!0},{children:x(ae?"purchases_stickers_product_purchased":"purchases_stickers_product_unavailable")}),void 0)}}}else{var ce=K||Y;X=(0,s.jsx)(b.default,{className:"StickerPackPreview__purchase",size:"m",loading:ce,disabled:ce,price:z.price,text:z.price.current?x("purchases_stickers_buy_for"):x("purchases_stickers_get_for_free"),onClick:function(){Y||(J(!0),F.order({ref:N,gift_ref:L}).then((function(e){J(!1),e&&!e.error&&(0,o.showDoneBox)((0,g.getPurchaseResult)(e))}),(function(){})))}},void 0)}var le=!K&&void 0!==V.find((function(e){return null==e?void 0:e.can_gift})),de=G.reduce((function(e,t){return t.product&&t.product.copyright&&e.add(t.product.copyright),e}),new Set),ue=I.colorScheme.isDarkScheme()?h.Theme.DARK:h.Theme.LIGHT;return(0,s.jsxs)("article",(0,r.__assign)({className:"StickerPackPreview"},{children:[(0,s.jsxs)("header",(0,r.__assign)({className:"StickerPackPreview__header"},{children:[(0,s.jsx)("a",(0,r.__assign)({className:"StickerPackPreview__close",onClick:A},{children:(0,s.jsx)(f.default,{},void 0)}),void 0),W&&(0,s.jsx)(j.default,{className:"StickerPackPreview__icon",sticker:W,theme:ue,width:128,height:128},void 0),(0,s.jsxs)("div",(0,r.__assign)({className:"StickerPackPreview__info"},{children:[(0,s.jsx)(d.default,(0,r.__assign)({element:"h1",className:"StickerPackPreview__title"},{children:t.title}),void 0),(0,s.jsx)(d.default,(0,r.__assign)({element:"div",className:"StickerPackPreview__author"},{children:t.author}),void 0),(0,s.jsx)(d.default,(0,r.__assign)({element:"div",className:"StickerPackPreview__description"},{children:t.description}),void 0)]}),void 0)]}),void 0),M.length>0&&(0,s.jsx)(T.default,{className:"StickerPackPreview__styles",styles:M,isLoading:H,isAdded:function(e){return F.hasProduct(e.id)},add:function(e){return F.addProduct(e.id)},remove:function(e){return F.removeProduct(e.id)},gift:function(e){return t=e.id,void(0,E.giftStickerProducts)([t],R);var t}},void 0),(0,s.jsxs)("div",(0,r.__assign)({className:"StickerPackPreview__footerContainer"},{children:[(0,s.jsx)("section",(0,r.__assign)({className:"StickerPackPreview__items"},{children:G.map((function(e){return(0,s.jsx)(C.default,{item:e,showHeader:M.length>0,remove:e.product&&(0,h.isStyleProduct)(e.product)?function(){return F.removeProduct(e.product_id)}:void 0},e.product_id)}))}),void 0),de.size>0&&(0,s.jsx)("section",(0,r.__assign)({className:"StickerPackPreview__copyrights"},{children:Array.from(de).map((function(e,t){return(0,s.jsx)("div",(0,r.__assign)({className:"StickerPackPreview__copyright"},{children:e}),t)}))}),void 0),(0,s.jsxs)("footer",(0,r.__assign)({className:"StickerPackPreview__footer"},{children:[!K&&($||le)&&(0,s.jsx)("div",(0,r.__assign)({className:"StickerPackPreview__footerNote"},{children:U}),void 0),(0,s.jsxs)("div",(0,r.__assign)({className:"StickerPackPreview__footerButtons"},{children:[le&&(0,s.jsxs)(u.default,(0,r.__assign)({className:"StickerPackPreview__gift",appearance:"primary",size:"m",onClick:function(){return(e=F.copy()).setRecipientIds(R),void(0,E.giftStickersCart)(e);var e}},{children:[(0,s.jsx)(m.default,{width:20,height:20,className:"StickerPackPreview__giftIcon"},void 0),x("purchases_stickers_gift")]}),void 0),X]}),void 0)]}),void 0)]}),void 0)]}),void 0)}},187925:(e,t,i)=>{"use strict";i.d(t,{default:()=>j});var r=i(570655),s=i(785893),n=i(667294),o=i(786067),a=i(41650),c=i(743927),l=i(439664),d=i(288420),u=i(118690),_=i(213984),f=i(749091),m=i(310835),h=i(399321),v=i(451322),p=i(683791),g=i(295565),k=i(190291),S=i(369783),w=i(870264),y=a.default.getLang;const j=function(e){var t=e.pack,i=e.options,a=e.closeBox,j=e.updateBox,T=(0,r.__read)((0,v.usePack)(t.id),2),C=T[0],b=T[1];C&&(t=C);var E=(0,r.__read)((0,p.useStyles)(t.style_ids||[]),2),I=E[0],x=E[1],P=b||x;(0,n.useEffect)((function(){j()}),[P]);var R=(0,r.__assign)((0,r.__assign)({},t),{base_id:t.id,title:y("purchases_stickers_product_preview_title_base_pack"),style_sticker_ids:t.sticker_ids}),N=(0,r.__spreadArray)([R],(0,r.__read)(I)),L=N.find((function(e){return e&&e.is_active}))||R,A=(0,r.__read)((0,n.useState)(),2),B=A[0],O=A[1],M=B&&N.find((function(e){return e&&e.id===B})),H=function(e){O(e&&e.id)},D=M||L,F=D===R?y("purchases_stickers_product_preview_title_base_pack"):(0,o.langStr)(y("purchases_stickers_product_preview_title_style"),"title",D.title);(0,n.useEffect)((function(){D.is_new&&(0,m.updateUserProductState)(D.id,f.UserProductStateKey.IsNew,0).finally((function(){}))}),[D,D.is_new]);var K=(0,r.__read)((0,n.useState)(!1),2),G=K[0],V=K[1],z=(0,r.__read)((0,n.useState)(!1),2),W=z[0],U=z[1];return(0,s.jsxs)("article",(0,r.__assign)({className:"StickerPackSettings"},{children:[(0,s.jsx)(c.ModalHeader,{className:"StickerPackSettings__header",title:t?(0,o.langStr)(y("purchases_stickers_style_selection_for_pack"),"title",t.title):"",onClose:a},void 0),P?(0,s.jsx)("section",(0,r.__assign)({className:"StickerPackSettings__content StickerPackSettings__content--loading"},{children:(0,s.jsx)(l.default,{size:24},void 0)}),void 0):(0,s.jsxs)(n.Fragment,{children:[N.length>0&&(0,s.jsx)(g.default,{className:"StickerPackSettings__styles",styles:N,isLoading:x,activeStyle:L,selectedStyle:D,select:function(e){return H(e)}},void 0),(0,s.jsxs)("div",(0,r.__assign)({className:"StickerPackSettings__footerContainer"},{children:[(0,s.jsxs)("section",(0,r.__assign)({className:"StickerPackSettings__stylePreview"},{children:[(0,s.jsx)(_.default,(0,r.__assign)({element:"h2",className:"StickerPackSettings__stylePreviewTitle"},{children:F}),void 0),(0,s.jsx)(k.default,{product:D},void 0)]}),void 0),(0,s.jsx)("footer",(0,r.__assign)({className:"StickerPackSettings__footer"},{children:(0,s.jsxs)("div",(0,r.__assign)({className:"StickerPackSettings__footerButtons"},{children:[D.can_gift&&(0,s.jsx)(d.default,{className:"StickerPackSettings__gift",appearance:"secondary",size:"m",onClick:function(){return e=D.id,void(0,w.giftStickerProducts)([e],i.recipientIds||[]);var e}},void 0),D.is_purchased?(0,s.jsx)(u.default,(0,r.__assign)({className:"StickerPackSettings__activate",appearance:"primary",size:"m",disabled:D===L,loading:W,onClick:function(){return e=D,void(W||(U(!0),(0,m.activateProduct)(e).then((function(){U(!1),H(void 0)}),(function(){}))));var e}},{children:y("purchases_stickers_product_settings_save")}),void 0):(0,s.jsx)(S.default,{className:"StickerPackSettings__buy",appearance:"primary",size:"m",price:D.price.purchase,text:y(D.price.purchase.current?"purchases_stickers_buy_for":"purchases_stickers_get_for_free"),loading:G,onClick:function(){return e=D,void(G||(V(!0),h.Cart.create([e.id]).load().then((function(e){return e.order()})).then((function(){V(!1)}),(function(){}))));var e}},void 0)]}),void 0)}),void 0)]}),void 0)]},void 0)]}),void 0)}},490808:(e,t,i)=>{"use strict";i.d(t,{default:()=>y});var r=i(570655),s=i(785893),n=i(667294),o=i(486125),a=i(786067),c=i(41650),l=i(743927),d=i(439664),u=i(273947),_=i(674041),f=i(479806),m=i(599940),h=i(749091),v=i(922377),p=i(450134),g=i(820159),k=i(945752),S=i(369783),w=c.default.getLang;const y=function(e){var t=e.cart,i=e.options,c=i.ref,y=i.gift_ref,j=e.closeBox,T=e.updateBox,C=(0,r.__read)((0,p.useCart)(t),2),b=C[0],E=C[1],I=!b.isLoaded()&&E;(0,n.useEffect)((function(){T()}),[I]);var x=b.getRecipientIds(),P=b.getOrder(),R=P&&!P.error&&P.items.find((function(e){return!e.error&&!(0,v.isSampleOrderItem)(e)})),N=(0,r.__read)(function(e){var t,i,s;if(!e)return[null,null];try{for(var n=(0,r.__values)(e.items),o=n.next();!o.done;o=n.next()){var c=o.value.product;if(c&&(0,h.isPackProduct)(c)){s=c;break}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}var l=e.items.filter((function(e){var t=e.product;return null==t?void 0:t.can_gift})),d=l.filter((function(e){return!e.error&&!(0,v.isSampleOrderItem)(e)}));d.length&&(l=d);var u=new h.ProductsByType(l.map((function(e){return e.product}))),_=u.pack.values().next().value,f=Array.from(u.style),m="",p="";if(1===f.length)m=(0,a.langStr)(w("purchases_stickers_gift_title_1_style"),"title",f[0].title),_?p=(0,a.langStr)(w("purchases_stickers_gift_description_with_pack"),"title",_.title):s&&(p=(0,a.langStr)(w("purchases_stickers_gift_description_for_pack"),"title",s.title));else if(_){if(m=(0,a.langStr)(w("purchases_stickers_gift_title_pack"),"title",_.title),f.length)switch(f.length){case 2:p=(0,a.langStr)(w("purchases_stickers_gift_description_with_2_styles"),"title1",f[0].title,"title2",f[1].title);break;case 3:p=(0,a.langStr)(w("purchases_stickers_gift_description_with_3_styles"),"title1",f[0].title,"title2",f[1].title,"title3",f[2].title);break;case 4:p=(0,a.langStr)(w("purchases_stickers_gift_description_with_3_styles_and_1_more"),"title1",f[0].title,"title2",f[1].title,"title3",f[2].title);break;default:var g=f.length-3;p=(0,a.langStr)(w("purchases_stickers_gift_description_with_3_styles_and_n_more",g),"title1",f[0].title,"title2",f[1].title,"title3",f[2].title,"n",g)}}else if(f.length){switch(f.length){case 2:m=(0,a.langStr)(w("purchases_stickers_gift_title_2_styles"),"title1",f[0].title,"title2",f[1].title);break;case 3:m=(0,a.langStr)(w("purchases_stickers_gift_title_3_styles"),"title1",f[0].title,"title2",f[1].title,"title3",f[2].title);break;case 4:m=(0,a.langStr)(w("purchases_stickers_gift_title_3_styles_and_1_more"),"title1",f[0].title,"title2",f[1].title,"title3",f[2].title);break;default:g=f.length-3;m=(0,a.langStr)(w("purchases_stickers_gift_title_3_styles_and_n_more",g),"title1",f[0].title,"title2",f[1].title,"title3",f[2].title,"n",g)}s&&(p=(0,a.langStr)(w("purchases_stickers_gift_description_for_pack"),"title",s.title))}f.length?p+=" "+w("purchases_stickers_gift_description_styles"):p+=" "+w("purchases_stickers_gift_description");return[m,p]}(P),2),L=N[0],A=N[1],B=(0,r.__read)((0,n.useState)(null),2)[1];(0,n.useLayoutEffect)((function(){var e,t,i=b.getRecipients();if(B(window.WideDropdown.init("StickerProductsGiftRecipientsDropdown",{defaultItems:i,items:i,noResult:w("gifts_nobody_found"),introText:w("gifts_start_typing_recipient"),maxItems:20,onChange:function(e,t){1===e?b.addRecipientId(+t):b.removeRecipientId(+t)}})),x.length)try{for(var s=(0,r.__values)(x),n=s.next();!n.done;n=s.next()){var o=n.value,a=b.getRecipientById(o);a&&window.WideDropdown.select("StickerProductsGiftRecipientsDropdown",!1,a)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else window.WideDropdown.focus("StickerProductsGiftRecipientsDropdown");return function(){window.WideDropdown.deinit("StickerProductsGiftRecipientsDropdown")}}),[I]);var O=(0,r.__read)((0,n.useState)(""),2),M=O[0],H=O[1],D=(0,r.__read)((0,n.useState)(!1),2),F=D[0],K=D[1],G=(0,r.__read)((0,n.useState)(!1),2),V=G[0],z=G[1],W=function(){V||(z(!0),b.order({message:M,is_private:F,ref:c,gift_ref:y}).then((function(e){z(!1),e&&!e.error&&((0,o.showDoneBox)(function(e,t){var i,s,n=new h.ProductsByType(e.items.filter((function(e){return!e.error})).map((function(e){return e.product}))),o=function(e){var t=e.getPack(),i=e.getStyles();if(t)return i.length?(0,a.langStr)(w("purchases_stickers_gift_result_products_pack_and_styles",i.length),"title",t.title,"styles_num",i.length):(0,a.langStr)(w("purchases_stickers_gift_result_products_pack"),"title",t.title);if(i.length)switch(i.length){case 1:return(0,a.langStr)(w("purchases_stickers_gift_result_products_1_style"),"title",i[0].title);case 2:return(0,a.langStr)(w("purchases_stickers_gift_result_products_2_styles"),"title1",i[0].title,"title2",i[1].title);case 3:return(0,a.langStr)(w("purchases_stickers_gift_result_products_3_styles"),"title1",i[0].title,"title2",i[1].title,"title3",i[2].title);case 4:return(0,a.langStr)(w("purchases_stickers_gift_result_products_3_styles_and_1_more"),"title1",i[0].title,"title2",i[1].title,"title3",i[2].title);default:var r=i.length-3;return(0,a.langStr)(w("purchases_stickers_gift_result_products_3_styles_and_n_more",r),"title1",i[0].title,"title2",i[1].title,"title3",i[2].title,"n",r)}return null}(n);if(!o)return null;var c=new Set;try{for(var l=(0,r.__values)(e.items),d=l.next();!d.done;d=l.next()){var u=d.value,_=u.error,f=u.recipient_id;if(!_){var m=t(f);m&&c.add(m)}}}catch(e){i={error:e}}finally{try{d&&!d.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}var v=function(e,t){var i=Array.from(e.values());switch(i.length){case 0:return null;case 1:var r=1===t?"purchases_stickers_gift_result_1_recipient_single":"purchases_stickers_gift_result_1_recipient_multiple";return(0,a.langStr)((0,a.langSex)(i[0][7],w(r,!0)),"name",i[0][8]);case 2:return(0,a.langStr)(w("purchases_stickers_gift_result_2_recipients",t),"name1",i[0][8],"name2",i[1][8]);case 3:return(0,a.langStr)(w("purchases_stickers_gift_result_3_recipients",t),"name1",i[0][8],"name2",i[1][8],"name3",i[2][8]);case 4:return(0,a.langStr)(w("purchases_stickers_gift_result_4_recipients",t),"name1",i[0][8],"name2",i[1][8],"name3",i[2][8],"name4",i[3][8]);case 5:return(0,a.langStr)(w("purchases_stickers_gift_result_5_recipients",t),"name1",i[0][8],"name2",i[1][8],"name3",i[2][8],"name4",i[3][8],"name5",i[4][8]);default:var s=i.length-4;r=1===t?"purchases_stickers_gift_result_4_recipients_and_n_more_single":"purchases_stickers_gift_result_4_recipients_and_n_more_multiple";return(0,a.langStr)(w(r),"name1",i[0][8],"name2",i[1][8],"name3",i[2][8],"name4",i[3][8],"n",s)}return null}(c,n.getCount());if(!v)return null;return(0,a.langStr)(v,"products",o)}(e,(function(e){return b.getRecipientById(e)}))),j())}),(function(){})))};return(0,n.useEffect)((function(){window.WideDropdown.disable("StickerProductsGiftRecipientsDropdown",V)}),[V]),(0,s.jsxs)("article",(0,r.__assign)({className:"StickerProductsGift"},{children:[(0,s.jsx)(l.ModalHeader,{className:"StickerProductsGift__header",title:w("purchases_stickers_gift_box_title"),onClose:j},void 0),I?(0,s.jsx)("section",(0,r.__assign)({className:"StickerProductsGift__content StickerProductsGift__content--loading"},{children:(0,s.jsx)(d.default,{size:24},void 0)}),void 0):(0,s.jsxs)(n.Fragment,{children:[(0,s.jsxs)("section",(0,r.__assign)({className:"StickerProductsGift__content"},{children:[(0,s.jsx)(g.default,{order:P,forceValid:!R},void 0),(0,s.jsx)("h1",(0,r.__assign)({className:"StickerProductsGift__productsTitle"},{children:L}),void 0),(0,s.jsx)("p",(0,r.__assign)({className:"StickerProductsGift__productsDescription"},{children:A}),void 0),P&&(0,s.jsxs)(n.Fragment,{children:[(0,s.jsxs)("dl",(0,r.__assign)({className:"StickerProductsGift__price"},{children:[(0,s.jsx)("dt",(0,r.__assign)({className:"StickerProductsGift__priceLabel"},{children:w("purchases_gift_price_label")}),void 0)," ",(0,s.jsx)("dd",(0,r.__assign)({className:"StickerProductsGift__priceValue"},{children:w("global_n_votes",P.price.current)}),void 0)]}),void 0),(0,s.jsx)("div",(0,r.__assign)({className:"StickerProductsGift__balance"},{children:(0,a.langStr)(w("gifts_you_have_X_votes"),"votes",w("global_n_votes",P.balance))}),void 0)]},void 0),(0,s.jsxs)("div",(0,r.__assign)({className:"StickerProductsGift__recipients"},{children:[(0,s.jsx)("label",(0,r.__assign)({className:"StickerProductsGift__recipientsLabel",htmlFor:"StickerProductsGiftRecipientsInput"},{children:w("gifts_receiver")}),void 0),(0,s.jsxs)("div",(0,r.__assign)({className:"wdd StickerProductsGift__recipientsDropdown",id:"StickerProductsGiftRecipientsDropdown"},{children:[(0,s.jsx)("div",{className:"fl_r wdd_arr"},void 0),(0,s.jsx)("input",{className:"wdd_text fl_l",id:"StickerProductsGiftRecipientsInput",placeholder:w("gifts_choose_recipients")},void 0)]}),void 0)]}),void 0),(0,s.jsxs)("div",(0,r.__assign)({className:"StickerProductsGift__message"},{children:[(0,s.jsx)("label",(0,r.__assign)({className:"StickerProductsGift__messageLabel",htmlFor:"StickerProductsGiftMessageInput"},{children:w("purchases_gift_your_message")}),void 0),(0,s.jsx)(u.default,{className:"StickerProductsGift__messageInput",id:"StickerProductsGiftMessageInput",value:M,onChange:function(e){return H(e.currentTarget.value)},onResize:function(){return T()},style:{height:80},disabled:V},void 0)]}),void 0),(0,s.jsx)(_.default,(0,r.__assign)({className:"StickerProductsGift__isPrivate",checked:F,disabled:V,onChange:function(){return K(!F)}},{children:w("gifts_receiver_only")}),void 0)]}),void 0),(0,s.jsxs)("footer",(0,r.__assign)({className:"StickerProductsGift__footer"},{children:[(0,s.jsx)("div",(0,r.__assign)({className:"StickerProductsGift__footerNote"},{children:!E&&P&&(0,s.jsxs)("div",(0,r.__assign)({className:"StickerProductsGift__details"},{children:[w("purchases_stickers_gift_details_label"),(0,s.jsx)(m.default,(0,r.__assign)({className:"StickerProductsGift__detailsTooltip",text:(0,s.jsx)(k.default,{order:P,recipients:b.getRecipientsMap()},void 0),position:"t",align:"center",appearance:"light"},{children:(0,s.jsx)(f.default,{className:"StickerProductsGift__detailsHintIcon"},void 0)}),void 0)]}),void 0)}),void 0),(0,s.jsx)("div",(0,r.__assign)({className:"StickerProductsGift__footerButtons"},{children:(0,s.jsx)(S.default,{className:"StickerProductsGift__gift",appearance:R?"primary":"secondary",size:"m",loading:E||V,disabled:!R,price:null==P?void 0:P.price,text:R?(0,a.langStr)(w("purchases_stickers_gift_send_for"),"price",w("global_n_votes",null==P?void 0:P.price.current)):w("purchases_stickers_gift_send"),onClick:function(){return W()}},void 0)}),void 0)]}),void 0)]},void 0)]}),void 0)}},945752:(e,t,i)=>{"use strict";i.d(t,{default:()=>f});var r=i(570655),s=i(785893),n=i(667294),o=i(786067),a=i(41650),c=i(213984),l=i(749091),d=i(922377),u=a.default.getLang;function _(e){var t=e.getPack(),i=e.getStyles(),r="";return i.length&&(r=i.map((function(e){return(0,o.langStr)(u("purchases_stickers_gift_details_recipient_style_title"),"title",e.title)})).join(", ")),t?r?(0,o.langStr)(u("purchases_stickers_gift_details_recipient_pack_and_styles"),"pack_title",t.title,"style_titles",r):(0,o.langStr)(u("purchases_stickers_gift_details_recipient_pack"),"title",t.title):r?(0,o.langStr)(u("purchases_stickers_gift_details_recipient_styles"),"style_titles",r):null}const f=function(e){var t,i,a=e.order,f=e.recipients,m=function(e){var t,i;if(!e)return null;var s=e.items.filter((function(e){var t=e.product;return null==t?void 0:t.can_gift})),n=s.filter((function(e){return!e.error&&!(0,d.isSampleOrderItem)(e)}));n.length&&(s=n);var a=[],c=[];try{for(var _=(0,r.__values)(s),f=_.next();!f.done;f=_.next()){var m=f.value,h=m.product;h&&((0,l.isPackProduct)(h)?a.push(m):(0,l.isStyleProduct)(h)&&c.push(m))}}catch(e){t={error:e}}finally{try{f&&!f.done&&(i=_.return)&&i.call(_)}finally{if(t)throw t.error}}var v=c.reduce((function(e,t){var i;return e+((null===(i=t.price)||void 0===i?void 0:i.current)||0)}),0);if(a.length){var p=a.reduce((function(e,t){var i;return e+((null===(i=t.price)||void 0===i?void 0:i.current)||0)}),0);return c.length?(0,o.langStr)(u("purchases_stickers_gift_details_summary_pack_with_styles",c.length),"pack_price_sum",u("global_n_votes",p),"styles_num",c.length,"styles_price_sum",u("global_n_votes",v)):(0,o.langStr)(u("purchases_stickers_gift_details_summary_pack"),"pack_price_sum",u("global_n_votes",p))}if(c.length)return(0,o.langStr)(u("purchases_stickers_gift_details_summary_styles",c.length),"styles_num",c.length,"styles_price_sum",u("global_n_votes",v));return null}(a),h=new Map;try{for(var v=(0,r.__values)(a.items),p=v.next();!p.done;p=v.next()){var g=p.value,k=g.error,S=g.product,w=g.recipient_id;if(!k){var y=f.get(w);if(y){var j=h.get(y);j||(j=new l.ProductsByType,h.set(y,j)),j.add(S)}}}}catch(e){t={error:e}}finally{try{p&&!p.done&&(i=v.return)&&i.call(v)}finally{if(t)throw t.error}}var T=Array.from(h.entries()),C=(0,n.useRef)(null);return(0,n.useEffect)((function(){var e=C.current;e&&(e.style.maxHeight=e.getBoundingClientRect().bottom-22+"px")})),(0,s.jsxs)("div",(0,r.__assign)({className:"StickerProductsGiftDetails",ref:C},{children:[m&&(0,s.jsx)(c.default,(0,r.__assign)({element:"p",className:"StickerProductsGiftDetails__summary"},{children:m}),void 0),T.length>0&&(0,s.jsx)("ul",(0,r.__assign)({className:"StickerProductsGiftDetails__recipients"},{children:T.map((function(e){var t=(0,r.__read)(e,2),i=t[0],n=t[1];return(0,s.jsxs)("li",(0,r.__assign)({className:"StickerProductsGiftDetails__recipient"},{children:[(0,s.jsx)(c.default,(0,r.__assign)({element:"div",className:"StickerProductsGiftDetails__recipientName"},{children:i[1]}),void 0),(0,s.jsx)("div",(0,r.__assign)({className:"StickerProductsGiftDetails__recipientProducts"},{children:_(n)}),void 0)]}),i[0])}))}),void 0)]}),void 0)}},820159:(e,t,i)=>{"use strict";i.d(t,{default:()=>l});var r=i(570655),s=i(785893),n=i(483295),o=i(749091),a=i(922377),c={s:56,m:96,l:168};const l=function(e){var t,i,l,d,u,_=e.order,f=e.forceValid,m=void 0!==f&&f,h=new Map,v=new Map;if(_)try{for(var p=(0,r.__values)(_.items),g=p.next();!g.done;g=p.next()){var k=g.value,S=k.product;S&&((0,o.isPackProduct)(S)?h.has(S)?null===(l=h.get(S))||void 0===l||l.push(k):h.set(S,[k]):(0,o.isStyleProduct)(S)&&(v.has(S)?null===(d=v.get(S))||void 0===d||d.push(k):v.set(S,[k])))}}catch(e){t={error:e}}finally{try{g&&!g.done&&(i=p.return)&&i.call(p)}finally{if(t)throw t.error}}var w=h.keys().next().value,y=(w?1:0)+v.size,j=y>1?y>2?"s":"m":"l",T=c[j],C=Array.from(v.entries());m||C.sort((function(e,t){var i=(0,r.__read)(e,2)[1];return(0,r.__read)(t,2)[1].filter((function(e){return!e.error})).length-i.filter((function(e){return!e.error})).length}));var b=C.slice(0,3),E=C.slice(3),I=!0;if(!m){var x=E.filter((function(e){return(0,r.__read)(e,2)[1].find((function(e){return!e.error}))}));x.length?E=x:I=!1}return(0,s.jsxs)("ul",(0,r.__assign)({className:"StickerProductsGiftIcons"},{children:[w&&(0,s.jsx)("li",{className:(0,n.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+j,"StickerProductsGiftIcons__icon--pack",{"StickerProductsGiftIcons__icon--invalid":!m&&!(null===(u=h.get(w))||void 0===u?void 0:u.find((function(e){return!e.error})))}),style:{backgroundImage:"url("+(0,a.getStickerPackIconUrl)(w,T,T)+")"}},w.id),b.map((function(e){var t=(0,r.__read)(e,2),i=t[0],o=t[1];return(0,s.jsx)("li",{className:(0,n.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+j,"StickerProductsGiftIcons__icon--style",{"StickerProductsGiftIcons__icon--invalid":!m&&!o.find((function(e){return!e.error}))}),style:{backgroundImage:"url("+(0,a.getStickerPackIconUrl)(i,T,T)+")"}},i.id)})),E.length?(0,s.jsxs)("li",(0,r.__assign)({className:(0,n.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+j,"StickerProductsGiftIcons__icon--more",{"StickerProductsGiftIcons__icon--invalid":!I})},{children:["+",E.length]}),"more"):null]}),void 0)}},618610:(e,t,i)=>{"use strict";i.d(t,{default:()=>u});var r=i(570655),s=i(785893),n=i(786067),o=i(41650),a=i(743927),c=i(288420),l=i(190291),d=o.default.getLang;const u=function(e){var t=e.style,i=e.options.add,o=e.closeBox;return(0,s.jsxs)("article",(0,r.__assign)({className:"StickerStylePreview"},{children:[(0,s.jsx)(a.ModalHeader,{className:"StickerStylePreview__header",title:(0,n.langStr)(d("purchases_stickers_stickers_of_style"),"title",t.title),onClose:o},void 0),(0,s.jsx)(l.default,{className:"StickerStylePreview__content",product:t},void 0),(0,s.jsxs)("footer",(0,r.__assign)({className:"StickerStylePreview__footer"},{children:[(0,s.jsx)(c.default,(0,r.__assign)({className:"StickerStylePreview__cancel",appearance:"tertiary",size:"m",onClick:o},{children:d("global_cancel")}),void 0),i&&(0,s.jsx)(c.default,(0,r.__assign)({className:"StickerStylePreview__add",appearance:"primary",size:"m",onClick:function(){return i(t)}},{children:d("purchases_stickers_preview_add_item")}),void 0)]}),void 0)]}),void 0)}},295565:(e,t,i)=>{"use strict";i.d(t,{default:()=>f});var r=i(570655),s=i(785893),n=i(483295),o=i(41650),a=i(647560),c=i(599940),l=i(479806),d=i(290625),u=i(171134),_=o.default.getLang;const f=function(e){var t=e.className,i=e.styles,o=e.isLoading,f=e.isAdded,m=e.add,h=e.remove,v=e.gift,p=e.activeStyle,g=e.selectedStyle,k=e.select,S=(0,d.default)({wrapperSelector:".StickerStylesMenu__wrapper",itemSelector:".StickerStylesMenu__item"});if(o)return(0,s.jsx)("section",(0,r.__assign)({className:(0,n.classNames)("StickerStylesMenu","StickerStylesMenu--loading",t)},{children:(0,s.jsx)(a.default,{className:"StickerStylesMenu__progress"},void 0)}),void 0);var w=[{title:_("purchases_stickers_purchased_styles"),styles:i.filter((function(e){return e.is_purchased&&!e.is_disabled}))},{title:_("purchases_stickers_other_styles"),styles:i.filter((function(e){return!e.is_purchased&&!e.is_disabled&&!e.is_hidden})),tooltip:_("purchases_stickers_styles_hint")}].filter((function(e){return e.styles.length}));return w.length?(0,s.jsxs)("section",(0,r.__assign)({className:(0,n.classNames)("StickerStylesMenu",t),ref:S.ref,onWheel:function(e){return S.onWheel(e)}},{children:[(0,s.jsx)("a",{className:(0,n.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--prev",{"StickerStylesMenu__nav--disabled":!S.hasPrev}),onClick:function(){return S.prev()}},void 0),(0,s.jsx)("a",{className:(0,n.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--next",{"StickerStylesMenu__nav--disabled":!S.hasNext}),onClick:function(){return S.next()}},void 0),(0,s.jsx)("div",(0,r.__assign)({className:"StickerStylesMenu__wrapper"},{children:w.map((function(e,t){return(0,s.jsxs)("section",(0,r.__assign)({className:"StickerStylesMenu__group"},{children:[(0,s.jsxs)("h2",(0,r.__assign)({className:"StickerStylesMenu__groupTitle"},{children:[e.title,e.tooltip&&(0,s.jsx)(c.default,(0,r.__assign)({className:"StickerStylesMenu__groupTitleHint",text:e.tooltip,position:"b",align:"center",appearance:"light"},{children:(0,s.jsx)(l.default,{className:"StickerStylesMenu__groupTitleHintIcon"},void 0)}),void 0)]}),void 0),(0,s.jsx)("div",(0,r.__assign)({className:"StickerStylesMenu__groupItems"},{children:e.styles.map((function(e){return(0,s.jsx)(u.default,{className:"StickerStylesMenu__item",style:e,isLoading:o,isAdded:f&&f(e),add:m&&function(){return m(e)},remove:h&&function(){return h(e)},gift:v&&function(){return v(e)},isActive:void 0===p?void 0:e===p,isSelected:void 0===g?void 0:e===g,select:k&&function(){return k(e)}},e.id)}))}),void 0)]}),t)}))}),void 0)]}),void 0):null}},171134:(e,t,i)=>{"use strict";i.d(t,{default:()=>f});var r=i(570655),s=i(785893),n=i(483295),o=i(41650),a=i(288420),c=i(213984),l=i(665820),d=i(686478),u=i(360989),_=o.default.getLang;const f=function(e){var t,i=e.className,o=e.style,f=e.isAdded,m=void 0!==f&&f,h=e.add,v=e.remove,p=e.gift,g=e.isActive,k=e.isSelected,S=e.select;t=o.is_new?o.title.trim().replace(/(^|\s)([^\s]+)$/,'$1<span class="StickerStylesMenuItem__titleLastWord">$2</span>'):o.title;var w=(0,l.getSticker)(o.style_sticker_ids[0]),y=function(e){return function(t){t.stopPropagation(),e()}};return(0,s.jsxs)("div",(0,r.__assign)({className:(0,n.classNames)("StickerStylesMenuItem",i,{"StickerStylesMenuItem--selected":Boolean(k),"StickerStylesMenuItem--added":Boolean(m),"StickerStylesMenuItem--new":o.is_new}),onClick:function(){S?S():m?v&&v():h&&h()}},{children:[w&&(0,s.jsx)(u.default,{className:"StickerStylesMenuItem__icon",sticker:w,width:100,height:100},void 0),(0,s.jsx)(c.default,(0,r.__assign)({element:"div",className:"StickerStylesMenuItem__title"},{children:t}),void 0),o.is_purchased?void 0===g?(0,s.jsx)("div",(0,r.__assign)({className:"StickerStylesMenuItem__notice"},{children:_("purchases_stickers_you_have_it")}),void 0):g&&(0,s.jsx)("div",(0,r.__assign)({className:"StickerStylesMenuItem__notice"},{children:_("purchases_stickers_active_style")}),void 0):o.price.purchase.regular?(0,s.jsx)("div",(0,r.__assign)({className:"StickerStylesMenuItem__price"},{children:_("global_n_votes",o.price.purchase.current)}),void 0):(0,s.jsx)("div",(0,r.__assign)({className:"StickerStylesMenuItem__price"},{children:_("purchases_for_free_btn")}),void 0),(h||v||p&&o.can_gift)&&(0,s.jsxs)("div",(0,r.__assign)({className:"StickerStylesMenuItem__actions"},{children:[m?v&&(0,s.jsx)(a.default,(0,r.__assign)({className:"StickerStylesMenuItem__remove",appearance:"secondary",size:"s",onClick:y(v)},{children:_("purchases_stickers_preview_remove_item")}),void 0):h&&(0,s.jsx)(a.default,(0,r.__assign)({className:"StickerStylesMenuItem__add",appearance:"primary",size:"s",onClick:y(h)},{children:_("purchases_stickers_preview_add_item")}),void 0),p&&o.can_gift&&(0,s.jsx)(a.default,(0,r.__assign)({className:"StickerStylesMenuItem__gift",size:"s",appearance:"primary",onClick:y(p)},{children:(0,s.jsx)(d.default,{width:20,height:20,className:"StickerStylesMenuItem__giftIcon"},void 0)}),void 0)]}),void 0)]}),void 0)}},54637:(e,t,i)=>{"use strict";i.d(t,{default:()=>u});var r=i(570655),s=i(785893),n=i(786067),o=i(41650),a=i(213984),c=i(749091),l=i(190291),d=o.default.getLang;const u=function(e){var t=e.item,i=e.showHeader,o=void 0!==i&&i,u=e.remove;if(!t.product)return null;var _="";return(0,c.isPackProduct)(t.product)?_=(0,n.langStr)(d("purchases_stickers_product_preview_title_pack"),"title",t.product.title):(0,c.isStyleProduct)(t.product)&&(_=(0,n.langStr)(d("purchases_stickers_product_preview_title_style"),"title",t.product.title)),(0,s.jsxs)("div",(0,r.__assign)({className:"StickersCartItem"},{children:[o&&(0,s.jsxs)("div",(0,r.__assign)({className:"StickersCartItem__header"},{children:[(0,s.jsx)(a.default,(0,r.__assign)({element:"span",className:"StickersCartItem__title"},{children:_}),void 0),u&&(0,s.jsx)("span",(0,r.__assign)({className:"StickersCartItem__actions"},{children:(0,s.jsx)("button",(0,r.__assign)({className:"StickersCartItem__remove",onClick:function(){return u()}},{children:d("purchases_stickers_preview_remove_item")}),void 0)}),void 0)]}),void 0),(0,s.jsx)(l.default,{className:"StickersCartItem__preview",product:t.product},void 0)]}),void 0)}},369783:(e,t,i)=>{"use strict";i.d(t,{default:()=>_});var r=i(570655),s=i(785893),n=i(667294),o=i(786067),a=i(483295),c=i(41650),l=i(118690),d=c.default.getLang,u=function(e){var t=e.className,i=e.price,c=e.text,u=e.placeholder,_=(0,r.__rest)(e,["className","price","text","placeholder"]),f=(0,n.useMemo)((function(){if(i){var e;i.current!==i.regular&&i.regular&&(e=(0,s.jsx)("span",(0,r.__assign)({className:"StickersPriceButton__regular"},{children:i.current?i.regular:(0,o.langStr)(d("purchases_stickers_n_for_m"),"%n","","%m",d("global_n_votes",i.regular))}),"regular"));var t=(0,s.jsx)("span",(0,r.__assign)({className:"StickersPriceButton__current"},{children:i.current?d("global_n_votes",i.current):d("purchases_for_free_btn").toLowerCase()}),"current");return c?c.split(/(\{regular_price\}|\{price\})/).map((function(i,n){return"{regular_price}"===i?e:"{price}"===i?t:i?(0,s.jsx)("span",(0,r.__assign)({className:"StickersPriceButton__label"},{children:i}),"label"+n):void 0})):[e,t]}return[u]}),[c,u,null==i?void 0:i.regular,null==i?void 0:i.current]);return(0,s.jsx)(l.default,(0,r.__assign)({className:(0,a.classNames)("StickersPriceButton",t)},_,{children:f}),void 0)};u.defaultProps=(0,r.__assign)({},l.default.defaultProps);const _=u},190291:(e,t,i)=>{"use strict";i.d(t,{default:()=>d});var r=i(570655),s=i(785893),n=i(483295),o=i(511417),a=i(749091),c=i(665820),l=i(360989);const d=function(e){var t=e.className,i=e.product;if(!(0,a.isPackProduct)(i)&&!(0,a.isStyleProduct)(i))return null;var d=(0,c.getStickers)((0,a.isStyleProduct)(i)?i.style_sticker_ids:i.sticker_ids),u=o.colorScheme.isDarkScheme()?a.Theme.DARK:a.Theme.LIGHT;return(0,s.jsx)("div",(0,r.__assign)({className:(0,n.classNames)("StickersProductPreview",t)},{children:(0,s.jsx)("ul",(0,r.__assign)({className:"StickersProductPreview__stickers"},{children:d.map((function(e){return e&&(0,s.jsx)(l.default,{className:"StickersProductPreview__sticker",sticker:e,width:128,height:128,theme:u},e.id)}))}),void 0)}),void 0)}},450134:(e,t,i)=>{"use strict";i.d(t,{useCart:()=>n});var r=i(570655),s=i(667294),n=function(e){var t=(0,r.__read)((0,s.useState)(e),2),i=t[0],n=t[1],o=(0,r.__read)((0,s.useState)(null),2),a=o[0],c=o[1],l=(0,s.useCallback)((function(){var e=i.load();c(e),e.then((function(t){n(t),c((function(t){return t===e?null:t}))}),(function(){}))}),[i]);return(0,s.useEffect)((function(){return i.onChange=l,i.isLoaded()||l(),function(){i.onChange=null,i.cancelLoad()}}),[i]),[i,null!==a]}},451322:(e,t,i)=>{"use strict";i.d(t,{usePack:()=>o});var r=i(570655),s=i(749091),n=i(516067),o=function(e){var t=(0,r.__read)((0,n.useProduct)(e),2),i=t[0],o=t[1];return i&&(0,s.isPackProduct)(i)?[i,o]:[void 0===i?void 0:null,o]}},516067:(e,t,i)=>{"use strict";i.d(t,{useProduct:()=>o});var r=i(570655),s=i(667294),n=i(310835),o=function(e){var t=(0,r.__read)((0,s.useState)({}),2)[1],i=(0,n.getProductFromCache)(e);return void 0===i?((0,n.getProduct)(e,!1).then((function(){return t({})}),(function(){})),[i,!0]):[i,!1]}},227110:(e,t,i)=>{"use strict";i.d(t,{useProducts:()=>o});var r=i(570655),s=i(667294),n=i(310835),o=function(e){var t=(0,r.__read)((0,s.useState)({}),2)[1],i=(0,n.getProductsFromCache)(e);return i.some((function(e){return void 0===e}))?((0,n.getProducts)(e,!1).then((function(){return t({})}),(function(){})),[i,!0]):[i,!1]}},290625:(e,t,i)=>{"use strict";i.d(t,{default:()=>l});var r=i(570655),s=i(667294),n={getOffset:function(){return{x:0,y:0}},scrollTo:function(){},scrollBy:function(){},onWheel:function(){},updateItems:function(){},hasPrev:!1,hasNext:!1,prev:function(){},next:function(){}};function o(e,t){switch(t.type){case"updateState":return(0,r.__assign)((0,r.__assign)({},e),t.state);case"updateNav":return t.hasPrev!==e.hasPrev||t.hasNext!==e.hasNext?(0,r.__assign)((0,r.__assign)({},e),{hasPrev:t.hasPrev,hasNext:t.hasNext}):e;default:throw new Error}}var a=function(e){for(var t=Array.from(e.entries()),i=0;i<t.length;i++){var s=(0,r.__read)(t[i],2),n=s[0],o=s[1];if(o&&o.intersectionRatio)return o.intersectionRatio<1?n:t[i-1]?t[i-1][0]:null}return null},c=function(e){for(var t=Array.from(e.entries()),i=t.length-1;i>=0;i--){var s=(0,r.__read)(t[i],2),n=s[0],o=s[1];if(o&&o.intersectionRatio)return o.intersectionRatio<1?n:t[i+1]?t[i+1][0]:null}return null};const l=function(e){var t=(0,s.useRef)(null),i=(0,r.__read)((0,s.useReducer)(o,n),2),l=i[0],d=i[1],u=(0,s.useCallback)((function(e){d({type:"updateState",state:e})}),[d]),_=(0,s.useCallback)((function(i){if(t.current&&l.onMouseWheel&&t.current.removeEventListener("mousewheel",l.onMouseWheel),i){var s=i.querySelector(e.wrapperSelector);if(s){var n,o={x:0,y:0},_=new Map,f=function(t){var r=0;s.offsetWidth>i.offsetWidth&&(r=Math.max(0,Math.min(s.offsetWidth-i.offsetWidth,t.x)));var n=0;s.offsetHeight>i.offsetHeight&&(n=Math.max(0,Math.min(s.offsetHeight-i.offsetHeight,t.y))),s.style.transform="translate3d(-"+r+"px, -"+n+"px, 0)",s.style.transitionDuration=t.noTransition?"0s":"",o={x:r,y:n},e.onScroll&&e.onScroll(r,n)},m=function(e){f((0,r.__assign)((0,r.__assign)({},e),{x:o.x+e.x,y:o.y+e.y}))},h=function(e){e.deltaX&&e.preventDefault()};i.addEventListener("mousewheel",h),u((0,r.__assign)((0,r.__assign)({},l),{onMouseWheel:h,updateItems:function(){var t,s;n&&n.disconnect(),n=new IntersectionObserver((function(e){var t,i;try{for(var s=(0,r.__values)(e),n=s.next();!n.done;n=s.next()){var o=n.value;_.has(o.target)&&_.set(o.target,o)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}d({type:"updateNav",hasPrev:null!==a(_),hasNext:null!==c(_)})}),{root:i,threshold:[0,1]}),_.clear();try{for(var o=(0,r.__values)(i.querySelectorAll(e.itemSelector)),l=o.next();!l.done;l=o.next()){var u=l.value;_.set(u,null),n.observe(u)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(s=o.return)&&s.call(o)}finally{if(t)throw t.error}}},getOffset:function(){return o},scrollTo:f,scrollBy:m,onWheel:function(e){m({x:e.deltaX,y:e.deltaY,noTransition:!0})},prev:function(){var e=a(_);if(e){var t=getComputedStyle(s),i=parseInt(t.paddingLeft)||0,r=parseInt(t.paddingTop)||0,n=s.getBoundingClientRect(),o=e.getBoundingClientRect();f({x:o.left-n.left-i,y:o.top-n.top-r})}},next:function(){var e=c(_);if(e){var t=getComputedStyle(s),r=parseInt(t.paddingBottom)||0,n=parseInt(t.paddingRight)||0,o=i.getBoundingClientRect(),a=s.getBoundingClientRect(),l=e.getBoundingClientRect();f({x:l.left-a.left-o.width+l.width+n,y:l.top-a.top-o.height+l.height+r})}}}))}}t.current=i}),[e.wrapperSelector,e.itemSelector,e.onScroll]);return(0,s.useLayoutEffect)((function(){l.updateItems()})),(0,r.__assign)({ref:_},l)}},683791:(e,t,i)=>{"use strict";i.d(t,{useStyles:()=>o});var r=i(570655),s=i(749091),n=i(227110),o=function(e){var t,i,o=(0,r.__read)((0,n.useProducts)(e),2),a=o[0],c=o[1],l=[];try{for(var d=(0,r.__values)(a),u=d.next();!u.done;u=d.next()){var _=u.value;_&&(0,s.isStyleProduct)(_)&&l.push(_)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(t)throw t.error}}return[l,c]}},155639:(e,t,i)=>{"use strict";i.d(t,{useWithProducts:()=>o});var r=i(570655),s=i(667294),n=i(227110);function o(e){var t=(0,r.__read)((0,n.useProducts)(e.map((function(e){return e.product_id}))),2),i=t[0],o=t[1];return[(0,s.useMemo)((function(){return e.map((function(e,t){return(0,r.__assign)((0,r.__assign)({},e),{product:i[t]})}))}),[e]),o]}},751595:(e,t,i)=>{"use strict";i.d(t,{previewSticker:()=>p,previewStickerProduct:()=>g});var r=i(570655),s=i(785893),n=i(973935),o=i(654612),a=i(786067),c=i(749091),l=i(310835),d=i(665820),u=i(399321),_=i(486125),f=i(60578),m=i(187925),h=i(618610),v=new Map;function p(e,t){var i=(0,_.showBoxLoader)();(0,d.getPackByStickerId)(e).then((function(e){!(0,_.isBoxLoadingCancelled)(i)&&e&&((0,_.hideBoxLoader)(),g(e.id,t))}),(function(){}))}function g(e,t){var i,d=(0,r.__assign)({},t);function p(){return null==i?void 0:i.bodyNode.querySelector(".StickersProductPreviewBox")}function g(){null==i||i.hide(),window.nav.objLoc[0].match(/^stickers\/(.*?)$/)&&window.nav.setLoc({0:"stickers"})}function k(){null==i||i.updateBoxCoords()}function S(e,t){var i=null,r=null;if((0,c.isPackProduct)(e))i=e.is_purchased&&(null==d?void 0:d.settings)?(0,s.jsx)(m.default,{pack:e,options:d,closeBox:g,updateBox:k},void 0):(0,s.jsx)(f.default,{pack:e,cart:t,options:d,closeBox:g,updateBox:k},void 0),r=e.name;else if((0,c.isStyleProduct)(e)){var o=(0,l.getProductFromCache)(e.base_id);if(o)return t.addProduct(o.id,!0),void S(o,t);i=(0,s.jsx)(h.default,{style:e,options:d,closeBox:g,updateBox:k},void 0),r=e.name}var a=p();if(a&&i&&(n.render(i,a),r)){var u=window.nav.objLoc[0].split("/");"stickers"===u[0]&&u[1]!==r&&window.nav.setLoc({0:"stickers/"+r})}}var w=(0,_.showBoxLoader)(),y=u.Cart.create([e]);return Promise.all([y.load(),window.stManager.add(["stickers.css"])]).then((function(t){var s=(0,r.__read)(t,2),c=s[0];s[1];if(!(0,_.isBoxLoadingCancelled)(w)){(0,_.hideBoxLoader)();var d=(0,l.getProductFromCache)(e);d&&!d.is_disabled?((i=new o.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:640,onShow:function(){S(d,c),requestAnimationFrame((function(){k(),function(){if(v.has(e)){var t=(0,_.getBoxLayerWrap)();t&&(t.scrollTop=v.get(e)||0),v.delete(e)}}()}))},onBeforeHide:function(){!function(){var t=(0,_.getBoxLayerWrap)();t&&v.set(e,t.scrollTop)}()},onHideAttempt:function(){var e;return(e=p())&&n.unmountComponentAtNode(e),!0}})).content('<div class="StickersProductPreviewBox"></div>'),i.show()):(0,o.showFastBox)((0,a.getLang)("global_box_error_title"),(0,a.getLang)("purchases_stickers_product_not_found"))}}),(function(){})),{hide:g}}},310835:(e,t,i)=>{"use strict";i.d(t,{cacheProductsData:()=>o,getProductFromCache:()=>a,getProductsFromCache:()=>c,getProducts:()=>d,getProduct:()=>u,activateProduct:()=>_,updateUserProductState:()=>f});var r=i(570655),s=i(293680),n=i(665820),o=function(e,t){var i,s,o,a,c,l;void 0===t&&(t=[]);var d=(0,n.getCache)();if(e.stickers){var u=d.stickers;try{for(var _=(0,r.__values)(e.stickers),f=_.next();!f.done;f=_.next()){var m=f.value;u.has(m.id)?u.set(m.id,(0,r.__assign)((0,r.__assign)({},u.get(m.id)),m)):u.set(m.id,m)}}catch(e){i={error:e}}finally{try{f&&!f.done&&(s=_.return)&&s.call(_)}finally{if(i)throw i.error}}}if(e.products)try{for(var h=(0,r.__values)(e.products),v=h.next();!v.done;v=h.next()){var p=v.value;d.products.set(p.id,p),d.productPromises.delete(p.id)}}catch(e){o={error:e}}finally{try{v&&!v.done&&(a=h.return)&&a.call(h)}finally{if(o)throw o.error}}try{for(var g=(0,r.__values)(t),k=g.next();!k.done;k=g.next()){var S=k.value;d.products.has(S)||d.products.set(S,null),d.productPromises.delete(S)}}catch(e){c={error:e}}finally{try{k&&!k.done&&(l=g.return)&&l.call(g)}finally{if(c)throw c.error}}e.emoji&&window.Emoji&&window.Emoji.updateTabs(e.emoji.stickers,e.emoji.keywords,!0),(0,n.updateCache)(d)},a=function(e){return(0,n.getCache)().products.get(e)},c=function(e){var t=(0,n.getCache)().products;return e.map((function(e){return t.get(e)}))};var l=function(e){var t,i;if(!e.length)return Promise.resolve([]);var a,l=(0,n.getCache)(),d=l.productPromises,u=l.productIdsQueue,_=new Set;try{for(var f=(0,r.__values)(e),m=f.next();!m.done;m=f.next()){var h=m.value;if(d.has(h)){(v=d.get(h))&&_.add(v)}else{u.add(h);var v=(a=void 0,(a=(0,n.getCache)().productsPromise)||(a=new Promise((function(e){return setTimeout((function(){var t=(0,n.getCache)().productIdsQueue,i=Array.from(t);t.clear(),(0,n.updateCache)({productIdsQueue:t,productsPromise:void 0}),s.ajax.post("stickers.php",{act:"get_products",product_ids:i},{onDone:function(t){o(t,i),e([])},onFail:function(t){return console.error(t),o({},i),e([]),!0}})}),300)})),(0,n.updateCache)({productsPromise:a})),a);d.set(h,v),_.add(v)}}}catch(e){t={error:e}}finally{try{m&&!m.done&&(i=f.return)&&i.call(f)}finally{if(t)throw t.error}}return(0,n.updateCache)({productIdsQueue:u,productPromises:d}),Promise.all(_).then((function(){return c(e)}))},d=function(e,t){void 0===t&&(t=!0);var i=t?e.filter((function(e){return void 0===a(e)})):e;return i.length?l(i).then((function(){return c(e)})):Promise.resolve(c(e))},u=function(e,t){if(void 0===t&&(t=!0),t){var i=a(e);if(void 0!==i)return Promise.resolve(i)}return l([e]).then((function(){return a(e)}))},_=function(e){return new Promise((function(t){s.ajax.post("stickers.php",{act:"activate_product",product_id:e.id,hash:e.csrf_hash},{onDone:function(e){o(e),t()},onFail:function(e){return console.error(e),t(),!0}})}))},f=function(e,t,i,r){return void 0===r&&(r=!0),new Promise((function(n){s.ajax.post("stickers.php",{act:"update_user_product_state",product_ids:[e],key:t,value:i},{onDone:function(e){r&&o(e),n()},onFail:function(e){return console.error(e),n(),!0}})}))}},870264:(e,t,i)=>{"use strict";i.d(t,{giftStickersCart:()=>u,giftStickerProducts:()=>_});var r=i(570655),s=i(785893),n=i(973935),o=i(654612),a=i(399321),c=i(348230),l=i(665820),d=i(490808);function u(e,t){var i;if((0,l.getCache)().productsGiftLock)return null;(0,l.updateCache)({productsGiftLock:!0});var a=(0,r.__assign)({},t);function u(){return null==i?void 0:i.bodyNode.querySelector(".StickersProductsGift")}function _(){null==i||i.hide()}function f(){null==i||i.updateBoxCoords()}return(0,c.showLoader)(),e.isGift=!0,Promise.all([e.load(!0),window.stManager.add(["stickers.css","wide_dd.js","wide_dd.css"])]).then((function(e){var t=(0,r.__read)(e,2),m=t[0];t[1];(0,c.hideLoader)(),i=new o.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:450,onShow:function(){!function(e){var t=u();t&&n.render((0,s.jsx)(d.default,{cart:e,options:a,closeBox:_,updateBox:f},void 0),t)}(m),requestAnimationFrame((function(){f()}))},onHideAttempt:function(){var e;return(e=u())&&n.unmountComponentAtNode(e),!0},onHide:function(){(0,l.updateCache)({productsGiftLock:!1})}}),i.content('<div class="StickersProductsGift"></div>'),i.show()}),(function(){})),{hide:_}}function _(e,t,i){return void 0===t&&(t=[]),u(a.Cart.create(e,t),i)}},348230:(e,t,i)=>{"use strict";i.d(t,{getBoxLayerWrap:()=>u,showLoader:()=>_,hideLoader:()=>f,getPurchaseResult:()=>m,updateStickersFromQueue:()=>h});var r=i(786067),s=i(41650),n=i(511417),o=i(315544),a=i(486125),c=i(749091),l=s.default.getLang;function d(){return document.querySelector("#box_loader")}function u(){return document.querySelector("#box_layer_wrap")}function _(){var e=d();(0,a.boxRefreshCoords)(e),(0,o.show)(e),(0,o.show)(u())}function f(){(0,o.hide)(d())}function m(e){var t=new c.ProductsByType(e.items.filter((function(e){return!e.error})).map((function(e){return e.product}))),i=t.getPack(),s=t.getStyles();if(i)return s.length?(0,r.langStr)(l("purchases_stickers_purchase_result_pack_and_styles",s.length),"pack_title",i.title,"n",s.length):(0,r.langStr)(l("purchases_stickers_purchase_result_pack"),"title",i.title);if(s.length)switch(s.length){case 1:return(0,r.langStr)(l("purchases_stickers_purchase_result_1_style"),"title",s[0].title);case 2:return(0,r.langStr)(l("purchases_stickers_purchase_result_2_styles"),"title1",s[0].title,"title2",s[1].title);case 3:return(0,r.langStr)(l("purchases_stickers_purchase_result_3_styles"),"title1",s[0].title,"title2",s[1].title,"title3",s[2].title);case 4:return(0,r.langStr)(l("purchases_stickers_purchase_result_3_styles_and_1_more"),"title1",s[0].title,"title2",s[1].title,"title3",s[2].title);default:var n=s.length-3;return(0,r.langStr)(l("purchases_stickers_purchase_result_3_styles_and_n_more",n),"title1",s[0].title,"title2",s[1].title,"title3",s[2].title,"n",n)}return null}function h(e){var t,i;t=e,i=n.colorScheme.isDarkScheme()?"data-src-dark":"data-src-light",t.querySelectorAll(".sticker_img["+i+"]").forEach((function(e){var t=e.getAttribute(i);t&&(e.src=t)}))}},575867:(e,t,i)=>{"use strict";i.d(t,{vmojiSubscribeToQueue:()=>s,vmojiPurchaseProduct:()=>n,vmojiGetAvatar:()=>o,vmojiGetStickerPacksRecommendationBlocks:()=>a,vmojiGetStickerPacksRecommendationBlock:()=>c,vmojiGetStickerPacks:()=>l,vmojiGetCharacterById:()=>d,vmojiSetAvatarState:()=>u,storeActivateProduct:()=>_,storeDeactivateProduct:()=>f,vmojiGetLangs:()=>m});var r=i(189798),s=function(){return(0,r.api)("vmoji.subscribeToQueue",{})},n=function(e,t){return void 0===t&&(t=!1),(0,r.api)("vmoji.purchaseProduct",{product_id:e,confirm:t?1:0})},o=function(e){var t={};return e&&Object.assign(t,{avatar_id:e}),(0,r.api)("vmoji.getAvatar",t)},a=function(e){return(0,r.api)("vmoji.getStickerPacksRecommendationBlocks",e)},c=function(e,t){var i={block_id:e};return t&&Object.assign(i,{count:t}),(0,r.api)("vmoji.getStickerPacksRecommendationBlock",i)},l=function(e){return(0,r.api)("vmoji.getStickerPacks",e)},d=function(e,t){return(0,r.api)("vmoji.getCharacterById",{character_id:e,with_stickers:t?1:0})},u=function(e,t){return(0,r.api)("vmoji.setAvatarState",{avatar_id:e,is_active:t?1:0})},_=function(e){return(0,r.api)("store.activateProduct",{type:"stickers",product_id:e})},f=function(e){return(0,r.api)("store.deactivateProduct",{type:"stickers",product_id:e})},m=function(){return new Promise((function(e,t){window.ajax.post("al_vmoji.php",{act:"lang_keys"},{onDone:function(){e()},onFail:function(){return t(),!1}})}))}}}]);try{stManager.done("dist/a1258c00747aa03727abf8c40b9e7df9.68f3862e0ef2f87f544d.js")}catch(e){}