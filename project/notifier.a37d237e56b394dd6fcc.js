(()=>{"use strict";var __webpack_modules__={588379:(e,t,i)=>{i.d(t,{default:()=>c});i(175115);var _=i(761508),o=i(726271),a=i(961540),r=i(421295);function n(){return n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(e[_]=i[_])}return e},n.apply(this,arguments)}var s=o.browser.iphone||o.browser.ipad||o.browser.ipod;function c(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=n({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function l(e,t,i){(0,a.isMvk)()?window.addEvent(e,t,i,{passive:!0}):window.addEvent(e,t,i)}function d(e,t,i){(0,a.isMvk)()?window.removeEvent(e,t,i,{passive:!0}):window.removeEvent(e,t,i)}function u(){return document.visibilityState||document.webkitVisibilityState}function f(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}window.extend(c.prototype,_.default.prototype),window.extend(c.prototype,{stop:function(){this.started=!1,d(this.opts.element,this.opts.triggerEvents,this.cbActiveB),(0,a.isMvk)()&&this._isTopLevel()&&f()&&d(document,f(),this.onVisiblityChange),(0,a.isMvk)()&&s||(d(this.opts.focusElement,"focus",this.cbActiveB),d(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!(0,a.isMvk)()&&o.browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),(0,a.isMvk)()&&this._isTopLevel()&&f()&&l(document,f(),this.onVisiblityChange),(0,a.isMvk)()&&s||(l(this.opts.focusElement,"focus",this.cbActiveB),l(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),d(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(r.screenWakeLocker.isLocked()||(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),d(this.opts.element,this.opts.triggerEvents,this.cbActiveB),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout)))},getActiveTime(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange(){"visible"===u()?this.cbActiveB():this.cbInactiveB()},_isTopLevel(){var e=this.opts.focusElement;return e===window||e===document},_isFocused(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=u();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},188015:(e,t,i)=>{i.d(t,{random:()=>o});i(781303);var _=i(40906);function o(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce(((e,t)=>e+t)))}}catch(e){}return(0,_.intval)((0,_.rand)(0,2147483647).toFixed(0))}},40415:(e,t,i)=>{i(530522),i(579665),i(95767),i(820075),i(66108),i(21466),i(283946),i(751876),i(59357),i(175115),i(991181),i(176774),i(940851),i(296253);var _=i(386409),o=i(726271),a=i(787481),r=i(654612),n=i(982452),s=i(100416),c=i(635429),l=i(427909),d=i(486125),u=i(49535),f=i(635676),h=i(315544),p=i(695724),b=i(376852),E=i(786067),C=i(40906),m=i(961540),g=i(28238),v=i(329164),w=i(722088),M=i(663825),P=i(188015),T=i(887294),O=i(191040),D=i(460615),I=i(294940),k=i(597903),y=i(454593),B=i(588379),L=i(363035),A=i(163612);function N(){return N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(e[_]=i[_])}return e},N.apply(this,arguments)}function R(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],_=!0,o=!1,a=void 0;try{for(var r,n=e[Symbol.iterator]();!(_=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);_=!0);}catch(e){o=!0,a=e}finally{try{_||null==n.return||n.return()}finally{if(o)throw a}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return F(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return F(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,_=new Array(t);i<t;i++)_[i]=e[i];return _}var W=1e4,U="fc_msgs_unread",S="WithCollapsedFastChats";function K(){return!curFastChat.version||!curFastChat.tabs}function x(e,t){var i=R(e,6);return{name:i[0],photo:i[1],fname:i[2],hash:i[3],sex:i[4],link:i[5],online:curFastChat.onlines[t]}}window.curFastChat||(window.curFastChat={}),window.FastChat={init:function(e){var t=this;0!==vk.id&&((0,p.extend)(curFastChat,{tabs:{},needPeers:{},gotPeers:{},needMedia:{},gotMedia:{},ldb:(0,g.mount)(vk.id),myTypingEvents:{},typingEvents:{},inited:!0,options:e,posSeq:0,error_timeout:1,lpInstance:Notifier.getLpInstance()}),delete curFastChat.standby,delete curFastChat.standbyTO,curFastChat.lpInstance.onData((function(){for(var e=arguments.length,i=new Array(e),_=0;_<e;_++)i[_]=arguments[_];var o=t.getResourcesThatShouldBeLoaded(i),a=o.shouldLoad?t.loadResources(o):Promise.resolve();a.then((()=>{i.forEach((e=>{switch(e.type){case M.TYPING:var i=t.getTab(e.peerId);t.setTyping(e),i&&(t.updateTypings(),t.waitTyping(e).then(t.updateTypings)),t.blinkTyping(e.peerId);break;case M.ADD_MESSAGE:var _=t.getTab(e.peerId);t.setTyping(e),_&&(t.addMessage(t.prepareMessageData(e)),t.scroll(e.peerId),t.blinkTab(e.peerId),t.updateTypings(),t.waitTyping(e).then(t.updateTypings)),t.updateTabUnreadCounter(_,e);break;case M.EDIT_MESSAGE:case M.REPLACE_MESSAGE:var o=e.peerId,a=e.messageId,r=t.getTab(o);r&&r.msgs[a]&&(delete curFastChat.gotMedia[a],t.editMessage(t.prepareMessageData(e)));break;case M.REPLACE_FLAGS:case M.SET_FLAGS:case M.RESET_FLAGS:e.flags&M.FLAG_DELETED&&t.deleteMessage(t.prepareMessageData(e));break;case M.READ_INBOUND:case M.READ_OUTBOUND:t.markMessagesAsRead(e);break;case M.CHAT_CHANGED:case M.CONVERSATION_UPDATED:var n=t.getTab(e.peerId);t.handleEventChatUpdated(n,e);case M.VIDEO_CALL:case M.UNREAD_COUNT:case M.NOTIFY_SETTINGS_CHANGED:case M.EMPTY:case M.RESYNC:case M.REFRESH_LP_KEY:case M.TRANSITION:case M.RESET_PEER:case M.MUTEX:case M.CHANGE_PEER:case M.CHANGE_TAB:case M.FAILED_MESSAGE:case M.RESEND:case M.DELETE_DIALOG:}}))}))})),Notifier.addRecvClbk("fastchat",0,FastChat.lcRecv,!0),Notifier.addRecvClbk("logged_off",0,FastChat.standby,!0),FastChat.lcSend("needSettings",{version:e.version,lang_id:langConfig.id}),clearTimeout(curFastChat.getSettingsTO),curFastChat.getSettingsTO=setTimeout(FastChat.getSettings,300))},getSettings:function(){var e=ls.get("fcFriends"+vk.id);ajax.post("al_im.php",{act:"a_get_fast_chat",friends:e&&e.version,cache_time:FastChat.cachedStickersKeywordsTime()},{onDone:function(t){-1==t.friends?(t.friends_version=e.version,t.friends=e.list):ls.set("fcFriends"+vk.id,{version:t.friends_version,list:t.friends}),FastChat.gotSettings(t),FastChat.sendSettings()},onFail:function(){return!0}})},cachedStickersKeywordsTime:function(){var e=ls.get("stickers_keywords");return e&&e.time?Math.floor(e.time/1e3):0},gotSettings:function(e){e.emoji_stickers&&(window.emojiStickers=e.emoji_stickers),window.Emoji&&Emoji.updateTabs(),e.autoplay_animations&&window.StickersSettings.setAutoplay(e.autoplay_animations),clearTimeout(curFastChat.getSettingsTO),window.lang=(0,p.extend)(window.lang||{},e.lang),(0,p.extend)(curFastChat,e,{lang_id:langConfig.id}),curFastChat.friendsCnt=Object.keys(curFastChat.friends),setTimeout(FastChat.clistCache.pbind(!1),10),FastChat.initUI()},sendSettings:function(){clearTimeout(curFastChat.sendSettingsTO);var e=["friends","friends_version","onlines","tpl","lang","me","version"].reduce(((e,t)=>(e[t]=curFastChat[t],e)),{});curFastChat.sendSettingsTO=setTimeout((function(){FastChat.lcSend("settings",{settings:e})}),curNotifier.is_server?0:(0,C.irand)(50,100))},destroy:function(){return!!curFastChat.inited&&(curFastChat.ldb.unmount(),(0,p.each)(curFastChat.tabs||{},(function(e,t){t.box.destroy()})),curFastChat.clistBox&&curFastChat.clistBox.destroy(),(0,p.each)(curFastChat.el||{},(function(){(0,h.cleanElems)(this)})),clearInterval(curFastChat.updateFriendsInt),clearTimeout(curFastChat.correspondentsTO),clearTimeout(curFastChat.lp_error_to),curFastChat={inited:!1},!0)},isChatOpen:function(e){if(window.curFastChat&&curFastChat.inited&&e){var t=curFastChat.tabs,i=curFastChat.clistBox;if(t&&t[e]&&t[e].box.visible||i&&i.visible)return!0}return!1},standby:function(e){FastChat.destroy(),curFastChat.standby=!0;var t=1;!function i(){if(!curNotifier.is_server)return clearTimeout(curFastChat.standbyTO),void(curFastChat.standbyTO=setTimeout(i,1e3*t));ajax.post("notifier.php?act=a_get_reload",{version:e},{onDone:function(e,t){FastChat.lcSend("gotConfig",{navVersion:e,config:t}),FastChat.gotConfig(e,t)},onFail:function(){return t*=2,clearTimeout(curFastChat.standbyTO),curFastChat.standbyTO=setTimeout(i,1e3*t),!0}})}()},gotConfig:function(e,t){clearTimeout(curFastChat.standbyTO),curFastChat.standby&&setTimeout((function(){if(e>stVersions.nav){(0,a.debugLog)("appending al loader");var i=vk.navPostfix||"";headNode.appendChild((0,h.ce)("script",{type:"text/javascript",src:`/js/loader_nav${i}${e}_${vk.lang}.js`}))}setTimeout((function(){e<=stVersions.nav?window.stManager.add(["notifier.js","notifier.css",window.jsc("web/emoji.js")],(function(){FastChat.init(t)})):setTimeout(arguments.callee,100)}),0)}),curNotifier.is_server?0:(0,C.irand)(1e3,2e3))},updateVersion:function(e){FastChat.lcSend("standby",{version:e}),FastChat.standby(e)},lcSend:function(e,t){Notifier.lcSend("fastchat",(0,p.extend)({act:e,__id:curFastChat.me&&curFastChat.me.id||vk.id},t))},lcRecv:function(e){if(!(0,C.isEmpty)(e)){var t=e.act;e.__id===(curFastChat.me&&curFastChat.me.id||vk.id)&&(delete e.act,delete e.__id,FastChat.lcFeed(t,e))}},lcFeed:function(e,t){switch(e){case"needSettings":curFastChat.version<t.version||t.lang_id==curFastChat.lang_id&&FastChat.sendSettings();break;case"settings":!curFastChat.version&&curFastChat.options&&t.settings.version==curFastChat.options.version&&FastChat.gotSettings(t.settings),clearTimeout(curFastChat.sendSettingsTO);break;case"standby":K()||FastChat.standby(t.version);break;case"gotConfig":FastChat.gotConfig(t.navVersion,t.config);break;case"clistOnlines":K()||FastChat.clistGotOnlines(t);break;case"needPeer":if(K())break;var i=t.id,_=curFastChat.tabs[i],o=curFastChat.friends[i+"_"],a=!1;if(void 0!==_?(a={name:_.name,photo:_.photo,fname:_.fname,hash:_.hash,sex:_.sex,data:_.data,online:_.online},Object.keys(_.msgs).length>0&&(a.history=[_.log.innerHTML,_.msgs])):o&&(a=x(o,i)),!1===a)break;curFastChat.gotPeers[i]=setTimeout((function(){var e={};e[i]=a,FastChat.lcSend("gotPeers",e)}),curNotifier.is_server?0:(0,C.irand)(50,100));break;case"fetchingPeers":if(K())break;(0,p.each)(t,(function(e,t){var i=curFastChat.needPeers[e];i&&(t&i[0])==i[0]&&clearTimeout(i[2])}));break;case"gotPeers":K()||FastChat.gotPeers(t);break;case"stateChange":K()||FastChat.onStateChanged(t);break;case"needMedia":var r=t.msgId,n=curFastChat.gotMedia[r];if(void 0===n||0===n)break;curFastChat.gotMedia[r][3]=setTimeout((function(){FastChat.lcSend("gotMedia",{msgId:r,peer:n[0],text:n[1],msgOpts:n[2]})}),curNotifier.is_server?0:(0,C.irand)(50,100));break;case"fetchingMedia":var s=t.msgId,c=curFastChat.needMedia[s];if(void 0===c||0===curFastChat.gotMedia[s])break;clearTimeout(c[1]),c[1]=setTimeout(FastChat.loadMsgMedia.pbind(c[0],s),1e3);break;case"gotMedia":var l=t.msgId,d=curFastChat.gotMedia[l];(0,C.isArray)(d)&&clearTimeout(d[3]),FastChat.gotMsgMedia(t.peer,l,t.text,t.msgOpts)}},getResourcesThatShouldBeLoaded(e){var t={},i=e.filter((e=>e.type===M.ADD_MESSAGE)),_=e.filter(I.isServiceMsg),o=i.filter((e=>!this.isTabLoaded(e.peerId))).map((e=>e.peerId));function a(e,i){var _=FastChat.getTab(e);(0,k.isChatPeer)(e)&&i&&_&&!_.data.members[i]&&(t[e]?-1===t[e].indexOf(i)&&t[e].push(i):t[e]=[i])}return i.forEach((e=>{this.isTabLoaded(e.peerId)&&a(e.peerId,e.userId)})),_.forEach((e=>{a(e.peerId,+e.kludges.source_mid)})),{shouldLoad:Object.keys(t).length>0||o.length>0,needPeers:o,needMembers:t}},loadResources(e){var t=e.needMembers,i=curFastChat.lpInstance;return i.pause(),this.loadMembers(t).then((()=>i.resume()))},loadMembers(e){if(0===Object.keys(e).length)return Promise.resolve();var t=Object.keys(e).map((t=>`${t}:${e[t].join(",")}`)).join(";");return(0,T.post)(y.CONTROLLER,{act:"a_load_member",need:t}).then((t=>{var i=R(t,1)[0];Object.keys(e).forEach((t=>{var _=this.getTab(t);_&&_.data&&_.data.members&&(_.data.members=e[t].reduce(((e,t)=>{var _=i.find((e=>e.id===t));return e[t]=Object.assign({name_inv_case:_.inv_name,name_kick_case:_.kick_name},_),e}),_.data.members))}))}))},handleEventChatUpdated(e,t){switch(t.updateType){case M.MAIL_CHAT_UPDATE_TYPE_TITLE_CHANGED:case M.MAIL_CHAT_UPDATE_TYPE_AVATAR_CHANGED:var i=[t.peerId,0].join(",");this.loadPeers(i,(e=>{this.updateChatInfo(t.peerId,e)}));case M.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED:case M.MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED:case M.MAIL_CHAT_UPDATE_TYPE_PINNED:case M.MAIL_CHAT_UPDATE_TYPE_USER_JOINED:case M.MAIL_CHAT_UPDATE_TYPE_USER_LEFT:case M.MAIL_CHAT_UPDATE_TYPE_USER_KICKED:case M.MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED:case M.MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED:case M.MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED:}},updateChatInfo(e,t){var i=this.getTab(e),_=t[e],o=_.photo,a=_.grid,r=_.name,n=document.querySelector(`#chat_tab_icon_${e} .chat_tab_img`),s=document.createElement(o?"img":"div"),c=i&&i.unread?" ("+i.unread+")":"";i&&i.title&&(i.name=r,i.title.innerHTML=r+c),s.classList.add("chat_tab_img"),a?s.innerHTML=`<div class="chat_tab_grid">${a}</div>`:o&&(s.id="im_dialog_ph"+(e-2e9),s.src=o),n&&n.parentNode.replaceChild(s,n)},blinkEl:function(e,t,i){if(t>10)return i(),!1;t%2==0?(0,f.animate)(e,{opacity:0},400,(function(){FastChat.blinkEl(e,t+1,i)})):(0,f.animate)(e,{opacity:1},400,(function(){setTimeout((function(){FastChat.blinkEl(e,t+1,i)}),400)}))},blinkTyping:function(e){var t=(0,h.ge)("chat_tab_icon_"+e);if(t){var i=(0,h.geByClass1)("chat_tab_typing_wrap",t);(0,f.fadeIn)(i,150,(function(){FastChat.blinkEl(i.firstChild,0,(function(){(0,f.fadeOut)(i,150)}))}))}},imFeed:function(e,t){var i=this.getTab(e);if(!i)return!1;i.auto&&!i.unread&&(i.box._close(!0),delete curFastChat.tabs[e])},tabNotify:function(e,t,i){var _,o=curFastChat.tabs[e];if(e>0&&e<2e9&&(0,C.isFunction)(cur.onPeerStatusChanged)&&cur.onPeerStatusChanged(e,t,i),!(e<=0)&&o&&o.box&&!o.box.minimized){switch(clearTimeout(o.hideNotifyTO),t){case"online":_=(0,E.getLang)("mail_im_user_became_online",3-o.sex),FastChat.blinkTab(e);break;case"offline":_=(0,E.getLang)("mail_im_user_became_offline",3-o.sex),FastChat.blinkTab(e);break;case"unavail":_=(0,E.getLang)("mail_im_not_online",3-o.sex).replace(/\.$/,"")}_=_.replace("{user}",o.fname),(0,h.val)(o.notify,'<div class="fc_tab_notify fc_tab_notify_'+t+'">'+_+"</div>");var a=o.notify.firstChild;clearTimeout(o.hideNotifyTO),o.hideNotifyTO=setTimeout((function(){(0,f.fadeOut)(a,200,(function(){(0,h.val)(o.notify,"")}))}),5e3)}},hideChatCtrl:function(){(0,h.removeClass)(Chat.wrap,"chat_active"),(0,u.removeEvent)(document,"mousedown",FastChat.onDocClick)},showChatCtrl:function(){(0,h.addClass)(Chat.wrap,"chat_active"),setTimeout((function(){(0,u.addEvent)(document,"mousedown",FastChat.onDocClick)}),0)},hideUI:function(){(0,h.addClass)(bodyNode,"chat_onl_hidden")},showUI:function(){(0,h.removeClass)(bodyNode,"chat_onl_hidden")},initUI:function(){if(curFastChat.options){var e=curFastChat.el={},t=getWndInner();(0,h.re)("rb_box_fc_clist"),e.clistWrap=(0,h.se)(curFastChat.tpl.clist),e.clist=(0,h.geByClass1)("fc_contacts",e.clistWrap,"div"),e.clistTitle=(0,h.geByClass1)("fc_tab_title",e.clistWrap,"div"),e.clistOnline=(0,h.geByClass1)("fc_clist_online",e.clistWrap,"div");var i=curFastChat.options.state||!1,_=!curFastChat.friendsCnt||(i&&void 0!==i.clist.min?i.clist.min:t[1]<1200||curFastChat.friendsCnt<5);curFastChat.clistW=270,curFastChat.clistH=299;var a={id:"fc_clist",movable:(0,h.geByClass1)("fc_tab_head",e.clistWrap),hider:(0,h.geByClass1)("fc_tab_close_wrap",e.clistWrap,"a"),startHeight:curFastChat.clistH,startWidth:curFastChat.clistW,resizeableH:e.clist,resize:!1,minH:150,fixed:_,onHide:function(){(0,h.val)("fc_clist_filter",curFastChat.q=""),(0,h.addClass)(curFastChat.clistBox.wrap,"fc_fixed"),curFastChat.clistBox.fixed=!0,FastChat.stateChange({op:"clist_toggled",val:0}),(0,h.setStyle)(curFastChat.clistBox.wrap,{top:"auto",bottom:0,right:72,left:"auto"}),(0,h.show)(e.topLink),FastChat.hideChatCtrl()},onShow:function(){FastChat.showChatCtrl()},onDragEnd:function(e,t){FastChat.stateChange({op:"clist_moved",y:e,x:t})},onResize:function(){curFastChat.clistBoxScroll&&curFastChat.clistBoxScroll.update(!1,!0)}};i&&!_&&(!1!==i.clist.x&&(-1==i.clist.x?a.startRight=0:a.startLeft=t[1]*i.clist.x),!1!==i.clist.y&&(-1==i.clist.y?a.startBottom=0:a.startTop=t[0]*i.clist.y)),_&&(a.noshow=!0),void 0===a.startTop&&void 0===a.startBottom&&(a.startTop=t[0]<800?0:.1*t[0]),void 0===a.startLeft&&void 0===a.startRight&&(a.startRight=0),curFastChat.clistBox=new window.RBox(e.clistWrap,a),a.noshow||void 0===a.startLeft&&void 0===a.startTop||curFastChat.clistBox._wnd_resize(t[0],t[1],!0),curFastChat.clistBoxScroll=new Scrollbar(e.clist,{prefix:"fc_",scrollChange:FastChat.clistShowMore,nomargin:!0,global:!0,nokeys:!0,right:vk.rtl?"auto":1,left:vk.rtl?1:"auto"}),curFastChat.updateFriendsInt=setInterval(FastChat.clistUpdate,18e4);var r,n=(0,h.ge)("fc_clist_filter");if((0,s.placeholderInit)(n,{global:!0}),curFastChat.q="",(0,u.addEvent)(n,"keyup "+(o.browser.opera?"keypress":"keydown"),(function(e){if(e.keyCode===u.KEY.ESC)return FastChat.clistHide(),(0,u.cancelEvent)(e);var t=FastChat.clistFilterKey(e);if(void 0!==t)return t;curFastChat.q=(0,p.trim)((0,h.val)(this)),FastChat.clistRender()})),e.clistOnline)bodyNode.appendChild(r=(0,h.ce)("nobr",{className:"fl_l",innerHTML:(0,E.getLang)("mail_im_clist_onlines")},{visibility:"hidden",position:"absolute"})),(0,h.re)(r),(0,u.addEvent)(e.clistOnline,"mouseover",(function(t){(0,b.showTooltip)(this,{text:(0,E.getLang)("mail_im_clist_onlines"),forcetoup:1,shift:[12,4,3],className:"tt_fc_onlines",init:function(){o.browser.msie&&(e.clistOnline.tt.isFixed=!1)},black:1})})),(0,u.addEvent)(e.clistOnline,"click",(function(e){(e.originalEvent||e).cancelBubble=!0,FastChat.clistToggleOnlines(),FastChat.clistRender()})),i&&i.clist&&i.clist.onlines&&FastChat.clistToggleOnlines(!0);_?FastChat.clistUpdateTitle():FastChat.clistRender(),curFastChat.ready=!0,i&&i.tabs&&(0,p.each)(i.tabs,(function(e,i){e=(0,p.intval)(e);var _={nofocus:1};this.min&&(_.minimized=!0),this.h&&(_.startHeight=this.h*t[0]),this.w&&(_.startWidth=this.w*t[1]),void 0!==this.x&&this.x<=1&&(this.x<0?_.startRight=0:_.startLeft=t[1]*this.x),void 0!==this.y&&this.y<=1&&(this.y<0?_.startBottom=0:_.startTop=t[0]*this.y),i.fx?(_.fixedLoad=!0,FastChat.prepareTabIcon(e,_,!0)):(_.noAnim=!0,FastChat.addPeer(e,!1,!1,_))})),(0,u.addEvent)(Chat.itemsCont,"mouseover",FastChat.itemsTT),(0,u.addEvent)(Chat.itemsCont,"mouseout",FastChat.itemsOut)}},itemsOffset:12,itemsTT:function(e){for(var t=e.target,i=!1;t&&t!=Chat.itemsCont;){if((0,h.hasClass)(t,"chat_tab_wrap")){i=t;break}t=t.parentNode}if(!i)return clearTimeout(Chat.ttOutTimeout),Chat.ttOutTimeout=!1,!1;var _=i.id.split("_")[3],o=Chat.tabs[_];return!!o&&(curFastChat.activeBox&&curFastChat.activeBox.visible&&curFastChat.activeBox.options.peer==_?(FastChat.itemsOut(),!1):(clearTimeout(Chat.ttOutTimeout),Chat.ttOutTimeout=!1,(0,b.showTooltip)(i,{text:o.name,slideX:15,black:1,asrtl:1,appendEl:Chat.ttNode,className:"tt_black_side",shift:[-58,-37,0],zIndex:10201}),void(Chat.ttPeer=i)))},itemsOut:function(){if(Chat.ttOutTimeout)return!1;Chat.ttOutTimeout=setTimeout((function(){if(Chat.ttOutTimeout=!1,!Chat.ttPeer)return!1;(0,u.triggerEvent)(Chat.ttPeer,"mouseout"),Chat.ttPeer=!1}),0)},stateChange:function(e){ajax.post("al_im.php",(0,p.extend)({act:"a_state_fc",hash:curFastChat.options.state_hash||""},e),{onFail:function(){return!0}}),FastChat.lcSend("stateChange",e)},onStateChanged:function(e){var t=!!e.peer&&curFastChat.tabs[e.peer],i=e.peer?t&&t.box:curFastChat.clistBox,_=getWndInner();switch(e.op){case"added":if(t){delete t.auto;break}e.fixed?FastChat.prepareTabIcon(e.peer,{fixedLoad:!0}):FastChat.addPeer(e.peer);break;case"unfixed":var o={startHeight:(0,p.intval)(_[0]*e.h),startWidth:(0,p.intval)(_[1]*e.w)};-1==e.y?o.startBottom=0:o.startTop=(0,p.intval)(_[0]*e.y),-1==e.x?o.startRight=0:o.startLeft=(0,p.intval)(_[1]*e.x),FastChat.addPeer(e.peer,!1,!1,o);break;case"closed":if(Chat.tabs[e.peer]&&FastChat.closeTabIcon(e.peer),!t||!i)break;i.close();break;case"hidden":if(!t||!i)break;i.close();break;case"minimized":if(!t||!i)break;e.val?i.unminimize():i.minimize();break;case"moved":case"clist_moved":(0,h.setStyle)(i.wrap,{bottom:-1==e.y?0:"auto",top:-1!=e.y?(0,p.intval)(_[0]*e.y):"auto",right:-1==e.x?0:"auto",left:-1!=e.x?(0,p.intval)(_[1]*e.x):"auto"}),i.toBottom=-1==e.y,i.toRight=-1==e.x;break;case"resized":(0,h.setStyle)(i.wrap,{bottom:-1==e.y?0:"auto",top:-1!=e.y?(0,p.intval)(_[0]*e.y):"auto",right:-1==e.x?0:"auto",left:-1!=e.x?(0,p.intval)(_[1]*e.x):"auto"}),i.toBottom=-1==e.y,i.toRight=-1==e.x;var a=(0,p.intval)(_[1]*e.w);(0,h.setStyle)(i.resizeableH,"height",(0,p.intval)(_[0]*e.h)),(0,h.setStyle)(i.resizeableW,"width",a),FastChat.fixResized(t,a);break;case"clist_toggled":e.val?i.show(0,!0):i.hide(0,!0),(0,h.toggle)(curFastChat.el.topLink,!e.val);break;case"onlines_toggled":FastChat.clistToggleOnlines(e.val),FastChat.clistRender()}},onUnidle:function(){curNotifier.version&&curFastChat.clistBox&&(curFastChat.clistBox.visible&&(curFastChat.el.clist.scrollTop<100||curRBox.active!=curFastChat.clistBox.id)?FastChat.clistRender():FastChat.clistUpdateTitle(),(0,p.each)(curFastChat.tabs,(function(e){FastChat.restoreDraft(e)})))},clistUpdate:function(){var e=(0,C.vkNow)();if(curNotifier.is_server&&!(curFastChat.clistUpdatedTs&&e-curFastChat.clistUpdatedTs<6e4)){curFastChat.clistUpdatedTs=e;var t=Object.keys(curFastChat.tabs).concat(Object.keys(Chat.tabs)).join();ajax.post("al_im.php",{act:"a_onlines",peer:t},{onDone:function(e){FastChat.clistGotOnlines(e),FastChat.lcSend("clistOnlines",e)},onFail:()=>!0})}},clistGotOnlines:function(e){var t=curFastChat.onlines,i=[];curFastChat.onlines=e,curNotifier.idle_manager&&curNotifier.idle_manager.is_idle||!curFastChat.tabs&&Chat.tabs||((0,p.each)(curFastChat.tabs,(function(_){curFastChat.onlines[_]!=t[_]&&(FastChat.tabNotify(_,e[_]?"online":"offline",e[_]),e[_]||(i[_]=1))})),(0,p.each)(Chat.tabs,(function(i){if(curFastChat.onlines[i]!=t[i]){var _=(0,h.geByClass1)("_chat_tab_image",(0,h.ge)("chat_tab_icon_"+i));(0,h.toggleClass)(_,"online",e[i]),(0,h.toggleClass)(_,"mobile",e[i]&&mobPlatforms[e[i]])}})),i=(0,p.arrayKeyDiff)(t,e,i),(0,p.each)(i,(function(e){FastChat.tabNotify(e,"offline")})),FastChat.clistRender())},clistShow:function(){var e=(0,h.hasClass)(Chat.wrap,"chat_active");FastChat.clistRender(),curFastChat.clistBox.visible?curFastChat.clistBox.focus():(curFastChat.activeBox&&curFastChat.activeBox!=curFastChat.clistBox&&curFastChat.activeBox.hide(),curFastChat.clistBox.show(),FastChat.setActive(curFastChat.clistBox),curFastChat.clistBoxScroll&&curFastChat.clistBoxScroll.update(!1,!0),curFastChat.el.topLink&&(0,h.hide)(curFastChat.el.topLink)),(0,h.elfocus)("fc_clist_filter"),FastChat.movePointer(!1,e)},clistHide:function(){curFastChat.clistBox.hide(),curFastChat.activeBox==curFastChat.clistBox&&FastChat.setActive(!1)},clistRender:function(e){var t=[],i=!e,_=1+(e?40:20),a=!1,r=!1,n=!1,s=curFastChat.q;if(s?(n=[],(0,p.each)(FastChat.clistCache(s),(function(){n.push((0,p.escapeRE)(this))})),n=new RegExp("([ -]|^|s|&nbsp;|\b)("+n.join("|")+")","gi"),a=curFastChat.clistCache[s]||{}):curFastChat.clOnlines&&(a=curFastChat.onlines),curFastChat.clHasMore=!1,(0,p.each)(curFastChat.friends,(function(e){var o=(0,p.intval)(e),s=!a||a[o];if(i){if(s){if(!--_)return curFastChat.clHasMore=!0,!1;t.push(FastChat.clistWrapPeer(o,this,n)),r=o}}else o==curFastChat.clOffset&&(i=!0)})),!1!==r||e||s?s&&!curFastChat.clHasMore&&t.push(FastChat.getCorrespondents(s,n,!1===r)):t.push('<div class="fc_clist_empty">'+(0,E.getLang)(s?"mail_im_clist_notfound":"mail_im_clist_empty")+"</div>"),curFastChat.clOffset=r,e){for(var c=(0,h.ce)("div",{innerHTML:t.join("")}),l=document.createDocumentFragment();c.firstChild;)l.appendChild(c.firstChild);curFastChat.el.clist.appendChild(l),curFastChat.clHasMore||FastChat.clistUpdateTitle(!0)}else(0,h.val)(curFastChat.el.clist,t.join("")),FastChat.clistUpdateTitle(!0),(o.browser.chrome||o.browser.safari)&&setTimeout((function(){(0,h.setStyle)(curFastChat.el.clist.firstChild,{width:curFastChat.el.clist.firstChild.clientWidth}),setTimeout((function(){(0,h.setStyle)(curFastChat.el.clist.firstChild,{width:""})}),0)}),0);if(curFastChat.clSel){var d=(0,h.ge)("fc_contact"+curFastChat.clSel);d?FastChat.clistPeerOver(d,1):curFastChat.clSel=!1}else{var u=(0,h.geByClass1)("fc_contact",curFastChat.el.clist);FastChat.clistPeerOver(u,1)}curFastChat.clistBoxScroll&&curFastChat.clistBoxScroll.update()},clistWrapPeer:function(e,t,i){var _,o,a=curFastChat.tabs[e]?curFastChat.tabs[e].unread:0,r=curFastChat.onlines[e],s=(0,n.onlinePlatformClass)(r),c=(t[0]||"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");return i&&(c=c.replace(i,'$1<em class="fc_clist_hl">$2</em>')),e>0&&e<2e9?(_="/id"+e,o='onmousemove="FastChat.clistPeerOver(this.parentNode, 2);"  onmouseout="FastChat.clistPeerOver(this.parentNode, 1);"'):(_="/im?sel="+e,o=""),'<a href="'+_+'" class="fc_contact clear_fix" id="fc_contact'+e+'" onclick="return FastChat.selectPeer('+e+', event, { entrypoint: \'fastchat_search\' });" onmousedown="event.cancelBubble = true;" onmouseover="FastChat.clistPeerOver(this, 1, event);"  onmouseout="FastChat.clistPeerOver(this, 0, event);"><span class="fc_contact_photo'+s+'" '+o+">"+(e>2e9&&t[3]?t[3]:'<img src="'+Notifier.fixPhoto(t[1])+'" class="fc_contact_photo"/>')+'</span><span class="fc_contact_status"></span><span class="fc_contact_name">'+c+'<span id="fc_contact_unread'+e+'" class="fc_contact_unread">'+(a?" <b>+"+a+"</b>":"")+"</span></span></a>"},clistPeerOver:function(e,t,i){if(e&&(0,u.checkOver)(i,e)){var _=e.id.substr(10);curFastChat.clSel&&t&&curFastChat.clSel!=_&&FastChat.clistPeerOver((0,h.ge)("fc_contact"+curFastChat.clSel),0),(0,h.toggleClass)(e,"fc_contact_over",t),t?curFastChat.clSel=_:curFastChat.clSel==_&&(curFastChat.clSel=!1)}},authorOver:function(e){var t=(0,h.gpeByClass)("fc_tab_log",e),i=e.getBoundingClientRect().top,_=t.getBoundingClientRect().top,o=e.getAttribute("data-title"),a=!1;if(i-_<10&&(a=!0),o){var r=e.getAttribute("data-date");r&&(o+="<br>"+r);var n=(0,h.gpeByClass)("rb_box_wrap",e).querySelector(".tt-fastchat-wrap");(0,b.showTooltip)(e,{text:'<div class="fc_author_tt">'+o+"</div>",black:1,center:1,forcetodown:a,appendEl:n,shift:[1,8,0]})}},getCorrespondents:function(e,t,i){return clearTimeout(curFastChat.correspondentsTO),curFastChat.correspondents&&void 0!==curFastChat.correspondents[e]?FastChat.wrapCorrespondents(curFastChat.correspondents[e])||i&&'<div class="fc_clist_empty">'+(0,E.getLang)("mail_im_clist_notfound")+"</div>"||"":(curFastChat.correspondentsTO=setTimeout(FastChat.loadCorrespondents.pbind(e,t),100),'<div id="fc_correspondents"></div>')},loadCorrespondents:function(e,t){e==curFastChat.q&&ajax.post("hints.php",{act:"a_json_friends",str:e,from:"fc",allow_multi:1},{onDone:function(i){curFastChat.correspondents||(curFastChat.correspondents={});var _,o={};if((0,p.each)(i,(function(){_=this[3]+"_",curFastChat.friends[_]||(o[_]=[this[1],this[2],this[3],this[4]||""])})),curFastChat.correspondents[e]=o,e==curFastChat.q){var a=(0,h.ge)("fc_correspondents");if(a){var r=a.parentNode,n=(0,h.ce)("div",{innerHTML:FastChat.wrapCorrespondents(o,t)}),s=document.createDocumentFragment();if(n.firstChild)for(;n.firstChild;)s.appendChild(n.firstChild);else r.firstChild==a&&s.appendChild((0,h.ce)("div",{className:"fc_clist_empty",innerHTML:(0,E.getLang)("mail_im_clist_notfound")}));r.replaceChild(s,a),FastChat.clistUpdateTitle(!0),curFastChat.clistBoxScroll&&curFastChat.clistBoxScroll.update()}}}})},wrapCorrespondents:function(e,t){var i=[];return(0,p.each)(e,(function(e){i.push(FastChat.clistWrapPeer((0,p.intval)(e),this,t))})),i.join("")},updateFriends:function(e){if(window.Chat&&Chat.inited){var t=Chat.onl;t&&(e>0?((0,h.val)(t,e),(0,h.show)(Chat.wrap)):(0,h.hide)(Chat.wrap))}},onDocClick:function(e){if(curFastChat.activeBox){var t=e.target;if((0,d.curBox)())return!0;for(;t;){if("fc_tab_wrap"==t.className||-1!==["chat_onl_wrap","custom_menu_cont","layer_wrap","box_layer_wrap","wk_layer_wrap"].indexOf(t.id))return!0;t=t.parentNode}var i=curFastChat.tabs[curFastChat.activeBox.options.peer];if(i&&((0,p.trim)(Emoji.editableVal(i.txt))||i.imMedia&&i.imMedia.getMedias().length))return!0;curFastChat.activeBox.hide()}},clistCache:function(e){if(e){var t,i,_,o,a,r,n=[e];if((i=(0,E.parseLatin)(e))&&n.push(i),(i=(0,E.parseLatKeys)(e))&&n.push(i),(i=(0,E.parseCyr)(e))&&n.push(i),void 0!==curFastChat.clistCache[e])return n;for(var s in r=curFastChat.clistCache[e]={},n)if(n.hasOwnProperty(s)&&(t=n[s],_=curFastChat.clistCache[" "+t.charAt(0).toLowerCase()]))for(var c in o=new RegExp("(^|\\s|\\()"+(0,p.escapeRE)(t),"gi"),_)if(_.hasOwnProperty(c)){if(a=curFastChat.friends[c+"_"],!(0,C.isArray)(a))continue;null!==a[0].match(o)&&(r[c]=1)}return r._num=Object.keys(r).length,n}var l,d,u;for(var f in curFastChat.clistCache={},curFastChat.friends)if(curFastChat.friends.hasOwnProperty(f))for(l=curFastChat.friends[f][0],f=(0,p.intval)(f),d=0;u=" "+l.charAt(d).toLowerCase(),curFastChat.clistCache[u]||(curFastChat.clistCache[u]={}),curFastChat.clistCache[u][f]=1,-1!==(d=l.indexOf(" ",d+1));)++d},clistShowMore:function(){if(curFastChat.clHasMore){var e=curFastChat.el.clist;e.scrollTop+3*e.clientHeight>e.scrollHeight&&FastChat.clistRender(!0)}},clistUpdateTitle:function(e){var t=0,i=0;for(var _ in curFastChat.friends)curFastChat.onlines[(0,p.intval)(_)]?(i++,t++):curFastChat.clOnlines||t++;var o=window.newVal=(i?(0,E.getLang)("mail_im_X_onlines_title",i):(0,E.getLang)("mail_im_onlines_title")).toString();FastChat.updateFriends(i),(0,h.val)(curFastChat.el.clistTitle,o),(0,h.val)(curFastChat.el.topLink,o.toLowerCase()),curFastChat.clistBoxScroll&&(!curFastChat.clHasMore&&e?t=curFastChat.el.clist.childNodes.length:curFastChat.q&&(t=(0,p.intval)((curFastChat.clistCache[curFastChat.q]||{})._num)),curFastChat.clistBoxScroll.options.contHeight=50*t)},clistToggleOnlines:function(e){void 0===e&&(e=!curFastChat.clOnlines,FastChat.stateChange({op:"onlines_toggled",val:e?1:0})),(0,h.toggleClass)(curFastChat.el.clistOnline,"fc_clist_online_active",e),curFastChat.clOnlines=e},clistFilterKey:function(e){var t;switch(e.keyCode){case u.KEY.DOWN:case u.KEY.UP:if("keyup"!==e.type){var i;if(t=curFastChat.clSel&&(0,h.ge)("fc_contact"+curFastChat.clSel)){var _=e.keyCode===u.KEY.DOWN?"nextSibling":"previousSibling";i=t;do{i=i[_]}while(i&&(1!==i.nodeType||!(0,h.hasClass)(i,"fc_contact")))}else curFastChat.clSel||e.keyCode!==u.KEY.DOWN||(i=(0,h.geByClass1)("fc_contact",curFastChat.el.clist,"a"));if(i&&i!==t){FastChat.clistPeerOver(i,1);var a=curFastChat.el.clist;i.offsetTop+16>a.clientHeight+a.scrollTop?(a.scrollTop=i.offsetTop+16-a.clientHeight,curFastChat.clistBoxScroll.update()):i.offsetTop-36<a.scrollTop&&(a.scrollTop=i.offsetTop-36,curFastChat.clistBoxScroll.update())}}break;case u.KEY.LEFT:case u.KEY.RIGHT:return!0;case u.KEY.ENTER:if("keyup"==e.type||!(t=curFastChat.clSel&&(0,h.ge)("fc_contact"+curFastChat.clSel)))break;if(e.ctrlKey||e.metaKey&&o.browser.mac){var r=(0,m.getHostName)().replace(".","\\.");nav.go(t.href.match(new RegExp(`\\b(vkontakte\\.ru|${r})(\\/[^\\/]+?)$`))[2])}else FastChat.selectPeer(curFastChat.clSel);case u.KEY.ESC:if("keyup"!=e.type){var n=(0,h.ge)("fc_clist_filter"),s=(0,h.val)(n)||curFastChat.clSel;n.blur(),(0,h.val)(n,curFastChat.q=""),curFastChat.clSel=!1,s&&FastChat.clistRender()}break;default:return}return(0,u.cancelEvent)(e)},prepareTabIcon:function(e,t,i){var _=curFastChat.friends&&curFastChat.friends[e+"_"];if(_){var o=x(_,e);FastChat.addTabIcon(e,o,i)}else{curFastChat.needPeers[e]=[3,!1,setTimeout(FastChat.getPeers,(0,C.irand)(150,200)),t]}},addTabIcon:function(e,t,i){if(Chat.itemsCont&&!Chat.tabs[e]){var _=e>2e9,o=_?t.data.members_grid_fc||"":`<img class="chat_tab_img" src="${t.photo}"/>`,a=_?"im?sel=c"+(e-2e9):t.alink||"/id"+e,r=(0,n.onlinePlatformClass)(t.online),s=(0,h.se)('<a class="chat_tab_wrap'+(i?"":" chat_tab_beforeanim")+'" id="chat_tab_icon_'+e+'" href="'+a+'" onclick="FastChat.itemsOut();return FastChat.togglePeer('+e+', event);"><div class="chat_tab_imgcont _chat_tab_image'+r+'"><div class="chat_tab_close" onclick="return FastChat.closeTabIcon('+e+', event)"></div>'+o+'</div><div class="chat_tab_typing_wrap"><div class="chats_sp chat_tab_typing_icon"></div></div><div class="chat_tab_counter"></div></a>');Chat.itemsCont.insertBefore(s,Chat.itemsCont.firstChild),Chat.tabs[e]={el:s,name:t.name},(0,h.addClass)(Chat.wrap,"chat_expand"),i||(0,h.removeClass)(s,"chat_tab_beforeanim"),FastChat.checkChatHeight(),Chat.scrollNode.scrollTop=0}},checkChatHeight:function(){var e=(0,h.getSize)(Chat.itemsCont)[1];function t(){(0,u.addEvent)(Chat.scrollNode,o.browserFeatures.wheelEvent,FastChat.scrollWrap)}function i(){(0,u.removeEvent)(Chat.scrollNode,o.browserFeatures.wheelEvent,FastChat.scrollWrap)}Chat.lastHeight=e,e>Chat.maxHeight?(Chat.fixH||(Chat.fixH=!0,(0,h.addClass)(Chat.scrollNode,"chat_fix_height"),(0,h.setStyle)(Chat.scrollNode,{height:Chat.maxHeight}),(0,u.addEvent)(Chat.scrollNode,"mouseenter",t),(0,u.addEvent)(Chat.scrollNode,"mouseleave",i),FastChat.checkShadow()),Chat.scrollNode.scrollTop=e-Chat.maxHeight):Chat.fixH&&(Chat.fixH=!1,(0,h.removeClass)(Chat.scrollNode,"chat_fix_height"),(0,h.setStyle)(Chat.scrollNode,{height:"auto"}),(0,u.removeEvent)(Chat.scrollNode,o.browserFeatures.wheelEvent,FastChat.scrollWrap),(0,u.removeEvent)(Chat.scrollNode,"mouseenter",t),(0,u.removeEvent)(Chat.scrollNode,"mouseleave",i),FastChat.checkShadow())},checkShadow:function(){var e=(0,p.intval)(Chat.scrollNode.scrollTop);e&&Chat.fixH?Chat.shadowTop||((0,h.addClass)(Chat.wrap,"chat_scroll_top"),(0,f.fadeIn)((0,h.geByClass1)("chat_cont_sh_top",Chat.wrap),200),Chat.shadowTop=!0):Chat.shadowTop&&((0,f.fadeOut)((0,h.geByClass1)("chat_cont_sh_top",Chat.wrap),200),Chat.shadowTop=!1),Chat.lastHeight-e>Chat.maxHeight&&Chat.fixH?Chat.shadowBottom||((0,f.fadeIn)((0,h.geByClass1)("chat_cont_sh_bottom",Chat.wrap),200),Chat.shadowBottom=!0):Chat.shadowBottom&&((0,f.fadeOut)((0,h.geByClass1)("chat_cont_sh_bottom",Chat.wrap),200),Chat.shadowBottom=!1)},scrollWrap:function(e){e||(e=window.event);var t=0;return e.wheelDeltaY||e.wheelDelta?t=(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&(t=10*-e.detail),Chat.scrollNode.scrollTop-=t,curFastChat.activeBox==curFastChat.clistBox?(curFastChat.pointerMargin=0,FastChat.setPointer(!1,curFastChat.pointerMargin,curFastChat.prevPointer)):(curFastChat.pointerMargin=-Chat.scrollNode.scrollTop,FastChat.setPointer(!0,curFastChat.pointerMargin,curFastChat.prevPointer)),FastChat.checkShadow(),(0,h.setStyle)(Chat.ttNode,{top:-Chat.scrollNode.scrollTop}),(0,u.cancelEvent)(e)},togglePeer:function(e,t){return curFastChat.activeBox&&curFastChat.activeBox.options.peer==e?(curFastChat.activeBox.hide(),FastChat.setActive(!1),!1):FastChat.selectPeer(e,t,{entrypoint:"fastchat_icon"})},selectPeer:function(e,t,i){if((0,u.checkEvent)(t))return!0;var _=(0,h.hasClass)(Chat.wrap,"chat_active");if(curFastChat.tabs&&curFastChat.tabs[e]){var o=curFastChat.tabs[e].box;o.minimized&&o.unminimize(!0),FastChat.activateTab(e),FastChat.movePointer(e,_)}else i||(i={}),i.fixed=!0,i.onPeerAdded=function(){FastChat.movePointer(e,_)},i.onHistoryLoaded=FastChat.readLastMessages.pbind(e),FastChat.addPeer(e,!1,!0,i);return curFastChat.tabs[e]&&curFastChat.tabs[e].iman&&(curFastChat.tabs[e].entrypoint=i&&i.entrypoint,curFastChat.tabs[e].iman.unidle()),FastChat.trackActivity("open"),!1},closeTabIcon:function(e,t,i){curFastChat.activeBox&&curFastChat.activeBox.options.peer==e&&!i&&(curFastChat.activeBox.hide(),FastChat.setActive(!1));var _=(0,h.ge)("chat_tab_icon_"+e);(0,h.addClass)(_,"chat_tab_hiding"),delete Chat.tabs[e],curFastChat.tabs[e]&&curFastChat.tabs[e].box.options.fixed&&(curFastChat.tabs[e].iman.stop(),delete curFastChat.tabs[e]);return(0,f.animate)(_,{height:0,opacity:0},{duration:100,onComplete:function(){(0,h.re)(_),_&&(_=!1,curFastChat.activeBox&&FastChat.movePointer(curFastChat.activeBox.options.peer,!0));var e=Chat.scrollNode.scrollTop;FastChat.checkChatHeight(),Chat.scrollNode.scrollTop=e}}),i||FastChat.stateChange({op:"closed",peer:e}),Object.keys(Chat.tabs).length||(0,h.removeClass)(Chat.wrap,"chat_expand"),FastChat.itemsOut(),(0,u.cancelEvent)(t)},getPointerShift:function(e,t,i){var _=i-t,o=Chat.maxHeight+32;return e&&_<62?_-62:e&&_>o?_-o:0},setPointer:function(e,t,i){if(!curFastChat.activeBox)return!1;var _=FastChat.getPointerShift(e,t,i),o=(0,h.geByClass1)("fc_tab_pointer",curFastChat.activeBox.wrap);return(0,h.setStyle)(o,{marginTop:t+_}),_},movePointer:function(e,t){if(!curFastChat.activeBox)return!1;var i,_,o=(0,h.geByClass1)("fc_pointer_offset",curFastChat.activeBox.wrap);if(e){var a,r=(0,h.ge)("chat_tab_icon_"+e);if(!r)return!1;a=!Chat.fixH&&r.nextSibling?(0,h.getXY)(r.nextSibling)[1]-50:r.nextSibling||Chat.fixH?(0,h.getXY)(r)[1]+Chat.scrollNode.scrollTop:(0,h.getXY)((0,h.ge)("chat_tab_wrap"))[1]-50,i=23+(0,h.getXY)(Chat.cont)[1]-a,_=-Chat.scrollNode.scrollTop}else i=28,_=0;var n=FastChat.setPointer(e,_,i);if(t){if(curFastChat.prevPointer){var s=FastChat.getPointerShift(!0,_+n,curFastChat.prevPointer);(0,h.setStyle)(o,{bottom:curFastChat.prevPointer-s+n})}(0,f.animate)(o,{bottom:i},{duration:100})}else(0,h.setStyle)(o,{bottom:i});curFastChat.prevPointer=i},setActive:function(e){curFastChat.activeBox=e,e&&FastChat.moveBoxesLeft(e.pos[1])},moveBoxesLeft:function(e,t){e-=8;var i=!1,_=0;for(var o in curFastChat.tabs)if(curFastChat.tabs.hasOwnProperty(o)){var a=curFastChat.tabs[o];if(t||(a.box.movedLeft=!1),!a||a.box.options.fixed||!a.box.toBottom||a.box.movedLeft||a.box.noMove)continue;var r=a.box.pos;r[1]+r[3]>=e&&r[1]>_&&(i=a,_=r[1])}if(i){var n=e-i.box.pos[3],s=i.box.pos[0];n<0&&(n=0),i.box.movedLeft=!0,(0,f.animate)(i.box.wrap,{left:n},200),i.box.pos=[s,n,i.box.pos[2],i.box.pos[3]];var c=getWndInner();FastChat.stateChange({op:"moved",peer:i.box.options.peer,y:s/c[0],x:n/c[1]}),n&&FastChat.moveBoxesLeft(n,!0)}else FastChat.moveLeftY=0},moveBoxAway:function(e,t){for(var i=e.pos[3],_=t-e.pos[3]-20,o=e.pos[0],a=!1;_>0&&!a;)for(var r in a=!0,curFastChat.tabs)if(curFastChat.tabs.hasOwnProperty(r)){var n=curFastChat.tabs[r].box.pos;n[0]+n[2]/2>o&&n[1]+n[3]>_&&n[1]<_+i&&(_-=n[3],a=!1)}_<0&&(_=(0,C.positive)(Math.random()*t)),(0,f.animate)(e.wrap,{left:_},300);var s=getWndInner();FastChat.stateChange({op:"moved",peer:e.options.peer,y:o/s[0],x:_/s[1]})},pinTab:function(e,t,i){var _=-1==e?curFastChat.clistBox:curFastChat.tabs[e].box;_.options.fixed=!1,(0,h.removeClass)(_.wrap,"fc_fixed"),FastChat.hideChatCtrl(),FastChat.setActive(!1);var o=_.wrap.offsetTop,a=_.wrap.offsetLeft-10;(0,h.setStyle)(_.wrap,{left:_.wrap.offsetLeft,top:_.wrap.offsetTop,right:"auto",bottom:"auto"}),i||(0,f.animate)(_.wrap,{left:a,top:o},300),_.pos=[o,a,_.pos[2],_.pos[3]],_.toRight=!1,_.toBottom=!0,(0,h.addClass)(_.wrap,"fc_tobottom");var r=_.resizeableW.clientWidth-(0,p.intval)((0,h.getStyle)(_.resizeableW,"paddingRight"))-(0,p.intval)((0,h.getStyle)(_.resizeableW,"paddingLeft")),n=_.resizeableH.clientHeight-(0,p.intval)((0,h.getStyle)(_.resizeableH,"paddingBottom"))-(0,p.intval)((0,h.getStyle)(_.resizeableH,"paddingTop")),s=getWndInner();-1==e?FastChat.stateChange({op:"clist_toggled",val:1,y:_.toBottom?-1:_.pos[0]/s[0],x:_.toRight?-1:_.pos[1]/s[1]}):FastChat.stateChange({op:"unfixed",peer:e,y:_.toBottom?-1:_.pos[0]/s[0],x:_.toRight?-1:_.pos[1]/s[1],h:n/s[0],w:r/s[1]}),_.noMove=!0,FastChat.moveBoxesLeft(a),_.noMove=!1},addPeer:function(e,t,i,_){_||(_={});var o=curFastChat.friends&&curFastChat.friends[e+"_"],a=0;if(i?FastChat.stateChange({op:"added",peer:e,fixed:_.fixed}):curNotifier.idle_manager&&!curNotifier.idle_manager.is_idle&&t&&(i=!0),o){var r=x(o,e);FastChat.addTabIcon(e,r,_.noAnim),FastChat.addBox(e,r,_),t?(curFastChat.tabs[e].auto=1,FastChat.imFeed(e,t)):(_&&_.nofocus||FastChat.activateTab(e),curFastChat.onlines[e]||FastChat.tabNotify(e,"unavail"),a|=2)}else a=3;a&&(i?(curFastChat.needPeers[e]=[a,t,!1,_],FastChat.getPeers()):(curFastChat.needPeers[e]=[a,t,setTimeout(FastChat.getPeers,(0,C.irand)(150,200)),_],FastChat.lcSend("needPeer",{id:e,mask:a})))},getPeers(){var e=[],t={};Object.keys(curFastChat.needPeers||{}).forEach((i=>{var _=R(curFastChat.needPeers[i],3),o=_[0],a=_[2];e.push(i,o),a&&clearTimeout(a),t[i]=o})),e.length&&(FastChat.lcSend("fetchingPeers",t),FastChat.loadPeers(e.join(","),(function(e){FastChat.gotPeers(e),FastChat.lcSend("gotPeers",e)})))},gotPeers:function(e){K()||(0,p.each)(curFastChat.needPeers,(function(t){if(e[t]){e[t]<2e9&&(curFastChat.friends[t+"_"]=[e[t].name,e[t].photo,e[t].fname,e[t].hash,(0,p.intval)(e[t].sex)]);var i=this[1],_=this[3];2&this[0]&&void 0===e[t].history||(clearTimeout(this[2]),delete curFastChat.needPeers[t]),curFastChat.tabs[t]?FastChat.gotHistory(t,e[t].history):_.fixedLoad?FastChat.addTabIcon(t,e[t]):(FastChat.addTabIcon(t,e[t]),FastChat.addBox(t,e[t],_),i?(curFastChat.tabs[t].auto=1,FastChat.imFeed(t,i)):(2&this[0]&&FastChat.gotHistory(t,e[t].history),_&&_.nofocus||FastChat.activateTab(t))),_.onHistoryLoaded&&_.onHistoryLoaded()}}))},gotHistory:function(e,t){if((0,C.isArray)(t)&&t.length&&t[0]){var i=curFastChat.tabs[e],_=t[0],o=t[1];i.offset=t[2],(0,p.extend)(i.msgs,o),(0,p.each)(o,(function(e,t){!t[0]&&t[1]&&i.unread++})),(0,h.val)(i.log,_),i.logWrap.scrollTop=i.logWrap.scrollHeight,setTimeout((function(){i.logWrap.scrollTop=i.logWrap.scrollHeight,i.scroll&&i.scroll.update(!1,!0)}),10)}},decHashCb:function(e){var t;t=e,curFastChat.decodedHashes[t]=function(e){for(var t=h.ge?"":"___",i=0;i<e.length;++i)t+=e.charAt(e.length-i-1);return h.geByClass?t:"___"}(t.substr(t.length-5)+t.substr(4,t.length-12))},decodehash:function(e){return curFastChat.decodedHashes||(curFastChat.decodedHashes={}),curFastChat.decodedHashes[e]||FastChat.decHashCb(e),curFastChat.decodedHashes[e]},loadPeers(e,t){ajax.post("al_im.php",{act:"a_get_fc_peers",peers:e},{onDone:t})},sendTyping:function(e){var t=(0,p.intval)(e),i=this.getTab(t),_=Date.now();t<=-2e9||!i||curFastChat.myTypingEvents[t]&&_-curFastChat.myTypingEvents[t]<5e3||(curFastChat.myTypingEvents[t]=_,ajax.post("al_im.php",{act:"a_activity",type:"typing",peer:t,hash:i.sendhash,from:"fc"}))},setTyping(e){var t=this.getTab(e.peerId),i=e.type===M.ADD_MESSAGE;if(t&&t.typing&&i){var _=t.typing.userIds.filter(((t,i)=>t!==e.userId));0===_.length?delete t.typing:t.typing=Object.assign(t.typing,{userIds:_})}else t&&!i&&(e.ts=Date.now()/1e3,t.typing=Object.assign(e,{userIds:(e.userIds||[]).filter(((e,t)=>e!==vk.id))}))},waitTyping(e){return(0,O.pause)(y.ACTIVITY_PERIOD+2).then((()=>{var t=this.getTab(e.peerId);t&&t.typing&&(Date.now()-1e3*t.typing.ts>=1e3*y.ACTIVITY_PERIOD&&delete t.typing)}))},updateTypings(){var e=curFastChat.tabs||{};Object.keys(e).forEach((e=>{FastChat.updateTyping(e)}))},updateTyping(e,t){var i=this.getTab(e),_=(0,h.ge)("fc_tab_typing"+e),o=(0,h.geByClass1)("_fc_tab_typing_progress",_),a=(0,h.geByClass1)("_fc_tab_typing_name",_);if(i.typing&&i.typing.userIds.length>0){var r=this.formatTyping(i.typing);(0,h.val)(a,r),(0,h.show)(o)}else(0,h.val)(a,""),(0,h.hide)(o);t?(0,h.setStyle)(_,"opacity",1):(0,f.fadeTo)(_,200,1)},formatTyping(e){var t=e.peerId,i=e.userIds,_=this.getTab(t),o=i[0],a=(0,k.isChatPeer)(t)?_.data.members[o]:_,r=e=>e.fname||e.name||"";if(1===i.length||!(0,k.isChatPeer)(t))return(0,E.langSex)(a.sex,(0,E.getLang)("mail_im_typing")).replace("{user}",r(a));var n=i[i.length-1],s=(0,k.isChatPeer)(t)?_.data.members[n]:_;return(0,E.getLang)("mail_im_multi_typing").replace("{users}",r(a)).replace("{last_user}",r(s))},markMessagesAsRead(e){var t=e.type,i=e.peerId,_=e.upToId,o=e.unread,a=this.getTab(i);a&&(t===M.READ_INBOUND&&(a.inUpTo=_),t===M.READ_OUTBOUND&&(a.outUpTo=_),a.unread=o,this.updateUnreadMessagesInTab(i,_,t===M.READ_OUTBOUND)),this.updateTabUnreadCounterElement(a||{unread:0},i)},updateUnreadMessagesInTab(e,t,i){var _=this.getTab(e),o=i?".fc_msgs_unread.fc_msgs_out":".fc_msgs_unread:not(.fc_msgs_out)";if(_&&_.log){var a=_.log.querySelectorAll(o);Array.prototype.forEach.call(a,(e=>{+e.getAttribute("data-message-id")<=t&&e.classList.remove(U)}))}},readLastMessages(e){var t=FastChat.getTab(e);if(e&&t){if(!t.markingRead&&t.unread){var i=[];for(var _ in t.msgs)!t.msgs[_][0]&&t.msgs[_][1]&&i.push(_);i.length>0&&FastChat.markRead(e,i)}t.unread=0,FastChat.updateTabUnreadCounterElement(t,e)}},markRead:function(e,t){var i=this.getTab(e);i.markingRead=!0,ajax.post("al_im.php",{act:"a_mark_read",peer:e,ids:t,hash:i.sendhash,from:"fc"},{onDone:function(_){for(var o in i.markingRead=!1,t){if(t.hasOwnProperty(o))if("continue"===function(){var e=t[o],_=(0,h.ge)("fc_msg"+e),a=_&&_.parentNode;if(!_)return"continue";i.msgs[e]&&i.msgs[e][1]&&(i.msgs[e][1]=0,i.msgs[e][0]||i.unread--),(0,h.removeClass)(_,"fc_msg_unread"),(0,h.hasClass)(a.parentNode,"fc_msgs_unread")&&(0,p.each)(a.childNodes,(function(){if(!(0,h.hasClass)(this,"fc_msg_unread"))return(0,h.removeClass)(a.parentNode,"fc_msgs_unread"),!1}))}())continue}i.unread=0,FastChat.updateTabUnreadCounterElement(i,e)},onFail:function(){i.markingRead=!1}})},getMessageText(e,t){var i=e||"",_=Math.round(1e9*Math.random()).toString(16),o={},a=0;return i=(i=(0,w.replaceHyperLinks)(i,w.linksReplacer.bind(null,!1))).replace(/(<a.+?<\/a>)/gi,(e=>{var t=`!link_${a}_${_}!`;return o[t]=e,a++,t})),i=(0,w.replaceMentions)(i),i=(0,w.replaceEmailLinks)(i),i=(0,w.replaceHashtags)(i,(e=>`<a href="/im?sel=${t}&st=${encodeURIComponent(e)}">${e}</a>`)),Object.keys(o).forEach((e=>{i=i.replace(e,o[e])})),i=Emoji.emojiToHTML(i,1)},getEditCont:function(e){return window.stManager.add([window.jsc("web/emoji.js")]),'<div class="emoji_cont _emoji_field_wrap">'+Emoji.tplSmile((0,E.getLang)("mail_emoji_hint"))+'<div class="fc_editable dark" tabindex="0" contenteditable="true" placeholder="'+(0,E.getLang)("mail_chat_placeholder")+'"></div></div>'},getInputValue:function(e){return Emoji?Emoji.editableVal(e):""},onTxtResize:function(e){var t=curFastChat.tabs[e],i=(0,h.geByClass1)("fc_tab_txt",t.wrap),_=(0,h.getSize)(i)[1];if(_>40){var o=(0,C.positive)(_-40),a=(0,p.intval)((0,h.getSize)(t.box.resizeableH)[1]);a+t.hDiff-o<40&&(o=a+t.hDiff-40),(0,h.setStyle)(t.box.resizeableH,{height:a+(t.hDiff||0)-o}),t.hDiff=o,FastChat.fixResized(t,t.wrap.clientWidth,!0)}else if(t.hDiff){var r=(0,p.intval)((0,h.getSize)(t.box.resizeableH)[1]);(0,h.setStyle)(t.box.resizeableH,{height:r+t.hDiff}),t.hDiff=0,FastChat.fixResized(t,t.wrap.clientWidth,!0)}},initTab:function(e,t,i){var _=(0,h.geByClass1)("fc_editable",i),o=curFastChat.tabs[e]={name:t.name,fname:t.fname,photo:t.photo,link:t.alink||"/id"+e,hash:t.hash,sendhash:FastChat.decodehash(t.hash),sex:t.sex||0,data:t.data||{},online:t.online,msgs:{},msgscount:0,unread:0,box:!1,wrap:i,editable:1,txt:_,txtWrap:_.parentNode.parentNode,logWrap:(0,h.geByClass1)("fc_tab_log",i),log:(0,h.geByClass1)("fc_tab_log_msgs",i),notify:(0,h.geByClass1)("fc_tab_notify_wrap",i),title:(0,h.geByClass1)("fc_tab_title",i)},a=30;if(o.addMediaBtn=(0,h.geByClass1)("fc_tab_attach",i),o.editable)cur.t=o,o.emojiId=Emoji.init(o.txt,{controlsCont:(0,h.geByClass1)("fc_tab_txt_wrap",i),ttDiff:-46,ttShift:0,rPointer:!0,global:!0,noRce:!0,peer:e,isChat:!0,noCtrlSend:!0,ref:"fast_chat",onSend:FastChat.send.pbind(e),checkEditable:FastChat.checkEditable,onResize:function(){FastChat.onTxtResize(e)},addMediaBtn:o.addMediaBtn,onShow:function(){(0,l.cssAnim)(o.scroll.scrollbar,{opacity:0},{duration:400})},onHide:function(){(0,l.cssAnim)(o.scroll.scrollbar,{opacity:1},{duration:400})},onEsc:function(e){return o.box.hide(),(0,u.cancelEvent)(e)},onStickerSend:function(t,i){FastChat.send(e,t,i)}});else{(0,c.autosizeSetup)(o.txt,{minHeight:15,maxHeight:42}),o.txt.autosize.options.onResize=function(e){if(!o.box.minimized){var t=42==e?42:15;t!=e&&(0,h.setStyle)(o.txt,"height",t),t!=a&&((0,h.setStyle)(o.logWrap,"height",o.logWrap.clientHeight-t+a),a=t,o.scroll&&o.scroll.update(!1,!0))}}}return o.imPeerMedias={},o.imSortedMedias={},o.previewEl=(0,h.geByClass1)("fc_tab_preview",i),window.stManager.add(["page.js","page.css",window.jsc("web/ui_media_selector.js"),"ui_media_selector.css"],(function(){var t=[["photo",(0,E.getLang)("profile_wall_photo")],["video",(0,E.getLang)("profile_wall_video")],["audio",(0,E.getLang)("profile_wall_audio")],["doc",(0,E.getLang)("profile_wall_doc")],["map",(0,E.getLang)("profile_wall_map")]];o.imMedia=new window.MediaSelector(o.addMediaBtn,o.previewEl,t,{limit:10,hideAfterCount:0,maxShown:0,mail:1,tooltip:1,topOffset:0,forceUp:1,global:1,toId:vk.id,from:"message"}),o.imMedia.onChange=setTimeout.pbind((function(){if(curFastChat.sendOnUpload)FastChat.send(curFastChat.sendOnUpload),curFastChat.sendOnUpload=void 0;else{var t=(0,v.loadDraftForPeer)(curFastChat.ldb,e);t.removeAllAttaches(),o.imMedia.getMedias().forEach((e=>t.addAttach(e[0],e[1]))),t.destroy()}FastChat.onTxtResize(e)}),0)})),o},addBox:function(e,t,i){if(void 0===curFastChat.tabs[e]){var a=FastChat.getEditCont(Emoji.last);i=i||{},curFastChat.tabs[e]={};var r=(0,h.se)((0,h.rs)(FastChat.tplBox,{id:e,name:t.name,myphoto:Notifier.fixPhoto(curFastChat.me.photo,!0),cont:a}));i.fixed&&curFastChat.activeBox&&curFastChat.activeBox.hide(0,!1,{noState:!0});var n=FastChat.initTab(e,t,r),s=getWndInner(),c={id:"fc_peer"+e,marginFixedToLayer:!0,peer:e,movable:(0,h.geByClass1)("fc_tab_head",r),closer:(0,h.geByClass1)("fc_tab_close_wrap",r,"a"),resizeableH:n.logWrap,startHeight:250,startWidth:270,fixed:i.fixed,minH:150,minW:270,nofocus:!0,onFocus:function(t){n.auto&&(FastChat.stateChange({op:"added",peer:e}),delete n.auto),FastChat.restoreDraft(e),n.editable?Emoji.editableFocus(n.txt,!1,!0):(0,h.elfocus)(n.txt),n.wrap.clientWidth&&(0,h.setStyle)(n.title,{maxWidth:n.wrap.clientWidth-71}),n.editable||(0,h.setStyle)(n.txt.autosize.helper,{width:(0,h.getStyle)(n.txt,"width",!1)}),n.scroll&&n.scroll.update(!1,!0),setTimeout(h.elfocus.pbind(n.txt),10)},onHide:function(){i.fixed&&FastChat.hideChatCtrl(),curFastChat.activeBox&&e==curFastChat.activeBox.options.peer&&FastChat.setActive(!1)},onClose:function(t){AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(),this.onHide(),i&&i.beforeClose&&i.beforeClose();var _=curFastChat.tabs,a=_[e].posSeq;if(delete _[e],curNotifier.isIdle||FastChat.stateChange({op:"hidden",peer:e}),a){var r,n,s,c,l,d={},u=[];for((0,p.each)(_,(function(){this.posSeq>a&&(d[this.posSeq]=this,u.push(this.posSeq))})),u.unshift(a),u.sort(),l=!o.browser.msie&&u.length<10,r=1;r<u.length;r++)n=u[r],s=d[n].box,c=r>1?d[u[r-1]].box.pos:t,l?(0,f.animate)(s.wrap,{left:c[1]},100,function(e){e._update_pos()}.pbind(s)):(0,h.setStyle)(s.wrap,{left:c[1]});if(!l)for(r=1;r<u.length;r++)(s=d[u[r]].box)._update_pos()}},onMinimize:function(t){FastChat.stateChange({op:"minimized",peer:e,val:t}),FastChat.fixResized(n,n.wrap.clientWidth,!0),t||(n.txt.blur(),FastChat.restoreDraft(e))},onResizeEnd:function(t,i){var _=getWndInner(),o=n.box.pos;n.scroll&&n.scroll.show(),FastChat.fixResized(n,i,!0),FastChat.stateChange({op:"resized",peer:e,h:t/_[0],w:i/_[1],y:n.box.toBottom?-1:o[0]/_[0],x:n.box.toRight?-1:o[1]/_[1]})},onResize:function(e,t){FastChat.fixResized(n,t);var i=(0,h.geByClass1)("fc_tab_title",n.box.content);(0,h.setStyle)(i,{width:t-78})},onResizeStart:function(){delete n.posSeq,n.scroll&&n.scroll.hide(),(0,h.val)(n.notify,""),clearTimeout(n.hideNotifyTO)},onDragEnd:function(t,i){delete n.posSeq,FastChat.stateChange({op:"moved",peer:e,y:t,x:i})}};if(i&&(0,p.extend)(c,i),void 0===c.startLeft&&void 0===c.startRight){var l=[],d=s[0]-350,b=curFastChat.clistBox.pos,E=!1;if(window.Call&&(Call.box||Call.invitation)){var C=Call.calcBoxPos();l.push([C.x,C.x+C.w]),E=!0}b[0]+b[2]>d&&(curFastChat.clistBox.visible||!E)&&l.push([b[1],b[1]+b[3]]),(0,p.each)(curFastChat.tabs,(function(t){(b=this.box&&this.box.pos)&&t!=e&&b[0]+b[2]>d&&l.push([b[1],b[1]+b[3]])}));var m,g,v,w=lastWindowWidth-262-(0,_.sbWidth)(),M=!1,P=!1,T=0>w?1:-1;for(m=w;T*m<0*T;m+=135*T){for(g=0,v=0;v<l.length;v++)m>l[v][0]-260&&m<l[v][1]&&g++,m>l[v][0]-10&&m<l[v][0]+10&&(g+=1.1);(!1===M||g<P)&&(M=m,P=g)}E&&P&&(M=w),(0,p.extend)(c,{startBottom:0,startLeft:M})}var O,D=!0;for(O in i||{})if("nofocus"!=O){D=!1;break}D&&(n.posSeq=++curFastChat.posSeq),c.fixed&&(c.startHeight=curFastChat.clistH,c.startWidth=curFastChat.clistW,c.onShow=FastChat.showChatCtrl),n.box=new window.RBox(r,c),n.iman=new B.default({id:"tab"+e,element:n.box.content,onUnIdleCb:function(){FastChat.readLastMessages(e)},parentManager:curNotifier.idle_manager,idleTimeout:1e4}),curFastChat.tabs[e].iman.start(),c.fixed&&FastChat.setActive(n.box),n.scroll=new Scrollbar(n.logWrap,{prefix:"fc_",nomargin:!0,nokeys:!0,global:!0,right:vk.rtl?"auto":1,left:vk.rtl?1:"auto",onScroll:FastChat.onScroll.pbind(n)}),c.minimized||!i||void 0===i.startLeft&&void 0===i.startTop&&void 0===i.startWidth&&void 0===i.startHeight||n.box._wnd_resize(s[0],s[1],!0),n.wrap.clientWidth&&(0,h.setStyle)(n.title,{maxWidth:n.wrap.clientWidth-71}),(0,u.addEvent)(n.txt,"keydown",this.onInputKeydown.bind(this,n)),(0,u.addEvent)(n.txt,"keyup",this.onInputKeyUp.bind(this,n,e)),(0,u.addEvent)(n.txt,"focus",this.onInputFocus.bind(this,e)),(0,u.addEvent)(n.log,"click",(t=>this.onLogClick(t,+e))),FastChat.restoreDraft(e),c.onPeerAdded&&c.onPeerAdded()}},onInputFocus(e){curFastChat.peer=e},onInputKeydown(e,t){if(t.ctrlKey&&t.keyCode===u.KEY.RETURN){var i=t.target,_=i.value;if("number"==typeof i.selectionStart&&"number"==typeof i.selectionEnd){var a=i.selectionStart;i.value=_.slice(0,a)+"\n"+_.slice(i.selectionEnd),i.selectionStart=i.selectionEnd=a+1}else if(document.selection&&document.selection.createRange){i.focus(t);var r=document.selection.createRange();r.text="\r\n",r.collapse(!1),o.browser.opera&&(r.moveEnd("character",0),r.moveStart("character",0)),r.select()}e.editable?this.checkEditable(e.emojiId,e.txt):(e.txt.autosize.update(),setTimeout((()=>e.txt.autosize.update()),0))}},onInputKeyUp(e,t){var i=e.lastValue||"",_=this.getInputValue(e.txt);_.length===i.length&&_===i||(_&&this.sendTyping(t),e.lastValue=_),clearTimeout(e.saveDraftTO),e.saveDraftTO=setTimeout(this.saveDraft.pbind(t),_.length?300:0),this.checkEditable(e.emojiId,e.txt)},onLogClick:function(e,t){if(e.target.classList.contains("_fc_call_link")){var i=this.getTab(t);if((0,k.isChatPeer)(t)){var _={peerId:t,name:i.name,tab:i.name,photo:i.photo};window.Calls.startGroupCall(t,[_],[],!1,L.CallStatSource.FAST_CHAT).then((()=>this.closeTab(t)))}else{var o={peerId:t,id:t,link:i.link,name:i.name,firstName:i.fname,lastName:i.name.split(" ")[1],sex:i.sex,photo:i.photo},a=N({},o,{canAddMembers:!0});window.Calls.call(t,!1,[a,[o]],L.CallStatSource.FAST_CHAT).then((()=>this.closeTab(t)))}}},onScroll:function(e){var t=e.scroll.obj.scrollTop,i=(0,h.geByClass1)("_fc_msgs_more",e.logWrap);t<200&&(0,h.isVisible)(i)&&i.click()},loadMore:function(e,t){var i=curFastChat.tabs[e],o=i.offset;if(i.moreLoading)return!1;i.moreLoading=!0,ajax.post("al_im.php",{act:"a_history",peer:e,offset:o,from:"fc"},{onDone:function(e){e[3]||(0,h.hide)(t);var _=t.parentNode,o=_.clientHeight;_.insertBefore((0,h.cf)(e[0]),t.nextSibling);var a=_.clientHeight-o;a&&(i.logWrap.scrollTop+=a),i.scroll.update(),i.offset=e[2],i.moreLoading=!1,FastChat.onScroll(i)},onFail:function(){i.moreLoading=!1},showProgress:_.lockButton.pbind(t),hideProgress:_.unlockButton.pbind(t)})},sendOnResponse:function(e,t,i){if(e.version&&(0,p.intval)(e.version)>curFastChat.version)FastChat.updateVersion(e.version);else{var _=(0,h.ge)("fc_msg"+t),o=e.msg_id,a=(0,p.indexOf)(t,i.newmsgs);if(_){if(e.media){var r={sticker:(0,p.intval)(e.sticker)};FastChat.lcSend("gotMedia",{msgId:t,peer:i.box.options.peer,text:e.media,msgOpts:r}),FastChat.gotMsgMedia(i.box.options.peer,t,e.media,r)}++i.msgscount,-1!=a&&i.newmsgs.splice(a,1),_.id="fc_msg"+o,i.msgs[o]=[1,1]}}},checkEditable:function(e,t){Emoji.checkEditable(e,t,{height:52})},fixResized:function(e,t,i){e&&(e.logWrap.scrollTop=e.logWrap.scrollHeight,t>0&&(0,h.setStyle)(e.title,{maxWidth:t-71}),i&&(e.editable||(0,h.setStyle)(e.txt.autosize.helper,{width:(0,h.getStyle)(e.txt,"width",!1)}),e.scroll&&e.scroll.update(!1,!0)))},activateTab:function(e){var t=curFastChat.tabs[e].box;curFastChat.activeBox&&curFastChat.activeBox!=t&&curFastChat.activeBox.hide(0,!1,{noState:!0}),t.show(),t.options.fixed&&FastChat.setActive(t)},blinkTab:function(e){var t=this.getTab(e);if(!t.blinking&&curFastChat.peer!=e){t.blinking=!0,clearTimeout(t.blinkingTO);var i=t.box.wrap,_=i.className,o=Math.min(W,(0,p.intval)((0,h.getStyle)(i,"zIndex")));(0,h.setStyle)(i,{zIndex:W}),(0,h.removeClass)(i,"rb_inactive"),t.blinkingTO=setTimeout((function(){delete t.blinking,delete t.blinkingTO,(0,h.getStyle)(i,"zIndex")==W&&((0,h.setStyle)(i,{zIndex:o}),i.className=_)}),2e3)}},createProgress:function(e,t,i){var _=(0,h.ce)("span",{innerHTML:(0,h.rs)(vk.pr_tpl,{id:"",cls:""}),className:"fc_msg_progress",id:"fc_msg_progress"+t});return e.insertBefore(_,i),_},removeProgress:function(e){(0,h.re)("fc_msg_progress"+e)},send:function(e,t,i){var _=curFastChat.tabs[e],o=(0,p.trim)(_.editable?Emoji.editableVal(_.txt):(0,h.val)(_.txt)),a="";t?(a=[["sticker",t]],o=""):a=_.imMedia?_.imMedia.getMedias():[];var r=(0,h.ge)("fc_tab_typing"+e),n=(0,h.geByClass1)("page_progress_preview",_.wrap);if(n&&n.childNodes.length>0){curFastChat.sendOnUpload=e;var s=(0,h.geByClass)("fc_tab_log",_.wrap)[0];return FastChat.createProgress(s,e,s.lastChild),void(r.style.visibility="hidden")}if(curFastChat.sendOnUpload=!1,FastChat.removeProgress(e),r.style.visibility="visible",o||a.length){var c=(0,P.random)(),l={act:"a_send",to:e,hash:_.sendhash,msg:o,from:"fc",entrypoint:curFastChat.tabs[e].entrypoint||"fastchat_old_default",media:[],random_id:c};i&&(l.sticker_referrer=i);for(var d,u=0,f=a.length;u<f;++u)(d=a[u])&&l.media.push(d[0]+":"+d[1]);l.media=l.media.join(","),_.sending=!0,Emoji.ttHide(_.emojiId),curFastChat.tabs[e].entrypoint=!1,ajax.post("al_im.php",l,{onDone:function(t){clearTimeout(_.saveDraftTO),FastChat.saveDraft(e),FastChat.sendOnResponse(t,c,_)},onFail:function(t){FastChat.error(e,t||(0,E.getLang)("global_unknown_error")),(0,h.elfocus)(_.txt),(0,h.val)(_.txt,(0,p.clean)(o)),_.editable?FastChat.checkEditable(_.emojiId,_.txt):_.txt.autosize.update();var i=(0,h.ge)("fc_msg"+c);if(i)return i.appendChild((0,h.ce)("span",{className:"fc_msg_error",innerHTML:(0,E.getLang)("global_error")})),FastChat.scroll(e),!0},showProgress:function(){_.sending=!0,_.sendProgressTO=setTimeout((function(){var e=(0,h.ge)("fc_msg"+c);e&&FastChat.createProgress(e,c,e.firstChild)}),2e3)},hideProgress:function(){_.sending=!1,clearTimeout(_.sendProgressTO),FastChat.removeProgress(c)}}),(0,h.re)("fc_error"+e),t||((0,h.val)(_.txt,""),_.imMedia&&_.imMedia.unchooseMedia()),FastChat.addMessage(FastChat.prepareMessageData({messageId:c,text:(0,p.clean)(o).replace(/\n/g,"<br>"),peerId:e,flags:3,randomId:l.random_id,attaches:[]})),delete curFastChat.myTypingEvents[e],_.editable?FastChat.checkEditable(_.emojiId,_.txt):_.txt.autosize.update(!1,!0),(0,h.elfocus)(_.txt),FastChat.scroll(e),FastChat.trackActivity("send")}else _.editable?Emoji.editableFocus(_.txt,!1,!0):(0,h.elfocus)(_.txt)},saveDraft:function(e){var t=curFastChat.tabs[e],i=(t||{}).txt;if(i&&t){var _=Emoji.editableVal(i),o=(0,v.loadDraftForPeer)(curFastChat.ldb,e);o.setText((0,p.trim)(_)||""),o.destroy()}},restoreDraft:function(e){var t=curFastChat.tabs[e],i=t.txt,_=(0,v.loadDraftForPeer)(curFastChat.ldb,e);return!(!i||!t||(0,h.val)(i).length>_.dData.txt.length&&!_.hasAttaches())&&(t.editable?i.innerHTML=Emoji.emojiToHTML((0,p.clean)(_.dData.txt),1):(0,h.val)(i,(0,p.clean)(_.dData.txt)),setTimeout((()=>{for(var e=_.dData.attaches,i=0;i<e.length;i++)t.imMedia&&t.imMedia.chooseMedia(e[i].type,e[i].id,e[i].object||{});_.destroy()}),40),FastChat.checkEditable(t.emojiId,i),setTimeout((function(){i.scrollTop=i.scrollHeight}),10),!0)},error:function(e,t){e=e||curFastChat.peer;var i=curFastChat.tabs[e];(0,h.re)("fc_error"+e),i.log.appendChild((0,h.ce)("div",{id:"fc_error"+e,className:"fc_msgs_error",innerHTML:t||(0,E.getLang)("global_error")})),FastChat.scroll(e)},scroll:function(e){e=e||curFastChat.peer;var t=curFastChat.tabs[e];t&&(t.logWrap.scrollTop=t.logWrap.scrollHeight,t.scroll&&t.scroll.update(!1,!0))},mkdate:function(e){var t=new Date(1e3*e),i=new Date,_=function(e){return(e+"").length<2?"0"+e:e};if(t.getDay()==i.getDay())return _(t.getHours())+":"+_(t.getMinutes());var o=_(t.getDate())+"."+_(t.getMonth()+1);return t.getFullYear()!=i.getFullYear()&&(o+="."+(t.getFullYear()+"").substr(2)),o},prepareMessageData(e){var t=e.peerId,i=e.flags,_=e.messageId,o=e.text,a=e.date,r=(0,I.getUserId)(e),n=R(this.getMessageMedia(e),2),s=n[0],c=n[1],l="",d=e.randomId;((0,I.isServiceMsg)(e)||(0,I.isCallMessage)(e))&&(l=this.renderServiceMessage(e));var u=(0,I.isServiceMsg)(e)||(0,I.isCallMessage)(e)?l:(0,I.isExpiredCasperMessage)(e)?(0,E.getLang)("mail_expired_message"):this.getMessageText(o,t)+s;return-1!==String(_).indexOf("rid")&&(d=Number(_.slice(3))),Object.assign({id:_,peer:t,from_id:r,text:u,out:(0,I.isOut)(e),unread:Boolean(1&i),date:a,date_str:FastChat.mkdate(a),randomId:d,isServiceMessage:(0,I.isServiceMsg)(e)||(0,I.isCallMessage)(e)},this.getMessageAuthor(e),c)},getMessageAuthor(e){var t=e.peerId,i=(0,I.getUserId)(e),_=this.getTab(e.peerId);if(!_||!i)return{};var o=(0,I.isOut)(e)?curFastChat.me:(0,k.isChatPeer)(t)?_.data.members[i]:_,a=o.name,r=o.link,n=o.photo,s=o.fname,c=o.first_name;return{fname:(0,k.isChatPeer)(t)?s||c:"",from_id:i,name:a,link:r,photo:n}},getMessageMedia(e){var t=e.peerId,i=e.messageId;if((0,I.isServiceMsg)(e)||(0,I.isCallMessage)(e)||!Array.isArray(e.attaches))return["",{}];var _="",o={};return e.attaches.forEach((e=>{switch(e.type){case"sticker":_+=i?this.renderSticker(e.id,e.productId,e.kind,i):this.renderSticker(e.id,e.productId),o.sticker=!0;break;case"mail":var a=e.object?e.object.fwd_count:e.id.split(";").length;_+=(0,h.rs)(curFastChat.tpl.msg_fwd,{msg_id:i,peerId_nice:(0,k.convertPeerToUrl)(t),label:(0,E.getLang)(a>1?"mail_im_fwd_msgs":"mail_im_fwd_msg")});break;default:_+=(0,h.rs)(vk.pr_tpl,{id:"",cls:""}),i>0&&setTimeout(FastChat.needMsgMedia.pbind(t,i),5)}})),_&&(_=`<div class="fc_msg_attachments" id="fc_msg_attachments${i}">${_}</div>`),[_,o]},renderSticker(e,t,i,_){var o,a=window.devicePixelRatio>=2?"256":"128";return"animation"===i?(o=(0,h.rs)(curFastChat.tpl.animatedSticker,{id:e,size:a,productId:t,messageId:_}),Number.isInteger(_)&&this.loadStickersModuleIfNeed().then((()=>{window.StickersSettings.getAutoplay()&&window.StickersAnimation&&window.StickersAnimation.loadAndPlayStickerWithTimer("animatedSticker"+_,10)}))):o=(0,h.rs)(curFastChat.tpl.sticker,{id:e,size:a}),o},loadStickersModuleIfNeed:()=>new Promise((e=>{var t=Boolean(window.StickersSettings&&window.StickersAnimation);curFastChat.stickersLoading||t?e():(curFastChat.stickersLoading=!0,window.stManager.add([window.jsc("web/stickers.js")],(()=>{curFastChat.stickersLoading=!1,e()})))})),renderServiceMessage(e){if((0,I.isCallMessage)(e))return this.renderCallMessage(e);var t=e.kludges,i=e.peerId,_=t.source_act,o=Number(t.source_mid),a=(0,p.intval)((0,k.isChatPeer)(e.peerId)?t.from:e.userId),r=this.getMember(i,a),n="",s=a===o;switch(_){case k.CREATE_CHAT_ACTION:n="mail_im_chat_created";break;case k.CHAT_TITLE_ACTION:n=t.source_is_channel?"mail_im_title_updated_channel":"mail_im_title_updated_dot";break;case k.CHAT_INVITE_USER:n=s?"mail_im_returned_to_chat":"mail_im_invited";break;case k.CHAT_KICK_USER:n=s?"mail_im_left":"mail_im_kicked_from_chat";break;case k.CHAT_PHOTO_UPDATE:n="mail_im_photo_set";break;case k.CHAT_PHOTO_REMOVE:n=t.source_is_channel?"mail_im_photo_removed_channel":"mail_im_photo_removed";break;case k.CHAT_PIN_MESSAGE:n=t.source_message?"mail_im_pin_message":"mail_im_pin_message_empty2";break;case k.CHAT_UNPIN_MESSAGE:n=t.source_message?"mail_im_unpin_message":"mail_im_unpin_message_empty2";break;case k.CHAT_INVITE_BY_LINK:n="mail_im_invite_by_link";break;case k.CHAT_SCREENSHOT:n=vk.id===o?"mail_im_chat_own_screenshot":"mail_im_chat_screenshot";break;case k.CHAT_GROUP_CALL_STARTED:n="mail_im_group_call_started";break;case k.CHAT_KICK_USER_CALL_BLOCK:n="mail_im_kick_user_call_block";break;case k.CHAT_KICK_DON:n="mail_im_chat_kick_don";break;default:return"mail_no_support"}if(n=(n=(0,E.langSex)(r.sex,(0,E.getLang)(n,"raw"))).replace("{from}",(0,A.getServiceLinkTemplate)(r.link,r.name,!0)),o&&o!==a){var c=t.source_email;if(c)n=n.replace("{user}",(0,A.getServiceLinkTemplate)(`/im?email=${encodeURIComponent(c)}`,"email",!0));else{var l=this.getMember(i,o)||{name_inv_case:"",name_kick_case:"",link:""},d=_===k.CHAT_KICK_USER?l.name_kick_case:l.name_inv_case;n=n.replace("{user}",(0,A.getServiceLinkTemplate)(l.link,d,!0))}}if(t.source_text){var u=t.source_old_text?`«<b class="im_srv_lnk">${t.source_old_text}</b>» &rarr; `:"";n=n.replace("{title}",u+`«<b class="im_srv_lnk">${t.source_text}</b>»`)}if(t.source_act===k.CHAT_PIN_MESSAGE||t.source_act===k.CHAT_UNPIN_MESSAGE)if(t.source_message){var f=(0,k.replaceSpecialSymbols)(Emoji.emojiToHTML((0,C.stripHTML)(t.source_message.replace(/<br\s?\/?>/gi," ")),!0)),h=(0,A.getServiceLinkTemplate)("",f,!1,"im_srv_mess_link");n=n.replace("{msg}",h)}else n=n.replace(/{link}(.+){\/link}/i,((e,t)=>(0,A.getServiceLinkTemplate)("",t,!1,"im_srv_mess_link")));return n},renderCallMessage(e){var t,i=vk.id,_=e.attaches[0],o=_.initiatorId,a=_.state,r=_.receiverId,n=i===o;switch(a){case"reached":var s=(0,k.secondsToHuman)(_.duration);t=(t=n?(0,E.getLang)("mail_call_outgoing"):(0,E.getLang)("mail_call_incoming")).replace("{duration}",s);break;case"canceled_by_initiator":t=n?(0,E.getLang)("mail_call_canceled"):(0,E.getLang)("mail_call_missed");break;case"canceled_by_receiver":if(n){var c=x(curFastChat.friends[r+"_"],r);t=c?(0,E.langSex)(c.sex,(0,E.getLang)("mail_call_declined_by","raw")).replace("{user_name}",c.name):(0,E.getLang)("mail_call_declined")}else t=(0,E.getLang)("mail_call_canceled");break;default:t=(0,E.getLang)("mail_added_call")}return(0,p.getTemplate)("im_calls_link",{text:t,peerId:e.peerId})},getMember(e,t){var i=this.getTab(e);return(0,k.isChatPeer)(e)&&i?i.data.members[t]:i||null},needMsgMedia:function(e,t){t<=0||(FastChat.lcSend("needMedia",{msgId:t}),curFastChat.needMedia[t]=[e,setTimeout(FastChat.loadMsgMedia.pbind(e,t),curNotifier.is_server?0:(0,C.irand)(150,250))])},loadMsgMedia:function(e,t){t<=0||void 0!==curFastChat.gotMedia[t]&&0!==curFastChat.gotMedia[t]||(FastChat.lcSend("fetchingMedia",{msgId:t}),curFastChat.gotMedia[t]=0,ajax.post("al_im.php",{act:"a_get_media",id:t,from:"fc"},{onDone:function(i){var _=R(i,4),o=(_[0],_[1]),a=(_[2],_[3]);FastChat.lcSend("gotMedia",{msgId:t,peer:e,text:o,msgOpts:a}),FastChat.gotMsgMedia(e,t,o,a)}}))},gotMsgMedia:function(e,t,i,_){if((0,h.val)("fc_msg_attachments"+t,i),_&&_.sticker){var o=(0,h.ge)("fc_msg"+t),a=o&&o.parentNode;o&&(0,h.addClass)(a.parentNode,"fc_msg_sticker"),window.StickersAnimation&&window.StickersAnimation.checkSettingsAndLoadInWeb(t,!1,!1,!0)}FastChat.scroll(e),curFastChat.gotMedia[t]=[e,i,_],_&&_.stickers&&window.Emoji&&Emoji.updateTabs(_.stickers,_.keywords),void 0!==curFastChat.needMedia[t]&&(clearTimeout(curFastChat.needMedia[t][1]),delete curFastChat.needMedia[t])},replaceSpecialSymbols:function(e){return e.replace(/&lt;&lt;/g,"&laquo;").replace(/&gt;&gt;/g,"&raquo;").replace(/ \-\-/g," &mdash;").replace(/\-\- /g,"&mdash; ").replace(/(^|[\s.,:\'\";>\)\(])(\*|@)([A-Za-z0-9_\.]{2,32})\s*\((.+?)\)/g,"$1$4")},addMessage:function(e){var t,i=e.peer,_=this.getTab(i),o=_.log;if(!_||e.out||!_.box.visible||_.iman.is_idle||curNotifier.idle_manager.is_idle||(e.unread=!1,FastChat.markRead(e.peer,[e.id])),e.randomId&&(0,h.re)(document.querySelector(`[data-random-id="${e.randomId}"]`)),_.msgs[e.id]=[e.out,e.unread],this.isNewStack(e)){(0,h.re)("fc_log_empty"+i);var a=(e.out?"fc_msgs_out ":"")+(e.unread?"fc_msgs_unread":"");e.sticker&&(a+=" fc_msg_sticker");var r=e.isServiceMessage?curFastChat.tpl.msgs_service:e.out?curFastChat.tpl.msgs_out:curFastChat.tpl.msgs;t=(0,h.se)((0,h.rs)(r,{from_id:e.from_id,link:e.link,photo:Notifier.fixPhoto(e.photo),name:e.from_id==curFastChat.me.id?(0,E.getLang)("mail_im_thats_u"):(0,C.stripHTML)(e.name),classname:a,date:e.date,date_str:e.date_str,msgs:"",randomId:e.randomId||0,messageId:e.id})),o.appendChild(t)}else e.unread||(0,h.removeClass)(t,"fc_msgs_unread");var n=(0,h.geByClass1)("fc_msgs_list",t,"div"),s=(0,h.geByClass1)("fc_msgs_date",n),c=(0,h.geByClass1)("fc_msg_last",n);c&&(0,h.removeClass)(c,"fc_msg_last");var l=FastChat.replaceSpecialSymbols(e.text),d=(0,h.se)((0,h.rs)(curFastChat.tpl.msg,{msg_id:e.id,classname:(e.unread?"fc_msg_unread":"")+" fc_msg_last",text:e.isServiceMessage?`<div class="fc_srv_msg">${l}</div>`:l}));(0,h.domFC)(n)&&"BR"===(0,h.domFC)(n).tagName&&(0,h.re)((0,h.domFC)(n)),s?n.insertBefore(d,s):n.appendChild(d),vk.id!=e.from_id&&(delete curFastChat.typingEvents[i],FastChat.updateTyping(i,1)),_.scroll&&_.scroll.update()},getTab:e=>curFastChat.tabs[e],isTabLoaded(e){return Boolean(curFastChat.tabs&&this.getTab(e))},isNewStack(e){var t=this.getTab(e.peer).log.lastChild;return t&&"fc_msgs_error"==t.className&&(t=t.previousSibling),!t||(!(0,h.hasClass)(t,"fc_msgs_wrap")||(!(0,h.hasClass)(t,"fc_msgs_unread")&&!0===e.unread||(t.getAttribute("data-from")!==e.from_id||(e.date-(0,p.intval)(t.getAttribute("data-date"))>=300||!(!e.sticker&&!(0,h.hasClass)(t,"fc_msg_sticker"))))))},editMessage(e){var t=e.id,i=(0,h.ge)("fc_msg"+t);if(i){var _=(0,h.se)((0,h.rs)(curFastChat.tpl.msg,{msg_id:t,classname:i.getAttribute("class"),text:FastChat.replaceSpecialSymbols(e.text)}));i.parentNode.replaceChild(_,i)}},deleteMessage(e){var t=e.id,i=(0,h.ge)("fc_msg"+t);if(i){var _=!(0,h.domNS)(i)&&!(0,h.domPS)(i),o=(0,h.domClosest)("fc_tab_log_msgs",i);for((0,h.re)(_?(0,h.domClosest)("fc_msgs_wrap",i):i);(0,h.hasClass)((0,h.domLC)(o),"fc_msgs_date");)(0,h.re)((0,h.domLC)(o))}},updateTabUnreadCounter(e,t){if(!e){var i=document.querySelector(`#chat_tab_icon_${t.peerId}`),_=i&&i.querySelector(".chat_tab_counter");e={unread:_&&Math.max(+_.innerHTML,0)||0}}(0,I.isOut)(t)?e.unread=0:e.unread++,this.updateTabUnreadCounterElement(e,t.peerId)},updateTabUnreadCounterElement(e,t){if(e){var i=document.querySelector(`#chat_tab_icon_${t}`),_=i&&i.querySelector(".chat_tab_counter");_&&(_.innerHTML=e.unread>0?e.unread:""),e.title&&e.name&&((0,h.val)(e.title,e.name+(e.unread?' <span class="fc_tab_count">('+e.unread+")</span>":"")),(0,h.val)("fc_contact_unread"+t,e.unread?" <b>+"+e.unread+"</b>":""))}},showMsgFwd:function(e){return!(0,r.showBox)("al_im.php",{act:"a_show_forward_box",id:vk.id+"_"+e,from:"mail"},{stat:["im.css"],dark:1,params:{onHide:function(){AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)}}})},closeTab:function(e){curFastChat.tabs[e].box.close()},trackActivity(e){(0,D.statlogsValueEvent)("im_fastchat_location",e,window.cur.module)},toggleFastChats(e){var t=!e;(0,h.toggleClass)((0,h.ge)("chat_onl_wrap"),"fast_chats_toggle_hide",t),(0,h.toggleClass)((0,h.ge)("rb_box_fc_clist"),"fast_chats_toggle_hide",t),(0,p.each)((0,h.geByClass)("rb_box_wrap"),(()=>(0,h.toggleClass)(this,"fast_chats_toggle_hide",t)))},toggleFullScreenState(e){e?document.body.classList.add(S):document.body.classList.remove(S)},getFullScreenState:()=>document.body.classList.contains(S),tplBox:'<div class="fc_tab_wrap"><div class="fc_tab_head clear_fix"><a class="fc_tab_close_wrap"><div class="chats_sp fc_tab_close"></div></a><a class="fc_tab_max_wrap" href="/im?sel=%id%" onmousedown="event.cancelBubble = true;" onclick="return nav.go(this, event);"><div class="chats_sp fc_tab_max"></div></a><a class="fc_tab_pin_wrap" onmousedown="event.cancelBubble = true;" onclick="return FastChat.pinTab(%id%, event);"><div class="chats_sp fc_tab_pin"></div></a><div class="fc_tab_title noselect">%name%</div></div><div class="fc_tab"><div class="fc_tab_log_wrap"><div class="fc_tab_notify_wrap"></div><div class="fc_tab_log"><div class="fc_tab_log_msgs"></div><div class="fc_tab_typing" id="fc_tab_typing%id%"><div class="pr fc_tab_typing_icon _fc_tab_typing_progress" id=""><div class="pr_bt"></div><div class="pr_bt"></div><div class="pr_bt"></div></div><div class="fc_tab_typing_name _fc_tab_typing_name"></div></div></div></div><div class="fc_tab_txt_wrap"><a class="fc_tab_attach"></a><div class="fc_tab_txt">%cont%<div class="fc_tab_preview"></div></div></div></div><div class="fc_pointer_offset"><div class="fc_tab_pointer fc_tab_pointer_peer"></div></div></div>',tplTab:'<div class="fc_tab_log_wrap"><div class="fc_tab_notify_wrap"></div><div class="fc_tab_log"><div class="fc_tab_log_msgs"></div><div class="fc_tab_typing" id="fc_tab_typing%id%"><div class="pr fc_tab_typing_icon _fc_tab_typing_progress" id=""><div class="pr_bt"></div><div class="pr_bt"></div><div class="pr_bt"></div></div><div class="fc_tab_typing_name _fc_tab_typing_name"></div></div></div></div><div class="fc_tab_txt_wrap"><div class="fc_tab_txt">%cont%</div></div>'}},367537:(__unused_webpack___webpack_module__,__unused_webpack___webpack_exports__,__webpack_require__)=>{var core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(175115),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21466),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(59357),core_js_modules_es6_promise__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(940851),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(296253),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(751876),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(787481),_shared_lib_browser__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(726271),_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(447215),_web_lib_lang__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(786067),_web_lib_ui_util__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(159121),_web_lib_utils__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(982452),_web_lib_fx__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(635676),_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(479957),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(49535),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(695724),_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(315544),_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(376270),_shared_lib_idle_manager__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(588379),_shared_lib_convert__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(668040),_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(40906),_longpoll_singleton__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(316031),_web_components_im_ServerSentEvents_DEPRECATEDLongpollAdapter__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(734693),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(19331),_shared_lib_site__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(961540),_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(850167),_shared_audio_utils_wrapAudioPlay__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(602227),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(654612),_web_market_HappySanta__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(597332),_shared_im_request__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(887294),_shared_im_EventQueue__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(967181),_shared_helpers_html_entities__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(449849),_shared_im_longpoll_events__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(663825),_web_messenger_helpers_events__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(645523),_shared_lib_js_logger__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__(66433),_notifier_utils__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__(16850),_vkontakte_internal_calls_constants__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__(173674),_icons_desktop_getIcon20RepostCircleFillGreen__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__(997453),_icons_desktop_getIcon20ClipCircleFillViolet__WEBPACK_IMPORTED_MODULE_39__=__webpack_require__(257663),_icons_desktop_getIcon20CheckCircleFillYellow__WEBPACK_IMPORTED_MODULE_41__=__webpack_require__(191451),_icons_desktop_getIcon20LikeCircleFillRed__WEBPACK_IMPORTED_MODULE_42__=__webpack_require__(740884),_icons_desktop_getIcon20PodcastCircleFillRed__WEBPACK_IMPORTED_MODULE_43__=__webpack_require__(896710),_icons_desktop_getIcon20PollCircleFillGreen__WEBPACK_IMPORTED_MODULE_44__=__webpack_require__(227031),_icons_desktop_getIcon20VideoCameraCircleFillRed__WEBPACK_IMPORTED_MODULE_45__=__webpack_require__(291634),_icons_desktop_getIcon20EditCircleFillBlue__WEBPACK_IMPORTED_MODULE_47__=__webpack_require__(498100),_icons_desktop_getIcon20AddCircleFillBlue__WEBPACK_IMPORTED_MODULE_48__=__webpack_require__(435703),_icons_desktop_getIcon20MailCircleFillBlue__WEBPACK_IMPORTED_MODULE_49__=__webpack_require__(426642),_icons_desktop_getIcon20QuestionCircleFillViolet__WEBPACK_IMPORTED_MODULE_50__=__webpack_require__(812939),_icons_desktop_getIcon20UserCircleFillBlue__WEBPACK_IMPORTED_MODULE_51__=__webpack_require__(41337),_icons_desktop_getIcon20StoryReplyCircleFillViolet__WEBPACK_IMPORTED_MODULE_54__=__webpack_require__(686497),_icons_desktop_getIcon20QuestionCircleFillGreen__WEBPACK_IMPORTED_MODULE_55__=__webpack_require__(775387),_icons_desktop_getIcon20SongCircleFillViolet__WEBPACK_IMPORTED_MODULE_56__=__webpack_require__(470685),_icons_desktop_getIcon20CameraCircleFillGreen__WEBPACK_IMPORTED_MODULE_57__=__webpack_require__(909165),_icons_desktop_getIcon20RssCircleFillYellow__WEBPACK_IMPORTED_MODULE_58__=__webpack_require__(749203),_icons_desktop_getIcon20RssCircleFillBlack__WEBPACK_IMPORTED_MODULE_59__=__webpack_require__(170953),_icons_desktop_getIcon20GiftCircleFillYellow__WEBPACK_IMPORTED_MODULE_60__=__webpack_require__(487759),_icons_desktop_getIcon20GiftCircleFillRed__WEBPACK_IMPORTED_MODULE_61__=__webpack_require__(673853),_icons_desktop_getIcon20CakeCircleFillPurple__WEBPACK_IMPORTED_MODULE_62__=__webpack_require__(966688),_icons_desktop_getIcon20GameCircleFillBlue__WEBPACK_IMPORTED_MODULE_64__=__webpack_require__(262039),_icons_desktop_getIcon20MentionCircleFillBlue__WEBPACK_IMPORTED_MODULE_65__=__webpack_require__(334402),_icons_desktop_getIcon20CalendarCircleFillRed__WEBPACK_IMPORTED_MODULE_66__=__webpack_require__(156543),_icons_desktop_getIcon20MessageCircleFillBlue__WEBPACK_IMPORTED_MODULE_67__=__webpack_require__(192090),_icons_desktop_getIcon20CommentCircleFillGreen__WEBPACK_IMPORTED_MODULE_68__=__webpack_require__(93534),_icons_desktop_getIcon20DiscussionsCircleFillBlue__WEBPACK_IMPORTED_MODULE_69__=__webpack_require__(793965),_icons_desktop_getIcon20BoxCircleFillBlue__WEBPACK_IMPORTED_MODULE_70__=__webpack_require__(776181),_icons_desktop_getIcon20MoneyTransferCircleFillTurquoise__WEBPACK_IMPORTED_MODULE_71__=__webpack_require__(70039),_icons_desktop_getIcon20MoneyTransferCircleFillRed__WEBPACK_IMPORTED_MODULE_72__=__webpack_require__(113803),_icons_desktop_getIcon20CancelCircleFillRed__WEBPACK_IMPORTED_MODULE_73__=__webpack_require__(706962),_icons_desktop_getIcon20MoneyRequestCircleFillBlue__WEBPACK_IMPORTED_MODULE_74__=__webpack_require__(261315),_icons_desktop_getIcon20CheckCircleFillGreen__WEBPACK_IMPORTED_MODULE_76__=__webpack_require__(511803),_icons_desktop_getIcon20ServicesCircleFillBlue__WEBPACK_IMPORTED_MODULE_77__=__webpack_require__(994635),_icons_desktop_getIcon20RecentCircleFillYellow__WEBPACK_IMPORTED_MODULE_80__=__webpack_require__(478574),_icons_desktop_getIcon20StatisticCircleFillBlue__WEBPACK_IMPORTED_MODULE_81__=__webpack_require__(871563),_icons_desktop_getIcon20DonateCircleFillYellow__WEBPACK_IMPORTED_MODULE_82__=__webpack_require__(382251),_icons_desktop_getIcon20TextLiveCircleFillGreen__WEBPACK_IMPORTED_MODULE_83__=__webpack_require__(101354),_icons_desktop_getIcon20LightbulbCircleFillYellow__WEBPACK_IMPORTED_MODULE_84__=__webpack_require__(136817),_icons_desktop_getIcon20MessageUnreadCircleFillRed__WEBPACK_IMPORTED_MODULE_85__=__webpack_require__(227180),_icons_desktop_getIcon20AdvertisingCircleFillRed__WEBPACK_IMPORTED_MODULE_86__=__webpack_require__(769945),_icons_desktop_getIcon20AddCircleFillGreen__WEBPACK_IMPORTED_MODULE_40__=__webpack_require__(469224),_icons_desktop_getIcon20StripCircleFillRed__WEBPACK_IMPORTED_MODULE_46__=__webpack_require__(571336),_icons_desktop_getIcon20VotesCircleFillBlue__WEBPACK_IMPORTED_MODULE_52__=__webpack_require__(704878),_icons_desktop_getIcon20ReplyCircleFillGreen__WEBPACK_IMPORTED_MODULE_53__=__webpack_require__(509473),_icons_desktop_getIcon20StoryFillCircleYellow__WEBPACK_IMPORTED_MODULE_63__=__webpack_require__(456769),_icons_desktop_getIcon20CheckCircleFillTurquoise__WEBPACK_IMPORTED_MODULE_75__=__webpack_require__(609754),_icons_desktop_getIcon20ServicesCircleFillYellow__WEBPACK_IMPORTED_MODULE_78__=__webpack_require__(991240),_icons_desktop_getIcon20ThumbsUpCircleFillGreen__WEBPACK_IMPORTED_MODULE_79__=__webpack_require__(420945),_icons_desktop_getIcon20Users3CircleFillBlue__WEBPACK_IMPORTED_MODULE_87__=__webpack_require__(79870),_icons_desktop_getIcon20FireCircleFillRed__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__(229009);function _extends(){return _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(e[_]=i[_])}return e},_extends.apply(this,arguments)}var ACTIVE_TAB_SWITCH_SERVER_TIMEOUT=_shared_lib_browser__WEBPACK_IMPORTED_MODULE_7__.browser.safari?3e3:1e4,LC_SERVER_SWITCH_TO_ACTIVE_FLAG="lc_server_switch_to_active_flag",NOTIFICATION_FADE_TIMEOUT=7e3,NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE=35e3,NOTIFICATION_FADE_TIMEOUT_AFTER_UNFREEZE=5e3,NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE_AFTER_UNFREEZE=3e4,IS_SSE_ENABLED=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("mail_sse_longpoll"),isMediaStoppedByCalls=!1,errorTimeout={initialValue:1,get:()=>window.curNotifier.error_timeout||errorTimeout.initialValue,set:e=>{window.curNotifier.error_timeout=e},reset:()=>{window.curNotifier.error_timeout=errorTimeout.initialValue},increase:()=>{window.curNotifier.error_timeout<64&&(window.curNotifier.error_timeout*=2)},increaseMore:()=>{window.curNotifier.error_timeout<256&&(window.curNotifier.error_timeout*=2)},decrease:()=>{window.curNotifier.error_timeout=Math.max(1,errorTimeout.get()/1.5)}};function showEventThumb(e){var t="";if(e.author_photo){var i;t="video_process_ready"===e.type?`<div class="notifier_video_thumb" style="background-image: url('${Notifier.fixPhoto(e.author_photo)}')"></div>`:`<img alt="" src="${Notifier.fixPhoto(e.author_photo)}" class="notifier_image" />`;var _=null===(i=e.icon_custom)||void 0===i?void 0:i.image_url;if(_)t=`<div class="feedback_photo_icon_custom" style="background-image: url('${(0,_shared_helpers_html_entities__WEBPACK_IMPORTED_MODULE_31__.escape)(_)}')"></div>`+t;else if(e.icon_type){var o=getSvgByIconType(e.icon_type);t=`<div class="feedback_photo_icon ${o&&"display_block"}">${o}</div>`+t}e.author_link&&(t=`<a href="${e.author_link}">${t}</a>`),t=`<div class="notifier_image_wrap">${t}</div>`}return t}function getSvgByIconType(e){switch(e){case"repost":case"mail_mention":return(0,_icons_desktop_getIcon20RepostCircleFillGreen__WEBPACK_IMPORTED_MODULE_37__.getIcon20RepostCircleFillGreen)().icon;case"interesting":return(0,_icons_desktop_getIcon20FireCircleFillRed__WEBPACK_IMPORTED_MODULE_38__.getIcon20FireCircleFillRed)().icon;case"clips":return(0,_icons_desktop_getIcon20ClipCircleFillViolet__WEBPACK_IMPORTED_MODULE_39__.getIcon20ClipCircleFillViolet)().icon;case"friends":return(0,_icons_desktop_getIcon20AddCircleFillGreen__WEBPACK_IMPORTED_MODULE_40__.getIcon20AddCircleFillGreen)().icon;case"suggested_post_published":return(0,_icons_desktop_getIcon20CheckCircleFillYellow__WEBPACK_IMPORTED_MODULE_41__.getIcon20CheckCircleFillYellow)().icon;case"like":return(0,_icons_desktop_getIcon20LikeCircleFillRed__WEBPACK_IMPORTED_MODULE_42__.getIcon20LikeCircleFillRed)().icon;case"podcast":return(0,_icons_desktop_getIcon20PodcastCircleFillRed__WEBPACK_IMPORTED_MODULE_43__.getIcon20PodcastCircleFillRed)().icon;case"voting":return(0,_icons_desktop_getIcon20PollCircleFillGreen__WEBPACK_IMPORTED_MODULE_44__.getIcon20PollCircleFillGreen)().icon;case"live":return(0,_icons_desktop_getIcon20VideoCameraCircleFillRed__WEBPACK_IMPORTED_MODULE_45__.getIcon20VideoCameraCircleFillRed)().icon;case"video_playlists":return(0,_icons_desktop_getIcon20StripCircleFillRed__WEBPACK_IMPORTED_MODULE_46__.getIcon20StripCircleFillRed)().icon;case"wall":return(0,_icons_desktop_getIcon20EditCircleFillBlue__WEBPACK_IMPORTED_MODULE_47__.getIcon20EditCircleFillBlue)().icon;case"follow":return(0,_icons_desktop_getIcon20AddCircleFillBlue__WEBPACK_IMPORTED_MODULE_48__.getIcon20AddCircleFillBlue)().icon;case"invite_group":return(0,_icons_desktop_getIcon20MailCircleFillBlue__WEBPACK_IMPORTED_MODULE_49__.getIcon20MailCircleFillBlue)().icon;case"question":case"story_question":return(0,_icons_desktop_getIcon20QuestionCircleFillViolet__WEBPACK_IMPORTED_MODULE_50__.getIcon20QuestionCircleFillViolet)().icon;case"friend_found":return(0,_icons_desktop_getIcon20UserCircleFillBlue__WEBPACK_IMPORTED_MODULE_51__.getIcon20UserCircleFillBlue)().icon;case"transfer_votes":return(0,_icons_desktop_getIcon20VotesCircleFillBlue__WEBPACK_IMPORTED_MODULE_52__.getIcon20VotesCircleFillBlue)().icon;case"reply":return(0,_icons_desktop_getIcon20ReplyCircleFillGreen__WEBPACK_IMPORTED_MODULE_53__.getIcon20ReplyCircleFillGreen)().icon;case"story_reply":return(0,_icons_desktop_getIcon20StoryReplyCircleFillViolet__WEBPACK_IMPORTED_MODULE_54__.getIcon20StoryReplyCircleFillViolet)().icon;case"story_question_answer":return(0,_icons_desktop_getIcon20QuestionCircleFillGreen__WEBPACK_IMPORTED_MODULE_55__.getIcon20QuestionCircleFillGreen)().icon;case"story_music":return(0,_icons_desktop_getIcon20SongCircleFillViolet__WEBPACK_IMPORTED_MODULE_56__.getIcon20SongCircleFillViolet)().icon;case"photo_tag":return(0,_icons_desktop_getIcon20CameraCircleFillGreen__WEBPACK_IMPORTED_MODULE_57__.getIcon20CameraCircleFillGreen)().icon;case"new_post":return(0,_icons_desktop_getIcon20RssCircleFillYellow__WEBPACK_IMPORTED_MODULE_58__.getIcon20RssCircleFillYellow)().icon;case"private_post":return(0,_icons_desktop_getIcon20RssCircleFillBlack__WEBPACK_IMPORTED_MODULE_59__.getIcon20RssCircleFillBlack)().icon;case"gift":case"recent":return(0,_icons_desktop_getIcon20GiftCircleFillYellow__WEBPACK_IMPORTED_MODULE_60__.getIcon20GiftCircleFillYellow)().icon;case"birthday":return(0,_icons_desktop_getIcon20GiftCircleFillRed__WEBPACK_IMPORTED_MODULE_61__.getIcon20GiftCircleFillRed)().icon;case"birthday_cake":return(0,_icons_desktop_getIcon20CakeCircleFillPurple__WEBPACK_IMPORTED_MODULE_62__.getIcon20CakeCircleFillPurple)().icon;case"advice":return(0,_icons_desktop_getIcon20StoryFillCircleYellow__WEBPACK_IMPORTED_MODULE_63__.getIcon20StoryFillCircleYellow)().icon;case"invite_app":return(0,_icons_desktop_getIcon20GameCircleFillBlue__WEBPACK_IMPORTED_MODULE_64__.getIcon20GameCircleFillBlue)().icon;case"mention":return(0,_icons_desktop_getIcon20MentionCircleFillBlue__WEBPACK_IMPORTED_MODULE_65__.getIcon20MentionCircleFillBlue)().icon;case"event_unify":return(0,_icons_desktop_getIcon20CalendarCircleFillRed__WEBPACK_IMPORTED_MODULE_66__.getIcon20CalendarCircleFillRed)().icon;case"message_request":return(0,_icons_desktop_getIcon20MessageCircleFillBlue__WEBPACK_IMPORTED_MODULE_67__.getIcon20MessageCircleFillBlue)().icon;case"comment":return(0,_icons_desktop_getIcon20CommentCircleFillGreen__WEBPACK_IMPORTED_MODULE_68__.getIcon20CommentCircleFillGreen)().icon;case"discussions":return(0,_icons_desktop_getIcon20DiscussionsCircleFillBlue__WEBPACK_IMPORTED_MODULE_69__.getIcon20DiscussionsCircleFillBlue)().icon;case"_delivery":case"market_order_status_delivering":return(0,_icons_desktop_getIcon20BoxCircleFillBlue__WEBPACK_IMPORTED_MODULE_70__.getIcon20BoxCircleFillBlue)().icon;case"transfer_money":case"money_complete":return(0,_icons_desktop_getIcon20MoneyTransferCircleFillTurquoise__WEBPACK_IMPORTED_MODULE_71__.getIcon20MoneyTransferCircleFillTurquoise)().icon;case"money_decline":return(0,_icons_desktop_getIcon20MoneyTransferCircleFillRed__WEBPACK_IMPORTED_MODULE_72__.getIcon20MoneyTransferCircleFillRed)().icon;case"transfer_money_cancelled":case"invite_group_fired":case"ads_fail":case"market_order_status_canceled":return(0,_icons_desktop_getIcon20CancelCircleFillRed__WEBPACK_IMPORTED_MODULE_73__.getIcon20CancelCircleFillRed)().icon;case"request_money":return(0,_icons_desktop_getIcon20MoneyRequestCircleFillBlue__WEBPACK_IMPORTED_MODULE_74__.getIcon20MoneyRequestCircleFillBlue)().icon;case"ads_ok":return(0,_icons_desktop_getIcon20CheckCircleFillTurquoise__WEBPACK_IMPORTED_MODULE_75__.getIcon20CheckCircleFillTurquoise)().icon;case"friend_accepted":case"approved":case"market_order_status_completed":case"invite_group_accepted":return(0,_icons_desktop_getIcon20CheckCircleFillGreen__WEBPACK_IMPORTED_MODULE_76__.getIcon20CheckCircleFillGreen)().icon;case"services":return(0,_icons_desktop_getIcon20ServicesCircleFillBlue__WEBPACK_IMPORTED_MODULE_77__.getIcon20ServicesCircleFillBlue)().icon;case"service_installation":return(0,_icons_desktop_getIcon20ServicesCircleFillYellow__WEBPACK_IMPORTED_MODULE_78__.getIcon20ServicesCircleFillYellow)().icon;case"service_recommend":return(0,_icons_desktop_getIcon20ThumbsUpCircleFillGreen__WEBPACK_IMPORTED_MODULE_79__.getIcon20ThumbsUpCircleFillGreen)().icon;case"market_order_status_collecting":return(0,_icons_desktop_getIcon20RecentCircleFillYellow__WEBPACK_IMPORTED_MODULE_80__.getIcon20RecentCircleFillYellow)().icon;case"engagement_stats":return(0,_icons_desktop_getIcon20StatisticCircleFillBlue__WEBPACK_IMPORTED_MODULE_81__.getIcon20StatisticCircleFillBlue)().icon;case"donut":return(0,_icons_desktop_getIcon20DonateCircleFillYellow__WEBPACK_IMPORTED_MODULE_82__.getIcon20DonateCircleFillYellow)().icon;case"text_live":return(0,_icons_desktop_getIcon20TextLiveCircleFillGreen__WEBPACK_IMPORTED_MODULE_83__.getIcon20TextLiveCircleFillGreen)().icon;case"market_native_shop_release":return(0,_icons_desktop_getIcon20LightbulbCircleFillYellow__WEBPACK_IMPORTED_MODULE_84__.getIcon20LightbulbCircleFillYellow)().icon;case"message_reminders":return(0,_icons_desktop_getIcon20MessageUnreadCircleFillRed__WEBPACK_IMPORTED_MODULE_85__.getIcon20MessageUnreadCircleFillRed)().icon;case"feed_promo":return(0,_icons_desktop_getIcon20AdvertisingCircleFillRed__WEBPACK_IMPORTED_MODULE_86__.getIcon20AdvertisingCircleFillRed)().icon;case"group":return(0,_icons_desktop_getIcon20Users3CircleFillBlue__WEBPACK_IMPORTED_MODULE_87__.getIcon20Users3CircleFillBlue)().icon;default:return null}}function showEventAddPhoto(e){var t="";return e.add_photo&&(t=`<div class="notifier_add_image_wrap"><img src="${e.add_photo}" class="notifier_add_image"></div>`),t}function setHooksForLoadingCalls(e){var t;if(!1!==(null===(t=window.Calls)||void 0===t?void 0:t.initialized)){var i={},_=t=>function(){for(var i=arguments.length,_=new Array(i),o=0;o<i;o++)_[o]=arguments[o];return loadCallsModule().then((()=>{var t,i;return null===(t=window.Calls)||void 0===t||null===(i=t.init)||void 0===i?void 0:i.call(t,e)})).then((()=>{var e,i;return null===(e=(i=window.Calls)[t])||void 0===e?void 0:e.call(i,..._)}))};i.call=_("call"),i.startGroupCall=_("startGroupCall"),i.startCall=_("startCall"),i.acceptCall=_("acceptCall"),i.joinCallByLink=_("joinCallByLink"),i.showJoinPopup=_("showJoinPopup"),i.showCallByNamePopup=_("showCallByNamePopup"),i.showCreateCallByLinkPopup=_("showCreateCallByLinkPopup"),i.showPlanCalendarEventPopup=_("showPlanCalendarEventPopup"),i.showStartCallModal=_("showStartCallModal"),i.showHistoryScreen=_("showHistoryScreen"),i.initArgs=e,window.Calls=i;var o=window.Notifier.getLpInstance();o&&o.onData((function t(){var i;if(null===(i=window.Calls)||void 0===i?void 0:i.initialized)o.offData(t);else{for(var _=arguments.length,a=new Array(_),r=0;r<_;r++)a[r]=arguments[r];a.forEach((i=>{if(i.type===_vkontakte_internal_calls_constants__WEBPACK_IMPORTED_MODULE_35__.INCOMING_CALL)return o.offData(t),loadCallsModule().then((()=>{var t;return null===(t=window.Calls)||void 0===t?void 0:t.init(e)})).then((()=>window.Calls.handleEvent(i)))}))}}))}else window.Calls.init(e)}function loadVKUIModule(){return new Promise((e=>window.stManager.add(["vkui.css"],(()=>e()))))}function loadCallsModule(){return new Promise((e=>{window.stManager.add([window.jsc("web/calls.js"),"vkui.css","calls.css"],(()=>{e()}))}))}function loadReforgedFastchatModule(){var e=ls.get("stickers_keywords"),t=e&&e.time?Math.floor(e.time/1e3):0;return ajax.post("al_im.php",{act:"a_get_fast_chat",cache_time:t},{onDone:e=>{e.emoji_stickers&&(window.emojiStickers=e.emoji_stickers),window.Emoji&&Emoji.updateTabs(),e.autoplay_animations&&window.StickersSettings.setAutoplay(e.autoplay_animations)},onFail:()=>!0}),window.stManager.add([window.jsc("web/ui_media_selector.js"),"vkui.css","ui_media_selector.css",window.jsc("web/emoji.js")]).then((()=>Promise.all([__webpack_require__.e(40885),__webpack_require__.e(38288),__webpack_require__.e(17816),__webpack_require__.e(79542),__webpack_require__.e(23299),__webpack_require__.e(8719),__webpack_require__.e(85780)]).then(__webpack_require__.bind(__webpack_require__,869210))))}window.curNotifier||(window.curNotifier={addQueues:{},recvClbks:{},recvData:{},onConnectionId:[]}),window.Notifier={debug:!1,init:function(e){var t;if(!window.curNotifier||!curNotifier.connection_id){if(Notifier.notificationsGc(),window.curNotifier=_extends({},e,{q_events:[],q_prior_events:[],q_shown:[],q_closed:[],q_max:3,q_idle_max:5,negotiations:{},currentIm:{},uiNotifications:[],browser_shown:{},done_events:{},addQueues:curNotifier.addQueues||{},recvClbks:curNotifier.recvClbks||{},recvData:curNotifier.recvData||{},error_timeout:errorTimeout.initialValue,request_timeout:1e3,sound:new Sound("mp3/bb1"),sound_im:new Sound("mp3/bb2"),sound_im_current:new Sound("mp3/bb3"),onConnectionId:[],showDoneBoxLastId:-1}),!this.initFrameTransport())return!1;this.initIdleMan(),this.initCommunityQueues(),IS_SSE_ENABLED||(0,_longpoll_singleton__WEBPACK_IMPORTED_MODULE_21__.lpSingletonOnTabInitialLoaded)(),(curNotifier.cont=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.ge)("notifiers_wrap"))||bodyNode.insertBefore(curNotifier.cont=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.ce)("div",{id:"notifiers_wrap",className:"fixed"}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.ge)("page_wrap"));if(loadVKUIModule(),!(null===(t=window.Calls)||void 0===t?void 0:t.initialized)&&!e.callsIsForbidden){var i,_={callsCredentials:e.callsCredentials,imHash:e.imHash,participantLimit:e.participantLimit,callsOkStaging:e.callsOkStaging,pushToTalkEnabled:e.callsPushToTalkEnabled,toggles:{debugLog:e.callsLogging,incomingCall:e.CallsIncomingCall,allowBanParticipant:e.callsAllowBanParticipant,showFeedbackScreen:e.callsFeedbackScreenEnabled,enableVideoSlots:e.callsVideoSlotsEnabled,videoSlotsCount:e.videoSlotsCount,browserWarnings:e.browserWarnings,allowCallByName:e.callsAllowCallByName,enableScreenTrack:e.callsEnableScreenTrack,enableProducerScreenTrack:e.callsEnableProducerScreenTrack,allowWaitingHall:e.callsAllowWaitingHall,allowPushToTalk:e.callsAllowPushToTalk,badNetwork:e.callsBadNetwork,badNetworkP2P:e.callsBadNetworkP2P,desktopAppNotification:e.callsDesktopAppNotification,enableVirtualBackground:e.callsEnableVirtualBackground,statReports:e.callsStatReports,lazyLoading:e.callsLazyLoading,enableDomainBender:e.callsEnableDomainBender,enableMultipleDevices:e.callsEnableMultipleDevices,enableCalendarPlanning:e.callsEnableCalendarPlanning,enableCalendarPlanningList:e.callsEnableCalendarPlanningList,enableServerAudioRed:e.callsEnableServerAudioRed,enableP2PAudioRed:e.callsEnableP2PAudioRed},onError:e=>{var t=e.msg;return t&&(0,_shared_lib_js_logger__WEBPACK_IMPORTED_MODULE_34__.logError)(t),t&&(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_27__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_9__.getLang)("global_error"),t)},onBeforeCallStart:()=>{Notifier.pauseGlobalMedia()},onAfterCallFinish:()=>{Notifier.resumeGlobalMedia()},tabIsMaster:()=>Notifier.tabIsMaster(),isFriend:e=>!!(window.curFastChat&&window.curFastChat.friends&&window.curFastChat.friends[e+"_"])},o=/(firefox)\/(\d+)\.(\d+)/.test(navigator.userAgent.toLowerCase());if(e.callsLazyLoading&&!o)setHooksForLoadingCalls(_);else window.Calls=null!==(i=window.Calls)&&void 0!==i?i:{},window.Calls.initArgs=_,window.requestIdleCallback((()=>{loadCallsModule().then((()=>{var e,t;null===(e=window.Calls)||void 0===e||null===(t=e.init)||void 0===t||t.call(e,_)}))}))}if((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("mail_longpoll_unread_counter")){var a=Notifier.getLpInstance();a&&a.onData(Notifier.handleUnreadCountChange)}}},handleUnreadCountChange(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];(0,_web_messenger_helpers_events__WEBPACK_IMPORTED_MODULE_33__.compactCounterEvents)(t).forEach((e=>{if(e.type===_shared_im_longpoll_events__WEBPACK_IMPORTED_MODULE_32__.UNREAD_COUNT){var t=e.showOnlyNotMuted,i=e.countNotMuted,_=e.count,o=e.headerNotMutedUnread,a=t?i:_;(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__.handlePageCount)("msg",a,"","",i>0,o)}}))},initCommunityQueues:function(e){var t=ls.get("im_m_comms_key"),i=t&&t.split?t.split(";"):[];if("empty"===i[0]&&i[1]&&Date.now()-i[1]<6e4?t="empty":"empty"===i[0]&&(t=!1),t)return Notifier.proccessCommunityQueues(t,e||0);ajax.post("al_im.php",{act:"a_get_comms_key"},{onDone:function(t){"empty"===t?t+=";"+Date.now():Notifier.proccessCommunityQueues(t,e||0),ls.set("im_m_comms_key",t)},onFail:function(){return!0}})},notificationsGc:function(){curNotifier.uiGcTo=setTimeout((function(){for(var e=curNotifier.uiNotifications,t=[],i=0;i<e.length;i++){var _=e[i];Date.now()-_[1]>1e4?_[0].close():t.push(_)}curNotifier.uiNotifications=t,Notifier.notificationsGc()}),5e3)},resetCommConnection:function(e){var t=ls.get("im_m_comms_key");t&&delete curNotifier.addQueues[t.queue],ls.set("im_m_comms_key",!1),Notifier.initCommunityQueues(e||0)},proccessCommunityQueues:function(e,t){if("empty"===e||!e)return!1;Notifier.addKey(e,(function(e,i){if(i.failed)++t<50&&setTimeout(Notifier.resetCommConnection.pbind(t),100);else{(e=ls.get("im_m_comms_key"))&&(e.ts=i.ts,ls.set("im_m_comms_key",e));var _=i.events;_&&_.map((function(e){return e.split("<!>")})).forEach((function(e){if("update_cnt"===e[1]){var t=e[5],i=e[4];(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__.handlePageCount)("mgid"+t,i)}}))}}))},destroy:function(){if(Notifier.hideAllEvents(),curNotifier.idle_manager.stop(),curNotifier.uiGcTo&&clearTimeout(curNotifier.uiGcTo),curNotifier={},(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.re)("notifiers_wrap"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.re)("queue_transport_wrap"),(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("mail_longpoll_unread_counter")){var e=Notifier.getLpInstance();e&&e.offData(Notifier.handleUnreadCountChange)}},reinit:function(){ajax.post("notifier.php?act=a_get_params",{},{onDone:function(e){e?(errorTimeout.reset(),this.init(e)):(setTimeout(this.reinit.bind(this),1e3*errorTimeout.get()),errorTimeout.increaseMore())}.bind(this),onFail:function(){return setTimeout(this.reinit.bind(this),1e3*errorTimeout.get()),errorTimeout.increaseMore(),!0}.bind(this)})},standby:function(e){this.destroy(),e&&errorTimeout.set(e),setTimeout(this.reinit.bind(this),1e3*errorTimeout.get())},freezeEvents:function(){curNotifier.frozen=!0,curNotifier.unfreezeAfterTooltipHide=!1,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)(curNotifier.q_shown,(function(){clearTimeout(this.fadeTO),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.getStyle)(this.baloonEl,"opacity")<1&&(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_12__.animate)(this.baloonEl,{opacity:1},100)}))},unfreezeEvents:function(){curNotifier.tooltipShown?curNotifier.unfreezeAfterTooltipHide=!0:(curNotifier.frozen=!1,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)(curNotifier.q_shown,(function(e,t){t.timeoutConf?t.fadeTO=setTimeout(t.startFading,(0,_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_17__.hasAccessibilityMode)()?t.timeoutConf.unfreeze_am:t.timeoutConf.unfreeze):t.fadeTO=setTimeout(t.startFading,(0,_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_17__.hasAccessibilityMode)()?3e4:5e3)})))},getTransportWrap:function(){return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.ge)("queue_transport_wrap")||utilsNode.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.ce)("div",{id:"queue_transport_wrap"}))},setFocus:function(e){var t=(e?"1":"0")+curNotifier.instance_id;"frame"===curNotifier.transport&&(Notifier.lcSend("focus",{instance_id:t}),this.onInstanceFocus(t))},initIdleMan:function(){curNotifier.idle_manager&&curNotifier.idle_manager.started||(curNotifier.idle_manager=new _shared_lib_idle_manager__WEBPACK_IMPORTED_MODULE_18__.default({onIdleCb:function(){Notifier.freezeEvents(),Notifier.setFocus(0),cur.onIdle&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)(cur.onIdle,(function(e,t){t()}))},onUnIdleCb:function(){Notifier.unfreezeEvents(),Notifier.setFocus(1),cur.onUnidle&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)(cur.onUnidle,(function(e,t){t()})),FastChat&&FastChat.onUnidle(),vk.spentLastSendTS=Date.now()},id:"window",element:document,focusElement:window}),curNotifier.idle_manager.start())},initFrameTransport:function(){if(!ls.checkVersion()||_shared_lib_browser__WEBPACK_IMPORTED_MODULE_7__.browser.msie8||!("onmessage"in window)&&!("postMessage"in window))return!1;for(var e in curNotifier.connection_id="queue_connection_"+curNotifier.queue_id,curNotifier.lc_prev_value="",curNotifier.is_server=!1,curNotifier.lp_connected=!1,curNotifier.transport="frame",errorTimeout.reset(),this.lcInit(),curNotifier.onConnectionId)curNotifier.onConnectionId[e]();return curNotifier.onConnectionId=[],!0},tabIsMaster:function(){return!(!window.curNotifier||!window.curNotifier.is_server)},tabIsIdle:function(){return!!(curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle)},onActivated:function(){curNotifier.idle_manager&&curNotifier.idle_manager.is_idle?curNotifier.idle_manager.is_idle=!1:curNotifier.idle_manager&&curNotifier.idle_manager.is_idle||Notifier.setFocus(1),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.removeEvent)(document,"mousemove keydown touchstart",Notifier.onActivated)},onConnectionInit:function(){(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.addEvent)(document,"mousemove keydown touchstart",Notifier.onActivated)},onConnectionFailed:function(){},onRelogin:function(){setTimeout((function(){Notifier.standby()}),0)},onMessage:function onMessage(msg){if(!curNotifier.focus_instance||curNotifier.focus_instance==curNotifier.instance_id)try{var events=eval("("+msg+")");Notifier.pushEvents(events)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)(e.message)}},onInstanceFocus:function(e){var t=e.charAt(0);e=e.substr(1),"1"==t?(curNotifier.focus_instance=e,e!=curNotifier.instance_id&&(curNotifier.idle_manager.is_idle||curNotifier.idle_manager.idle(),Notifier.hideAllEvents())):curNotifier.focus_instance==e&&(curNotifier.focus_instance="")},onInstanceServer:function(e){curNotifier.is_server!==!!e&&(curNotifier.is_server=!!e,IS_SSE_ENABLED||(0,_longpoll_singleton__WEBPACK_IMPORTED_MODULE_21__.lpSingletonSyncWithNotifier)(),window.reforgedME&&window.reforgedME.engine&&window.reforgedME.engine.switch(e?"master":"slave"))},getLpInstance:()=>IS_SSE_ENABLED?(window.sseConnect||(window.sseConnect=new _web_components_im_ServerSentEvents_DEPRECATEDLongpollAdapter__WEBPACK_IMPORTED_MODULE_22__.DEPRECATEDLongpollAdapter(window.vk.lpConfig.key,window.vk.lpConfig.ts,window.vk.lpConfig.sseUrl,window.vk.id)),window.sseConnect):(0,_longpoll_singleton__WEBPACK_IMPORTED_MODULE_21__.lpSingletonGetInstance)(),getEventQueueInstance(){if(!window.imEventQueue){var e="im_event_queue";window.imEventQueue=new _shared_im_EventQueue__WEBPACK_IMPORTED_MODULE_30__.EventQueue({getQueue:()=>{var t=()=>(localStorage.removeItem(e),(0,_shared_im_request__WEBPACK_IMPORTED_MODULE_29__.post)("al_im.php",{act:"a_messenger_queue_subscribe"}).then((e=>e[0])).then((t=>(localStorage.setItem(e,JSON.stringify(t)),t))));return Notifier.tabIsMaster()?t():new Promise(((i,_)=>{var o=()=>{if(Notifier.tabIsMaster())return t().then(i).catch(_);var a=localStorage.getItem(e);if(!a)return setTimeout(o,3e3);try{i(JSON.parse(a))}catch(e){_(e)}};o()}))},registerQueue:(t,i)=>{Notifier.addKey(t,((t,_)=>{!(!_.failed&&!_.err)&&Notifier.tabIsMaster()&&localStorage.removeItem(e),i(t,_)}))}})}return window.imEventQueue},pushEvents:function(e,t){var i=0;(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)(e,(function(e,_){i|=Notifier.pushEvent(_,t)})),i&&!ls.get("sound_notify_off")&&curNotifier.is_server&&!1&i&&curNotifier.sound.play()},pushEvent:function pushEvent(ev,cnt){var _window$Emoji,_window$Emoji2;if("nop"!==ev){if("string"==typeof ev)try{ev=JSON.parse(ev)}catch(e){return void(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.logEvalError)(e,ev)}ev.timeoutConf={default:ev.timeout?ev.timeout:NOTIFICATION_FADE_TIMEOUT,default_am:ev.timeout?5*ev.timeout:NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE,unfreeze:ev.timeout?.7*ev.timeout:NOTIFICATION_FADE_TIMEOUT_AFTER_UNFREEZE,unfreeze_am:ev.timeout?4.4*ev.timeout:NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE_AFTER_UNFREEZE};var push=cnt?0:1,push_prioritized=!1;if(ev.version!==curNotifier.version&&-1!==ev.version)return(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)("Notifier old version: "+ev.version+" !== "+curNotifier.version),!1;if("update_cnt"===ev.type){if(ev.add&&ev.add.section){if((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("mail_longpoll_unread_counter")&&"msg"===ev.add.section_id)return 0;(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__.handlePageCount)(ev.add.section_id,ev.add.count,ev.add.section_link,ev.add.section_add)}return 0}if(!curNotifier.done_events[ev.id]){switch(curNotifier.done_events[ev.id]=1,void 0!==ev.top_count&&-1!==ev.top_count&&(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__.handlePageCount)("ntf",ev.top_count),ev.type){case"video_process_ready":if(ev.add.video_raw&&window.Video&&Video.isVideoPlayerOpen(ev.add.video_raw))return;if(ev.add&&window.Video&&Video.isVideoPlayerOpen(ev.add))return;break;case"mail":if((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("mail_longpoll_unread_counter"))break;ev.add&&null!==ev.add.count&&void 0!==ev.add.count&&(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__.handlePageCount)("msg",ev.add.count);break;case"friend_request":ev.add.fr_count?(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__.handlePageCount)("fr",ev.add.fr_count):(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__.handlePageCount)("fr",ev.add);break;case"friend_request_counter":(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__.handlePageCount)("fr",ev.add.fr_count),push=0;break;case"ach_achieved":ev.add.cnt&&(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__.handlePageCount)("ach",ev.add.cnt);break;case"ach_achieved_upd":(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__.handlePageCount)("ach",ev.add),push=0;break;case"group_update_addresses":window.opener&&window.opener.postMessage(ev.add,window.opener.origin),push=0;break;case"bt_upd":if(ev.add.cnt){(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__.handlePageCount)("bt",ev.add.cnt);var bt=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.ge)("bt_tab_updates");bt&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("ui_tab_count",bt),ev.add.cnt>0?ev.add.cnt:"")}break;case"bt_upd_upd":ev.add&&ev.add.section&&(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__.handlePageCount)("bt",ev.add.count,ev.add.section,ev.add.prefix),push=0;var bt=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.ge)("bt_tab_updates");bt&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("ui_tab_count",bt),ev.add>0?ev.add:"");break;case"push_settings":push=0;var muted=JSON.parse(ev.add);curNotifier.mutedPeers=curNotifier.mutedPeers.filter((function(e){return e!==muted.peer_id})),0!==muted.disabled_until&&curNotifier.mutedPeers.push(muted.peer_id);break;case"mail_cnt":if(push=0,(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("mail_longpoll_unread_counter"))break;(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__.handlePageCount)("msg",ev.add);break;case"clear_notify":TopNotifier&&TopNotifier.invalidate(),Notifier.hideAllEvents(),push=0;break;case"support_reply":(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__.handlePageCount)("spr",ev.add,"support",ev.author_id?"act=show&id="+ev.author_id:"act=show"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggle)("l_spr",ev.add>0);break;case"support_cnt":(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__.handlePageCount)("spr",ev.add,"support",ev.author_id?"act=show&id="+ev.author_id:"act=show"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggle)("l_spr",ev.add>0),push=0;break;case"balance_changed":parseInt(ev.add.balance)?(0,_web_lib_utils__WEBPACK_IMPORTED_MODULE_11__.updateMoney)(parseInt(ev.add.balance)):parseInt(ev.add)&&(0,_web_lib_utils__WEBPACK_IMPORTED_MODULE_11__.updateMoney)(parseInt(ev.add));break;case"gift_sent":(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.re)("left_block10_0");var left_block=ev.add;if(left_block){var leftBlocksElem=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.ge)("left_blocks"),left_unpaid_gifts=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.se)(left_block);leftBlocksElem&&(leftBlocksElem.firstChild?leftBlocksElem.insertBefore(left_unpaid_gifts,leftBlocksElem.firstChild):leftBlocksElem.appendChild(left_unpaid_gifts))}break;case"notify_tt":case"login_attempt":if(ev.add.text&&ev.add.key){var evalText=`(${ev.add})`;try{ev.add=eval(evalText),TopNotifier.showTooltip(ev.add.text,ev.add.key)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.logEvalError)(e,evalText)}push=0}break;case"reload_stickers":window.emojiStickers=null,null===(_window$Emoji=window.Emoji)||void 0===_window$Emoji||_window$Emoji.resetStickersCache();case"reload_stickers_keywords":window.stickersKeywordsData=null,ls.remove("stickers_keywords"),null===(_window$Emoji2=window.Emoji)||void 0===_window$Emoji2||_window$Emoji2.updateTabs(),push=0;break;case"any_counter":if(push=0,(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("mail_longpoll_unread_counter")&&"msg"===ev.add.section_id)break;(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_8__.handlePageCount)(ev.add.section_id,ev.add.count,ev.add.link,ev.add.add);break;case"done_box":case"done_box_full":push=0,push_prioritized=!0;break;case _web_market_HappySanta__WEBPACK_IMPORTED_MODULE_28__.MARKET_NOTIFY_ID__HS_MIGRATION_STATE:push=0,(0,_web_market_HappySanta__WEBPACK_IMPORTED_MODULE_28__.onHappySantaMarketMigrationStateChanged)(ev)}if("mail"===ev.type&&(push=this.sendMailNotification(ev)),ev.add&&ev.add.tooltip_text){var html='<div class="notify_tt_wrap">'+(ev.author_photo?`<img class="notify_tt_img" src="${ev.author_photo}" />`:'<div class="notify_tt_thumb"></div>')+'<h4 class="notify_tt_text">'+ev.add.tooltip_text+"</h4></div>";TopNotifier.showTooltip(html,0),push=0}return 1&push&&(curNotifier.q_events.push(ev),curNotifier.q_events.length>30&&curNotifier.q_events.splice(0,curNotifier.q_events.length-30),this.checkEvents()),push_prioritized&&(curNotifier.q_prior_events.push(ev),curNotifier.q_prior_events.length>5&&curNotifier.q_prior_events.splice(0,curNotifier.q_prior_events.length-5),this.checkEvents()),push}}},isActive:function(){return window.curNotifier&&curNotifier.idle_manager&&!curNotifier.idle_manager.is_idle},sendImProxy:function(e){e.text=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.winToUtf)(e.text),curNotifier.browser_shown[e.id]||(curNotifier.browser_shown[e.id]=!0,Notifier.trySendBrowserNotification(e,!0),setTimeout((function(){curNotifier.browser_shown[e.id]=void 0}),2e3))},shouldShowNotification:function(e){return"im"!==cur.module&&!FastChat.isChatOpen(e.author_id)},sendSimpleNotification:function(e){return Notifier.playSound(e),Notifier.shouldShowNotification(e)?3:0},sendBrowserNotification:function(e){"im"!==cur.module?Notifier.negotiate({message:"send_im_notification",onSuccess:function(t){Notifier.lcSend("negotiate_back",{token:t.msg,ev:e})},onFail:function(){Notifier.showBrowserNotification(e)}}):(e.onclick="IMBRIDGE.activateTab("+e.author_id+");",Notifier.showBrowserNotification(e))},shouldPlaySound:function(e){var t=e.add&&e.add.no_sound;return!ls.get("sound_notify_off")&&Notifier.shouldDisturb(e)&&!t},shouldDisturb:e=>!cur.noDisturbMode&&(cur.focused!=e.author_id&&!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.inArray)(e.author_id,cur.mutedPeers)&&!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.inArray)(e.author_id,curNotifier.mutedPeers)),shouldPlayCurrentSound:function(e){return!ls.get("sound_notify_off")&&cur.focused==e.author_id&&(0,_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_17__.hasAccessibilityMode)()&&!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.inArray)(e.author_id,cur.mutedPeers)},playSound:function(e){curNotifier.sound_im&&curNotifier.sound_im.play&&Notifier.shouldPlaySound(e)?e.author_id==cur.peer&&(0,_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_17__.hasAccessibilityMode)()?curNotifier.sound_im_current.play():curNotifier.sound_im.play():Notifier.shouldPlayCurrentSound(e)&&curNotifier.sound_im_current&&curNotifier.sound_im_current.play()},trySendBrowserNotification:function(e,t){Notifier.negotiate({message:"who_is_active",msg:e.author_id,onFail:function(){!Notifier.canNotifyUi()||cur.peer==e.author_id&&Notifier.isActive()?(t||(Notifier.lcSend("show_notification",e),Notifier.shouldShowNotification(e)&&Notifier.showEvent(e,!0)),Notifier.playSound(e)):Notifier.sendBrowserNotification(e)}})},showBrowserNotification:function(e){Notifier.showEventUi(e),Notifier.playSound(e)},proxyIm:function(e){if(this.isActive())return this.playSound(e),void(Notifier.canNotifyUi()&&cur.peer!==e.author_id&&Notifier.shouldDisturb(e)&&(e.onclick="IMBRIDGE.activateTab("+e.author_id+");",Notifier.showEventUi(e)));curNotifier.is_server?(e.onclick="IMBRIDGE.activateTab("+e.author_id+");",this.sendImProxy(e)):curNotifier.is_server||this.lcSend("message_from_im",e)},sendMailNotification:function(e){if(e.add.is_call)return 0;if("im"===cur.module?e.onclick="IMBRIDGE.activateTab('"+e.author_id+"');":(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("mail_fastchat_reforged")?e.onclick=`window.reforgedME && window.reforgedME.selectPeer && window.reforgedME.selectPeer(${(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.intval)(e.author_id)}, 'notifications');`:e.onclick="FastChat.selectPeer('"+e.author_id+"');",this.isActive()&&Notifier.canNotifyUi())this.playSound(e),this.shouldDisturb(e)&&cur.peer!=e.author_id&&this.showEventUi(e);else{if(this.isActive()&&this.shouldDisturb(e))return this.sendSimpleNotification(e);curNotifier.is_server&&this.shouldDisturb(e)&&this.trySendBrowserNotification(e)}return 0},checkEvents:function(){var e;window.curNotifier&&curNotifier.idle_manager&&((!curNotifier.q_events.length||curNotifier.q_shown.length>=(curNotifier.idle_manager.is_idle?curNotifier.q_idle_max:curNotifier.q_max))&&!curNotifier.q_prior_events.length||!curNotifier.idle_manager.is_idle&&curNotifier.frozen||cur.noDisturbMode||(e=curNotifier.q_prior_events.length?curNotifier.q_prior_events.shift():curNotifier.q_events.shift())&&this.showEvent(e))},showEvent:function showEvent(ev,force){"mail"!==ev.type&&Math.random()<.1&&(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_13__.statlogsValueEvent)("feed_top_notify_popup",1,"show",ev.type),curNotifier.q_shown.push(ev);var thumbEl=showEventThumb(ev),addPhoto=showEventAddPhoto(ev);ev.baloonWrapEl=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.ce)("div",{className:"notifier_baloon_wrap",innerHTML:`\n        <div class="notifier_baloon notifier_type_${ev.type}">\n          <div class="notifier_baloon_head clear_fix">\n            <a class="notifier_close_wrap" role="link" title="${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_9__.getLang)("global_close")}" aria-label="${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_9__.getLang)("global_close")}"></a>\n            <h4 class="notifier_baloon_title">${ev.title||""}</h4>\n          </div>\n          <div class="notifier_baloon_body clear_fix">\n            ${thumbEl}\n            ${addPhoto}\n            <div class="notifier_baloon_msg wrapped">${ev.text||""}</div>\n          </div>\n        </div>`}),!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.ge)("notifier_popup_icon_mask")&&ev.icon_type&&(utilsNode.appendChild(document.createElement("div")).outerHTML='<svg style="display: block;" width="0" height="0"><defs><clipPath id="notifier_popup_icon_mask"><path d="M48.254 34.197A9.958 9.958 0 0 0 42 32c-5.523 0-10 4.477-10 10 0 2.367.822 4.542 2.197 6.254A24.934 24.934 0 0 1 25 50C11.193 50 0 38.807 0 25S11.193 0 25 0s25 11.193 25 25c0 3.247-.62 6.35-1.746 9.197z"/></clipPath></defs></svg>'),ev.baloonEl=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("notifier_baloon",ev.baloonWrapEl),ev.closeEl=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("notifier_close_wrap",ev.baloonEl),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.addEvent)(ev.baloonEl,"mouseover mouseout",(function(e){ev.over="mouseover"==e.type,ev.over?Notifier.freezeEvents():Notifier.unfreezeEvents()})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.addEvent)(ev.baloonEl,"mousedown click",(function(event){event=event.originalEvent||event||window.event;var btn=event.which,nohide=!1;if(1==btn&&(event.ctrlKey||_shared_lib_browser__WEBPACK_IMPORTED_MODULE_7__.browser.mac&&event.metaKey)&&(btn=2,_shared_lib_browser__WEBPACK_IMPORTED_MODULE_7__.browser.mac&&(nohide=!0)),"A"!=(event.target||event.srcElement).tagName){switch("mail"!==ev.type&&Math.random()<.1&&(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_13__.statlogsValueEvent)("feed_top_notify_popup",1,"click",ev.type),btn){case 1:try{eval(ev.onclick)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.logEvalError)(e,ev.onclick)}Notifier.trackEvent("click",{event_id:ev.id}),ev.preventHideByClick||Notifier.hideEvent(ev);break;case 2:if(!ev.link)return;var wnd=window.open(ev.link,"_blank");try{wnd.blur(),window.focus()}catch(e){}Notifier.trackEvent("click",{event_id:ev.id}),nohide||Notifier.hideEvent(ev);break;case 3:if(_shared_lib_browser__WEBPACK_IMPORTED_MODULE_7__.browser.mozilla)return}return(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(event)}})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.addEvent)(ev.baloonEl,"contextmenu",(function(e){return setTimeout((function(){Notifier.hideEvent(ev,!1,!1,!0)}),10),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(e)})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.addEvent)(ev.closeEl,"mousedown click",(function(e){return Notifier.hideEvent(ev,!1,!1,!0),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(e)})),ev.startFading=function(){ev.fading=(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_12__.animate)(ev.baloonEl,{opacity:0},1e3,Notifier.hideEvent.bind(Notifier).pbind(ev,!1)),ev.over&&ev.fading.stop()},curNotifier.cont.insertBefore(ev.baloonWrapEl,curNotifier.cont.firstChild);var h=ev.baloonWrapEl.offsetHeight;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.re)(ev.baloonWrapEl),curNotifier.cont.appendChild(ev.baloonWrapEl),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(curNotifier.cont,{bottom:-h}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(ev.baloonWrapEl,{visibility:"visible"}),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_12__.animate)(curNotifier.cont,{bottom:0},200),curNotifier.idle_manager.is_idle&&!force||(ev.timeoutConf?ev.fadeTO=setTimeout(ev.startFading,(0,_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_17__.hasAccessibilityMode)()?ev.timeoutConf.default_am:ev.timeoutConf.default):ev.fadeTO=setTimeout(ev.startFading,(0,_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_17__.hasAccessibilityMode)()?NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE:NOTIFICATION_FADE_TIMEOUT)),(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.isFunction)(ev.tooltipHandler)&&ev.tooltipHandler(ev.baloonWrapEl,{ev,hide:()=>{Notifier.hideEvent(ev,!1,!1,!0)}})},trackEvent:function(e,t){ajax.post("al_feed.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)({act:"a_feedback_track_event",event:e},t||{}))},canNotifyUi:function(){if(window.pushNotifier&&window.pushNotifier.loadEndpoint())return!1;var e="im_notify_flag",t=!ls.get("im_ui_notify_off")&&DesktopNotifications.supported()&&DesktopNotifications.checkPermissionNeeded()<=0;return!ls.get(e)&&t&&ls.set(e,1),t&&!cur.noDisturbMode},showEventUi:function showEventUi(ev){if(!this.canNotifyUi())return!1;var title,text;if("mail"===ev.type){var div=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.ce)("div");div.innerHTML=ev.text,title=div.firstChild.textContent.trim(),text=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.stripHTML)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.replaceEntities)(ev.text.replace(/<br\/?>/g,"\n")).replace(/<span class='notifier_author_quote'.*<\/span>(.*?)/,"$1").replace(/<img.*?alt="(.*?)".*?>/gi,"$1")).replace(/&laquo;|&raquo;/gi,'"').trim()}else title=ev.title,text=ev.text;var notification=ev.uiNotification=DesktopNotifications.createNotification(ev.author_photo,title,text);return curNotifier.uiNotifications.push([notification,Date.now()]),notification.onclick=function(e){if(window.focus(),ev.onclick||("im"===cur.module?ev.onclick="IMBRIDGE.activateTab("+ev.author_id+");":(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("mail_fastchat_reforged")?ev.onclick=`window.reforgedME && window.reforgedME.selectPeer && window.reforgedME.selectPeer(${(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.intval)(ev.author_id)}, 'notifications');`:ev.onclick="FastChat.selectPeer('"+ev.author_id+"');"),"IM"===ev.onclick.substr(0,2)&&"im"!==cur.module)(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("mail_fastchat_reforged")?window.reforgedME&&window.reforgedME.selectPeer&&window.reforgedME.selectPeer((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.intval)(ev.author_id),"notifications"):FastChat.selectPeer((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.intval)(ev.author_id));else try{eval(ev.onclick)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.logEvalError)(e,ev.onclick)}Notifier.hideEvent(ev)},notification.onclose=function(){Notifier.hideEvent(ev,!0)},notification.show(),ev.closeTO=setTimeout(Notifier.hideEvent.bind(Notifier).pbind(ev),5e3),!0},hideEvent:function(e,t,i,_){clearTimeout(e.closeTO),clearTimeout(e.fadeTO),e.fading&&e.fading.stop();var o,a=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.indexOf)(curNotifier.q_shown,e);-1!=a&&curNotifier.q_shown.splice(a,1),Notifier.unfreezeEvents(),t||(e.baloonWrapEl?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.cleanElems)(e.closeEl,e.baloonEl),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.re)(e.baloonWrapEl)):e.uiNotification&&e.uiNotification.cancel()),!0===_&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.isArray)(curNotifier.q_closed)&&(curNotifier.q_closed.unshift((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.vkNow)()),(o=curNotifier.q_closed.length)>3&&(curNotifier.q_closed.splice(3,o-3),o=3),3==o&&curNotifier.q_closed[0]-curNotifier.q_closed[2]<700&&Notifier.hideAllEvents()),-1!=_&&this.checkEvents(),"frame"!=curNotifier.transport||i||this.lcSend("hide",{event_id:e.id}),!0!==_&&curNotifier.idle_manager.is_idle||curNotifier.q_events.length||curNotifier.q_shown.length||ajax.post("notifier.php",{act:"a_clear_notifier"}),(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.isFunction)(e.onHide)&&e.onHide()},hideAllEvents:function(){curNotifier.q_events=[],(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.clone)(curNotifier.q_shown),(function(){Notifier.hideEvent(this,!1,!0,-1)})),curNotifier.q_shown=[],curNotifier.q_closed=[]},onEventHide:function(e){e&&((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)(curNotifier.q_shown,(function(){if(this.id==e)return Notifier.hideEvent(this,!1,!0),!1})),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)(curNotifier.q_events,(function(t){if(this.id==e)return curNotifier.q_events.splice(t,1),!1})))},lcInit:function(){(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.addEvent)(window,"storage",this.lcOnStorage.bind(this)),this.lcStart()},lcStart:function(){Notifier.lcCheckServer()?this.lcServer():(this.lcSend("check"),clearTimeout(curNotifier.becomeServerTO),curNotifier.becomeServerTO=setTimeout(this.lcServer.bind(this).pbind(!0),500)),curNotifier.checkServerInt=setInterval(function(){curNotifier.is_server||(curNotifier.idle_manager&&!curNotifier.idle_manager.is_idle&&curNotifier.idle_manager.getActiveTime()>ACTIVE_TAB_SWITCH_SERVER_TIMEOUT&&(Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)("this tab wants to become server"),ls.set(LC_SERVER_SWITCH_TO_ACTIVE_FLAG,!0),this.lcServer(!0)),(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.vkNow)()-curNotifier.last_succ>8e3&&Notifier.lcCheckServer()&&(Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)("timeout"),this.lcServer(!0)))}.bind(this),1e3+(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.intval)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.rand)(-100,100))),curNotifier.isServerBroadcastInt=setInterval(function(){curNotifier.is_server&&(Notifier.lcCheckServer()?this.lcSend("check_ok"):(Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)("no server from server broadcast"),this.lcNoServer()))}.bind(this),5e3+(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.intval)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.rand)(-100,100)));var e=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("top_convo_list"),t=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("mail_fastchat_reforged");t||void 0!==curNotifier.fc&&window.stManager.add([window.jsc("web/emoji.js")],(function(){FastChat.init(curNotifier.fc)})),(t||e)&&loadReforgedFastchatModule().then((()=>{window.reforgedME.init({fcEnabled:t,tclEnabled:e,silentModules:curNotifier.fastchatsSilentModules||[]})}))},lcStop:function(){clearInterval(curNotifier.isServerBroadcastInt),clearInterval(curNotifier.checkServerInt),clearTimeout(curNotifier.becomeServerTO)},lcSend:function(e,t){if(!curNotifier.connection_id)return curNotifier.onConnectionId&&curNotifier.onConnectionId.push(Notifier.lcSend.pbind(e,t)),!1;Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)(curNotifier.instance_id+": sending",e,t||"");var i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)({__client:curNotifier.instance_id,__act:e,__rnd:Math.random()},t||{});if(curNotifier.post_message)try{curNotifier.storage_frame.postMessage(curNotifier.connection_id+":"+JSON.stringify(i),curNotifier.storage_frame_origin)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)(e,e.message,e.stack)}else ls.set(curNotifier.connection_id,i)},lcRecv:function(e){if(e&&!(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.isEmpty)(e)&&e.__client!=curNotifier.instance_id){var t=e.__act;switch(delete e.__client,delete e.__act,delete e.__rnd,Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)(curNotifier.instance_id+": recv",t,e),t){case"new_server":curNotifier.last_succ=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.vkNow)()+1e3;break;case"feed":curNotifier.timestamp=e.ts,curNotifier.key=e.key,Notifier.pushEvents(e.events,!e.full);break;case"addfeed":Notifier.addFeed(e[0],e[1]);break;case"new_key":(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)("new key",e),curNotifier.timestamp=e.ts,curNotifier.key=e.key;break;case"new_addkey":var i=(0,_notifier_utils__WEBPACK_IMPORTED_MODULE_36__.subscriptionObjectStableId)(e),_=curNotifier.addQueues[i],o=!_&&curNotifier.is_server;_?_[0]=Date.now():curNotifier.addQueues[i]=[Date.now(),e.ts,e.key],o&&Notifier.lpReset(Notifier.lpCheck.bind(Notifier));break;case"clear_addkeys":curNotifier.addQueues={};break;case"check_ok":curNotifier.last_succ=Date.now(),curNotifier.becomeServerTO&&(clearTimeout(curNotifier.becomeServerTO),curNotifier.becomeServerTO=!1),curNotifier.lp_connected||(curNotifier.lp_connected=!0,Notifier.onConnectionInit());break;case"focus":Notifier.onInstanceFocus(e.instance_id);break;case"hide":Notifier.onEventHide(e.event_id);break;case"check_playlist":var a=ls.get("pad_playlist");a&&a.instance==curNotifier.instance_id&&ls.set("pad_pltime",(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.vkNow)());break;case"who_is_active":Notifier.isActive()&&((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.intval)(e.msg)>2e9&&"im"===cur.module||(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.intval)(e.msg)<2e9)&&this.lcSend("negotiate_back",e);break;case"show_notification":Notifier.shouldShowNotification(e)&&Notifier.showEvent(e,!0);break;case"send_im_notification":if("im"===cur.module){var r=Notifier.createNegotiationSlot({onSuccess:function(e){e.ev.onclick="IMBRIDGE.activateTab("+e.ev.author_id+");",Notifier.showBrowserNotification(e.ev)}});Notifier.lcSend("negotiate_back",{msg:r.token,token:e.token})}break;case"negotiate_back":Notifier.endNegotiation(e);break;case"recent_emoji_set":window.Emoji&&Emoji.setRecentEmojiList(e);break;case"lp_data":IS_SSE_ENABLED||(0,_longpoll_singleton__WEBPACK_IMPORTED_MODULE_21__.lpSingletonOnNotifierRecv)(e);break;default:if(curNotifier.recvClbks&&curNotifier.recvClbks[t])for(var n in curNotifier.recvClbks[t])curNotifier.recvClbks[t][n](e);else curNotifier.recvData[t]=e}if(curNotifier.is_server)switch(t){case"new_server":case"new_key":case"check_ok":Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)("no server from lcRecv",t),Notifier.lcNoServer();break;case"check":this.lcSend("check_ok");break;case"message_from_im":Notifier.sendImProxy(e)}}},negotiate:function(e){e=this.createNegotiationSlot(e),this.lcSend(e.message,{token:e.token,msg:e.msg})},createNegotiationSlot:function(e){var t="negotiations_"+Date.now()+Math.round((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.rand)(0,1e4));return e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)({timeout:3e3,token:t,msg:""},e),curNotifier.negotiations[e.token]={},curNotifier.negotiations[e.token].timer=setTimeout((function(){e.onFail&&e.onFail(),curNotifier.negotiations[e.token]&&(curNotifier.negotiations[e.token]=void 0)}),e.timeout),curNotifier.negotiations[e.token].success=e.onSuccess,e},endNegotiation:function(e){var t=e.token,i=curNotifier.negotiations[t];i&&(clearTimeout(i.timer),curNotifier.negotiations[t].success&&curNotifier.negotiations[t].success(e),curNotifier.negotiations[t]=void 0)},lcOnStorage:function(e){e=e||window.event,Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)("onstorage",e.key,e.newValue,e);var t=e.key,i=e.newValue;if(i){if(t){if(e.key!=curNotifier.connection_id)return}else{if(t=curNotifier.connection_id,(i=localStorage.getItem(t))==curNotifier.lc_prev_value)return;curNotifier.lc_prev_value=i}this.lcRecv(JSON.parse(i)||{})}},lcServer:function(e){Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)("becoming server"),this.lpInit(),this.lcSend("new_server"),Notifier.lcCheckServer(!0),Notifier.onInstanceServer(1),curNotifier.lp_connected||(curNotifier.lp_connected=!0,Notifier.onConnectionInit()),this.lpStop(),e?this.lpReset(this.lpStart.bind(this)):this.lpStart()},lcNoServer:function(){this.lpStop(),curNotifier.is_server&&(Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)("not server now"),this.onInstanceServer(0))},lcCheckServer:function(e){var t,i="server_"+curNotifier.connection_id,_=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.vkNow)();return!(!e&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.isArray)(t=ls.get(i))&&t[0]!=curNotifier.instance_id&&_-t[1]<8e3)&&(ls.set(i,[curNotifier.instance_id,_]),!0)},lpInit:function(){curNotifier.lpMakeRequest||(delete curNotifier.lpMakeRequest,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.re)("queue_transport_frame"),Notifier.getTransportWrap().appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.ce)("iframe",{id:"queue_transport_frame",name:"queue_transport_frame",src:curNotifier.frame_path})))},lpStart:function(){curNotifier.lp_started=!0,curNotifier.lpInvalid?Notifier.lpGetKey():Notifier.lpCheck()},lpStop:function(){curNotifier.lp_started=!1,clearTimeout(curNotifier.lp_check_to),clearTimeout(curNotifier.lp_error_to),clearTimeout(curNotifier.lp_req_check_to)},lpCheck:function lpCheck(){if(curNotifier.lp_started&&!curNotifier.lpActive&&!curNotifier.lpInvalid){if(!curNotifier.lpMakeRequest)return clearTimeout(curNotifier.lp_check_to),void(curNotifier.lp_check_to=setTimeout(this.lpCheck.bind(this),1e3));if(!Notifier.lcCheckServer())return Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)("no server from check"),void this.lcNoServer();var now=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.vkNow)(),add_queues=[],completed=!1,params={act:"a_check",ts:curNotifier.timestamp,key:curNotifier.key,id:curNotifier.uid,wait:25};(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)(curNotifier.addQueues,(function(e,t){if(now-t[0]>3e4&&!e.match(/nccts/))return(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)("drop key",e,now-t[0]),void delete curNotifier.addQueues[e];add_queues.push(e),params.ts+="_"+t[1],params.key+=t[2]}));var onFail=function(){completed||(completed=!0,curNotifier.lpActive=!1,clearTimeout(curNotifier.lp_req_check_to),clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(this.lpCheck.bind(this),1e3*errorTimeout.get()+(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.irand)(1e3,1e4)),errorTimeout.increase())}.bind(this);curNotifier.lpActive=!0,clearTimeout(curNotifier.lp_req_check_to),curNotifier.lp_req_check_to=setTimeout(onFail,1e3*(params.wait+5)),curNotifier.lpMakeRequest(curNotifier.frame_url,params,function(text){if(!completed&&(completed=!0,curNotifier.lpActive=!1,curNotifier.lp_started)){this.lcSend("check_ok");try{var response=eval("("+text+")"),main_response=response,add_response,add_queue,busy=0;if((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.isArray)(response))for(main_response=response.shift();(add_response=response.shift())&&(add_queue=add_queues.shift(),add_queue);)2!=add_response.failed||4!=add_response.err?(this.lcSend("addfeed",[add_queue,add_response]),this.addFeed(add_queue,add_response),add_response.failed&&delete curNotifier.addQueues[add_queue]):(Notifier.debug&&(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)("!!notifier key busy!! "+curNotifier.instance_id),busy|=1);else if(response.failed){for(;add_queue=add_queues.shift();)this.lcSend("addfeed",[add_queue,response]),this.addFeed(add_queue,response),delete curNotifier.addQueues[add_queue];this.lcSend("clear_addkeys")}switch(this.lpChecked(main_response)){case 0:break;case 1:default:return;case 2:busy|=2}busy?ls.get(LC_SERVER_SWITCH_TO_ACTIVE_FLAG)?ls.remove(LC_SERVER_SWITCH_TO_ACTIVE_FLAG):this.lcNoServer():(clearTimeout(curNotifier.lpCheckTO),curNotifier.lpCheckTO=setTimeout(this.lpCheck.bind(this),curNotifier.request_timeout||1e3),errorTimeout.decrease())}catch(e){text&&-1==text.indexOf("Ad Muncher")&&((0,_web_lib_ui_util__WEBPACK_IMPORTED_MODULE_10__.topError)("Notifier error: "+e.message,{dt:-1,type:5,stack:e.stack,answer:text+"\n\nbusy:"+busy+"\nserver:"+curNotifier.is_server+"\ninstance:"+curNotifier.instance_id,url:curNotifier.frame_url,query:params&&(0,_shared_lib_convert__WEBPACK_IMPORTED_MODULE_19__.toQueryString)(params)}),(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)(e.message,e.stack,e)),clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(this.lpCheck.bind(this),1e3*errorTimeout.get()),errorTimeout.increase()}}}.bind(this),onFail)}},lpChecked:function(e){if(2==e.failed)return 4==e.err?2:((0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)("notifier lpCheck error",e),curNotifier.lpInvalid=!0,clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(this.lpGetKey.bind(this),1e3*errorTimeout.get()),errorTimeout.increase(),1==e.err?1:3);if(e.failed)throw new Error((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_9__.getLang)("global_unknown_error"));return this.lcSend("feed",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)({full:curNotifier.idle_manager&&curNotifier.idle_manager.is_idle&&!this.canNotifyUi(),key:curNotifier.key},e)),curNotifier.timestamp=e.ts,Notifier.pushEvents(e.events),0},lpOnReset:function(){curNotifier.lpOnReset&&curNotifier.lpOnReset()},lpReset:function(e){curNotifier.lpOnReset=e,clearTimeout(curNotifier.resetTO),curNotifier.resetTO=setTimeout((function(){if(!curNotifier.is_server||curNotifier.lp_started){if(curNotifier.lpMakeRequest&&!curNotifier.lpInvalid){var e=curNotifier.key,t=curNotifier.timestamp;return(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)(curNotifier.addQueues,(function(i,_){e+=_[2],t+="_"+_[1]})),void curNotifier.lpMakeRequest(curNotifier.frame_url,{act:"a_release",key:e,ts:t,id:curNotifier.uid,wait:25},Notifier.lpOnReset,Notifier.lpOnReset)}ajax.post("notifier.php?act=a_reset",!1,{onDone:Notifier.lpOnReset,onFail:function(){return Notifier.lpOnReset(),!0}})}else Notifier.lpStart()}),100)},lpGetKey:function(){ajax.post("notifier.php?act=a_get_key",{id:curNotifier.uid,hash:curNotifier.notifierHash},{onDone:function(e,t){curNotifier.timestamp=t,curNotifier.key=e,curNotifier.lpInvalid=!1,(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)("notifier lpGetKey done"),this.lcSend("new_key",{ts:t,key:e}),this.lpCheck()}.bind(this),onFail:function(e){switch((0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)("notifier lpGetKey fail",e),e){case 1:case 3:return void Notifier.standby();case 4:return void Notifier.standby(300);case 2:return void Notifier.onRelogin();default:return errorTimeout.set(64),clearTimeout(this.lp_error_to),this.lp_error_to=setTimeout(this.lpGetKey.bind(this),1e3*errorTimeout.get()),!0}}.bind(this)})},addKey:function(e,t,i){var _;if(!e||!(null===(_=window.curNotifier)||void 0===_?void 0:_.addQueues))return!1;var o=(0,_notifier_utils__WEBPACK_IMPORTED_MODULE_36__.subscriptionObjectStableId)(e),a=curNotifier.addQueues[o],r=!a&&curNotifier.is_server;return a?(a[0]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.vkNow)(),a[3]=t,a[4]=i):curNotifier.addQueues[o]=[(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.vkNow)(),e.ts,e.key,t,i],i||Notifier.lcSend("new_addkey",e),r&&Notifier.lpReset(Notifier.lpCheck.bind(Notifier)),!0},addFeed:function(e,t){var i,_,o=null===(i=window.curNotifier)||void 0===i||null===(_=i.addQueues)||void 0===_?void 0:_[e];(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.isArray)(o)&&o.length&&(o[1]=t.ts,(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_20__.isFunction)(o[3])&&o[3](e,t))},addRecvClbk:function(e,t,i,_){curNotifier.recvClbks||(curNotifier.recvClbks={}),curNotifier.recvClbks[e]||(curNotifier.recvClbks[e]={}),curNotifier.recvClbks[e][t]&&!_||(curNotifier.recvClbks[e][t]=i)},setRecvClbk:function(e,t){curNotifier.recvClbks||(curNotifier.recvClbks={}),curNotifier.recvClbks[e]=[t]},fixPhoto:function(e,t){return-1===(e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.clean)(e)).indexOf("question_c.gif")?e:t?"/images/question_inv_xc.png":"/images/question_inv_c.png"},pauseGlobalMedia:function(){var e=!!(0,_shared_lib_site__WEBPACK_IMPORTED_MODULE_24__.isMvk)(),t=e?audio:(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_25__.getAudioPlayer)(),i=window.Videoview;isMediaStoppedByCalls=!0,Notifier.lcSend("video_start"),!e&&t&&t.isPlaying()&&(t.pause(),t.pausedByCalls=!0),!e&&i&&(i.togglePlay(!1),i.pausedByCalls=!0),e&&t.playing&&t.playing()&&(t.pause(),t.pausedByCalls=!0)},resumeGlobalMedia:function(){var e=!!(0,_shared_lib_site__WEBPACK_IMPORTED_MODULE_24__.isMvk)(),t=e?audio:(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_25__.getAudioPlayer)(),i=window.Videoview;isMediaStoppedByCalls&&(isMediaStoppedByCalls=!1,Notifier.lcSend("video_hide")),!e&&t&&t.pausedByCalls&&(t.play(),delete t.pausedByCalls),!e&&i&&i.pausedByCalls&&(i.togglePlay(!0),delete i.pausedByCalls),e&&t&&t.pausedByCalls&&((0,_shared_audio_utils_wrapAudioPlay__WEBPACK_IMPORTED_MODULE_26__.wrapAudioPlay)(t).catch((()=>{})),delete window.audio.pausedByCalls)}}},262928:(e,t,i)=>{var _=i(386409),o=i(726271),a=i(635676),r=i(49535),n=i(315544),s=i(695724),c=i(40906);window.curRBox||(window.curRBox={guid:0,active:!1,focused:[],tabs:{}});function l(e,t){var i=this;i.options=t=(0,s.extend)({minH:50,minW:50},t),i.content=e;var a=i.id="rb_box_"+(t.id||curRBox.guid++);i.wrap=(0,n.ce)("div",{id:a,className:"rb_box_wrap fixed"+(t.fixed?" fc_fixed":"")}),i.wrap.innerHTML+='<div class="tt-fastchat-wrap"></div>';var c={};i.toBottom=i.toRight=!1,t.fixed?(c.bottom=0,c.right=72):(void 0!==t.startTop?c.top=t.startTop:void 0!==t.startBottom&&(c.bottom=t.startBottom),void 0!==t.startLeft?c.left=t.startLeft:void 0!==t.startRight&&(c.right=t.startRight)),(0,n.setStyle)(i.wrap,c),t.movable&&(0,r.addEvent)(t.movable,"mousedown",i._head_mdown.bind(i)),i.resizeableH=t.resizeableH||e,t.startHeight&&(0,n.setStyle)(i.resizeableH,"height",t.startHeight),i.resizeableW=t.resizeableW||e,t.startWidth&&(0,n.setStyle)(i.resizeableW,"width",t.startWidth),(0,r.addEvent)(e,"mousedown",i._cont_mdown.bind(i)),t.closer&&((0,r.addEvent)(t.closer,"mousedown",i._close_mdown.bind(i)),(0,r.addEvent)(t.closer,"click",i._close_click.bind(i))),t.hider&&((0,r.addEvent)(t.hider,"mousedown",i._close_mdown.bind(i)),(0,r.addEvent)(t.hider,"click",i._hide_click.bind(i))),t.minimizer&&!0!==t.minimizer&&((0,r.addEvent)(t.minimizer,"mousedown",i._close_mdown.bind(i)),(0,r.addEvent)(t.minimizer,"click",i._min_toggle.bind(i))),i.wrap.appendChild(e),!1!==t.resize&&(i.resizeWrap=(0,n.ce)("div",{className:"rb_resize_wrap",innerHTML:'<div class="chats_sp rb_resize"></div>'}),i.wrap.appendChild(i.resizeWrap),(0,r.addEvent)(i.resizeWrap,"mousedown",i._resize_mdown.bind(i))),t.minimized&&((0,n.addClass)(i.wrap,"rb_minimized"),i.minimized=!0),bodyNode.insertBefore(i.wrap,(0,n.ge)("page_wrap"));var l=(0,n.getStyle)(i.wrap,"top"),d=(0,n.getStyle)(i.wrap,"bottom"),u=(0,n.getStyle)(i.wrap,"left"),f=(0,n.getStyle)(i.wrap,"right");this.toBottom=("auto"===l||""===l||o.browser.msie&&0===l)&&"auto"!=d&&""!==d&&!(o.browser.msie&&0===d),this.toRight=("auto"===u||""===u||o.browser.msie&&0===u)&&"auto"!=f&&""!==f&&!(o.browser.msie&&0===f),this.toRight&&(0,n.setStyle)(i.wrap,{marginRight:lastWndScroll[0]?(0,_.sbWidth)():0}),(t.nofocus||t.noshow)&&(0,n.addClass)(i.wrap,"rb_inactive"),this.toBottom&&((0,n.setStyle)(i.wrap,{marginRight:lastWndScroll[0]?(0,_.sbWidth)():0}),(0,n.addClass)(i.wrap,"fc_tobottom")),this.options.marginFixedToLayer&&(0,n.setStyle)(i.wrap,{marginRight:(0,n.hasClass)(document.body,"layers_shown")?(0,_.sbWidth)():0}),curRBox.tabs[a]=i,i.pos=!1,t.noshow?((0,n.setStyle)(i.wrap,{visibility:"hidden",display:"block"}),i._update_pos(),(0,n.setStyle)(i.wrap,{visibility:"",display:""})):i.show(!1,t.nofocus)}(0,s.extend)(l.prototype,{show:function(e,t){var i=this;void 0===e&&(e=0),e?((0,n.setStyle)(i.wrap,{opacity:0,display:"block"}),i.visible=!0,!t&&i.focus(),(0,a.animate)(i.wrap,{opacity:1},e,(function(){(0,n.setStyle)(i.wrap,o.browser.msie?{filter:"none"}:{opacity:""}),i._update_pos()}))):((0,n.show)(i.wrap),i.visible=!0,!t&&i.focus(),i._update_pos()),i.options.onShow&&i.options.onShow()},hide:function(e,t,i){var _=this;if(!t&&_.options.onBeforeHide&&_.options.onBeforeHide())return!0;void 0===e&&(e=0),e?((0,n.setStyle)(_.wrap,{opacity:1,display:"block"}),(0,a.animate)(_.wrap,{opacity:0},e,(function(){(0,n.hide)(_.wrap),(0,n.setStyle)(_.wrap,o.browser.msie?{filter:"none"}:{opacity:""})}))):(0,n.hide)(_.wrap),_.visible=!1,!t&&_.options.onHide&&_.options.onHide(i||{})},_head_mdown:function(e){if(!(0,r.checkEvent)(e)){(e.originalEvent||e).cancelBubble=!0;var t,i,a=this,c=e.target,l=getWndInner(),d=curRBox.active==a.id,u=e.pageY,f=e.pageX,h=a.wrap.offsetHeight,p=a.wrap.offsetWidth,b=0,E=0,C=l[0]-h,m=l[1]-p,g=o.browser.msie?"selectstart":"mousedown";a.options.fixed&&FastChat.pinTab(a.options.peer||-1,e,!0),d||a.focus(e),a.toBottom?(a.toBottom=!1,t=l[0]-(0,s.intval)((0,n.getStyle)(a.wrap,"bottom"))-h,(0,n.setStyle)(a.wrap,{top:t,bottom:"auto"}),(0,n.removeClass)(a.wrap,"fc_tobottom")):t=(0,s.intval)((0,n.getStyle)(a.wrap,"top")),a.toRight?(a.toRight=!1,i=l[1]-(0,s.intval)((0,n.getStyle)(a.wrap,"right"))-p,(0,n.setStyle)(a.wrap,{left:i,right:"auto"})):i=(0,s.intval)((0,n.getStyle)(a.wrap,"left")),b=t,E=i,cur._fcdrag=1;var v=function(e){return b=Math.max(0,Math.min(C,t+e.pageY-u)),C-b<10?b=C:b<10&&(b=0),a.wrap.style.top=b+"px",E=Math.max(0,Math.min(m,i+e.pageX-f)),m-E<10?E=m:E<10&&(E=0),a.wrap.style.left=E+"px",(0,r.cancelEvent)(e)};return(0,r.addEvent)(document,"mousemove",v),(0,r.addEvent)(document,"mouseup",(function e(t){cur._fcdrag=0,(0,r.removeEvent)(document,"mousemove",v),(0,r.removeEvent)(document,"mouseup",e),(0,r.removeEvent)(document,g,r.cancelEvent),(0,n.setStyle)(bodyNode,"cursor",""),(0,n.setStyle)(c,"cursor",""),(a.toBottom=b>=C-5)&&((0,n.setStyle)(a.wrap,{top:"auto",bottom:0}),(0,n.addClass)(a.wrap,"fc_tobottom")),(a.toRight=E>=m-5)&&(0,n.setStyle)(a.wrap,{left:"auto",right:0,marginRight:lastWndScroll[0]?(0,_.sbWidth)():0}),a._update_pos();var i=Math.abs(t.pageY-u)<3&&Math.abs(t.pageX-f)<3;cur._fcpromo>0?cur._fcpromo=i?0:-1:a.options.minimizer&&i?!a.minimized&&d?a.minimize(!0):a.minimized&&a.unminimize(!0):a.options.onDragEnd&&a.options.onDragEnd(a.toBottom?-1:b/l[0],a.toRight?-1:E/l[1])})),(0,r.addEvent)(document,g,r.cancelEvent),(0,n.setStyle)(bodyNode,"cursor","move"),(0,n.setStyle)(c,"cursor","move"),!1}},_resize_mdown:function(e){if(!(0,r.checkEvent)(e)){this.focus(e);var t,i,a=this,c=e.target,l=getWndInner(),d=e.pageY,u=e.pageX,f=a.wrap.offsetHeight,h=a.wrap.offsetWidth,p=0,b=0,E=a.resizeableH.clientHeight-(0,s.intval)((0,n.getStyle)(a.resizeableH,"paddingBottom"))-(0,s.intval)((0,n.getStyle)(a.resizeableH,"paddingTop")),C=a.resizeableW.clientWidth-(0,s.intval)((0,n.getStyle)(a.resizeableW,"paddingRight"))-(0,s.intval)((0,n.getStyle)(a.resizeableW,"paddingLeft")),m=o.browser.msie?"selectstart":"mousedown",g=!o.browser.msie&&a.options.onResize||!1;a.toBottom?(a.toBottom=!1,t=l[0]-(0,s.intval)((0,n.getStyle)(a.wrap,"bottom"))-f,(0,n.setStyle)(a.wrap,{top:t,bottom:"auto"}),(0,n.removeClass)(a.wrap,"fc_tobottom")):t=(0,s.intval)((0,n.getStyle)(a.wrap,"top")),a.toRight?(a.toRight=!1,i=l[1]-(0,s.intval)((0,n.getStyle)(a.wrap,"right"))-h,(0,n.setStyle)(a.wrap,{left:i,right:"auto"})):i=(0,s.intval)((0,n.getStyle)(a.wrap,"left")),a.options.onResizeStart&&a.options.onResizeStart(E,C);var v=E+l[0]-t-f,w=C+l[1]-i-h,M=function(e){return p=Math.max(a.options.minH,Math.min(v,E+e.pageY-d)),v-p<10&&(p=v),a.resizeableH.style.height=p+"px",b=Math.max(a.options.minW,Math.min(w,C+e.pageX-u)),w-b<10&&(b=w),a.resizeableW.style.width=b+"px",g&&g(p,b),(0,r.cancelEvent)(e)};return(0,r.addEvent)(document,"mousemove",M),(0,r.addEvent)(document,"mouseup",(function e(t){(0,r.removeEvent)(document,"mousemove",M),(0,r.removeEvent)(document,"mouseup",e),(0,r.removeEvent)(document,m,r.cancelEvent),(0,n.setStyle)(bodyNode,"cursor",""),(0,n.setStyle)(c,"cursor",""),(a.toBottom=p==v)&&((0,n.setStyle)(a.wrap,{top:"auto",bottom:0}),(0,n.addClass)(a.wrap,"fc_tobottom")),(a.toRight=b==w)&&(0,n.setStyle)(a.wrap,{left:"auto",right:0,marginRight:lastWndScroll[0]?(0,_.sbWidth)():0}),a._update_pos(),a.options.onResizeEnd&&a.options.onResizeEnd(p,b,l[0],l[1],a.toBottom,a.toRight)})),(0,r.addEvent)(document,m,r.cancelEvent),(0,n.setStyle)(bodyNode,"cursor","move"),(0,n.setStyle)(c,"cursor","move"),!1}},_update_pos:function(){var e=this;e.pos=[e.wrap.offsetTop,e.wrap.offsetLeft,e.wrap.offsetHeight,e.wrap.offsetWidth]},_wnd_resize:function(e,t,i){var _=this;_.toBottom&&(_.pos[0]=_.wrap.offsetTop),_.toRight&&(_.pos[1]=_.wrap.offsetLeft);var o={},a=!1,r=!1,s=_.pos[0]+_.pos[2]-e,c=_.pos[0],l=_.resizeableH.clientHeight-_.options.minH,d=_.pos[1]+_.pos[3]-t,u=_.pos[1],f=!1!==_.options.resize?_.resizeableW.clientWidth-_.options.minW:0;i&&(f<0&&(0,n.setStyle)(_.resizeableW,_.options.minW),l<0&&(0,n.setStyle)(_.resizeableH,_.options.minH)),(s<=0||c<=0&&l<=0)&&(d<=0||u<=0&&f<=0)||(s>0&&c>0&&(s-=c=Math.min(s,c),o.top=_.pos[0]-c,o.bottom=""),s>0&&l>0&&(l=Math.min(s,l),a=_.resizeableH.clientHeight-l),d>0&&u>0&&(d-=u=Math.min(d,u),o.left=_.pos[1]-u,o.right=""),d>0&&f>0&&(f=Math.min(d,f),r=_.resizeableW.clientWidth-f),!1!==r&&(0,n.setStyle)(_.resizeableW,"width",r),!1!==a&&(0,n.setStyle)(_.resizeableH,"height",a),(0,n.setStyle)(_.wrap,o),_._update_pos(),_.options.onResize&&_.options.onResize(_.resizeableH.clientHeight,_.resizeableW.clientWidth))},_cont_mdown:function(e){if(curRBox.active!=this.id&&(this.focus(e),!(0,n.hasClass)(e.target,"fc_editable")))return(0,r.cancelEvent)(e)},_focus:function(){var e=this,t=(0,s.indexOf)(curRBox.focused,e.id),i=curRBox.active,_=i&&curRBox.tabs[i];if(i!=e.id){_&&(0,c.isFunction)(_.options.onBlur)&&_.options.onBlur(),-1!=t&&curRBox.focused.splice(t,1),curRBox.focused.unshift(e.id);var o=1e4+curRBox.focused.length,a=!0;(0,s.each)(curRBox.focused,(function(e,t){var i=curRBox.tabs[t].wrap;a?((0,n.addClass)(i,"rb_active"),(0,n.removeClass)(i,"rb_inactive"),curRBox.active=t,a=!1):((0,n.removeClass)(i,"rb_active"),(0,n.addClass)(i,"rb_inactive")),(0,n.setStyle)(i,"zIndex",o),o--}))}},_hide_click:function(){this.hide()},minimize:function(e){var t=this,i=t.wrap;if(t.options.fixed)return!1;(0,n.addClass)(i,"rb_minimized"),t.minimized=!0,t._update_pos(),e&&t.options.onMinimize&&t.options.onMinimize(0)},unminimize:function(e){var t=this,i=t.wrap,_=getWndInner();(0,n.removeClass)(i,"rb_minimized"),t.minimized=!1,t._update_pos(),t._wnd_resize(_[0],_[1],!0),curRBox.active=!1,t.focus(),e&&t.options.onMinimize&&t.options.onMinimize(1)},_min_toggle:function(e){var t=this;setTimeout((function(){t.minimized?t.unminimize(!0):t.minimize(!0)}),50)},destroy:function(){var e=this,t=(0,s.indexOf)(curRBox.focused,e.id);-1!=t&&curRBox.focused.splice(t,1),(0,n.cleanElems)(e.wrap,e.resizeWrap,e.content,e.options.movable,e.options.closer,e.options.hider),(0,n.re)(e.wrap),delete curRBox.tabs[e.id]},_close_mdown:function(e){(e.originalEvent||e).cancelBubble=!0},_close_click:function(e){this.close()},_close:function(e){this.destroy(),curRBox.focused[0]&&!0!==e&&curRBox.tabs[curRBox.focused[0]].focus()},focus:function(e){var t=this,i=curRBox.active!=t.id||!0;return t._focus(),i&&(0,c.isFunction)(t.options.onFocus)&&t.options.onFocus(e),i},close:function(){var e=this,t=e.pos;e._close(),(0,c.isFunction)(e.options.onClose)&&e.options.onClose(t)}}),window.RBox=l},624817:(e,t,i)=>{var _=i(315544),o=i(726271),a=i(787481);function r(e,t){var i,r,n=!1;if(!e)throw new Error("Undefined filename");t=t||{};try{n=!!(r=(0,_.ce)("audio")).canPlayType,"no"!=r.canPlayType("audio/mpeg")&&""!=r.canPlayType("audio/mpeg")?i=".mp3?1":"no"==r.canPlayType('audio/ogg; codecs="vorbis"')||""==r.canPlayType('audio/ogg; codecs="vorbis"')||t.forceMp3?n=!1:i=".ogg?1"}catch(e){}var s=t.forcePath||"/"+e+i;if(n){r.src=s;var c=!1;r.addEventListener("ended",(function(){c=!0}),!0),r.load(),this.playSound=function(){c&&r.load();try{var e=r.play();e&&e.catch((e=>{(0,a.debugLog)(e)}))}catch(e){}c=!1},this.pauseSound=function(){var e=r.pause();e&&e.catch((e=>{(0,a.debugLog)(e)}))}}else{cur.__sound_guid=cur.__sound_guid||0;var l=(0,_.ge)("flash_sounds_wrap")||utilsNode.appendChild((0,_.ce)("span",{id:"flash_sounds_wrap"})),d="flash_sound_"+cur.__sound_guid++;if(renderFlash(l,{url:"/swf/audio_lite.swf?4",id:d},{swliveconnect:"true",allowscriptaccess:"always",wmode:"opaque"},{})){var u=o.browser.msie?window[d]:document[d],f=!1,h=setInterval((function(){if(u&&u.paused)try{u.setVolume(1),u.loadAudio(s),u.pauseAudio()}catch(e){(0,a.debugLog)(e)}f=!0,clearInterval(h)}),300);this.playSound=function(){f&&u.playAudio(0)},this.pauseSound=function(){f&&u.pauseAudio()}}}}r.prototype={play:function(){try{this.playSound()}catch(e){}},pause:function(){try{this.pauseSound()}catch(e){}}},window.Sound=r},669906:(__unused_webpack___webpack_module__,__unused_webpack___webpack_exports__,__webpack_require__)=>{var core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21466),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(59357),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(751876),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(49535),_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(475632),_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(786067),_shared_lib_common__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(40906),_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(479957),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(803834),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(695724),_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(315544),_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(386409),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(654612),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(376852),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(787481),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(19331),_shared_lib_js_logger__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(66433),_web_lib_fx__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(635676),_shared_lib_web_stats__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(171516),_shared_evbus__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(182804),_icons_desktop_getIcon20Check__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(244030),_icons_desktop_getIcon20Cancel__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(784502),_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(659397),_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(486125);function _readOnlyError(e){throw new Error('"'+e+'" is read-only')}window.TopNotifierCur||(window.TopNotifierCur={link:"top_notify_btn",count:"top_notify_count",_qParams:{section:"notifications",_tb:1,list:""},loaded:!1,loading:!1,from:"",viewsObserver:null,viewedNotifications:[]}),window.TopNotifier={onBellMouseDown:function(e){return!(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.checkKeyboardEvent)(e)&&TopNotifier.show(e)},onBellClick:function(e){return!!(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.checkEvent)(e)||!!(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.checkKeyboardEvent)(e)&&TopNotifier.show(e)},onLoad:function onLoad(rows,js,from,header){if(!from||TopNotifierCur.from!==from){void 0!==rows&&"undefined"!==rows||(0,_shared_lib_js_logger__WEBPACK_IMPORTED_MODULE_16__.logError)("TopNotifier load undefinded response",{environment:"top_notify"});var evalExpr=`(function(){${js};})()`;try{eval(evalExpr)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_14__.logEvalError)(e,evalExpr)}TopNotifierCur.loaded=!0,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)(TopNotifier.getContentNode(),rows),TopNotifier.trackViews(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.show)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("top_notify_show_all")),TopNotifier.refreshHeader(header),TopNotifier.cleanCount(),TopNotifier.refreshCounters(),TopNotifierCur.from=from}},trackViews:function(){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ge)("top_notify_cont");"IntersectionObserver"in window&&(TopNotifierCur.viewsObserver&&TopNotifierCur.viewsObserver.disconnect(),TopNotifierCur.viewsObserver=new IntersectionObserver((function(e){e.forEach((e=>{var t=e.target.parentNode.dataset.notification_id;e.isIntersecting&&-1===TopNotifierCur.viewedNotifications.indexOf(t)&&(TopNotifierCur.viewedNotifications.push(t),(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_15__.partConfigEnabled)("notifications_view_new")?(0,_shared_lib_web_stats__WEBPACK_IMPORTED_MODULE_18__.saveStatlogEvents)({name:"notifications_views",value:t,keys:[]}):(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_7__.statlogsValueEvent)("notifications_views",t))}))}),{root:e,threshold:.6}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass)("feedback_row",e).forEach((function(e){TopNotifierCur.viewsObserver.observe(e)})))},refreshHeader:function(e){var t,i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("_notify_unread"),_=e&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("_top_notify_header"),o=i&&i.offsetHeight;if(_?(TopNotifierCur.header=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.se)(e),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ce)("div",{className:"top_notify_header_label"}),TopNotifierCur.header.appendChild(t)):t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("top_notify_header_label",TopNotifierCur.header),_){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)(t,"");var a="";TopNotifierCur.notify_sources.forEach((function(e){""!==e.list&&e.list===TopNotifierCur._qParams.list&&(a=e.name)})),""===a&&(a=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("global_notifications_user"));var r,n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ce)("div",{className:"top_notify_header_sup_label"}),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ce)("span",{className:"top_notify_header_label_user",innerHTML:a}),c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ce)("span",{className:"top_notify_header_label_groups"}),l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ce)("a",{onmouseover:function(e){TopNotifier.getSourcesTip(this,e)},className:"top_notify_header_label_groups_link",innerHTML:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("global_notifications_groups")});if(c.appendChild(l),r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ce)("span",{className:"top_notify_header_label_groups_counter",innerHTML:""}),n.appendChild(s),cur.user_has_admined_groups>0&&(n.appendChild(c),n.appendChild(r)),t.appendChild(n),o){var d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ce)("div",{className:"top_notify_header_sub_label",innerHTML:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("global_viewed_notifications")});t.appendChild(d)}}_&&TopNotifierCur.wrapper.insertBefore(TopNotifierCur.header,TopNotifierCur.wrapper.firstChild),TopNotifierCur.header_unread=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("_notify_header"),TopNotifierCur.header_unread&&(o?(TopNotifierCur.header_unread_hidden&&(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_17__.slideDown)(TopNotifierCur.header_unread,100),TopNotifierCur.header_unread_hidden=!1,TopNotifierCur.header_unread_handler||(TopNotifierCur.header_unread_height=TopNotifierCur.header_unread.offsetHeight,TopNotifierCur.header_unread_handler=function(e){if(TopNotifierCur.header_unread){var t=TopNotifierCur.header_unread.offsetTop+TopNotifierCur.header_unread_height<e.data.scrollTop;t!=TopNotifierCur.swaped&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.toggleClass)(TopNotifierCur.header,"top_notify_header_swap_labels",t),TopNotifierCur.swaped=t)}},TopNotifierCur.scrollbar.emitter.addListener("update",TopNotifierCur.header_unread_handler))):(TopNotifierCur.header_unread_hidden||(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_17__.slideUp)(TopNotifierCur.header_unread,100),TopNotifierCur.header_unread_hidden=!0,TopNotifierCur.header_unread_handler&&(TopNotifierCur.scrollbar.emitter.removeListener("update",TopNotifierCur.header_unread_handler),TopNotifierCur.header_unread_handler=null)))},preload:function(){TopNotifier.shown()||vk.isBanned||TopNotifierCur.loaded||ajax.post("/al_feed.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_9__.extend)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_9__.clone)(TopNotifierCur._qParams),{_preload:1}),{cache:1,onDone:function(e,t,i,_){TopNotifier.shown()&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("pr","top_notify_cont")&&(TopNotifier.onLoad(e,t,i,_),TopNotifierCur.loaded=!0)},stat:["feed.css","page.css","post.css"]})},loadMore:function loadMore(){var btn=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ge)("ui_top_notify_load_more");btn&&!(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.isButtonLocked)(btn)&&(TopNotifierCur.ajax=ajax.post("/al_feed.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_9__.extend)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_9__.clone)(TopNotifierCur._qParams),{from:TopNotifierCur.from,more:1,need_header:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_9__.intval)(!((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("_notify_header")||!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("_notify_sticky")&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("_notify_unread")))}),{onDone:function onDone(rows,js,newFrom){if(TopNotifierCur.scrollbar){var evalExpr=`(function(){${js};})()`;try{eval(evalExpr)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_14__.logEvalError)(e,evalExpr)}if(rows){for(var row=null,cont=TopNotifier.getContentNode(),au=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.cf)(rows);row=au.firstChild;)cont.insertBefore(row,btn);TopNotifier.refreshHeader(),TopNotifier.trackViews()}newFrom?TopNotifierCur.from=newFrom:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.re)(btn)}},showProgress:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.show)(btn),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.lockButton)(btn)},hideProgress:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hide)(btn),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.unlockButton)(btn)}}))},updateTime:function(e){(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_9__.each)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass)("rel_date_needs_update",e,"span"),(function(e,t){if(t){var i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_9__.intval)(t.getAttribute("time")),_=60*((new Date).getTimezoneOffset()+180),o=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getDateText)(i,_);!0===(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hasClass)(this,"ucfirst")&&(o=o.charAt(0).toUpperCase()+o.slice(1)),t.innerHTML=o}}))},createNewEventsBox:function(e){if((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_15__.partConfigEnabled)("notify_new_events_box")){var t=TopNotifier.getContentNode();if(t){var i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("notifications_new_events",t);e>0?(i||((i=document.createElement("div")).className="feed_row _feed_row notifications_new_events",i.onclick=function(e){i.onclick=null,(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.showProgress)(i),TopNotifierCur._qParams.list="",TopNotifier.refresh(e,!1)}),i.innerHTML=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.langStr)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("notifications_new_events",e),"count",e),t.insertBefore(i,t.children[0])):i&&!TopNotifierCur.loading&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.re)(i)}}},show:function(e){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.gpeByClass)("top_notify_cont",e.target))return!0;if(!0!==(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.checkEvent)(e)&&!vk.isBanned){if(TopNotifier.shown())return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.gpeByClass)("top_notify_wrap",e.target,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ge)("top_nav"))||TopNotifier.hide(),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(e);var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ge)(TopNotifierCur.link),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ge)("top_notify_cont");TopNotifier.updateTime(i),TopNotifierCur.timeUpdateInt=setInterval((function(){TopNotifier.updateTime(i)}),1e4),cur.introNotifyTooltipHide&&(cur.introNotifyTooltipHide(),delete cur.introNotifyTooltipHide),t.tt&&t.tt.hide&&t.tt.hide(),i||(TopNotifierCur.wrapper=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ce)("div",{innerHTML:'<div id="top_notify_cont" class="top_notify_cont wall_module" ontouchstart="event.cancelBubble = true;" onmousedown="event.cancelBubble = true;"></div><a href="/feed?section=notifications'+(TopNotifierCur._qParams.list?"&list="+TopNotifierCur._qParams.list:"")+'" class="top_notify_show_all" onmousedown="event.cancelBubble = true;" onclick="TopNotifier.hide(); return nav.go(this, event);">'+(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("global_notify_show_all")+"</a>",id:"top_notify_wrap",className:"scroll_fix_wrap top_notify_wrap"}),t.appendChild(TopNotifierCur.wrapper),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ge)("top_notify_cont"));var _=window.innerHeight||document.documentElement.clientHeight;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.setStyle)(i,{maxHeight:Math.min(Math.max(_-200,300),600)}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.addClass)(TopNotifierCur.link,"TopNavBtn--active");var o=uiScroll;return TopNotifierCur.scrollbar&&TopNotifierCur.scrollbar.container.__uiScroll__||(TopNotifierCur.scrollbar=new o(i,{global:!0,stopScrollPropagationAlways:!0,onmore:TopNotifier.loadMore})),TopNotifierCur.loaded?TopNotifier.trackViews():TopNotifier.refresh(),window.pushNotifier&&window.pushNotifier.cleanNotification(),(0,_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_4__.cancelStackPush)("top_notifier",TopNotifier.hide.bind(TopNotifier),!0),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(e)}},hide:function(){TopNotifier.shown()&&(TopNotifierCur.viewedNotifications=[],(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.removeClass)(TopNotifierCur.link,"TopNavBtn--active"),clearInterval(TopNotifierCur.timeUpdateInt),(0,_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_4__.cancelStackFilter)("top_notifier",!0),""!==TopNotifierCur._qParams.list&&(TopNotifierCur._qParams.list="",TopNotifier.invalidate()))},shown:function(){return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hasClass)(TopNotifierCur.link,"TopNavBtn--active")},getContentNode:function(){return TopNotifierCur.scrollbar&&TopNotifierCur.scrollbar.content&&TopNotifierCur.scrollbar.container.__uiScroll__?TopNotifierCur.scrollbar.content:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ge)("top_notify_cont")},showProgress:function(){var e=TopNotifier.getContentNode();(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("pr",e)||((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)(e,""),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.showProgress)(e))},hideProgress:function(){var e=TopNotifier.getContentNode();(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)(e,""),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.hideProgress)(e)},showTooltip:function(e,t){if(!TopNotifier.shown()&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.isVisible)("dev_top_nav")){var i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ge)(TopNotifierCur.link),_={};if(i){if("shownow"==i.tt&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.removeAttr)(i,"tt"),e)_.text=function(){return e},t&&(_.onHide=n.pbind(t));else{i.tt&&i.tt.destroy&&i.tt.destroy();var o=ls.get("ntfseen")||{},a=[];(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_9__.each)(o,(function(e,t){a.push(e+":"+t)})),_=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_9__.extend)(_,{url:"al_feed.php",params:{act:"a_last_notify",seen:a.join(";")},ajaxdt:2e3,noload:1,onHide:n})}var r=function e(t){setTimeout((function(){window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle?e(t):(t&&t.hide(),Notifier.lcSend("hide_notify_tt"))}),6e3)};(0,_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_13__.showTooltip)(i,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_9__.extend)(_,{typeClass:"top_notify_tt",dir:"up",width:250,shift:[1,0],nohideover:1,nohide:1,onShowStart:function(e){TopNotifier.shown()&&(e.opts.onHide=!1,e.hide()),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.addEvent)(e.container,"mousedown",(function(e){if(!e||!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_9__.inArray)(e.target.tagName,["A","IMG"]))return TopNotifier.show(e),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(e)})),r(e),Notifier.setRecvClbk("hide_notify_tt",e.hide)}}))}}function n(e){if(!e&&cur.topNotifyTTKey&&(e=cur.topNotifyTTKey,delete cur.topNotifyTTKey),e){var t=e.split(":"),i=ls.get("ntfseen")||{};2===t.length&&(i[0]=parseInt((new Date).getTime()/1e3),i[t[0]]=t[1],ls.set("ntfseen",i))}}},invalidate:function(){TopNotifierCur.loaded=!1,TopNotifierCur.from="",ajax.invalidate("/al_feed.php",TopNotifierCur._qParams),TopNotifierCur.ajax&&TopNotifierCur.ajax.abort()},setCount:function(e,t){(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_6__.isString)(e)&&(e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_9__.trim)(e)),parseInt(e)>=100&&(e="+99"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hasClass)(TopNotifierCur.link,"has_notify")&&e?(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_17__.animateCount)(TopNotifierCur.count,e,{str:"auto"}):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)(TopNotifierCur.count,e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.toggleClass)(TopNotifierCur.link,"has_notify",!!e),t||TopNotifier.invalidate()},cleanCount:function(){if(cur.topNotifyHash){var e=cur.groupNotify_readGids||[];cur.groupNotify_readGids=[],TopNotifierCur.notify_sources.forEach((function(t,i){var _=parseInt(t.list.replace("group-",""));t.list!==TopNotifierCur._qParams.list&&-1===e.indexOf(_)||(TopNotifierCur.notify_sources[i].counter=0)})),ajax.post("/al_feed.php",{act:"a_clean_notify",hash:cur.topNotifyHash,list:TopNotifierCur._qParams.list,gn_readGids:e})}},refresh:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null!==e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(e),TopNotifier.invalidate(),TopNotifierCur.wrapper&&!TopNotifierCur.loading&&(TopNotifierCur.loading=!0,t&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.re)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("_notify_header")),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.re)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("_top_notify_header"))),TopNotifierCur.from=0,ajax.post("/al_feed.php",TopNotifierCur._qParams,{cache:1,onDone:(e,t,i,_)=>{TopNotifierCur.loading=!1,TopNotifier.onLoad(e,t,i,_)},showProgress:()=>{t&&TopNotifier.showProgress()},stat:["feed.css"],onFail(){TopNotifierCur.loading=!1,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hide)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("top_notify_show_all")),TopNotifier.hideProgress(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)(TopNotifier.getContentNode(),'<div class="top_notify_empty no_rows error_message"><div>'+(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("global_notify_error_occured")+'</div><button class="flat_button button_small secondary" onclick="TopNotifier.refresh(event);">'+(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("global_notify_refresh")+"</button></div>")},no_ads_params:!0}))},unifiedDeleteRow:function(e,t,i,_,o){(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(e);var a=o.closest(".ui_actions_menu_wrap");a&&TopNotifier.hideActionsMenu(a);var r=a&&a.dataset.for_notification_id,n=TopNotifier.getContentNode(),s=n&&n.querySelector(`.feedback_row_wrap[data-notification_id="${r}"]`),c=s&&s.closest(".feed_row"),l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("post_actions",c),d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("feedback_row_wrap",c);ajax.post("al_feed.php",{act:"a_feedback_unified_delete",query:t,hash:i,from:"top_notifier"},{onDone:function(e){"."!==_.substr(-1)&&(_+=".");var o=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("notifications_cancel_disable"),a=`${_} <a onclick="TopNotifier.unifiedRestoreRow('${t}', '${i}', this);return cancelEvent(event);">${o}</a>`;e&&(a+="<br>"+e);var r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ce)("div",{className:"feedback_deleted_container"});r.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ce)("div",{className:"feedback_row dld _feedback_deleted _top_feedback_deleted",innerHTML:a})),c.appendChild(r),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hide)(d),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hasClass)(c,"feedback_row_clickable")&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.addClass)(c,"feedback_row_touched")},showProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.addClass.pbind(l,"post_actions_progress"),hideProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.removeClass.pbind(l,"post_actions_progress")})},unifiedRestoreRow:function(e,t,i){var _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.gpeByClass)("feed_row",i),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.gpeByClass)("feedback_deleted_container",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("_feedback_deleted",_)),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("feedback_row_wrap",_);if(o&&a){var r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ce)("span",{className:"progress_inline"});ajax.post("al_feed.php",{act:"a_feedback_unified_restore",query:e,hash:t,from:"top_notifier"},{onDone:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.show)(a),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.re)(o),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.removeClass)(_,"feedback_row_touched")},showProgress:()=>i.parentNode.replaceChild(r,i),hideProgress:()=>r.parentNode.replaceChild(i,r)})}},notifyMarkSpam:function(e,t){ajax.post("al_feed.php",{act:"a_feedback_mark_spam",item:e,hash:t},{onDone:function(t){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ge)("notify_mark_spam_"+e).innerHTML=t}})},notifyDeleteAll:function(e,t,i,_){if(cur.notifyDeletingAll||(cur.notifyDeletingAll={}),!cur.notifyDeletingAll[e]){cur.notifyDeletingAll[e]=1;var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ce)("span",{className:"progress_inline"});ajax.post("al_feed.php",{act:"a_feedback_delete_all",uid:e,item:i,hash:t},{onDone:function(t,i){var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.gpeByClass)("_feedback_deleted",_);if(1!=i){var a,r=!1;if((r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hasClass)(o,"_top_feedback_deleted")?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ge)("top_notify_cont"):cur.rowsCont)&&(a=r.firstChild)){var n,s,c=!1,l=(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_8__.scrollGetY)();do{a.className&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hasClass)(a,"_feed_row")&&a.firstChild&&e==a.firstChild.getAttribute("author")&&(n=a.offsetHeight,s=a.offsetTop,!1===c&&(c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.getXY)(a.offsetParent)[1]),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hide)(a),s+c<l&&(l-=n,(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_8__.scrollToY)(l,0)))}while(a=a.nextSibling);(0===cur.wasScroll||cur.wasScroll>0)&&(cur.wasScroll=l)}o.innerHTML='<span class="dld_inner">'+t+"</span>"}else(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.re)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.gpeByClass)("_feed_row",o))},showProgress:function(){_&&"button"===_.tagName.toLowerCase()?(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.lockButton)(_):_.parentNode.replaceChild(o,_)},hideProgress:function(){_&&"button"===_.tagName.toLowerCase()?(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.unlockButton)(_):o.parentNode.replaceChild(_,o)}})}},checkClick:function(e,t){if(t=t||window.event,!e||!t)return!0;TopNotifier.trackClick(t.target);var i=t.target||t.srcElement,_=8,o=!1,a=/(feedback_row)/;do{if(!i||i===e||i.onclick||i.onmousedown||(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_9__.inArray)(i.tagName,["A","IMG","TEXTAREA","EMBED","OBJECT"])||(o=i.className.match(a)))break}while(_--&&(i=i.parentNode));return!!o&&(i||!0)},detectClickRegion:function(e){switch(e.tagName){case"BUTTON":for(var t=e.parentNode.childNodes,i=1,_=0;_<t.length;++_)t[_]===e&&(i=_+1);return"button"+i;case"IMG":return e.dataset.elementName;default:return e.parentNode.closest(".feedback_attachments")?"attachments":"cell"}},trackClick:function(e){var t=e.closest(".feedback_row");if(t){for(var i=t.parentNode,_=TopNotifier.detectClickRegion(e),o=-1,a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass)("feedback_row"),r=0;r<a.length;++r)if(a[r]===t){o=r;break}(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_7__.statlogsValueEvent)("notifications_click",0,i.dataset.notification_type,o,i.dataset.notification_id,_)}},loadMoreUngrouped:(e,t,i)=>{ajax.post("/al_feed.php",{act:"ungroup_notifications",query:t,from:i},{onDone:(i,_,o)=>{if(!_&&o){if(!i)return TopNotifier.loadMoreUngrouped(e,t,o),!1;i+='<div class="feedback_group_loadmore_button" onclick="TopNotifier.loadMoreUngrouped(this, \''+t+"', '"+o+"')\">"+(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("notifications_show_more")+"</div>"}e.outerHTML=i},showProgress:()=>{e.innerHTML="",(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.showProgress)(e)},hideProgress:()=>e.innerHTML=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("notifications_show_more"),no_ads_params:!0})},ungroupUnified:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,_=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(null!==i){var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.gpeByClass)("feed_row",e),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("post_actions",o);ajax.post("/al_feed.php",{act:"ungroup_notifications",query:i,from:_},{onDone:(_,o,a)=>{if(!o&&a){if(!_)return TopNotifier.ungroupUnified(e,t,i,a),!1;_+='<div class="feedback_group_loadmore_button" onclick="TopNotifier.loadMoreUngrouped(this, \''+i+"', '"+a+"')\">"+(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("notifications_show_more")+"</div>"}e.parentNode.outerHTML=_},showProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.addClass.pbind(a,"post_actions_progress"),hideProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.removeClass.pbind(a,"post_actions_progress"),no_ads_params:!0})}else e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.domClosest)("_feed_row",e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.show)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.domNS)(e)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.re)(e);t.stopPropagation(),t.preventDefault()},showActionsMenu:function(e){var t=!1,i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.domClosest)("_feed_row",e),_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.domPN)(i);if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hasClass)(_,"_notify_unread")&&(_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.domPN)(_)),!(_.lastChild!=i||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hasClass)(_,"feed_row_fb_hidden")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hasClass)(_,"feedback_sticky_rows")&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.domPN)(_).lastChild!=_)){t={appendParentCls:"top_notify_wrap",processHoverCls:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hasClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.domPN)(e),"post_actions")?"feedback_row":"feedback_sticky_row"};var o=e.dataset.for_notification_id;o&&(t.wrapAttrs={"data-for_notification_id":o})}uiActionsMenu.show(e,!1,t)},hideActionsMenu:function(e){uiActionsMenu.hide(e)},frProcess:function(e,t,i,_){var o;(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.isButtonLocked)(i)||(o=_?{act:"add",mid:e,hash:t,request:1,from:"top_notifier"}:{act:"remove",mid:e,hash:t,report_spam:1,from:"top_notifier"},(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_7__.statlogsValueEvent)("feed_top_notify",0,"friends",o.act),ajax.post("/al_friends.php",o,{onDone:function(t,o){var a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.domPN)(i);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)(a,t),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.addClass)(a,"feedback_buttons_response"),"friends"==cur.module&&window.Friends&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)("request_controls_"+e,t),window.Friends.processRequest(e,_)),o&&(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_21__.showDoneBox)(o)},onFail:function(e){if(e)return setTimeout((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_12__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("global_error"),e).hide,3e3),!0},showProgress:()=>(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.lockButton)(i),hideProgress:()=>(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.unlockButton)(i)}))},apiCallProcess:function(e,t){if(!(0,_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_20__.isObject)(e)||(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.isButtonLocked)(t))return!1;var i=e.query,_=e.successText,o=e.successIcon,a=e.confirmTitle,r=e.confirmText,n=e.confirmOkLabel,s=e.confirmCancelLabel,c=e.snackbarText,l=e.replaceAllActions,d=function(){ajax.post("/al_feed.php",{act:"a_api_call",hash:cur.topNotifyHash,query:i},{onDone:function(e){var i;switch(o){case"done":i=(0,_icons_desktop_getIcon20Check__WEBPACK_IMPORTED_MODULE_22__.getIcon20Check)().icon;break;case"cancel":i=(0,_icons_desktop_getIcon20Cancel__WEBPACK_IMPORTED_MODULE_23__.getIcon20Cancel)().icon}var a=`<div class="feedback_apicallText">${i?`<div class="feedback_apicallText__icon">${i}</div>`:""}${_}</div>`;if(l){var r=t.parentElement;r&&(r.innerHTML=a)}else t.outerHTML=a;c&&(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_21__.showDoneBox)(c)},onFail:function(e){if(e)return setTimeout((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_12__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("global_error"),e).hide,3e3),!0},showProgress:()=>(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.lockButton)(t),hideProgress:()=>(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.unlockButton)(t)})};return r?(_readOnlyError("confirmTitle"),a=a||(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("global_action_confirmation"),cur.confirmBox=(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_12__.showFastBox)(a,r,n,(function(){d(),cur.confirmBox.hide()}),s)):d(),!0},grProcess:function(e,t,i,_){if(!((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hasClass)(i,"flat_button")&&(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.isButtonLocked)(i)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.domFC)(i)&&"progress_inline"==(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.domFC)(i))){var o=-2==_?"spam":_?"enter":"leave",a=-1==_?"_decline":"";ajax.post("/al_groups.php",{act:o,gid:e,hash:t,from:"top_notifier",context:a},{onDone:function(e){var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.domPN)(i);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)(t,e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.addClass)(t,"feedback_buttons_response")},onFail:function(e){if(e)return setTimeout((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_12__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("global_error"),e).hide,3e3),!0},showProgress:function(){if(-2==_){i.oldhtml=i.innerHTML;var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.getSize)(i)[0];i.innerHTML='<span class="progress_inline"></span>',(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.setStyle)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.domFC)(i),{width:e})}else(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.lockButton)(i)},hideProgress:function(){-2==_?i.innerHTML=i.oldhtml:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.unlockButton)(i)}})}},gn_grProcess:function(e,t,i,_,o,a){return o.stopPropagation(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hasClass)(_,"flat_button")&&(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.isButtonLocked)(_)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.domFC)(_)&&"progress_inline"==(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.domFC)(_)||ajax.post("groupsedit.php",{act:"user_action",id:e,addr:t,hash:i,from:"top_notifier",action:a},{onDone:function(e){var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.domPN)(_);return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)(t,e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.addClass)(t,"feedback_buttons_response"),!1},onFail:function(e){return!!e&&(setTimeout((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_12__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("global_error"),e).hide,3e3),!1)},showProgress:function(){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.lockButton)(_)},hideProgress:function(){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.unlockButton)(_)}}),!1},showGiftBox:function(e,t,i){return!(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_12__.showBox)("al_gifts.php",{act:"get_gift_box",fids:e,fr:1,ref:i},{stat:["gifts.css","wide_dd.js","wide_dd.css"],cache:1,dark:1},t)},getSourcesTip:function(e,t){return(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(t),(0,_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_13__.showTooltip)(e,{url:"/al_page.php",params:{act:"notify_get_sources",cur_list:TopNotifierCur._qParams.list},slide:15,ajxdt:200,hidedt:200,dir:"bottom",shift:[100,10],id:"notify_sources",className:"notify_sources",onShowStart:function(){TopNotifierCur.notify_sources.forEach((function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("notify_tooltip_counter"+e.list),e.counter>0?e.counter:"")})),TopNotifier.refreshTooltip()}}),!1},changeSource:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==i&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(i),e!==TopNotifierCur._qParams.list?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.re)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("notify_sources")),t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("ui_rmenu_count",t),""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("top_notify_show_all")&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.attr)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("top_notify_show_all"),"href","/feed?section=notifications"+(e?"&list="+e:"")),TopNotifierCur._qParams.list=e,TopNotifier.refresh()):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hide)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("notify_sources"))},changeSourceFullCallback:function(){TopNotifier.refreshCounters(),TopNotifierCur.notify_sources.forEach((function(e){e.list&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("ui_rmenu_count",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("feed_section_"+e.list)),e.counter>0?e.counter:"")}));var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByTag1)("a",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("header_side_link",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("feed_notifications")));""===TopNotifierCur.settings_url?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hide)(e):((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.show)(e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.attr)(e,"href",TopNotifierCur.settings_url)),TopNotifierCur.source_name||(TopNotifierCur.source_name=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("news_title_notifications")),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("page_block_header_inner",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("feed_notifications")),TopNotifierCur.source_name)},hideBanner:function(e,t,i){ajax.post("al_feed.php",{act:"a_feedback_hide_banner",group_id:i,hash:t}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.hide)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ge)("internal_notification131"))},addNewSource:function(e,t,i){return ajax.post("al_settings.php",{act:"a_group_notify_add_source",gid:e,from:i,hash:t},{onDone:function(t){nav.go("/settings?act=group_notify&gid="+e),TopNotifier.changeSource("group-"+e,null,null)},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.lockButton.pbind(cur.popupSubmitBtnEl),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_11__.unlockButton.pbind(cur.popupSubmitBtnEl)}),!0},refreshCounters:function(){var e=0,t=0,i=0,_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("top_notify_header_label_groups_counter");TopNotifierCur.notify_sources.forEach((function(_){""!==_.list&&_.counter>0&&(1===_.unmuted?t++:e++),""===_.list&&(i=_.counter)})),vk.counts.ntf=i+t,TopNotifier.setCount(i+t,!0),TopNotifier.createNewEventsBox(i),t>0?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.addClass)(_,"unmuted"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)(_,t)):((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.removeClass)(_,"unmuted"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)(_,e>0?e:""))},refreshTooltip:function(){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("groups",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("notify_sources")),t=[],i=[],_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.ce)("div");e&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass)("line_cell",e).forEach((function(e,_){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.geByClass1)("ui_rmenu_count",e))>0?t.push(e):i.push(e)})),t.concat(i).forEach((function(e){_.appendChild(e)})),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_10__.val)(e,""),e.appendChild(_))},showCommonFriendsBox:function(e,t){return(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_12__.showTabbedBox)("al_page.php",{act:"box",oid:t,tab:"common"},{cache:1},e),!1}},vk.widget||((0,_shared_evbus__WEBPACK_IMPORTED_MODULE_19__.tq)().setInteractiveHandler("Gifts/show_received_gifts",(e=>{var t=e.event,i=e.payload.dataAttrs.userId;(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_12__.showBox)("al_gifts.php",{act:"box",tab:"received",mid:i},{cache:1,stat:["gifts.css",window.jsc("web/gifts.js")]},t)})),(0,_shared_evbus__WEBPACK_IMPORTED_MODULE_19__.tq)().setInteractiveHandler("Gifts/show_gifts_catalog",(e=>{var t=e.event,i=e.payload.dataAttrs,_=i.toId,o=i.ref;window.TopNotifier.showGiftBox(_,t,o)})))},967181:(e,t,i)=>{i.d(t,{EntityType:()=>_,EventQueue:()=>a});var _,o=i(570655);!function(e){e.Online="online"}(_||(_={}));var a=function(e){var t=this,i=e.getQueue,_=e.registerQueue;this.QUEUE_KEY_TTL=3e3,this.MAX_RETRIES=5,this.listeners=[],this.retriesLeft=this.MAX_RETRIES,this.restart=function(){t.intervalId&&clearInterval(t.intervalId),0!==t.retriesLeft&&(t.retriesLeft--,t.getQueue().then((function(e){t.retriesLeft=t.MAX_RETRIES;var i=(0,o.__assign)({},e);t.intervalId=window.setInterval((function(){t.registerQueue(i,(function(e,_){var a,r,n,s;if(function(e){return void 0!==e.err}(_))t.restart();else{i.ts=_.ts;try{for(var c=(0,o.__values)(_.events),l=c.next();!l.done;l=c.next()){var d=l.value;try{for(var u=(n=void 0,(0,o.__values)(t.listeners)),f=u.next();!f.done;f=u.next())(0,f.value)(d)}catch(e){n={error:e}}finally{try{f&&!f.done&&(s=u.return)&&s.call(u)}finally{if(n)throw n.error}}}}catch(e){a={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(a)throw a.error}}}}))}),t.QUEUE_KEY_TTL)})).catch((function(e){console.error(e),setTimeout(t.restart,t.QUEUE_KEY_TTL)})))},this.subscribe=function(e){return t.listeners.push(e),1===t.listeners.length&&t.restart(),function(){t.listeners=t.listeners.filter((function(t){return t!==e})),0===t.listeners.length&&(t.retriesLeft=t.MAX_RETRIES,t.intervalId&&clearInterval(t.intervalId))}},this.registerQueue=_,this.getQueue=i}},49267:(e,t,i)=>{i.d(t,{createLongpollConnect:()=>f});var _=i(570655),o=i(191040),a=i(887294),r=i(663825),n=i(19331),s=(0,n.partConfigEnabled)("me_web_read_by_cmid")?15:14;function c(e,t){e.waitAbortFns.push(t)}function l(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});var t=(0,a.plaingetCancelable)(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode}),i=t.request,r=t.cancel;return e.stopFn=r,i.then((function(t){var i=(0,_.__read)(t,2),o=i[0],a=i[1];return e.onData(e,a),e.waitTimeout=2,JSON.parse(o)})).catch((function(t){var i=(0,_.__read)(t,2)[1];return e.onData(e,i),Promise.reject(new Error(""))})).then((function(t){return function(e,t){var i=t.failed?(0,o.abortablePause)(4,null):{abort:function(){},pause:function(){return Promise.resolve()}},a=i.abort,r=i.pause;switch(t.failed){case 1:return c(e,a),e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(r).then((function(){return l(e)}));case 2:return c(e,a),e.onKeyExpired(e,t).then((function(t){var i=(0,_.__read)(t,4),o=i[0],a=i[1],r=i[2],n=i[3];return e.onResult({ts:+n,updates:[[-2,o,a+"/"+r],[-1]]})})).then(r).then((function(){return l(e)}));case 3:return e.onLpBroken(e,t);default:return t.updates.some((function(e){switch(e[0]){case 4:return 4===e.length;case 5:case 18:return 3===e.length;default:return!1}}))?e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(r).then((function(){return l(e)})):Promise.resolve(t)}}(e,t)}))}function d(e){e.isStoppedFn()||l(e).then(e.onResult.bind(e)).then((function(){return e.isReconnecting&&u(e,-5)})).catch((function(t){return function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),u(e,-3);var i=(0,o.abortablePause)(e.waitTimeout,null),_=i.abort,a=i.pause;return c(e,_),a().then((function(){return u(e,-4)}))}(e,t)})).then((function(){return d(e)}))}function u(e,t){e.isReconnecting=-4===t,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function f(e,t){var i=!!e.stopped,_={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||s,mode:1226,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:function(){return i},onResult:function(e){e.ts&&a(_.ts,e.ts,e.updates.map(r.constructEvent))},onData:h(t.onData),onRequestError:h(t.onRequestError),onHistoryLost:p(t.onHistoryLost),onKeyExpired:p(t.onKeyExpired),onLpBroken:p(t.onHistoryLost)},o=t.onEvents;function a(e,t,i){_.ts=t;for(var a=0;a<i.length;++a)i[a].type===r.REFRESH_LP_KEY&&(_.key=i[a].key||"",_.url=i[a].url||"");o(e,t,i)}var n={options:_,isStopped:function(){return i},stopConnection:function(){i=!0,_.stopFn&&_.stopFn(),_.stopFn=void 0,document.removeEventListener("resume",c),this.abortWaiting()},reinitConnection:function(){this.stopConnection(),document.addEventListener("resume",c),u(_,-4),i=!1,d(_)},abortWaiting:function(){_.waitAbortFns.forEach((function(e){return e()})),_.waitAbortFns=[],_.waitTimeout=2},onLp:a};function c(){n.abortWaiting()}return document.addEventListener("resume",c),d(_),n}function h(e){return e||function(){}}function p(e){return e?function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return Promise.resolve(e.apply(void 0,(0,_.__spreadArray)([],(0,_.__read)(t))))}:function(){return Promise.reject()}}},384099:(e,t,i)=>{i.d(t,{createLongpollEventsQueue:()=>o});var _=i(570655);function o(e,t,i){var o=0,a=e,r=[],n=!1;function s(){!r.length||o>0||n||(t(r),r=[])}return{pause:function(){o++},resume:function(){o>0&&(o--,s())},onLp:function(e,t,o){n||(a>=e?(a=t,r.push.apply(r,(0,_.__spreadArray)([],(0,_.__read)(o))),s()):i&&(n=!0,i(a).then((function(e){var t=(0,_.__read)(e,3),i=t[1],o=t[2];a=i,n=!1,r.push.apply(r,(0,_.__spreadArray)([],(0,_.__read)(o))),s()}))))}}}},421295:(e,t,i)=>{i.d(t,{screenWakeLocker:()=>_});var _=new(function(){function e(){this.onVisibilityChange=this._onVisibilityChange.bind(this)}return e.prototype._onVisibilityChange=function(){this.wakeLockSentinel&&"visible"===document.visibilityState&&this.lock().then((function(){})).catch(console.error)},e.prototype.requestWakeLock=function(){var e=this;return navigator.wakeLock?this.wakeLockSentinel?Promise.resolve():navigator.wakeLock.request("screen").then((function(t){e.wakeLockSentinel=t})):Promise.reject()},e.prototype.isLocked=function(){return!!this.wakeLockSentinel&&!this.wakeLockSentinel.released},e.prototype.lock=function(){var e=this;return this.requestWakeLock().then((function(){e.wakeLockSentinel&&document.addEventListener("visibilitychange",e.onVisibilityChange)})).catch((function(){}))},e.prototype.unlock=function(){var e=this;return this.wakeLockSentinel?(document.removeEventListener("visibilitychange",this.onVisibilityChange),this.wakeLockSentinel.release().finally((function(){e.wakeLockSentinel=null}))):Promise.resolve()},e}())},603748:(e,t,i)=>{i.d(t,{ConnectionLimiter:()=>o});var _=i(161644),o=function(){var e=this;this.scheduleReconnect=function(t,i,o){var a=i.onConnect,r=i.onOpen,n=i.onMessage,s=i.onClose;void 0===o&&(o=0),e.disconnect(),(0,_.log)("none","scheduling reconnection in",o);var c=function(){(0,_.log)("green","creating new EventSource");var i=new EventSource(t);setTimeout(a,0),i.addEventListener("open",r),i.addEventListener("message",(function(t){e.resetPingTimeout(s),n(t)})),i.addEventListener("ping-interval",(function(t){var i=JSON.parse(t.data);(0,_.log)("none","ping interval received",i),e.pingInterval=i})),i.addEventListener("ping",(function(){e.resetPingTimeout(s)})),i.addEventListener("error",(function(){switch((0,_.log)("red","EventSource error, readyState:",i.readyState),e.pingTimeoutId&&clearTimeout(e.pingTimeoutId),i.readyState){case EventSource.CONNECTING:case EventSource.OPEN:break;case EventSource.CLOSED:s()}})),e.source=i},l=window.setTimeout((function(){e.scheduled=void 0,c()}),o);e.scheduled={timeoutId:l,reconnect:c}},this.skipWaiting=function(){if(e.scheduled){var t=e.scheduled,i=t.timeoutId,_=t.reconnect;e.scheduled=void 0,clearTimeout(i),_()}},this.disconnect=function(){(0,_.log)("red","disconnecting EventSource"),e.scheduled&&(clearTimeout(e.scheduled.timeoutId),e.scheduled=void 0),e.pingTimeoutId&&clearTimeout(e.pingTimeoutId),e.source&&e.source.close()},this.isConnected=function(){return!!e.source&&e.source.readyState===EventSource.OPEN},this.resetPingTimeout=function(t){if(e.pingTimeoutId&&clearTimeout(e.pingTimeoutId),e.pingInterval){var i=e.pingInterval+1e3;e.pingTimeoutId=window.setTimeout((function(){(0,_.log)("red","connection ping timed out"),e.disconnect(),t()}),i)}}}},734693:(e,t,i)=>{i.d(t,{DEPRECATEDLongpollAdapter:()=>c});var _=i(570655),o=i(170902),a=i(603748),r=i(663825),n=i(887294),s=i(161644),c=function(e,t,i,c){var l=this;this.buffer=[],this.paused=0,this.subscriptions=[],this.onData=function(e){l.subscriptions.push(e),l.unsubscribe||(l.unsubscribe=l.source.subscribe((function(e){var t,i,o,a=e.map(r.constructEvent);if(l.isPaused())(t=l.buffer).push.apply(t,(0,_.__spreadArray)([],(0,_.__read)(a)));else try{for(var n=(0,_.__values)(l.subscriptions),s=n.next();!s.done;s=n.next())s.value.apply(void 0,(0,_.__spreadArray)([],(0,_.__read)(a)))}catch(e){i={error:e}}finally{try{s&&!s.done&&(o=n.return)&&o.call(n)}finally{if(i)throw i.error}}})))},this.offData=function(e){l.subscriptions=l.subscriptions.filter((function(t){return t!==e})),0===l.subscriptions.length&&l.unsubscribe&&(l.unsubscribe(),l.unsubscribe=void 0)},this.push=function(e){var t,i;e.length>0&&"transition_event"!==e[0].type&&(0,s.log)("none","pushed events",e);try{for(var o=(0,_.__values)(l.subscriptions),a=o.next();!a.done;a=o.next())a.value.apply(void 0,(0,_.__spreadArray)([],(0,_.__read)(e)))}catch(e){t={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}},this.isPaused=function(){return l.paused>0},this.pause=function(){(0,s.log)("none","paused longpoll"),l.paused++},this.resume=function(){var e,t;if(0!==l.paused&&((0,s.log)("none","resumed longpoll"),l.paused--,0!==l.buffer.length)){var i=l.buffer;l.buffer=[];try{for(var o=(0,_.__values)(l.subscriptions),a=o.next();!a.done;a=o.next())a.value.apply(void 0,(0,_.__spreadArray)([],(0,_.__read)(i)))}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}}},this.abortWaiting=function(){l.source.skipWaiting()},this.isEnabled=function(){return l.source.isConnected()},this.isSSE=!0,this.source=new o.ServerSentEvents(new a.ConnectionLimiter,{starterConfig:function(){return{key:e,ts:t,url:i,userId:c}},refreshedConfig:function(){return function(e){return new Promise((function(t,i){var _=!1,o=setTimeout((function(){_=!0,i(new Error("timeout"))}),1e3);(0,n.post)("al_im.php",{act:"a_get_key",uid:e,gid:Math.max(-e,0)},1e3).then((function(e){_||(t(e),clearTimeout(o))})).catch((function(e){_||(i(e),clearTimeout(o))}))}))}(c).then((function(e){var t=(0,_.__read)(e,4);return{key:t[0],url:t[1]+"/"+t[2],ts:t[3],userId:c}}))}})}},170902:(e,t,i)=>{i.d(t,{ServerSentEvents:()=>r});var _=i(570655),o=i(668040),a=i(161644),r=function(e,t){var i=this,r=t.starterConfig,s=t.refreshedConfig;this.listeners=[],this.reconnect=function(e){if(void 0===e&&(e=200),(0,a.log)("none","new connection requested"),0!==i.listeners.length){var t=e>500;t&&i.simulate([-3,e/1e3]);var r=(0,o.toQueryString)({key:i.config.key,ts:i.config.ts,uid:i.config.userId,version:14,mode:1226});i.connectionLimiter.scheduleReconnect(i.config.url+"?"+r,{onConnect:function(){t&&i.simulate([-4])},onOpen:function(){(0,a.log)("green","connection opened"),e=200,i.simulate([-5])},onClose:function(){var t=n(e);(0,a.log)("red","connection closed, reconnect in",t),i.reconnect(t)},onMessage:function(t){var o,r,s=JSON.parse(t.data);if((0,a.log)("none","message received",s),void 0!==s.failed)switch(i.connectionLimiter.disconnect(),s.failed){case 1:i.simulate([-1]),i.config.ts=s.ts,i.reconnect();break;case 2:case 3:(0,a.log)("none","requesting new config"),i.refreshedConfig().then((function(e){(0,a.log)("none","new config received",e),i.config=(0,_.__assign)((0,_.__assign)({},e),{url:i.config.url}),i.simulate([-1]),i.reconnect()})).catch((function(t){(0,a.log)("red","error on updating key",t);var _=n(e);i.reconnect(_)}));break;case 4:throw new Error("Unknown longpoll version");default:throw new Error("Unknown longpoll error")}else{i.config.ts=s.ts;try{for(var c=(0,_.__values)(i.listeners),l=c.next();!l.done;l=c.next())(0,l.value)(s.updates)}catch(e){o={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(o)throw o.error}}}}},e)}else(0,a.log)("none","no listeners, aborting reconnect")},this.skipWaiting=function(){i.isConnected()||(0,a.log)("none","skip waiting"),i.connectionLimiter.skipWaiting()},this.subscribe=function(e){return(0,a.log)("none","new client subscribed"),i.listeners.push(e),1===i.listeners.length&&i.reconnect(200),function(){(0,a.log)("none","client unsubscribed"),i.listeners.includes(e)&&(i.listeners=i.listeners.filter((function(t){return e!==t})),0!==i.listeners.length||i.connectionLimiter.disconnect())}},this.simulate=function(){for(var e,t,o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];(0,a.log)("none","simulating events",o);try{for(var n=(0,_.__values)(i.listeners),s=n.next();!s.done;s=n.next()){var c=s.value;c(o)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},this.isConnected=function(){return i.connectionLimiter.isConnected()},this.config=r(),this.refreshedConfig=s,this.connectionLimiter=e};function n(e){return Math.min(2*e,6e4)}},161644:(e,t,i)=>{i.d(t,{log:()=>o});var _=i(570655);function o(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var o=function(e){return e<10?"0"+e.toString():e.toString()},a=new Date,r=a.getHours()+":"+o(a.getMinutes())+":"+o(a.getSeconds()),n="background: "+e+"; color: white";window.__sseDebug&&console.debug.apply(console,(0,_.__spreadArray)(["%c"+r+" SSE:",n],(0,_.__read)(t)))}window.sseDebug=function(e){window.__sseDebug=e,window.__debugMode=e}},63524:(e,t,i)=>{var _=i(386409),o=i(787481),a=i(695724),r=i(315544);i(588379),i(624817),i(262928),i(367537),i(40415),i(533143),i(669906);window.getWndInner=function(){var e=window.lastWindowWidth,t=window.lastWindowHeight,i=(0,_.sbWidth)();return(!1!==window.lastWndScroll[0]?window.lastWndScroll[0]:window.htmlNode.scrollHeight>window.htmlNode.clientHeight)&&(e-=i+(i?1:0)),[t,e]},window.lastWndScroll=[!1,!1];window.updateWndVScroll=function(){var e=!1;e=window.boxLayerWrap&&(0,r.isVisible)(window.boxLayerWrap)?window.boxLayerWrap.scrollHeight>window.boxLayerWrap.clientHeight?1:0:window.layerWrap&&(0,r.isVisible)(window.layerWrap)?window.layerWrap.scrollHeight>window.layerWrap.clientHeight?1:0:!(!window.mvLayerWrap||!(0,r.isVisible)(window.mvLayerWrap))&&(window.mvLayerWrap.scrollHeight>window.mvLayerWrap.clientHeight?1:0),(0,a.each)(window.curRBox.tabs,(function(){this.options.marginFixedToLayer&&(0,r.setStyle)(this.wrap,{marginRight:(0,r.hasClass)(document.body,"layers_shown")?(0,_.sbWidth)():0})})),e!==window.lastWndScroll[0]&&(window.lastWndScroll[0]=e,(0,a.each)(window.curRBox.tabs,(function(){this.toRight&&!this.options.marginFixedToLayer&&(0,r.setStyle)(this.wrap,{marginRight:e?(0,_.sbWidth)():0})})))};window.defBox=function(e,t){var i,_='<div class="'+(e.subClass||"")+'"><div class="fc_tab_head"><a class="fc_tab_close_wrap fl_r"><div class="chats_sp fc_tab_close"></div></a><div class="fc_tab_title noselect">%title%</div></div><div id="fc_ctabs_cont"><div class="fc_ctab fc_ctab_active">%content%</div></div></div></div>';i=e.content?'<div class="fc_content_wrap"><div class="fc_content">'+e.content+"</div></div>":e.innerHTML;var n=(0,r.se)((0,r.rs)(_,{title:e.title,content:i}));i=(0,r.geByClass1)("fc_content",n,"div");var s,c={movable:(0,r.geByClass1)("fc_tab_head",n),hider:(0,r.geByClass1)("fc_tab_close_wrap",n,"a"),startLeft:e.x,startTop:e.y,startHeight:e.height,startWidth:e.width,resizeableH:i,resize:!1,minH:e.minH,onBeforeHide:e.onBeforeHide||function(){},onHide:e.onHide||function(){},onDragEnd:function(){},onResize:function(){}},l=new window.RBox(n,(0,a.extend)(c,e));return e.content&&(s=new window.Scrollbar(i,{prefix:"fc_",more:o.debugLog,nomargin:!0,global:!0,nokeys:!0,right:window.vk.rtl?"auto":0,left:window.vk.rtl?0:"auto",onHold:e.onHold})),t({id:l.id,cont:i,update:function(){s&&s.update()}}),l};try{window.stManager.done("notifier.js")}catch(e){}},597332:(e,t,i)=>{i.d(t,{MARKET_NOTIFY_ID__HS_MIGRATION_STATE:()=>r,onHappySantaMarketMigrationStateChanged:()=>s});var _=i(718253),o=i(315544),a=i(654612),r="happy_santa_market_migration_state";function n(){window.wkcur&&window.cur&&window.WkView&&(window.wkcur.onHide=null,window.cur.isMigrateAvailable=!1,window.WkView.hide())}function s(e){if(void 0!==e.add&&void 0!==e.add.state&&void 0!==e.add.group_id){var t=Number(e.add.state),i=Number(e.add.group_id);if(1!==t)switch(t){case 3:var r=_.GROUP_ORDERS_DEFAULT_COLUMNS.map((function(e,t){return{id:e,order:t,isEnabled:"merchantComment"!==e&&"deliveryOption"!==e}})),s=_.GROUP_ORDERS_COLUMNS_STORAGE_KEY+"_"+i;window.ls.set(s,r);var c=document.querySelector("#group_edit_market_settings_link");c&&(0,o.show)(c),n();break;case 2:n();var l=e.add.info_title?String(e.add.info_title):"",d=e.add.info_text?String(e.add.info_text):"";l&&d&&window.cur.isMigrationInProgress&&(0,a.showFastBox)(l,d)}}}},533143:(e,t,i)=>{var _=i(612202);window.DesktopNotifications={supported:function(){return!!window.Notification},checkPermissionNeeded:function(){return"granted"===Notification.permission?0:1},requestPermission:function(e){window.Notification.requestPermission(e).finally((function(){}))},createNotification:function(e,t,i){var o;return(o=new Notification(t,{icon:e,body:i})).cancel=function(){this.close()},o.show=function(){},(0,_.statlogsProbValueEvent)(.1,"browser_notification",1),o}}},988058:(e,t,i)=>{i.d(t,{createLongpoll:()=>s});var _=i(49267),o=i(437361),a=i(887294),r=i(454593),n=i(460615);function s(e,t){return(0,_.createLongpollConnect)(e,{onEvents:t,onData:d,onRequestError:u,onHistoryLost:f,onKeyExpired:h,onLpBroken:p})}var c={},l=Date.now();function d(e,t){if(t&&t.status&&e.lpstat){var i=t.status.toString();t.status>=500&&t.status<600&&(0,n.statlogsValueEvent)("fc_longpoll",1,i,t.getResponseHeader("x-frontend")||""),c[i]=i in c?c[i]+1:1,Date.now()-l>=3e4&&(Object.keys(c).forEach((function(e){(0,n.statlogsValueEvent)("fc_longpoll",c[e],e,t.getResponseHeader("x-frontend")||"")})),c={},l=Date.now())}}function u(e){(0,o.lpLogFc)("red","LP error",e.message||"no message (probably browser reset)")}function f(e,t){(0,o.lpLogFc)("red","LP failed: old timestamp; resync, next ts",t.ts)}function h(e){return(0,o.lpLogFc)("red","LP failed: key is incorrect; refresh key"),(0,a.post)(r.CONTROLLER,{act:"a_get_key",uid:e.id,gid:e.id<0?-e.id:0},1e3)}function p(){throw window.nav.reload({force:!0}),new Error("ts is very wrong")}},437361:(e,t,i)=>{i.d(t,{lpLogFc:()=>o,longpollTestingOnFcEvents:()=>c});var _=i(570655);function o(e,t){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];if(window.vk.lpConfig.debug){var a="background: "+e+"; color: white",r=new Date,n=function(e){return e<10?"0"+e.toString():e.toString()};console.log.apply(console,(0,_.__spreadArray)(["%c "+r.getHours()+":"+n(r.getMinutes())+":"+n(r.getSeconds())+":"+r.getMilliseconds()+" "+t+" ",a],(0,_.__read)(i)))}}function a(){return window.lpBufferFc||(window.lpBufferFc=[]),window.lpBufferFc}function r(){return window.lpBufferIm||(window.lpBufferIm=[]),window.lpBufferIm}function n(){return"im"===window.cur.module&&window.store&&window.store.get().longpoll&&!window.store.get().stopped}function s(){var e;n()&&(r().forEach((function(e){!a().find((function(t){return e.ev===t.ev}))&&e.time<Date.now()-1e3&&!e.warned&&(e.warned=!0,o("red","im not fc",e.ev))})),a().forEach((function(e){var t=r().find((function(t){return t.ev===e.ev}));t&&t.warned&&!e.warned&&(e.warned=!0,o("red","now fc like im",e.ev))}))),e=Date.now()-3e4,window.lpBufferFc=a().filter((function(t){return t.time>e})),window.lpBufferIm=r().filter((function(t){return t.time>e}))}function c(e){var t;n()&&((t=a()).push.apply(t,(0,_.__spreadArray)([],(0,_.__read)(e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))))),setTimeout(s,0)),o.apply(void 0,(0,_.__spreadArray)(["green","fc"],(0,_.__read)(e)))}window.longpollTestingOnImEvents=function(e){var t;n()&&((t=r()).push.apply(t,(0,_.__spreadArray)([],(0,_.__read)(e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))))),setTimeout(s,1100)),o.apply(void 0,(0,_.__spreadArray)(["blue","im"],(0,_.__read)(e)))}},316031:(e,t,i)=>{i.d(t,{lpSingletonGetInstance:()=>b,lpSingletonOnTabInitialLoaded:()=>E,lpSingletonSyncWithNotifier:()=>C,lpSingletonOnNotifierRecv:()=>m});var _=i(988058),o=i(384099),a=i(437361),r=i(726271),n=i(695724),s=i(194795),c=i.n(s),l=window.lpConnect,d=window.lpInstance;function u(){return window.vk.id>0}function f(){return Boolean(window.curNotifier&&window.curNotifier.lp_connected)}function h(){return window.curNotifier&&window.curNotifier.is_server||r.browser.safari}function p(e,t,i){d.onLp(e,t,i),f()&&h()&&(e!=t||i.length)&&function(e,t,i){window.Notifier.lcSend("lp_data",{tsOld:e,tsNow:t,evs:i}),(0,a.lpLogFc)("silver","broadcast to others",e,t,i)}(e,t,i)}function b(){return u()?(d||(window.vk.lpConfig.url&&0!==window.vk.lpConfig.enabled||(window.vk.lpConfig.stopped=!0),window.vk.lpConfig.id=window.vk.id,window.lpConnect=l=(0,_.createLongpoll)(window.vk.lpConfig,p),e=new(c()),t=(0,o.createLongpollEventsQueue)(window.vk.lpConfig.ts,(function(t){(0,a.longpollTestingOnFcEvents)(t),e.trigger("data",t)}),g),window.lpInstance=d={onData:function(t){e.on("data",t)},offData:function(t){e.off("data",t)},pause:function(){t.pause()},resume:function(){t.resume()},push:function(t){e.trigger("data",t)},abortWaiting:function(){l.abortWaiting()},onLp:function(e,i,_){t.onLp(e,i,_)},isEnabled:function(){return l&&!l.isStopped()}}),d):null;var e,t}function E(){var e,t;u()&&((0,a.lpLogFc)("orange","init longpoll connection on load"),b(),null===(t=null===(e=window.curNotifier)||void 0===e?void 0:e.idle_manager)||void 0===t||t.on("unidle",(function(){l.abortWaiting()})),C())}function C(){u()&&(f()?l.isStopped()&&h()?((0,a.lpLogFc)("orange","now master, init connection"),l.reinitConnection()):l.isStopped()||h()||((0,a.lpLogFc)("orange","now slave, stop connection"),l.stopConnection()):setTimeout(C,500))}function m(e){f()&&!h()&&u()&&((0,a.lpLogFc)("silver","recv from master",e.tsOld,e.tsNow,e.evs),l.onLp(e.tsOld,e.tsNow,e.evs))}function g(e){var t=(0,n.extend)({},window.lpConnect.options,{ts:e});return(0,a.lpLogFc)("orange","createLongpoll to load from",e),new Promise((function(e){var i=(0,_.createLongpoll)(t,(function(t,_,o){(0,a.lpLogFc)("orange","Loaded ["+t+","+_+")"),i.stopConnection(),e([t,_,o])}))}))}},16850:(e,t,i)=>{function _(e){var t,i;if(null!==(i=t=e)&&"object"==typeof i&&("queue"in t||"key"in t&&"string"==typeof t.key))return e.queue||e.key}i.d(t,{subscriptionObjectStableId:()=>_})}},__webpack_module_cache__={},deferred,leafPrototypes,getProto,inProgress,loadStylesheet,installedCssChunks;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(i.exports,i,i.exports,__webpack_require__),i.loaded=!0,i.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(e,t,i,_)=>{if(!t){var o=1/0;for(s=0;s<deferred.length;s++){for(var[t,i,_]=deferred[s],a=!0,r=0;r<t.length;r++)(!1&_||o>=_)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](t[r])))?t.splice(r--,1):(a=!1,_<o&&(o=_));if(a){deferred.splice(s--,1);var n=i();void 0!==n&&(e=n)}}return e}_=_||0;for(var s=deferred.length;s>0&&deferred[s-1][2]>_;s--)deferred[s]=deferred[s-1];deferred[s]=[t,i,_]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var i=Object.create(null);__webpack_require__.r(i);var _={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var o=2&t&&e;"object"==typeof o&&!~leafPrototypes.indexOf(o);o=getProto(o))Object.getOwnPropertyNames(o).forEach((t=>_[t]=()=>e[t]));return _.default=()=>e,__webpack_require__.d(i,_),i},__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,i)=>(__webpack_require__.f[i](e,t),t)),[])),__webpack_require__.u=e=>38288===e?"lottie.7d914fa3404556039ac3.js":17816===e?"77116999564e687dda317dd30e742de2.bb59d71a241557ee899c.js":79542===e?"11c7a0efa74f6d488cf4ce0ffbe4d05a.2ccf47039eebdc323cdd.js":23299===e?"3bad6e117063d3681bf4f60574b483cc.ba0f7f8a93f4ac86ae04.js":8719===e?"c565bd4c03935309f8a94999b93eb4f2.e584a1885cab8923bfc9.js":85780===e?"fastchat_reforged_v150.809324fa6d0ce91ff939.js":void 0,__webpack_require__.miniCssF=e=>8719===e?"c565bd4c03935309f8a94999b93eb4f2.6199c8e0f5f49ae735ec.css":e+".4eaa50e945e615b374b3.css",__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),inProgress={},__webpack_require__.l=(e,t,i,_)=>{if(inProgress[e])inProgress[e].push(t);else{var o,a;if(void 0!==i)for(var r=document.getElementsByTagName("script"),n=0;n<r.length;n++){var s=r[n];if(s.getAttribute("src")==e||s.getAttribute("data-webpack")=="vk:"+i){o=s;break}}o||(a=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,__webpack_require__.nc&&o.setAttribute("nonce",__webpack_require__.nc),o.setAttribute("data-webpack","vk:"+i),o.src=e),inProgress[e]=[t];var c=(t,i)=>{o.onerror=o.onload=null,clearTimeout(l);var _=inProgress[e];if(delete inProgress[e],o.parentNode&&o.parentNode.removeChild(o),_&&_.forEach((e=>e(i))),t)return t(i)},l=setTimeout(c.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=c.bind(null,o.onerror),o.onload=c.bind(null,o.onload),a&&document.head.appendChild(o)}},__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.p="/dist/",loadStylesheet=e=>new Promise(((t,i)=>{var _=__webpack_require__.miniCssF(e),o=__webpack_require__.p+_;if(((e,t)=>{for(var i=document.getElementsByTagName("link"),_=0;_<i.length;_++){var o=(r=i[_]).getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(o===e||o===t))return r}var a=document.getElementsByTagName("style");for(_=0;_<a.length;_++){var r;if((o=(r=a[_]).getAttribute("data-href"))===e||o===t)return r}})(_,o))return t();((e,t,i,_)=>{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.onerror=o.onload=a=>{if(o.onerror=o.onload=null,"load"===a.type)i();else{var r=a&&("load"===a.type?"missing":a.type),n=a&&a.target&&a.target.href||t,s=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");s.code="CSS_CHUNK_LOAD_FAILED",s.type=r,s.request=n,o.parentNode.removeChild(o),_(s)}},o.href=t,document.head.appendChild(o)})(e,o,t,i)})),installedCssChunks={90675:0},__webpack_require__.f.miniCss=(e,t)=>{installedCssChunks[e]?t.push(installedCssChunks[e]):0!==installedCssChunks[e]&&{8719:1,85780:1}[e]&&t.push(installedCssChunks[e]=loadStylesheet(e).then((()=>{installedCssChunks[e]=0}),(t=>{throw delete installedCssChunks[e],t})))},(()=>{var e={90675:0};__webpack_require__.f.j=(t,i)=>{var _=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==_)if(_)i.push(_[2]);else{var o=new Promise(((i,o)=>_=e[t]=[i,o]));i.push(_[2]=o);var a=__webpack_require__.p+__webpack_require__.u(t),r=new Error;__webpack_require__.l(a,(i=>{if(__webpack_require__.o(e,t)&&(0!==(_=e[t])&&(e[t]=void 0),_)){var o=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;r.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",r.name="ChunkLoadError",r.type=o,r.request=a,_[1](r)}}),"chunk-"+t,t)}},__webpack_require__.O.j=t=>0===e[t];var t=(t,i)=>{var _,o,[a,r,n]=i,s=0;for(_ in r)__webpack_require__.o(r,_)&&(__webpack_require__.m[_]=r[_]);if(n)var c=n(__webpack_require__);for(t&&t(i);s<a.length;s++)o=a[s],__webpack_require__.o(e,o)&&e[o]&&e[o][0](),e[a[s]]=0;return __webpack_require__.O(c)},i=self.webpackChunkvk=self.webpackChunkvk||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var __webpack_exports__=__webpack_require__.O(void 0,[11216,24509,40885,68592,76032,21654],(()=>__webpack_require__(63524)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();